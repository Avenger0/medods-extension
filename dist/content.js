(function(){"use strict";var We=document.createElement("style");We.textContent=`.scheme-item.svelte-6vrfgr{background-color:var(--item-bg-color, #f8f9fa);border:1px solid var(--item-border-color, #e9ecef);border-radius:4px;padding:12px;margin-bottom:10px;transition:background-color .2s ease,transform .1s ease}.scheme-item.svelte-6vrfgr:hover{background-color:var(--item-hover-color, #e9ecef);transform:translateY(-1px);box-shadow:0 2px 4px #0000000d}.scheme-title.svelte-6vrfgr{color:var(--title-color, #333)}.medication-details.svelte-6vrfgr{color:var(--details-color, #6c757d);font-size:.9em;margin-top:5px}.diluent-info.svelte-6vrfgr{font-style:italic}.scheme-actions.svelte-6vrfgr{display:flex;gap:8px;margin-top:10px}.btn-use-scheme.svelte-6vrfgr,.btn-edit-scheme.svelte-6vrfgr{padding:6px 10px;font-size:13px;border:none;border-radius:4px;cursor:pointer;transition:opacity .2s ease}.btn-use-scheme.svelte-6vrfgr{background-color:var(--use-btn-bg, #007bff);color:var(--use-btn-text, #fff)}.btn-edit-scheme.svelte-6vrfgr{background-color:var(--edit-btn-bg, #6c757d);color:var(--edit-btn-text, #fff)}.btn-use-scheme.svelte-6vrfgr:hover,.btn-edit-scheme.svelte-6vrfgr:hover{opacity:.9}.existing-schemes.svelte-5qbczz{margin-top:20px;background-color:var(--bg-color, #f8f9fa);border-radius:6px;padding:15px;border:1px solid var(--border-color, #e9ecef)}h2.svelte-5qbczz{margin-top:0;color:var(--title-color, #333);font-size:1.2rem;margin-bottom:15px;border-bottom:1px solid var(--border-color, #e9ecef);padding-bottom:10px}.schemes-list.svelte-5qbczz{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-height:500px;overflow-y:auto;padding-right:5px}.no-schemes.svelte-5qbczz{font-style:italic;color:#6c757d;text-align:center;padding:15px 0}.modal-overlay.svelte-1lbmm4i{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--overlay-color, rgba(0,0,0,.5));display:flex;justify-content:center;align-items:center;z-index:var(--z-index, 1000);overflow-y:auto}.modal-content.svelte-1lbmm4i{background:var(--bg-color, white);border-radius:var(--border-radius, 8px);max-width:var(--max-width, 1100px);max-height:var(--max-height, 80%);width:calc(100% - 40px);position:relative;padding:var(--padding, 20px);box-shadow:var(--box-shadow, 0 4px 6px rgba(0,0,0,.1));overflow-y:auto}.modal-close.svelte-1lbmm4i{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999;transition:color .2s ease;z-index:1}.modal-close.svelte-1lbmm4i:hover{color:#333}.form-control.svelte-17gdirg.svelte-17gdirg{width:100%;border:1px solid #ccc;border-radius:4px;font-size:14px}.administration-type.svelte-17gdirg.svelte-17gdirg,.diluent-choice.svelte-17gdirg.svelte-17gdirg{display:flex;gap:15px;margin-bottom:15px}.administration-type.svelte-17gdirg label.svelte-17gdirg,.diluent-choice.svelte-17gdirg label.svelte-17gdirg{display:flex;align-items:center;gap:5px}.diluents-container.svelte-17gdirg.svelte-17gdirg{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-17gdirg.svelte-17gdirg{display:flex;gap:8px;align-items:center;margin-bottom:10px}.diluent-select.svelte-17gdirg.svelte-17gdirg{flex:3}.diluent-dosage.svelte-17gdirg.svelte-17gdirg{flex:2}.btn-remove-diluent.svelte-17gdirg.svelte-17gdirg{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-17gdirg.svelte-17gdirg{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer;align-self:flex-start;margin-top:5px}.button-row.svelte-17gdirg.svelte-17gdirg{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}.btn-save.svelte-17gdirg.svelte-17gdirg,.btn-cancel.svelte-17gdirg.svelte-17gdirg{padding:8px 16px;border-radius:4px;cursor:pointer;border:none}.btn-save.svelte-17gdirg.svelte-17gdirg{background-color:#2196f3;color:#fff}.btn-save.svelte-17gdirg.svelte-17gdirg:disabled{opacity:.5;cursor:not-allowed}.btn-cancel.svelte-17gdirg.svelte-17gdirg{background-color:#f1f1f1;color:#333}.btn-add-new-scheme.svelte-651s9i{background-color:var(--btn-bg-color, #28a745);color:var(--btn-text-color, #fff);border:none;padding:12px 16px;border-radius:var(--btn-border-radius, 4px);cursor:pointer;width:100%;max-width:300px;font-weight:500;transition:background-color .2s ease,transform .1s ease;box-shadow:0 2px 4px #0000001a;margin:auto;font-size:18px}.btn-add-new-scheme.svelte-651s9i:hover{background-color:var(--btn-hover-color, #218838);transform:translateY(-1px);box-shadow:0 3px 6px #00000026}.btn-add-new-scheme.svelte-651s9i:active{transform:translateY(1px);box-shadow:0 1px 2px #0000001a}h3.svelte-l6krs5.svelte-l6krs5{font-size:21px;margin:0 0 15px;padding:0}.empty.svelte-l6krs5.svelte-l6krs5{text-align:center}.treatment-scheme-button.svelte-l6krs5.svelte-l6krs5{background-color:var(--bg-color, #007bff);color:var(--text-color, white);border:none;padding:8px 12px;border-radius:var(--border-radius, 4px);cursor:pointer;transition:opacity .2s ease}.treatment-scheme-button.svelte-l6krs5.svelte-l6krs5:hover{opacity:.9}.modal-grid.svelte-l6krs5.svelte-l6krs5{display:grid;gap:20px}.medication-form-column.svelte-l6krs5.svelte-l6krs5,.schedule-column.svelte-l6krs5.svelte-l6krs5{display:flex;flex-direction:column;gap:10px}.schedule-table.svelte-l6krs5.svelte-l6krs5{border:1px solid #ddd}.schedule-header.svelte-l6krs5.svelte-l6krs5{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-l6krs5.svelte-l6krs5,.medication-column.svelte-l6krs5.svelte-l6krs5{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-l6krs5.svelte-l6krs5{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-l6krs5.svelte-l6krs5{display:flex;justify-content:space-between;padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-l6krs5.svelte-l6krs5{border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-l6krs5.svelte-l6krs5:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-l6krs5.svelte-l6krs5{background-color:#007bff}.error-highlight.svelte-l6krs5 .medication-cell.svelte-l6krs5{background-color:#fff4f4;border-left:3px solid #dc3545}.validation-error.svelte-l6krs5.svelte-l6krs5{background-color:#fff3cd;color:#856404;padding:10px;margin-bottom:15px;border-radius:4px;border-left:4px solid #ffc107;font-size:14px}.medication-actions.svelte-l6krs5.svelte-l6krs5{margin-top:5px;display:flex;gap:5px}.btn-edit-medication.svelte-l6krs5.svelte-l6krs5,.btn-delete-medication.svelte-l6krs5.svelte-l6krs5{padding:2px 5px;font-size:12px;border:none;border-radius:3px;cursor:pointer;background-color:transparent}.btn-edit-medication.svelte-l6krs5.svelte-l6krs5:hover{background-color:#f0f0f0}.btn-delete-medication.svelte-l6krs5.svelte-l6krs5:hover{background-color:#fff5f5}.schedule-actions.svelte-l6krs5.svelte-l6krs5{display:flex;justify-content:space-between;margin-top:10px}.btn-continue.svelte-l6krs5.svelte-l6krs5{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:18px}.btn-continue.svelte-l6krs5.svelte-l6krs5:disabled{opacity:.5;cursor:not-allowed}.btn-add-medication.svelte-l6krs5.svelte-l6krs5{background-color:#4caf50;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:18px}.spinner.svelte-l6krs5.svelte-l6krs5{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-l6krs5-spin 1s ease-in-out infinite;margin-right:8px}@keyframes svelte-l6krs5-spin{to{transform:rotate(360deg)}}
`,document.head.appendChild(We);function Et(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function l(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(o=>{const i=history[o];history[o]=function(...n){i.apply(this,n),l()}}),window.addEventListener("popstate",l),t()}function te(){}function Rt(t,e){for(const l in e)t[l]=e[l];return t}function qe(t){return t()}function Ue(){return Object.create(null)}function le(t){t.forEach(qe)}function de(t){return typeof t=="function"}function he(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function zt(t){return Object.keys(t).length===0}function Mt(t,e,l,o){if(t){const i=Ye(t,e,l,o);return t[0](i)}}function Ye(t,e,l,o){return t[1]&&o?Rt(l.ctx.slice(),t[1](o(e))):l.ctx}function Ot(t,e,l,o){if(t[2]&&o){const i=t[2](o(l));if(e.dirty===void 0)return i;if(typeof i=="object"){const n=[],s=Math.max(e.dirty.length,i.length);for(let r=0;r<s;r+=1)n[r]=e.dirty[r]|i[r];return n}return e.dirty|i}return e.dirty}function Dt(t,e,l,o,i,n){if(i){const s=Ye(e,l,o,n);t.p(s,i)}}function xt(t){if(t.ctx.length>32){const e=[],l=t.ctx.length/32;for(let o=0;o<l;o++)e[o]=-1;return e}return-1}function m(t,e){t.appendChild(e)}function S(t,e,l){t.insertBefore(e,l||null)}function T(t){t.parentNode&&t.parentNode.removeChild(t)}function ye(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function b(t){return document.createElement(t)}function D(t){return document.createTextNode(t)}function O(){return D(" ")}function we(){return D("")}function A(t,e,l,o){return t.addEventListener(e,l,o),()=>t.removeEventListener(e,l,o)}function je(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function v(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Ve(t){let e;return{p(...l){e=l,e.forEach(o=>t.push(o))},r(){e.forEach(l=>t.splice(t.indexOf(l),1))}}}function Ht(t){return Array.from(t.childNodes)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function Re(t,e){t.value=e??""}function B(t,e,l,o){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,o?"important":"")}function ze(t,e,l){for(let o=0;o<t.options.length;o+=1){const i=t.options[o];if(i.__value===e){i.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Ge(t){const e=t.querySelector(":checked");return e&&e.__value}function Je(t,e,l){t.classList[l?"add":"remove"](e)}let Fe;function Te(t){Fe=t}function jt(t,e){const l=t.$$.callbacks[e.type];l&&l.slice().forEach(o=>o.call(this,e))}const _e=[],Ke=[];let be=[];const Qe=[],Ft=Promise.resolve();let Pe=!1;function Pt(){Pe||(Pe=!0,Ft.then(Xe))}function Se(t){be.push(t)}const Le=new Set;let ve=0;function Xe(){if(ve!==0)return;const t=Fe;do{try{for(;ve<_e.length;){const e=_e[ve];ve++,Te(e),Lt(e.$$)}}catch(e){throw _e.length=0,ve=0,e}for(Te(null),_e.length=0,ve=0;Ke.length;)Ke.pop()();for(let e=0;e<be.length;e+=1){const l=be[e];Le.has(l)||(Le.add(l),l())}be.length=0}while(_e.length);for(;Qe.length;)Qe.pop()();Pe=!1,Le.clear(),Te(t)}function Lt(t){if(t.fragment!==null){t.update(),le(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Se)}}function Nt(t){const e=[],l=[];be.forEach(o=>t.indexOf(o)===-1?e.push(o):l.push(o)),l.forEach(o=>o()),be=e}const Me=new Set;let fe;function Oe(){fe={r:0,c:[],p:fe}}function De(){fe.r||le(fe.c),fe=fe.p}function V(t,e){t&&t.i&&(Me.delete(t),t.i(e))}function Z(t,e,l,o){if(t&&t.o){if(Me.has(t))return;Me.add(t),fe.c.push(()=>{Me.delete(t),o&&(l&&t.d(1),o())}),t.o(e)}else o&&o()}function Ze(t,e){t.d(1),e.delete(t.key)}function At(t,e){Z(t,1,1,()=>{e.delete(t.key)})}function Ne(t,e,l,o,i,n,s,r,c,a,d,u){let g=t.length,h=n.length,y=g;const _={};for(;y--;)_[t[y].key]=y;const w=[],k=new Map,I=new Map,W=[];for(y=h;y--;){const p=u(i,n,y),M=l(p);let C=s.get(M);C?o&&W.push(()=>C.p(p,e)):(C=a(M,p),C.c()),k.set(M,w[y]=C),M in _&&I.set(M,Math.abs(y-_[M]))}const G=new Set,P=new Set;function H(p){V(p,1),p.m(r,d),s.set(p.key,p),d=p.first,h--}for(;g&&h;){const p=w[h-1],M=t[g-1],C=p.key,j=M.key;p===M?(d=p.first,g--,h--):k.has(j)?!s.has(C)||G.has(C)?H(p):P.has(j)?g--:I.get(C)>I.get(j)?(P.add(C),H(p)):(G.add(j),g--):(c(M,s),g--)}for(;g--;){const p=t[g];k.has(p.key)||c(p,s)}for(;h;)H(w[h-1]);return le(W),w}function ke(t){t&&t.c()}function me(t,e,l,o){const{fragment:i,after_update:n}=t.$$;i&&i.m(e,l),o||Se(()=>{const s=t.$$.on_mount.map(qe).filter(de);t.$$.on_destroy?t.$$.on_destroy.push(...s):le(s),t.$$.on_mount=[]}),n.forEach(Se)}function ge(t,e){const l=t.$$;l.fragment!==null&&(Nt(l.after_update),le(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function Wt(t,e){t.$$.dirty[0]===-1&&(_e.push(t),Pt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,l,o,i,n,s,r=[-1]){const c=Fe;Te(t);const a=t.$$={fragment:null,ctx:[],props:n,update:te,not_equal:i,bound:Ue(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Ue(),dirty:r,skip_bound:!1,root:e.target||c.$$.root};s&&s(a.root);let d=!1;if(a.ctx=l?l(t,e.props||{},(u,g,...h)=>{const y=h.length?h[0]:g;return a.ctx&&i(a.ctx[u],a.ctx[u]=y)&&(!a.skip_bound&&a.bound[u]&&a.bound[u](y),d&&Wt(t,u)),g}):[],a.update(),d=!0,le(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){const u=Ht(e.target);a.fragment&&a.fragment.l(u),u.forEach(T)}else a.fragment&&a.fragment.c();e.intro&&V(t.$$.fragment),me(t,e.target,e.anchor,e.customElement),Xe()}Te(c)}class pe{$destroy(){ge(this,1),this.$destroy=te}$on(e,l){if(!de(l))return te;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(l),()=>{const i=o.indexOf(l);i!==-1&&o.splice(i,1)}}$set(e){this.$$set&&!zt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const zl="";function $e(t,e,l){const o=t.slice();return o[12]=e[l],o}function et(t){let e,l,o=t[12].diluents.map(lt).join(", ")+"",i;return{c(){e=b("span"),l=D("+ "),i=D(o),v(e,"class","diluent-info svelte-6vrfgr")},m(n,s){S(n,e,s),m(e,l),m(e,i)},p(n,s){s&1&&o!==(o=n[12].diluents.map(lt).join(", ")+"")&&$(i,o)},d(n){n&&T(e)}}}function tt(t){let e,l=t[12].name+"",o,i,n=t[12].dosage+"",s,r,c=t[12].administrationType+"",a,d,u,g=t[12].diluents&&t[12].diluents.length>0&&et(t);return{c(){e=b("div"),o=D(l),i=D(", "),s=D(n),r=D(" ("),a=D(c),d=D(`)\r
        `),g&&g.c(),u=O(),v(e,"class","medication-details svelte-6vrfgr")},m(h,y){S(h,e,y),m(e,o),m(e,i),m(e,s),m(e,r),m(e,a),m(e,d),g&&g.m(e,null),m(e,u)},p(h,y){y&1&&l!==(l=h[12].name+"")&&$(o,l),y&1&&n!==(n=h[12].dosage+"")&&$(s,n),y&1&&c!==(c=h[12].administrationType+"")&&$(a,c),h[12].diluents&&h[12].diluents.length>0?g?g.p(h,y):(g=et(h),g.c(),g.m(e,u)):g&&(g.d(1),g=null)},d(h){h&&T(e),g&&g.d()}}}function qt(t){let e,l,o,i=t[0].name+"",n,s,r,c,a,d,u,g,h,y=t[0].medications,_=[];for(let w=0;w<y.length;w+=1)_[w]=tt($e(t,y,w));return{c(){e=b("div"),l=b("div"),o=b("strong"),n=D(i),s=O();for(let w=0;w<_.length;w+=1)_[w].c();r=O(),c=b("div"),a=b("button"),a.textContent="Использовать",d=O(),u=b("button"),u.textContent="Редактировать",v(l,"class","scheme-title svelte-6vrfgr"),v(a,"class","btn-use-scheme svelte-6vrfgr"),v(u,"class","btn-edit-scheme svelte-6vrfgr"),v(c,"class","scheme-actions svelte-6vrfgr"),v(e,"class","scheme-item svelte-6vrfgr"),B(e,"--item-bg-color",t[3]),B(e,"--item-hover-color",t[4]),B(e,"--item-border-color",t[5]),B(e,"--title-color",t[6]),B(e,"--details-color",t[7]),B(e,"--use-btn-bg",t[8]),B(e,"--use-btn-text",t[9]),B(e,"--edit-btn-bg",t[10]),B(e,"--edit-btn-text",t[11])},m(w,k){S(w,e,k),m(e,l),m(l,o),m(o,n),m(l,s);for(let I=0;I<_.length;I+=1)_[I]&&_[I].m(l,null);m(e,r),m(e,c),m(c,a),m(c,d),m(c,u),g||(h=[A(a,"click",je(function(){de(t[1])&&t[1].apply(this,arguments)})),A(u,"click",je(function(){de(t[2])&&t[2].apply(this,arguments)}))],g=!0)},p(w,[k]){if(t=w,k&1&&i!==(i=t[0].name+"")&&$(n,i),k&1){y=t[0].medications;let I;for(I=0;I<y.length;I+=1){const W=$e(t,y,I);_[I]?_[I].p(W,k):(_[I]=tt(W),_[I].c(),_[I].m(l,null))}for(;I<_.length;I+=1)_[I].d(1);_.length=y.length}k&8&&B(e,"--item-bg-color",t[3]),k&16&&B(e,"--item-hover-color",t[4]),k&32&&B(e,"--item-border-color",t[5]),k&64&&B(e,"--title-color",t[6]),k&128&&B(e,"--details-color",t[7]),k&256&&B(e,"--use-btn-bg",t[8]),k&512&&B(e,"--use-btn-text",t[9]),k&1024&&B(e,"--edit-btn-bg",t[10]),k&2048&&B(e,"--edit-btn-text",t[11])},i:te,o:te,d(w){w&&T(e),ye(_,w),g=!1,le(h)}}}const lt=t=>`${t.type} (${t.dosage})`;function Ut(t,e,l){let{scheme:o={}}=e,{onSelect:i}=e,{onEdit:n}=e,{itemBgColor:s="#f8f9fa"}=e,{itemHoverColor:r="#e9ecef"}=e,{itemBorderColor:c="#e9ecef"}=e,{titleColor:a="#333"}=e,{detailsColor:d="#6c757d"}=e,{useButtonBgColor:u="#007bff"}=e,{useButtonTextColor:g="#fff"}=e,{editButtonBgColor:h="#6c757d"}=e,{editButtonTextColor:y="#fff"}=e;return t.$$set=_=>{"scheme"in _&&l(0,o=_.scheme),"onSelect"in _&&l(1,i=_.onSelect),"onEdit"in _&&l(2,n=_.onEdit),"itemBgColor"in _&&l(3,s=_.itemBgColor),"itemHoverColor"in _&&l(4,r=_.itemHoverColor),"itemBorderColor"in _&&l(5,c=_.itemBorderColor),"titleColor"in _&&l(6,a=_.titleColor),"detailsColor"in _&&l(7,d=_.detailsColor),"useButtonBgColor"in _&&l(8,u=_.useButtonBgColor),"useButtonTextColor"in _&&l(9,g=_.useButtonTextColor),"editButtonBgColor"in _&&l(10,h=_.editButtonBgColor),"editButtonTextColor"in _&&l(11,y=_.editButtonTextColor)},[o,i,n,s,r,c,a,d,u,g,h,y]}class Yt extends pe{constructor(e){super(),Ce(this,e,Ut,qt,he,{scheme:0,onSelect:1,onEdit:2,itemBgColor:3,itemHoverColor:4,itemBorderColor:5,titleColor:6,detailsColor:7,useButtonBgColor:8,useButtonTextColor:9,editButtonBgColor:10,editButtonTextColor:11})}}const Ml="";function ot(t,e,l){const o=t.slice();return o[8]=e[l],o}function Vt(t){let e;return{c(){e=b("p"),e.textContent="Нет существующих схем",v(e,"class","no-schemes svelte-5qbczz")},m(l,o){S(l,e,o)},p:te,i:te,o:te,d(l){l&&T(e)}}}function Gt(t){let e,l=[],o=new Map,i,n=t[0];const s=r=>r[8].id;for(let r=0;r<n.length;r+=1){let c=ot(t,n,r),a=s(c);o.set(a,l[r]=nt(a,c))}return{c(){e=b("div");for(let r=0;r<l.length;r+=1)l[r].c();v(e,"class","schemes-list svelte-5qbczz")},m(r,c){S(r,e,c);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null);i=!0},p(r,c){c&7&&(n=r[0],Oe(),l=Ne(l,c,s,1,r,n,o,e,At,nt,null,ot),De())},i(r){if(!i){for(let c=0;c<n.length;c+=1)V(l[c]);i=!0}},o(r){for(let c=0;c<l.length;c+=1)Z(l[c]);i=!1},d(r){r&&T(e);for(let c=0;c<l.length;c+=1)l[c].d()}}}function nt(t,e){let l,o,i;function n(){return e[6](e[8])}function s(){return e[7](e[8])}return o=new Yt({props:{scheme:e[8],onSelect:n,onEdit:s}}),{key:t,first:null,c(){l=we(),ke(o.$$.fragment),this.first=l},m(r,c){S(r,l,c),me(o,r,c),i=!0},p(r,c){e=r;const a={};c&1&&(a.scheme=e[8]),c&3&&(a.onSelect=n),c&5&&(a.onEdit=s),o.$set(a)},i(r){i||(V(o.$$.fragment,r),i=!0)},o(r){Z(o.$$.fragment,r),i=!1},d(r){r&&T(l),ge(o,r)}}}function Jt(t){let e,l,o,i,n,s;const r=[Gt,Vt],c=[];function a(d,u){return d[0].length?0:1}return i=a(t),n=c[i]=r[i](t),{c(){e=b("div"),l=b("h2"),l.textContent="Существующие схемы лечения",o=O(),n.c(),v(l,"class","svelte-5qbczz"),v(e,"class","existing-schemes svelte-5qbczz"),B(e,"--bg-color",t[3]),B(e,"--title-color",t[4]),B(e,"--border-color",t[5])},m(d,u){S(d,e,u),m(e,l),m(e,o),c[i].m(e,null),s=!0},p(d,[u]){let g=i;i=a(d),i===g?c[i].p(d,u):(Oe(),Z(c[g],1,1,()=>{c[g]=null}),De(),n=c[i],n?n.p(d,u):(n=c[i]=r[i](d),n.c()),V(n,1),n.m(e,null)),(!s||u&8)&&B(e,"--bg-color",d[3]),(!s||u&16)&&B(e,"--title-color",d[4]),(!s||u&32)&&B(e,"--border-color",d[5])},i(d){s||(V(n),s=!0)},o(d){Z(n),s=!1},d(d){d&&T(e),c[i].d()}}}function Kt(t,e,l){let{schemes:o=[]}=e,{onSelect:i}=e,{onEdit:n}=e,{bgColor:s="#f8f9fa"}=e,{titleColor:r="#333"}=e,{borderColor:c="#e9ecef"}=e;const a=u=>i(u),d=u=>n(u);return t.$$set=u=>{"schemes"in u&&l(0,o=u.schemes),"onSelect"in u&&l(1,i=u.onSelect),"onEdit"in u&&l(2,n=u.onEdit),"bgColor"in u&&l(3,s=u.bgColor),"titleColor"in u&&l(4,r=u.titleColor),"borderColor"in u&&l(5,c=u.borderColor)},[o,i,n,s,r,c,a,d]}class Qt extends pe{constructor(e){super(),Ce(this,e,Kt,Jt,he,{schemes:0,onSelect:1,onEdit:2,bgColor:3,titleColor:4,borderColor:5})}}const Ol="";function it(t){let e,l,o,i,n,s,r;const c=t[12].default,a=Mt(c,t,t[11],null);return{c(){e=b("div"),l=b("div"),o=b("button"),o.textContent="✖",i=O(),a&&a.c(),v(o,"class","modal-close svelte-1lbmm4i"),v(l,"class","modal-content svelte-1lbmm4i"),B(l,"--max-width",t[2]),B(l,"--max-height",t[3]),B(l,"--bg-color",t[4]),B(l,"--border-radius",t[5]),B(l,"--padding",t[6]),B(l,"--box-shadow",t[7]),v(e,"class","modal-overlay svelte-1lbmm4i"),B(e,"--overlay-color",t[9]),B(e,"--z-index",t[8])},m(d,u){S(d,e,u),m(e,l),m(l,o),m(l,i),a&&a.m(l,null),n=!0,s||(r=[A(o,"click",function(){de(t[1])&&t[1].apply(this,arguments)}),A(l,"click",je(t[13])),A(e,"mousedown",t[10])],s=!0)},p(d,u){t=d,a&&a.p&&(!n||u&2048)&&Dt(a,c,t,t[11],n?Ot(c,t[11],u,null):xt(t[11]),null),(!n||u&4)&&B(l,"--max-width",t[2]),(!n||u&8)&&B(l,"--max-height",t[3]),(!n||u&16)&&B(l,"--bg-color",t[4]),(!n||u&32)&&B(l,"--border-radius",t[5]),(!n||u&64)&&B(l,"--padding",t[6]),(!n||u&128)&&B(l,"--box-shadow",t[7]),(!n||u&512)&&B(e,"--overlay-color",t[9]),(!n||u&256)&&B(e,"--z-index",t[8])},i(d){n||(V(a,d),n=!0)},o(d){Z(a,d),n=!1},d(d){d&&T(e),a&&a.d(d),s=!1,le(r)}}}function Xt(t){let e,l,o=t[0]&&it(t);return{c(){o&&o.c(),e=we()},m(i,n){o&&o.m(i,n),S(i,e,n),l=!0},p(i,[n]){i[0]?o?(o.p(i,n),n&1&&V(o,1)):(o=it(i),o.c(),V(o,1),o.m(e.parentNode,e)):o&&(Oe(),Z(o,1,1,()=>{o=null}),De())},i(i){l||(V(o),l=!0)},o(i){Z(o),l=!1},d(i){o&&o.d(i),i&&T(e)}}}function Zt(t,e,l){let{$$slots:o={},$$scope:i}=e,{isOpen:n=!1}=e,{onClose:s}=e,{maxWidth:r="1100px"}=e,{maxHeight:c="80%"}=e,{backgroundColor:a="white"}=e,{borderRadius:d="8px"}=e,{padding:u="20px"}=e,{boxShadow:g="0 4px 6px rgba(0,0,0,0.1)"}=e,{zIndex:h=1e3}=e,{overlayColor:y="rgba(0,0,0,0.5)"}=e;function _(k){k.target.classList.contains("modal-overlay")&&s()}function w(k){jt.call(this,t,k)}return t.$$set=k=>{"isOpen"in k&&l(0,n=k.isOpen),"onClose"in k&&l(1,s=k.onClose),"maxWidth"in k&&l(2,r=k.maxWidth),"maxHeight"in k&&l(3,c=k.maxHeight),"backgroundColor"in k&&l(4,a=k.backgroundColor),"borderRadius"in k&&l(5,d=k.borderRadius),"padding"in k&&l(6,u=k.padding),"boxShadow"in k&&l(7,g=k.boxShadow),"zIndex"in k&&l(8,h=k.zIndex),"overlayColor"in k&&l(9,y=k.overlayColor),"$$scope"in k&&l(11,i=k.$$scope)},[n,s,r,c,a,d,u,g,h,y,_,i,o,w]}class rt extends pe{constructor(e){super(),Ce(this,e,Zt,Xt,he,{isOpen:0,onClose:1,maxWidth:2,maxHeight:3,backgroundColor:4,borderRadius:5,padding:6,boxShadow:7,zIndex:8,overlayColor:9})}}const Dl="";function st(t,e,l){const o=t.slice();return o[20]=e[l],o[21]=e,o[22]=l,o}function ct(t,e,l){const o=t.slice();return o[23]=e[l],o}function ut(t){let e,l=t[23].name+"",o,i;return{c(){e=b("option"),o=D(l),e.__value=i=t[23],e.value=e.__value},m(n,s){S(n,e,s),m(e,o)},p(n,s){s&8&&l!==(l=n[23].name+"")&&$(o,l),s&8&&i!==(i=n[23])&&(e.__value=i,e.value=e.__value)},d(n){n&&T(e)}}}function at(t){let e,l=[],o=new Map,i,n,s,r,c=t[0].diluents;const a=d=>d[20].id;for(let d=0;d<c.length;d+=1){let u=st(t,c,d),g=a(u);o.set(g,l[d]=dt(g,u))}return{c(){e=b("div");for(let d=0;d<l.length;d+=1)l[d].c();i=O(),n=b("button"),n.textContent="+ Добавить растворитель",v(n,"class","btn-add-diluent svelte-17gdirg"),v(e,"class","diluents-container svelte-17gdirg")},m(d,u){S(d,e,u);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(e,null);m(e,i),m(e,n),s||(r=A(n,"click",t[6]),s=!0)},p(d,u){u&129&&(c=d[0].diluents,l=Ne(l,u,a,1,d,c,o,e,Ze,dt,i,st))},d(d){d&&T(e);for(let u=0;u<l.length;u+=1)l[u].d();s=!1,r()}}}function dt(t,e){let l,o,i,n,s,r,c,a,d,u;function g(){e[17].call(o,e[21],e[22])}function h(){e[18].call(r,e[21],e[22])}function y(){return e[19](e[20])}return{key:t,first:null,c(){l=b("div"),o=b("select"),i=b("option"),i.textContent="Глюкоза",n=b("option"),n.textContent="Физраствор",s=O(),r=b("input"),c=O(),a=b("button"),a.textContent="✖",i.__value="глюкоза",i.value=i.__value,n.__value="физраствор",n.value=n.__value,v(o,"class","form-control diluent-select svelte-17gdirg"),e[20].type===void 0&&Se(g),v(r,"type","text"),v(r,"placeholder","Дозировка"),v(r,"class","form-control diluent-dosage svelte-17gdirg"),v(a,"class","btn-remove-diluent svelte-17gdirg"),v(l,"class","diluent-row svelte-17gdirg"),this.first=l},m(_,w){S(_,l,w),m(l,o),m(o,i),m(o,n),ze(o,e[20].type,!0),m(l,s),m(l,r),Re(r,e[20].dosage),m(l,c),m(l,a),d||(u=[A(o,"change",g),A(r,"input",h),A(a,"click",y)],d=!0)},p(_,w){e=_,w&9&&ze(o,e[20].type),w&9&&r.value!==e[20].dosage&&Re(r,e[20].dosage)},d(_){_&&T(l),d=!1,le(u)}}}function $t(t){let e,l=t[4]?"Редактирование препарата":"Добавление препарата",o,i,n,s,r,c,a,d,u,g,h,y,_,w,k,I,W,G,P,H,p,M,C,j,oe,se,q,L,U,N,J,ce=t[4]?"Сохранить изменения":"Добавить препарат",ae,ne,re,K,x,Be,ue=t[3],Q=[];for(let R=0;R<ue.length;R+=1)Q[R]=ut(ct(t,ue,R));let X=t[0].hasDiluent==="да"&&at(t);return re=Ve(t[12][0]),K=Ve(t[12][1]),{c(){e=b("h2"),o=D(l),i=O(),n=b("select");for(let R=0;R<Q.length;R+=1)Q[R].c();s=O(),r=b("div"),c=b("label"),a=b("input"),d=D(` \r
            Внутримышечно`),u=O(),g=b("label"),h=b("input"),y=D(` \r
            Внутривенно`),_=O(),w=b("input"),k=O(),I=b("div"),W=b("label"),W.textContent="Использовать растворитель:",G=O(),P=b("label"),H=b("input"),p=D(` \r
            Нет`),M=O(),C=b("label"),j=b("input"),oe=D(` \r
            Да`),se=O(),X&&X.c(),q=O(),L=b("div"),U=b("button"),U.textContent="Отмена",N=O(),J=b("button"),ae=D(ce),v(n,"class","form-control svelte-17gdirg"),t[0].medication===void 0&&Se(()=>t[10].call(n)),v(a,"type","radio"),a.__value="в/м",a.value=a.__value,v(c,"class","svelte-17gdirg"),v(h,"type","radio"),h.__value="в/в",h.value=h.__value,v(g,"class","svelte-17gdirg"),v(r,"class","administration-type svelte-17gdirg"),v(w,"type","text"),v(w,"placeholder","Дозировка препарата"),v(w,"class","form-control svelte-17gdirg"),v(W,"class","svelte-17gdirg"),v(H,"type","radio"),H.__value="нет",H.value=H.__value,v(P,"class","svelte-17gdirg"),v(j,"type","radio"),j.__value="да",j.value=j.__value,v(C,"class","svelte-17gdirg"),v(I,"class","diluent-choice svelte-17gdirg"),v(U,"class","btn-cancel svelte-17gdirg"),v(J,"class","btn-save svelte-17gdirg"),J.disabled=ne=!t[5],v(L,"class","button-row svelte-17gdirg"),re.p(H,j),K.p(a,h)},m(R,F){S(R,e,F),m(e,o),S(R,i,F),S(R,n,F);for(let Y=0;Y<Q.length;Y+=1)Q[Y]&&Q[Y].m(n,null);ze(n,t[0].medication,!0),S(R,s,F),S(R,r,F),m(r,c),m(c,a),a.checked=a.__value===t[0].administrationType,m(c,d),m(r,u),m(r,g),m(g,h),h.checked=h.__value===t[0].administrationType,m(g,y),S(R,_,F),S(R,w,F),Re(w,t[0].dosage),S(R,k,F),S(R,I,F),m(I,W),m(I,G),m(I,P),m(P,H),H.checked=H.__value===t[0].hasDiluent,m(P,p),m(I,M),m(I,C),m(C,j),j.checked=j.__value===t[0].hasDiluent,m(C,oe),S(R,se,F),X&&X.m(R,F),S(R,q,F),S(R,L,F),m(L,U),m(L,N),m(L,J),m(J,ae),x||(Be=[A(n,"change",t[10]),A(a,"change",t[11]),A(h,"change",t[13]),A(w,"input",t[14]),A(H,"change",t[15]),A(j,"change",t[16]),A(U,"click",function(){de(t[2])&&t[2].apply(this,arguments)}),A(J,"click",t[8])],x=!0)},p(R,F){if(t=R,F&16&&l!==(l=t[4]?"Редактирование препарата":"Добавление препарата")&&$(o,l),F&8){ue=t[3];let Y;for(Y=0;Y<ue.length;Y+=1){const He=ct(t,ue,Y);Q[Y]?Q[Y].p(He,F):(Q[Y]=ut(He),Q[Y].c(),Q[Y].m(n,null))}for(;Y<Q.length;Y+=1)Q[Y].d(1);Q.length=ue.length}F&9&&ze(n,t[0].medication),F&9&&(a.checked=a.__value===t[0].administrationType),F&9&&(h.checked=h.__value===t[0].administrationType),F&9&&w.value!==t[0].dosage&&Re(w,t[0].dosage),F&9&&(H.checked=H.__value===t[0].hasDiluent),F&9&&(j.checked=j.__value===t[0].hasDiluent),t[0].hasDiluent==="да"?X?X.p(t,F):(X=at(t),X.c(),X.m(q.parentNode,q)):X&&(X.d(1),X=null),F&16&&ce!==(ce=t[4]?"Сохранить изменения":"Добавить препарат")&&$(ae,ce),F&32&&ne!==(ne=!t[5])&&(J.disabled=ne)},d(R){R&&T(e),R&&T(i),R&&T(n),ye(Q,R),R&&T(s),R&&T(r),R&&T(_),R&&T(w),R&&T(k),R&&T(I),R&&T(se),X&&X.d(R),R&&T(q),R&&T(L),re.r(),K.r(),x=!1,le(Be)}}}function el(t){let e,l;return e=new rt({props:{isOpen:t[1],onClose:t[2],maxWidth:"500px",$$slots:{default:[$t]},$$scope:{ctx:t}}}),{c(){ke(e.$$.fragment)},m(o,i){me(e,o,i),l=!0},p(o,[i]){const n={};i&2&&(n.isOpen=o[1]),i&4&&(n.onClose=o[2]),i&67108925&&(n.$$scope={dirty:i,ctx:o}),e.$set(n)},i(o){l||(V(e.$$.fragment,o),l=!0)},o(o){Z(e.$$.fragment,o),l=!1},d(o){ge(e,o)}}}function tl(t,e,l){let o,{isOpen:i=!1}=e,{onClose:n}=e,{medications:s=[]}=e,{medicationForm:r}=e,{isEditing:c=!1}=e,{onSave:a}=e;function d(){l(0,r.diluents=[...r.diluents,{id:Date.now(),type:"глюкоза",dosage:""}],r)}function u(p){l(0,r.diluents=r.diluents.filter(M=>M.id!==p),r)}function g(){if(o){const p={...r,diluents:r.diluents.map(M=>({...M}))};a(p)}}const h=[[],[]];function y(){r.medication=Ge(this),l(0,r),l(3,s)}function _(){r.administrationType=this.__value,l(0,r),l(3,s)}function w(){r.administrationType=this.__value,l(0,r),l(3,s)}function k(){r.dosage=this.value,l(0,r),l(3,s)}function I(){r.hasDiluent=this.__value,l(0,r),l(3,s)}function W(){r.hasDiluent=this.__value,l(0,r),l(3,s)}function G(p,M){p[M].type=Ge(this),l(0,r),l(3,s)}function P(p,M){p[M].dosage=this.value,l(0,r),l(3,s)}const H=p=>u(p.id);return t.$$set=p=>{"isOpen"in p&&l(1,i=p.isOpen),"onClose"in p&&l(2,n=p.onClose),"medications"in p&&l(3,s=p.medications),"medicationForm"in p&&l(0,r=p.medicationForm),"isEditing"in p&&l(4,c=p.isEditing),"onSave"in p&&l(9,a=p.onSave)},t.$$.update=()=>{t.$$.dirty&1&&l(5,o=!!(r.medication&&r.administrationType&&r.dosage&&(r.hasDiluent==="нет"||r.hasDiluent==="да"&&r.diluents.length>0&&r.diluents.every(p=>p.type&&p.dosage))))},[r,i,n,s,c,o,d,u,g,a,y,_,h,w,k,I,W,G,P,H]}class ll extends pe{constructor(e){super(),Ce(this,e,tl,el,he,{isOpen:1,onClose:2,medications:3,medicationForm:0,isEditing:4,onSave:9})}}const xl="";function ol(t){let e,l,o,i;return{c(){e=b("button"),l=D("+ Создать новую схему"),v(e,"class","btn-add-new-scheme svelte-651s9i"),B(e,"--btn-bg-color",t[1]),B(e,"--btn-text-color",t[2]),B(e,"--btn-hover-color",t[3]),B(e,"--btn-border-radius",t[4])},m(n,s){S(n,e,s),m(e,l),o||(i=A(e,"click",function(){de(t[0])&&t[0].apply(this,arguments)}),o=!0)},p(n,[s]){t=n,s&2&&B(e,"--btn-bg-color",t[1]),s&4&&B(e,"--btn-text-color",t[2]),s&8&&B(e,"--btn-hover-color",t[3]),s&16&&B(e,"--btn-border-radius",t[4])},i:te,o:te,d(n){n&&T(e),o=!1,i()}}}function nl(t,e,l){let{onClick:o}=e,{buttonBgColor:i="#28a745"}=e,{buttonTextColor:n="#fff"}=e,{buttonHoverColor:s="#218838"}=e,{buttonBorderRadius:r="4px"}=e;return t.$$set=c=>{"onClick"in c&&l(0,o=c.onClick),"buttonBgColor"in c&&l(1,i=c.buttonBgColor),"buttonTextColor"in c&&l(2,n=c.buttonTextColor),"buttonHoverColor"in c&&l(3,s=c.buttonHoverColor),"buttonBorderRadius"in c&&l(4,r=c.buttonBorderRadius)},[o,i,n,s,r]}class il extends pe{constructor(e){super(),Ce(this,e,nl,ol,he,{onClick:0,buttonBgColor:1,buttonTextColor:2,buttonHoverColor:3,buttonBorderRadius:4})}}const Hl="";function ft(t,e,l){const o=t.slice();return o[54]=e[l],o}function mt(t,e,l){const o=t.slice();return o[57]=e[l],o}function gt(t,e,l){const o=t.slice();return o[60]=e[l],o}function rl(t,e,l){const o=t.slice();return o[57]=e[l],o}function ht(t){let e,l,o,i;return e=new Qt({props:{schemes:t[23],onSelect:t[32],onEdit:t[34],bgColor:t[4],titleColor:t[5],borderColor:t[6]}}),o=new il({props:{onClick:t[33],buttonBgColor:t[7],buttonTextColor:t[8],buttonHoverColor:t[9],buttonBorderRadius:t[10]}}),{c(){ke(e.$$.fragment),l=O(),ke(o.$$.fragment)},m(n,s){me(e,n,s),S(n,l,s),me(o,n,s),i=!0},p(n,s){const r={};s[0]&8388608&&(r.schemes=n[23]),s[0]&16&&(r.bgColor=n[4]),s[0]&32&&(r.titleColor=n[5]),s[0]&64&&(r.borderColor=n[6]),e.$set(r);const c={};s[0]&128&&(c.buttonBgColor=n[7]),s[0]&256&&(c.buttonTextColor=n[8]),s[0]&512&&(c.buttonHoverColor=n[9]),s[0]&1024&&(c.buttonBorderRadius=n[10]),o.$set(c)},i(n){i||(V(e.$$.fragment,n),V(o.$$.fragment,n),i=!0)},o(n){Z(e.$$.fragment,n),Z(o.$$.fragment,n),i=!1},d(n){ge(e,n),n&&T(l),ge(o,n)}}}function _t(t){let e,l,o,i,n,s,r,c,a,d,u,g,h,y,_,w,k=[1,2,3,4,5,6,7,8,9,10],I=[];for(let C=0;C<10;C+=1)I[C]=sl(rl(t,k,C));function W(C,j){return C[14].length>0?ul:cl}let G=W(t),P=G(t);function H(C,j){return C[19]?dl:al}let p=H(t),M=p(t);return{c(){e=b("div"),l=b("h3"),l.textContent="Создание новой схемы лечения",o=O(),i=b("div"),n=b("div"),s=b("div"),s.textContent="Препарат",r=O();for(let C=0;C<10;C+=1)I[C].c();c=O(),P.c(),a=O(),d=b("div"),u=b("button"),u.textContent="+ Добавить препарат",g=O(),h=b("button"),M.c(),v(l,"class","svelte-l6krs5"),v(s,"class","medication-column svelte-l6krs5"),v(n,"class","schedule-header svelte-l6krs5"),v(i,"class","schedule-table svelte-l6krs5"),v(u,"class","btn-add-medication svelte-l6krs5"),v(h,"class","btn-continue svelte-l6krs5"),h.disabled=y=t[14].length===0||t[19]||!t[24],v(d,"class","schedule-actions svelte-l6krs5"),v(e,"class","schedule-column svelte-l6krs5")},m(C,j){S(C,e,j),m(e,l),m(e,o),m(e,i),m(i,n),m(n,s),m(n,r);for(let oe=0;oe<10;oe+=1)I[oe]&&I[oe].m(n,null);m(i,c),P.m(i,null),m(e,a),m(e,d),m(d,u),m(d,g),m(d,h),M.m(h,null),_||(w=[A(u,"click",t[27]),A(h,"click",t[35])],_=!0)},p(C,j){G===(G=W(C))&&P?P.p(C,j):(P.d(1),P=G(C),P&&(P.c(),P.m(i,null))),p!==(p=H(C))&&(M.d(1),M=p(C),M&&(M.c(),M.m(h,null))),j[0]&17317888&&y!==(y=C[14].length===0||C[19]||!C[24])&&(h.disabled=y)},d(C){C&&T(e),ye(I,C),P.d(),M.d(),_=!1,le(w)}}}function sl(t){let e,l;return{c(){e=b("div"),l=D(t[57]),v(e,"class","day-header svelte-l6krs5")},m(o,i){S(o,e,i),m(e,l)},p:te,d(o){o&&T(e)}}}function cl(t){let e;return{c(){e=b("p"),e.textContent="Пока назначений нет",v(e,"class","empty svelte-l6krs5")},m(l,o){S(l,e,o)},p:te,d(l){l&&T(e)}}}function ul(t){let e=[],l=new Map,o,i=t[14];const n=s=>s[54].id;for(let s=0;s<i.length;s+=1){let r=ft(t,i,s),c=n(r);l.set(c,e[s]=Ct(c,r))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();o=we()},m(s,r){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(s,r);S(s,o,r)},p(s,r){r[0]&805355520|r[1]&1&&(i=s[14],e=Ne(e,r,n,1,s,i,l,o.parentNode,Ze,Ct,o,ft))},d(s){for(let r=0;r<e.length;r+=1)e[r].d(s);s&&T(o)}}}function bt(t){let e,l=t[54].diluents,o=[];for(let i=0;i<l.length;i+=1)o[i]=vt(gt(t,l,i));return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=we()},m(i,n){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(i,n);S(i,e,n)},p(i,n){if(n[0]&16384){l=i[54].diluents;let s;for(s=0;s<l.length;s+=1){const r=gt(i,l,s);o[s]?o[s].p(r,n):(o[s]=vt(r),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=l.length}},d(i){ye(o,i),i&&T(e)}}}function vt(t){let e,l=t[60].type+"",o,i,n=t[60].dosage+"",s,r;return{c(){e=D("+ "),o=D(l),i=D(" ("),s=D(n),r=D(")")},m(c,a){S(c,e,a),S(c,o,a),S(c,i,a),S(c,s,a),S(c,r,a)},p(c,a){a[0]&16384&&l!==(l=c[60].type+"")&&$(o,l),a[0]&16384&&n!==(n=c[60].dosage+"")&&$(s,n)},d(c){c&&T(e),c&&T(o),c&&T(i),c&&T(s),c&&T(r)}}}function kt(t){let e,l,o;function i(){return t[50](t[54],t[57])}return{c(){e=b("div"),v(e,"class","schedule-cell svelte-l6krs5"),Je(e,"selected",t[15][t[54].id]&&t[15][t[54].id][1]&&t[15][t[54].id][1].has(t[57]))},m(n,s){S(n,e,s),l||(o=A(e,"click",i),l=!0)},p(n,s){t=n,s[0]&49152&&Je(e,"selected",t[15][t[54].id]&&t[15][t[54].id][1]&&t[15][t[54].id][1].has(t[57]))},d(n){n&&T(e),l=!1,o()}}}function Ct(t,e){let l,o,i,n,s=e[54].medication.name+"",r,c,a=e[54].administrationType+"",d,u,g=e[54].dosage+"",h,y,_,w,k,I,W,G,P,H,p,M,C=e[54].hasDiluent==="да"&&e[54].diluents&&e[54].diluents.length>0&&bt(e);function j(){return e[48](e[54])}function oe(){return e[49](e[54])}let se=[1,2,3,4,5,6,7,8,9,10],q=[];for(let L=0;L<10;L+=1)q[L]=kt(mt(e,se,L));return{key:t,first:null,c(){l=b("div"),o=b("div"),i=b("div"),n=b("strong"),r=D(s),c=O(),d=D(a),u=D(", "),h=D(g),y=O(),C&&C.c(),_=O(),w=b("div"),k=b("button"),k.textContent="✏️",I=O(),W=b("button"),W.textContent="🗑️",G=O();for(let L=0;L<10;L+=1)q[L].c();P=O(),v(i,"class","medication-title"),v(k,"class","btn-edit-medication svelte-l6krs5"),v(W,"class","btn-delete-medication svelte-l6krs5"),v(w,"class","medication-actions svelte-l6krs5"),v(o,"class","medication-cell svelte-l6krs5"),v(l,"class",H="schedule-row "+(!e[15][e[54].id]||!Object.values(e[15][e[54].id]).some(Bt)?"error-highlight":"")+" svelte-l6krs5"),this.first=l},m(L,U){S(L,l,U),m(l,o),m(o,i),m(i,n),m(n,r),m(i,c),m(i,d),m(i,u),m(i,h),m(i,y),C&&C.m(i,null),m(o,_),m(o,w),m(w,k),m(w,I),m(w,W),m(l,G);for(let N=0;N<10;N+=1)q[N]&&q[N].m(l,null);m(l,P),p||(M=[A(k,"click",j),A(W,"click",oe)],p=!0)},p(L,U){if(e=L,U[0]&16384&&s!==(s=e[54].medication.name+"")&&$(r,s),U[0]&16384&&a!==(a=e[54].administrationType+"")&&$(d,a),U[0]&16384&&g!==(g=e[54].dosage+"")&&$(h,g),e[54].hasDiluent==="да"&&e[54].diluents&&e[54].diluents.length>0?C?C.p(e,U):(C=bt(e),C.c(),C.m(i,null)):C&&(C.d(1),C=null),U[0]&49152|U[1]&1){se=[1,2,3,4,5,6,7,8,9,10];let N;for(N=0;N<10;N+=1){const J=mt(e,se,N);q[N]?q[N].p(J,U):(q[N]=kt(J),q[N].c(),q[N].m(l,P))}for(;N<10;N+=1)q[N].d(1)}U[0]&49152&&H!==(H="schedule-row "+(!e[15][e[54].id]||!Object.values(e[15][e[54].id]).some(Bt)?"error-highlight":"")+" svelte-l6krs5")&&v(l,"class",H)},d(L){L&&T(l),C&&C.d(),ye(q,L),p=!1,le(M)}}}function al(t){let e;return{c(){e=D("Опубликовать схему")},m(l,o){S(l,e,o)},d(l){l&&T(e)}}}function dl(t){let e,l;return{c(){e=b("span"),l=D(" Сохранение..."),v(e,"class","spinner svelte-l6krs5")},m(o,i){S(o,e,i),S(o,l,i)},d(o){o&&T(e),o&&T(l)}}}function pt(t){let e,l,o;return{c(){e=b("div"),l=D("⚠️ "),o=D(t[20]),v(e,"class","validation-error svelte-l6krs5")},m(i,n){S(i,e,n),m(e,l),m(e,o)},p(i,n){n[0]&1048576&&$(o,i[20])},d(i){i&&T(e)}}}function fl(t){let e,l,o,i,n,s,r=!t[17]&&ht(t),c=t[17]&&_t(t),a=t[20]&&pt(t);return{c(){e=b("div"),l=b("div"),r&&r.c(),o=O(),c&&c.c(),i=O(),a&&a.c(),n=we(),v(l,"class","medication-form-column svelte-l6krs5"),v(e,"class","modal-grid svelte-l6krs5")},m(d,u){S(d,e,u),m(e,l),r&&r.m(l,null),m(e,o),c&&c.m(e,null),S(d,i,u),a&&a.m(d,u),S(d,n,u),s=!0},p(d,u){d[17]?r&&(Oe(),Z(r,1,1,()=>{r=null}),De()):r?(r.p(d,u),u[0]&131072&&V(r,1)):(r=ht(d),r.c(),V(r,1),r.m(l,null)),d[17]?c?c.p(d,u):(c=_t(d),c.c(),c.m(e,null)):c&&(c.d(1),c=null),d[20]?a?a.p(d,u):(a=pt(d),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(d){s||(V(r),s=!0)},o(d){Z(r),s=!1},d(d){d&&T(e),r&&r.d(),c&&c.d(),d&&T(i),a&&a.d(d),d&&T(n)}}}function ml(t){let e,l,o,i,n,s,r,c,a,d;return n=new rt({props:{isOpen:t[16],onClose:t[26],maxWidth:t[0],backgroundColor:t[1],borderRadius:t[2],overlayColor:t[3],$$slots:{default:[fl]},$$scope:{ctx:t}}}),r=new ll({props:{isOpen:t[18],onClose:t[36],medications:t[25],medicationForm:t[21],isEditing:!!t[22],onSave:t[30]}}),{c(){e=b("div"),l=b("button"),o=D("📋 Схема лечения"),i=O(),ke(n.$$.fragment),s=O(),ke(r.$$.fragment),v(l,"class","treatment-scheme-button svelte-l6krs5"),B(l,"--bg-color",t[11]),B(l,"--text-color",t[12]),B(l,"--border-radius",t[13]),v(e,"class","treatment-scheme-container")},m(u,g){S(u,e,g),m(e,l),m(l,o),m(e,i),me(n,e,null),m(e,s),me(r,e,null),c=!0,a||(d=A(l,"click",t[26]),a=!0)},p(u,g){(!c||g[0]&2048)&&B(l,"--bg-color",u[11]),(!c||g[0]&4096)&&B(l,"--text-color",u[12]),(!c||g[0]&8192)&&B(l,"--border-radius",u[13]);const h={};g[0]&65536&&(h.isOpen=u[16]),g[0]&1&&(h.maxWidth=u[0]),g[0]&2&&(h.backgroundColor=u[1]),g[0]&4&&(h.borderRadius=u[2]),g[0]&8&&(h.overlayColor=u[3]),g[0]&26920944|g[2]&8&&(h.$$scope={dirty:g,ctx:u}),n.$set(h);const y={};g[0]&262144&&(y.isOpen=u[18]),g[0]&2097152&&(y.medicationForm=u[21]),g[0]&4194304&&(y.isEditing=!!u[22]),r.$set(y)},i(u){c||(V(n.$$.fragment,u),V(r.$$.fragment,u),c=!0)},o(u){Z(n.$$.fragment,u),Z(r.$$.fragment,u),c=!1},d(u){u&&T(e),ge(n),ge(r),a=!1,d()}}}const Bt=t=>t.size>0;function gl(t,e,l){let o,{serviceId:i=null}=e,{medicalCardId:n=null}=e,{modalMaxWidth:s="1100px"}=e,{modalBgColor:r="white"}=e,{modalBorderRadius:c="8px"}=e,{modalOverlayColor:a="rgba(0,0,0,0.5)"}=e,{schemesBgColor:d="#f8f9fa"}=e,{schemesTitleColor:u="#333"}=e,{schemesBorderColor:g="#e9ecef"}=e,{schemeItemBgColor:h="#f8f9fa"}=e,{schemeItemHoverColor:y="#e9ecef"}=e,{schemeItemBorderColor:_="#e9ecef"}=e,{schemeTitleColor:w="#333"}=e,{schemeDetailsColor:k="#6c757d"}=e,{useButtonBgColor:I="#007bff"}=e,{useButtonTextColor:W="#fff"}=e,{editButtonBgColor:G="#6c757d"}=e,{editButtonTextColor:P="#fff"}=e,{createButtonBgColor:H="#28a745"}=e,{createButtonTextColor:p="#fff"}=e,{createButtonHoverColor:M="#218838"}=e,{createButtonBorderRadius:C="4px"}=e,{mainButtonBgColor:j="#007bff"}=e,{mainButtonTextColor:oe="white"}=e,{mainButtonBorderRadius:se="4px"}=e,q=!1,L=!1,U=!1,N=!1,J="",ce=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],ae={medication:ce[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},ne=null,re=null,K=[],x={},Be=[];function ue(){l(16,q=!q),q||Q()}function Q(){l(21,ae=X()),l(14,K=[]),l(15,x={}),l(17,L=!1),re=null,l(20,J="")}function X(){return{medication:ce[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}}function R(){l(21,ae=X()),l(22,ne=null),l(18,U=!0)}function F(f){l(21,ae={medication:ce.find(E=>E.name===f.medication.name)||ce[0],administrationType:f.administrationType,dosage:f.dosage,hasDiluent:f.diluents&&f.diluents.length>0?"да":"нет",diluents:f.diluents?f.diluents.map(E=>({...E})):[]}),l(22,ne=f.id),l(18,U=!0)}function Y(f){l(14,K=K.filter(E=>E.id!==f)),x[f]&&(delete x[f],l(15,x={...x})),l(20,J="")}function He(f){if(ne)l(14,K=K.map(E=>E.id===ne?{...f,id:E.id}:E)),l(22,ne=null);else{const E={...f,id:Date.now()};l(14,K=[...K,E])}l(18,U=!1)}function St(f,E,ie){x[f]||l(15,x[f]={},x),x[f][E]||l(15,x[f][E]=new Set,x),x[f][E].has(ie)?x[f][E].delete(ie):x[f][E].add(ie),l(15,x={...x}),l(20,J="")}function It(f){l(14,K=f.medications.map(E=>({id:E.id||Date.now()+Math.random(),medication:{name:E.name},administrationType:E.administrationType,dosage:E.dosage,hasDiluent:E.diluents&&E.diluents.length>0?"да":"нет",diluents:E.diluents?E.diluents.map(ee=>({...ee})):[]}))),l(15,x={}),f.schedule&&Object.entries(f.schedule).forEach(([E,ie])=>{l(15,x[E]={},x),Object.entries(ie).forEach(([ee,Ee])=>{l(15,x[E][ee]=new Set(Ee),x)})}),l(17,L=!0),l(20,J="")}function pl(){l(17,L=!0),l(14,K=[]),l(15,x={}),l(20,J="")}function Bl(f){It(f),re=f}function yl(){const f=K.filter(E=>!x[E.id]||!Object.values(x[E.id]).some(ie=>ie.size>0));if(f.length>0){const E=f.map(ie=>ie.medication.name).join(", ");l(20,J=`Не выбрано ни одного дня для препаратов: ${E}`);return}try{l(19,N=!0);const E={};Object.entries(x).forEach(([ee,Ee])=>{E[ee]={},Object.entries(Ee).forEach(([El,Rl])=>{E[ee][El]=Array.from(Rl)})});const ie={id:Date.now(),name:re?`${re.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:K.map(ee=>({id:ee.id,name:ee.medication.name,dosage:ee.dosage,administrationType:ee.administrationType,diluents:ee.diluents?ee.diluents.map(Ee=>({...Ee})):[]})),createdFor:{serviceId:i,medicalCardId:n},createdAt:new Date().toISOString(),isRevision:!!re,originalSchemeId:re?re.id:null,schedule:E};setTimeout(()=>{l(23,Be=[...Be,ie]),l(19,N=!1),ue()},1e3)}catch(E){console.error("Ошибка публикации схемы:",E),l(19,N=!1)}}function wl(){l(18,U=!1),l(22,ne=null)}const Tl=f=>F(f),Sl=f=>Y(f.id),Il=(f,E)=>St(f.id,1,E);return t.$$set=f=>{"serviceId"in f&&l(37,i=f.serviceId),"medicalCardId"in f&&l(38,n=f.medicalCardId),"modalMaxWidth"in f&&l(0,s=f.modalMaxWidth),"modalBgColor"in f&&l(1,r=f.modalBgColor),"modalBorderRadius"in f&&l(2,c=f.modalBorderRadius),"modalOverlayColor"in f&&l(3,a=f.modalOverlayColor),"schemesBgColor"in f&&l(4,d=f.schemesBgColor),"schemesTitleColor"in f&&l(5,u=f.schemesTitleColor),"schemesBorderColor"in f&&l(6,g=f.schemesBorderColor),"schemeItemBgColor"in f&&l(39,h=f.schemeItemBgColor),"schemeItemHoverColor"in f&&l(40,y=f.schemeItemHoverColor),"schemeItemBorderColor"in f&&l(41,_=f.schemeItemBorderColor),"schemeTitleColor"in f&&l(42,w=f.schemeTitleColor),"schemeDetailsColor"in f&&l(43,k=f.schemeDetailsColor),"useButtonBgColor"in f&&l(44,I=f.useButtonBgColor),"useButtonTextColor"in f&&l(45,W=f.useButtonTextColor),"editButtonBgColor"in f&&l(46,G=f.editButtonBgColor),"editButtonTextColor"in f&&l(47,P=f.editButtonTextColor),"createButtonBgColor"in f&&l(7,H=f.createButtonBgColor),"createButtonTextColor"in f&&l(8,p=f.createButtonTextColor),"createButtonHoverColor"in f&&l(9,M=f.createButtonHoverColor),"createButtonBorderRadius"in f&&l(10,C=f.createButtonBorderRadius),"mainButtonBgColor"in f&&l(11,j=f.mainButtonBgColor),"mainButtonTextColor"in f&&l(12,oe=f.mainButtonTextColor),"mainButtonBorderRadius"in f&&l(13,se=f.mainButtonBorderRadius)},t.$$.update=()=>{t.$$.dirty[0]&49152&&l(24,o=K.length>0&&K.every(f=>x[f.id]&&Object.values(x[f.id]).some(E=>E.size>0)))},[s,r,c,a,d,u,g,H,p,M,C,j,oe,se,K,x,q,L,U,N,J,ae,ne,Be,o,ce,ue,R,F,Y,He,St,It,pl,Bl,yl,wl,i,n,h,y,_,w,k,I,W,G,P,Tl,Sl,Il]}class hl extends pe{constructor(e){super(),Ce(this,e,gl,ml,he,{serviceId:37,medicalCardId:38,modalMaxWidth:0,modalBgColor:1,modalBorderRadius:2,modalOverlayColor:3,schemesBgColor:4,schemesTitleColor:5,schemesBorderColor:6,schemeItemBgColor:39,schemeItemHoverColor:40,schemeItemBorderColor:41,schemeTitleColor:42,schemeDetailsColor:43,useButtonBgColor:44,useButtonTextColor:45,editButtonBgColor:46,editButtonTextColor:47,createButtonBgColor:7,createButtonTextColor:8,createButtonHoverColor:9,createButtonBorderRadius:10,mainButtonBgColor:11,mainButtonTextColor:12,mainButtonBorderRadius:13},null,[-1,-1,-1])}}const _l="#show_info_table_title",Ae="treatment-scheme-container",z={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),styleConfigs:{clinic1:{mainButtonBgColor:"#4CAF50",mainButtonTextColor:"white",schemesBgColor:"#f0f8ff",schemesTitleColor:"#2c3e50",useButtonBgColor:"#3498db",editButtonBgColor:"#9b59b6",createButtonBgColor:"#4CAF50"}},log(t,e,...l){if(!this.debug)return;const i={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${i} [RecordBtn-${this.instanceId}] ${e}`,...l)}};function yt(t){const e=new URL(t,window.location.origin),l=e.pathname,o=l.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!o,patientId:o?o[1]:null,recordId:o?o[2]:null,fullPath:l+e.search,params:e.searchParams}}function Ie(){z.log("action","Запущена процедура очистки"),z.intervalId!==null&&(clearInterval(z.intervalId),z.log("unmount","Интервал остановлен:",z.intervalId),z.intervalId=null);const t=document.getElementById(Ae);t&&(t.remove(),z.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),z.mounted=!1}function xe(t=!1){const e=yt(window.location.href);z.log("check","Проверка страницы:",e),e.recordId!==z.currentRecordId&&(z.log("route",`Изменился ID записи: ${z.currentRecordId||"none"} -> ${e.recordId||"none"}`),z.currentRecordId=e.recordId,z.currentPatientId=e.patientId,z.mounted&&(z.log("action","Удаляем компоненты из-за смены записи"),Ie()));const o=document.querySelector(_l),i=document.getElementById(Ae);if(z.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!o}, mounted=${z.mounted}`),!i&&z.mounted&&(z.log("warn","Компонент исчез из DOM, но состояние не обновлено"),z.mounted=!1),e.isRecordPage&&o){if(!i){z.log("mount","Монтируем компонент TreatmentSchemeButton");const n=document.createElement("div");n.id=Ae,o.appendChild(n);try{new hl({target:n,props:{serviceId:e.recordId,medicalCardId:e.patientId,...z.styleConfigs.clinic1}}),z.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),z.mounted=!0}catch(s){z.log("error","Ошибка при монтировании TreatmentSchemeButton:",s),n.remove()}}}else!e.isRecordPage&&(i||z.mounted)&&(z.log("action","Не страница записи - удаляем компонент"),Ie())}function bl(){z.log("start","Инициализация компонентов"),Ie(),window._recordButtonListenersInitialized||(vl(),window._recordButtonListenersInitialized=!0);const t=yt(window.location.href);return z.currentPath=t.fullPath,z.currentRecordId=t.recordId,z.currentPatientId=t.patientId,xe(!0),z.intervalId=setInterval(()=>{z.log("timer","Регулярная проверка по интервалу"),xe()},1e3),z.log("success","Интервал установлен, ID:",z.intervalId),Ie}function vl(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),z.log("route",`Обнаружен ${t}`),wt()}}),window.addEventListener("popstate",()=>{z.log("route","Обнаружен popstate"),wt()})}function wt(){[10,50,100,250,500,1e3,1500].forEach((e,l)=>{setTimeout(()=>{z.log("timer",`Запланированная проверка #${l+1} (${e}ms)`),xe(!0)},e)})}window.addEventListener("beforeunload",Ie),z.log("info","Модуль загружен"),xe(!0);const kl=[{match:/\/medical_records\/\d+\/\d+$/,render:bl}];let Tt=null;function Cl(){console.log("📡 Router запущен"),Et(()=>{const t=window.location.pathname,e=kl.find(l=>l.match.test(t));console.log("📌 Найден роут:",e?.match),e!==Tt&&(Tt=e,e?.render())})}console.log("✅ Content script работает"),Cl()})();
