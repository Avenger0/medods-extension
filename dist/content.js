(function(){"use strict";var ge=document.createElement("style");ge.textContent=`.treatment-scheme-button.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}.modal-overlay.svelte-1pd2jfb.svelte-1pd2jfb{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content.svelte-1pd2jfb.svelte-1pd2jfb{background:white;border-radius:8px;max-width:1100px;max-height:80%;position:relative;padding:20px;box-shadow:0 4px 6px #0000001a}.modal-grid.svelte-1pd2jfb.svelte-1pd2jfb{display:grid;grid-template-columns:1fr 1fr;gap:20px}.medication-form-column.svelte-1pd2jfb.svelte-1pd2jfb{display:flex;flex-direction:column;gap:10px;max-width:350px}.schedule-column.svelte-1pd2jfb.svelte-1pd2jfb{display:flex;flex-direction:column;gap:10px}.form-control.svelte-1pd2jfb.svelte-1pd2jfb{width:100%;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;font-size:14px}.modal-close.svelte-1pd2jfb.svelte-1pd2jfb{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999}.administration-type.svelte-1pd2jfb.svelte-1pd2jfb,.diluent-choice.svelte-1pd2jfb.svelte-1pd2jfb{display:flex;gap:15px;margin-bottom:10px}.administration-type.svelte-1pd2jfb label.svelte-1pd2jfb,.diluent-choice.svelte-1pd2jfb label.svelte-1pd2jfb{display:flex;align-items:center;gap:5px}.schedule-table.svelte-1pd2jfb.svelte-1pd2jfb{border:1px solid #ddd}.schedule-header.svelte-1pd2jfb.svelte-1pd2jfb{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-1pd2jfb.svelte-1pd2jfb,.medication-column.svelte-1pd2jfb.svelte-1pd2jfb{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-1pd2jfb.svelte-1pd2jfb{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-1pd2jfb.svelte-1pd2jfb{padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-1pd2jfb.svelte-1pd2jfb{height:30px;border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-1pd2jfb.svelte-1pd2jfb:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#007bff}.btn-add.svelte-1pd2jfb.svelte-1pd2jfb,.btn-continue.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}.btn-add.svelte-1pd2jfb.svelte-1pd2jfb:disabled,.btn-continue.svelte-1pd2jfb.svelte-1pd2jfb:disabled{opacity:.5;cursor:not-allowed}.existing-schemes.svelte-1pd2jfb.svelte-1pd2jfb{margin-top:20px}.scheme-item.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:10px;margin-bottom:10px;cursor:pointer;transition:background-color .3s ease}.scheme-item.svelte-1pd2jfb.svelte-1pd2jfb:hover{background-color:#e9ecef}.medication-details.svelte-1pd2jfb.svelte-1pd2jfb{color:#6c757d;font-size:.9em;margin-top:5px}.btn-add-new-scheme.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#28a745;color:#fff;border:none;padding:10px;border-radius:4px;margin-top:10px;cursor:pointer;width:100%}.scheme-actions.svelte-1pd2jfb.svelte-1pd2jfb{display:flex;gap:8px;margin-top:8px}.btn-use-scheme.svelte-1pd2jfb.svelte-1pd2jfb,.btn-edit-scheme.svelte-1pd2jfb.svelte-1pd2jfb{padding:4px 8px;font-size:12px;border:none;border-radius:4px;cursor:pointer}.btn-use-scheme.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#007bff;color:#fff}.btn-edit-scheme.svelte-1pd2jfb.svelte-1pd2jfb{background-color:#6c757d;color:#fff}.spinner.svelte-1pd2jfb.svelte-1pd2jfb{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-1pd2jfb-spin 1s ease-in-out infinite;margin-right:8px}@keyframes svelte-1pd2jfb-spin{to{transform:rotate(360deg)}}.diluents-container.svelte-1pd2jfb.svelte-1pd2jfb{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-1pd2jfb.svelte-1pd2jfb{display:flex;gap:8px;align-items:center}.diluent-select.svelte-1pd2jfb.svelte-1pd2jfb{flex:3}.diluent-dosage.svelte-1pd2jfb.svelte-1pd2jfb{flex:2}.btn-remove-diluent.svelte-1pd2jfb.svelte-1pd2jfb{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-1pd2jfb.svelte-1pd2jfb{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer;align-self:flex-start}
`,document.head.appendChild(ge);function $e(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function l(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(n=>{const o=history[n];history[n]=function(...s){o.apply(this,s),l()}}),window.addEventListener("popstate",l),t()}function H(){}function ve(t){return t()}function je(){return Object.create(null)}function V(t){t.forEach(ve)}function ke(t){return typeof t=="function"}function et(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function tt(t){return Object.keys(t).length===0}function u(t,e){t.appendChild(e)}function D(t,e,l){t.insertBefore(e,l||null)}function I(t){t.parentNode&&t.parentNode.removeChild(t)}function W(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function v(t){return document.createElement(t)}function L(t){return document.createTextNode(t)}function P(){return L(" ")}function ye(){return L("")}function N(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function pe(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function j(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function we(t){let e;return{p(...l){e=l,e.forEach(n=>t.push(n))},r(){e.forEach(l=>t.splice(t.indexOf(l),1))}}}function lt(t){return Array.from(t.childNodes)}function F(t,e){e=""+e,t.data!==e&&(t.data=e)}function de(t,e){t.value=e??""}function re(t,e,l){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e){o.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Ie(t){const e=t.querySelector(":checked");return e&&e.__value}function Se(t,e,l){t.classList[l?"add":"remove"](e)}let _e;function te(t){_e=t}function nt(t,e){const l=t.$$.callbacks[e.type];l&&l.slice().forEach(n=>n.call(this,e))}const X=[],De=[];let Y=[];const Ee=[],ot=Promise.resolve();let he=!1;function it(){he||(he=!0,ot.then(Te))}function le(t){Y.push(t)}const be=new Set;let Z=0;function Te(){if(Z!==0)return;const t=_e;do{try{for(;Z<X.length;){const e=X[Z];Z++,te(e),st(e.$$)}}catch(e){throw X.length=0,Z=0,e}for(te(null),X.length=0,Z=0;De.length;)De.pop()();for(let e=0;e<Y.length;e+=1){const l=Y[e];be.has(l)||(be.add(l),l())}Y.length=0}while(X.length);for(;Ee.length;)Ee.pop()();he=!1,be.clear(),te(t)}function st(t){if(t.fragment!==null){t.update(),V(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(le)}}function dt(t){const e=[],l=[];Y.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),Y=e}const rt=new Set;function Ce(t,e){t&&t.i&&(rt.delete(t),t.i(e))}function Me(t,e){t.d(1),e.delete(t.key)}function Re(t,e,l,n,o,s,i,b,a,p,d,c){let f=t.length,_=s.length,g=f;const E={};for(;g--;)E[t[g].key]=g;const w=[],O=new Map,S=new Map,M=[];for(g=_;g--;){const m=c(o,s,g),T=l(m);let x=i.get(T);x?n&&M.push(()=>x.p(m,e)):(x=p(T,m),x.c()),O.set(T,w[g]=x),T in E&&S.set(T,Math.abs(g-E[T]))}const k=new Set,R=new Set;function A(m){Ce(m,1),m.m(b,d),i.set(m.key,m),d=m.first,_--}for(;f&&_;){const m=w[_-1],T=t[f-1],x=m.key,q=T.key;m===T?(d=m.first,f--,_--):O.has(q)?!i.has(x)||k.has(x)?A(m):R.has(q)?f--:S.get(x)>S.get(q)?(R.add(x),A(m)):(k.add(q),f--):(a(T,i),f--)}for(;f--;){const m=t[f];O.has(m.key)||a(m,i)}for(;_;)A(w[_-1]);return V(M),w}function ct(t,e,l,n){const{fragment:o,after_update:s}=t.$$;o&&o.m(e,l),n||le(()=>{const i=t.$$.on_mount.map(ve).filter(ke);t.$$.on_destroy?t.$$.on_destroy.push(...i):V(i),t.$$.on_mount=[]}),s.forEach(le)}function at(t,e){const l=t.$$;l.fragment!==null&&(dt(l.after_update),V(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function ft(t,e){t.$$.dirty[0]===-1&&(X.push(t),it(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ut(t,e,l,n,o,s,i,b=[-1]){const a=_e;te(t);const p=t.$$={fragment:null,ctx:[],props:s,update:H,not_equal:o,bound:je(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:je(),dirty:b,skip_bound:!1,root:e.target||a.$$.root};i&&i(p.root);let d=!1;if(p.ctx=l?l(t,e.props||{},(c,f,..._)=>{const g=_.length?_[0]:f;return p.ctx&&o(p.ctx[c],p.ctx[c]=g)&&(!p.skip_bound&&p.bound[c]&&p.bound[c](g),d&&ft(t,c)),f}):[],p.update(),d=!0,V(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const c=lt(e.target);p.fragment&&p.fragment.l(c),c.forEach(I)}else p.fragment&&p.fragment.c();e.intro&&Ce(t.$$.fragment),ct(t,e.target,e.anchor,e.customElement),Te()}te(a)}class pt{$destroy(){at(this,1),this.$destroy=H}$on(e,l){if(!ke(l))return H;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const o=n.indexOf(l);o!==-1&&n.splice(o,1)}}$set(e){this.$$set&&!tt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ot="";function Le(t,e,l){const n=t.slice();return n[37]=e[l],n}function Oe(t,e,l){const n=t.slice();return n[40]=e[l],n}function Pe(t,e,l){const n=t.slice();return n[43]=e[l],n[45]=l,n}function _t(t,e,l){const n=t.slice();return n[40]=e[l],n}function xe(t,e,l){const n=t.slice();return n[43]=e[l],n[54]=e,n[55]=l,n}function Be(t,e,l){const n=t.slice();return n[51]=e[l],n}function Ne(t,e,l){const n=t.slice();return n[48]=e[l],n}function Ae(t,e,l){const n=t.slice();return n[51]=e[l],n}function ze(t){let e,l,n,o,s,i,b,a,p;function d(g,E){return g[2]?ht:bt}let c=d(t),f=c(t),_=t[2]&&t[5].length>0&&Ve(t);return{c(){e=v("div"),l=v("div"),n=v("button"),n.textContent="✖",o=P(),s=v("div"),i=v("div"),f.c(),b=P(),_&&_.c(),j(n,"class","modal-close svelte-1pd2jfb"),j(i,"class","medication-form-column svelte-1pd2jfb"),j(s,"class","modal-grid svelte-1pd2jfb"),j(l,"class","modal-content svelte-1pd2jfb"),j(e,"class","modal-overlay svelte-1pd2jfb")},m(g,E){D(g,e,E),u(e,l),u(l,n),u(l,o),u(l,s),u(s,i),f.m(i,null),u(s,b),_&&_.m(s,null),a||(p=[N(n,"click",t[12]),N(l,"click",pe(t[21])),N(e,"mousedown",t[35])],a=!0)},p(g,E){c===(c=d(g))&&f?f.p(g,E):(f.d(1),f=c(g),f&&(f.c(),f.m(i,null))),g[2]&&g[5].length>0?_?_.p(g,E):(_=Ve(g),_.c(),_.m(s,null)):_&&(_.d(1),_=null)},d(g){g&&I(e),f.d(),_&&_.d(),a=!1,V(p)}}}function ht(t){let e,l,n,o,s,i,b,a,p,d,c,f,_,g,E,w,O,S,M,k,R,A,m,T,x,q,Q,G,ae,$,oe,ie,se,fe;function ue(r,y){return r[4]?gt:mt}let ee=ue(t),U=ee(t),J=t[9],z=[];for(let r=0;r<J.length;r+=1)z[r]=Ue(Be(t,J,r));let h=t[0].hasDiluent==="да"&&Fe(t);return oe=we(t[26][0]),ie=we(t[26][1]),{c(){e=v("h2"),U.c(),l=P(),n=v("select");for(let r=0;r<z.length;r+=1)z[r].c();o=P(),s=v("div"),i=v("label"),b=v("input"),a=L(` \r
                                    Внутримышечно`),p=P(),d=v("label"),c=v("input"),f=L(` \r
                                    Внутривенно`),_=P(),g=v("input"),E=P(),w=v("div"),O=v("label"),O.textContent="Использовать растворитель:",S=P(),M=v("label"),k=v("input"),R=L(` \r
                                    Нет`),A=P(),m=v("label"),T=v("input"),x=L(` \r
                                    Да`),q=P(),h&&h.c(),Q=P(),G=v("button"),ae=L("Добавить препарат"),j(n,"class","form-control svelte-1pd2jfb"),t[0].medication===void 0&&le(()=>t[24].call(n)),j(b,"type","radio"),b.__value="в/м",b.value=b.__value,j(i,"class","svelte-1pd2jfb"),j(c,"type","radio"),c.__value="в/в",c.value=c.__value,j(d,"class","svelte-1pd2jfb"),j(s,"class","administration-type svelte-1pd2jfb"),j(g,"type","text"),j(g,"placeholder","Дозировка препарата"),j(g,"class","form-control svelte-1pd2jfb"),j(O,"class","svelte-1pd2jfb"),j(k,"type","radio"),k.__value="нет",k.value=k.__value,j(M,"class","svelte-1pd2jfb"),j(T,"type","radio"),T.__value="да",T.value=T.__value,j(m,"class","svelte-1pd2jfb"),j(w,"class","diluent-choice svelte-1pd2jfb"),j(G,"class","btn-add svelte-1pd2jfb"),G.disabled=$=!t[8],oe.p(k,T),ie.p(b,c)},m(r,y){D(r,e,y),U.m(e,null),D(r,l,y),D(r,n,y);for(let B=0;B<z.length;B+=1)z[B]&&z[B].m(n,null);re(n,t[0].medication,!0),D(r,o,y),D(r,s,y),u(s,i),u(i,b),b.checked=b.__value===t[0].administrationType,u(i,a),u(s,p),u(s,d),u(d,c),c.checked=c.__value===t[0].administrationType,u(d,f),D(r,_,y),D(r,g,y),de(g,t[0].dosage),D(r,E,y),D(r,w,y),u(w,O),u(w,S),u(w,M),u(M,k),k.checked=k.__value===t[0].hasDiluent,u(M,R),u(w,A),u(w,m),u(m,T),T.checked=T.__value===t[0].hasDiluent,u(m,x),D(r,q,y),h&&h.m(r,y),D(r,Q,y),D(r,G,y),u(G,ae),se||(fe=[N(n,"change",t[24]),N(b,"change",t[25]),N(c,"change",t[27]),N(g,"input",t[28]),N(k,"change",t[29]),N(T,"change",t[30]),N(G,"click",t[13])],se=!0)},p(r,y){if(ee===(ee=ue(r))&&U?U.p(r,y):(U.d(1),U=ee(r),U&&(U.c(),U.m(e,null))),y[0]&512){J=r[9];let B;for(B=0;B<J.length;B+=1){const K=Be(r,J,B);z[B]?z[B].p(K,y):(z[B]=Ue(K),z[B].c(),z[B].m(n,null))}for(;B<z.length;B+=1)z[B].d(1);z.length=J.length}y[0]&513&&re(n,r[0].medication),y[0]&513&&(b.checked=b.__value===r[0].administrationType),y[0]&513&&(c.checked=c.__value===r[0].administrationType),y[0]&513&&g.value!==r[0].dosage&&de(g,r[0].dosage),y[0]&513&&(k.checked=k.__value===r[0].hasDiluent),y[0]&513&&(T.checked=T.__value===r[0].hasDiluent),r[0].hasDiluent==="да"?h?h.p(r,y):(h=Fe(r),h.c(),h.m(Q.parentNode,Q)):h&&(h.d(1),h=null),y[0]&256&&$!==($=!r[8])&&(G.disabled=$)},d(r){r&&I(e),U.d(),r&&I(l),r&&I(n),W(z,r),r&&I(o),r&&I(s),r&&I(_),r&&I(g),r&&I(E),r&&I(w),r&&I(q),h&&h.d(r),r&&I(Q),r&&I(G),oe.r(),ie.r(),se=!1,V(fe)}}}function bt(t){let e,l,n,o,s,i,b;function a(c,f){return c[7].length?jt:vt}let p=a(t),d=p(t);return{c(){e=v("div"),l=v("h2"),l.textContent="Существующие схемы лечения",n=P(),d.c(),o=P(),s=v("button"),s.textContent="+ Создать новую схему",j(e,"class","existing-schemes svelte-1pd2jfb"),j(s,"class","btn-add-new-scheme svelte-1pd2jfb")},m(c,f){D(c,e,f),u(e,l),u(e,n),d.m(e,null),D(c,o,f),D(c,s,f),i||(b=N(s,"click",t[16]),i=!0)},p(c,f){p===(p=a(c))&&d?d.p(c,f):(d.d(1),d=p(c),d&&(d.c(),d.m(e,null)))},d(c){c&&I(e),d.d(),c&&I(o),c&&I(s),i=!1,b()}}}function mt(t){let e;return{c(){e=L("Добавление препарата")},m(l,n){D(l,e,n)},p:H,d(l){l&&I(e)}}}function gt(t){let e,l=t[4].name+"",n;return{c(){e=L("Редактирование схемы: "),n=L(l)},m(o,s){D(o,e,s),D(o,n,s)},p(o,s){s[0]&16&&l!==(l=o[4].name+"")&&F(n,l)},d(o){o&&I(e),o&&I(n)}}}function Ue(t){let e,l=t[51].name+"",n;return{c(){e=v("option"),n=L(l),e.__value=t[51],e.value=e.__value},m(o,s){D(o,e,s),u(e,n)},p:H,d(o){o&&I(e)}}}function Fe(t){let e,l=[],n=new Map,o,s,i,b,a=t[0].diluents;const p=d=>d[43].id;for(let d=0;d<a.length;d+=1){let c=xe(t,a,d),f=p(c);n.set(f,l[d]=qe(f,c))}return{c(){e=v("div");for(let d=0;d<l.length;d+=1)l[d].c();o=P(),s=v("button"),s.textContent="+ Добавить растворитель",j(s,"class","btn-add-diluent svelte-1pd2jfb"),j(e,"class","diluents-container svelte-1pd2jfb")},m(d,c){D(d,e,c);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);u(e,o),u(e,s),i||(b=N(s,"click",t[10]),i=!0)},p(d,c){c[0]&2049&&(a=d[0].diluents,l=Re(l,c,p,1,d,a,n,e,Me,qe,o,xe))},d(d){d&&I(e);for(let c=0;c<l.length;c+=1)l[c].d();i=!1,b()}}}function qe(t,e){let l,n,o,s,i,b,a,p,d,c,f;function _(){e[31].call(n,e[54],e[55])}function g(){e[32].call(a,e[54],e[55])}function E(){return e[33](e[43])}return{key:t,first:null,c(){l=v("div"),n=v("select"),o=v("option"),o.textContent="Выберите растворитель",s=v("option"),s.textContent="Глюкоза",i=v("option"),i.textContent="Физраствор",b=P(),a=v("input"),p=P(),d=v("button"),d.textContent="✖",o.__value="",o.value=o.__value,s.__value="глюкоза",s.value=s.__value,i.__value="физраствор",i.value=i.__value,j(n,"class","form-control diluent-select svelte-1pd2jfb"),e[43].type===void 0&&le(_),j(a,"type","text"),j(a,"placeholder","Дозировка"),j(a,"class","form-control diluent-dosage svelte-1pd2jfb"),j(d,"class","btn-remove-diluent svelte-1pd2jfb"),j(l,"class","diluent-row svelte-1pd2jfb"),this.first=l},m(w,O){D(w,l,O),u(l,n),u(n,o),u(n,s),u(n,i),re(n,e[43].type,!0),u(l,b),u(l,a),de(a,e[43].dosage),u(l,p),u(l,d),c||(f=[N(n,"change",_),N(a,"input",g),N(d,"click",E)],c=!0)},p(w,O){e=w,O[0]&513&&re(n,e[43].type),O[0]&513&&a.value!==e[43].dosage&&de(a,e[43].dosage)},d(w){w&&I(l),c=!1,V(f)}}}function vt(t){let e;return{c(){e=v("p"),e.textContent="Нет существующих схем"},m(l,n){D(l,e,n)},p:H,d(l){l&&I(e)}}}function jt(t){let e,l=t[7],n=[];for(let o=0;o<l.length;o+=1)n[o]=He(Ne(t,l,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ye()},m(o,s){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,s);D(o,e,s)},p(o,s){if(s[0]&295040){l=o[7];let i;for(i=0;i<l.length;i+=1){const b=Ne(o,l,i);n[i]?n[i].p(b,s):(n[i]=He(b),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=l.length}},d(o){W(n,o),o&&I(e)}}}function Ge(t){let e,l=t[51].name+"",n,o,s=t[51].dosage+"",i,b,a=t[51].администрationType+"",p,d;return{c(){e=v("div"),n=L(l),o=L(", "),i=L(s),b=L(" ("),p=L(a),d=L(")"),j(e,"class","medication-details svelte-1pd2jfb")},m(c,f){D(c,e,f),u(e,n),u(e,o),u(e,i),u(e,b),u(e,p),u(e,d)},p(c,f){f[0]&128&&l!==(l=c[51].name+"")&&F(n,l),f[0]&128&&s!==(s=c[51].dosage+"")&&F(i,s),f[0]&128&&a!==(a=c[51].администрationType+"")&&F(p,a)},d(c){c&&I(e)}}}function He(t){let e,l,n=t[48].name+"",o,s,i,b,a,p,d,c,f,_,g=t[48].medications,E=[];for(let S=0;S<g.length;S+=1)E[S]=Ge(Ae(t,g,S));function w(){return t[22](t[48])}function O(){return t[23](t[48])}return{c(){e=v("div"),l=v("strong"),o=L(n),s=P();for(let S=0;S<E.length;S+=1)E[S].c();i=P(),b=v("div"),a=v("button"),a.textContent="Использовать",p=P(),d=v("button"),d.textContent="Редактировать",c=P(),j(a,"class","btn-use-scheme svelte-1pd2jfb"),j(d,"class","btn-edit-scheme svelte-1pd2jfb"),j(b,"class","scheme-actions svelte-1pd2jfb"),j(e,"class","scheme-item svelte-1pd2jfb")},m(S,M){D(S,e,M),u(e,l),u(l,o),u(e,s);for(let k=0;k<E.length;k+=1)E[k]&&E[k].m(e,null);u(e,i),u(e,b),u(b,a),u(b,p),u(b,d),u(e,c),f||(_=[N(a,"click",pe(w)),N(d,"click",pe(O))],f=!0)},p(S,M){if(t=S,M[0]&128&&n!==(n=t[48].name+"")&&F(o,n),M[0]&128){g=t[48].medications;let k;for(k=0;k<g.length;k+=1){const R=Ae(t,g,k);E[k]?E[k].p(R,M):(E[k]=Ge(R),E[k].c(),E[k].m(e,i))}for(;k<E.length;k+=1)E[k].d(1);E.length=g.length}},d(S){S&&I(e),W(E,S),f=!1,V(_)}}}function Ve(t){let e,l,n,o,s,i,b,a,p=[],d=new Map,c,f,_,g,E,w=[1,2,3,4,5,6,7,8,9,10],O=[];for(let m=0;m<10;m+=1)O[m]=kt(_t(t,w,m));let S=t[5];const M=m=>m[37].id;for(let m=0;m<S.length;m+=1){let T=Le(t,S,m),x=M(T);d.set(x,p[m]=We(x,T))}function k(m,T){return m[3]?wt:yt}let R=k(t),A=R(t);return{c(){e=v("div"),l=v("h2"),l.textContent="График приема препаратов",n=P(),o=v("div"),s=v("div"),i=v("div"),i.textContent="Препарат",b=P();for(let m=0;m<10;m+=1)O[m].c();a=P();for(let m=0;m<p.length;m+=1)p[m].c();c=P(),f=v("button"),A.c(),j(i,"class","medication-column svelte-1pd2jfb"),j(s,"class","schedule-header svelte-1pd2jfb"),j(o,"class","schedule-table svelte-1pd2jfb"),j(f,"class","btn-continue svelte-1pd2jfb"),f.disabled=_=t[5].length===0||t[3],j(e,"class","schedule-column svelte-1pd2jfb")},m(m,T){D(m,e,T),u(e,l),u(e,n),u(e,o),u(o,s),u(s,i),u(s,b);for(let x=0;x<10;x+=1)O[x]&&O[x].m(s,null);u(o,a);for(let x=0;x<p.length;x+=1)p[x]&&p[x].m(o,null);u(e,c),u(e,f),A.m(f,null),g||(E=N(f,"click",t[17]),g=!0)},p(m,T){T[0]&16480&&(S=m[5],p=Re(p,T,M,1,m,S,d,o,Me,We,null,Le)),R!==(R=k(m))&&(A.d(1),A=R(m),A&&(A.c(),A.m(f,null))),T[0]&40&&_!==(_=m[5].length===0||m[3])&&(f.disabled=_)},d(m){m&&I(e),W(O,m);for(let T=0;T<p.length;T+=1)p[T].d();A.d(),g=!1,E()}}}function kt(t){let e,l,n;return{c(){e=v("div"),l=L("День "),n=L(t[40]),j(e,"class","day-header svelte-1pd2jfb")},m(o,s){D(o,e,s),u(e,l),u(e,n)},p:H,d(o){o&&I(e)}}}function Je(t){let e,l=t[37].diluents,n=[];for(let o=0;o<l.length;o+=1)n[o]=Ke(Pe(t,l,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ye()},m(o,s){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,s);D(o,e,s)},p(o,s){if(s[0]&32){l=o[37].diluents;let i;for(i=0;i<l.length;i+=1){const b=Pe(o,l,i);n[i]?n[i].p(b,s):(n[i]=Ke(b),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=l.length}},d(o){W(n,o),o&&I(e)}}}function Ke(t){let e,l=t[43].type+"",n,o,s=t[43].dosage+"",i,b;return{c(){e=L("+ "),n=L(l),o=L(" ("),i=L(s),b=L(")")},m(a,p){D(a,e,p),D(a,n,p),D(a,o,p),D(a,i,p),D(a,b,p)},p(a,p){p[0]&32&&l!==(l=a[43].type+"")&&F(n,l),p[0]&32&&s!==(s=a[43].dosage+"")&&F(i,s)},d(a){a&&I(e),a&&I(n),a&&I(o),a&&I(i),a&&I(b)}}}function Qe(t){let e,l,n;function o(){return t[34](t[37],t[40])}return{c(){e=v("div"),j(e,"class","schedule-cell svelte-1pd2jfb"),Se(e,"selected",t[6][t[37].id]&&t[6][t[37].id][1]&&t[6][t[37].id][1].has(t[40]))},m(s,i){D(s,e,i),l||(n=N(e,"click",o),l=!0)},p(s,i){t=s,i[0]&96&&Se(e,"selected",t[6][t[37].id]&&t[6][t[37].id][1]&&t[6][t[37].id][1].has(t[40]))},d(s){s&&I(e),l=!1,n()}}}function We(t,e){let l,n,o,s=e[37].medication.name+"",i,b,a=e[37].administrationType+"",p,d,c=e[37].dosage+"",f,_,g,E,w=e[37].hasDiluent==="да"&&e[37].diluents.length>0&&Je(e),O=[1,2,3,4,5,6,7,8,9,10],S=[];for(let M=0;M<10;M+=1)S[M]=Qe(Oe(e,O,M));return{key:t,first:null,c(){l=v("div"),n=v("div"),o=v("strong"),i=L(s),b=P(),p=L(a),d=L(", "),f=L(c),_=P(),w&&w.c(),g=P();for(let M=0;M<10;M+=1)S[M].c();E=P(),j(n,"class","medication-cell svelte-1pd2jfb"),j(l,"class","schedule-row svelte-1pd2jfb"),this.first=l},m(M,k){D(M,l,k),u(l,n),u(n,o),u(o,i),u(n,b),u(n,p),u(n,d),u(n,f),u(n,_),w&&w.m(n,null),u(l,g);for(let R=0;R<10;R+=1)S[R]&&S[R].m(l,null);u(l,E)},p(M,k){if(e=M,k[0]&32&&s!==(s=e[37].medication.name+"")&&F(i,s),k[0]&32&&a!==(a=e[37].administrationType+"")&&F(p,a),k[0]&32&&c!==(c=e[37].dosage+"")&&F(f,c),e[37].hasDiluent==="да"&&e[37].diluents.length>0?w?w.p(e,k):(w=Je(e),w.c(),w.m(n,null)):w&&(w.d(1),w=null),k[0]&16480){O=[1,2,3,4,5,6,7,8,9,10];let R;for(R=0;R<10;R+=1){const A=Oe(e,O,R);S[R]?S[R].p(A,k):(S[R]=Qe(A),S[R].c(),S[R].m(l,E))}for(;R<10;R+=1)S[R].d(1)}},d(M){M&&I(l),w&&w.d(),W(S,M)}}}function yt(t){let e;return{c(){e=L("Опубликовать схему")},m(l,n){D(l,e,n)},d(l){l&&I(e)}}}function wt(t){let e,l;return{c(){e=v("span"),l=L(" Сохранение..."),j(e,"class","spinner svelte-1pd2jfb")},m(n,o){D(n,e,o),D(n,l,o)},d(n){n&&I(e),n&&I(l)}}}function It(t){let e,l,n,o,s,i=t[1]&&ze(t);return{c(){e=v("div"),l=v("button"),l.textContent="📋 Схема лечения",n=P(),i&&i.c(),j(l,"class","treatment-scheme-button svelte-1pd2jfb"),j(e,"class","treatment-scheme-container")},m(b,a){D(b,e,a),u(e,l),u(e,n),i&&i.m(e,null),o||(s=N(l,"click",t[12]),o=!0)},p(b,a){b[1]?i?i.p(b,a):(i=ze(b),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:H,o:H,d(b){b&&I(e),i&&i.d(),o=!1,s()}}}function St(t,e,l){let n,{serviceId:o=null}=e,{medicalCardId:s=null}=e,i=!1,b=!1,a=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],p=!1,d={medication:a[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},c=null,f=[],_={},g=[{id:1,name:"Схема лечения №1",medications:[{id:101,name:"Цефтриаксон",dosage:"1г",администрationType:"в/м",diluents:[{id:1001,type:"физраствор",dosage:"2мл"}]}],schedule:{101:{1:[1,3,5,7,9]}}},{id:2,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}}];function E(){l(0,d.diluents=[...d.diluents,{id:Date.now(),type:"",dosage:""}],d)}function w(h){l(0,d.diluents=d.diluents.filter(r=>r.id!==h),d)}function O(){l(1,i=!i),i||S()}function S(){l(0,d={medication:a[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),l(5,f=[]),l(6,_={}),l(2,b=!1),l(4,c=null)}function M(){if(n){const h={...d,id:Date.now()};h.hasDiluent==="нет"&&(h.diluents=[]),l(5,f=[...f,h]),l(0,d={medication:a[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]})}}function k(h,r,y){_[h]||l(6,_[h]={},_),_[h][r]||l(6,_[h][r]=new Set,_),_[h][r].has(y)?_[h][r].delete(y):_[h][r].add(y),l(6,_={..._})}function R(h){console.log("Выбрана схема:",h),l(5,f=h.medications.map(r=>({id:r.id||Date.now()+Math.random(),medication:{name:r.name},administrationType:r.администрationType,dosage:r.dosage,hasDiluent:r.diluents&&r.diluents.length>0?"да":"нет",diluents:r.diluents||[]}))),l(6,_={}),h.schedule&&Object.entries(h.schedule).forEach(([r,y])=>{l(6,_[r]={},_),Object.entries(y).forEach(([B,K])=>{l(6,_[r][B]=new Set(K),_)})}),l(2,b=!0),O()}function A(){l(2,b=!0),l(5,f=[]),l(6,_={})}function m(){try{l(3,p=!0);const h={};Object.entries(_).forEach(([y,B])=>{h[y]={},Object.entries(B).forEach(([K,Lt])=>{h[y][K]=Array.from(Lt)})});const r={id:Date.now(),name:c?`${c.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:f.map(y=>({id:y.id,name:y.medication.name,dosage:y.dosage,администрationType:y.administrationType,hasDiluent:y.hasDiluent,diluent:y.diluent,diluentDosage:y.diluentDosage})),createdFor:{serviceId:o,medicalCardId:s},createdAt:new Date().toISOString(),isRevision:!!c,originalSchemeId:c?c.id:null,schedule:h};setTimeout(()=>{l(7,g=[...g,r]),console.log("Опубликована схема лечения",r),l(3,p=!1),O()},1e3)}catch(h){console.error("Ошибка публикации схемы:",h),l(3,p=!1)}}function T(h){console.log("Редактирование схемы:",h),l(5,f=h.medications.map(r=>({id:r.id||Date.now()+Math.random(),medication:{name:r.name},administrationType:r.администрationType,dosage:r.dosage,hasDiluent:r.diluents&&r.diluents.length>0?"да":"нет",diluents:r.diluents||[]}))),l(6,_={}),h.schedule&&Object.entries(h.schedule).forEach(([r,y])=>{l(6,_[r]={},_),Object.entries(y).forEach(([B,K])=>{l(6,_[r][B]=new Set(K),_)})}),l(2,b=!0),l(4,c=h)}const x=[[],[]];function q(h){nt.call(this,t,h)}const Q=h=>R(h),G=h=>T(h);function ae(){d.medication=Ie(this),l(0,d),l(9,a)}function $(){d.administrationType=this.__value,l(0,d),l(9,a)}function oe(){d.administrationType=this.__value,l(0,d),l(9,a)}function ie(){d.dosage=this.value,l(0,d),l(9,a)}function se(){d.hasDiluent=this.__value,l(0,d),l(9,a)}function fe(){d.hasDiluent=this.__value,l(0,d),l(9,a)}function ue(h,r){h[r].type=Ie(this),l(0,d),l(9,a)}function ee(h,r){h[r].dosage=this.value,l(0,d),l(9,a)}const U=h=>w(h.id),J=(h,r)=>k(h.id,1,r),z=h=>{h.target.classList.contains("modal-overlay")&&O()};return t.$$set=h=>{"serviceId"in h&&l(19,o=h.serviceId),"medicalCardId"in h&&l(20,s=h.medicalCardId)},t.$$.update=()=>{t.$$.dirty[0]&1&&l(8,n=!!(d.medication&&d.administrationType&&d.dosage&&(d.hasDiluent==="нет"||d.hasDiluent==="да"&&d.diluents.length>0&&d.diluents.every(h=>h.type&&h.dosage))))},[d,i,b,p,c,f,_,g,n,a,E,w,O,M,k,R,A,m,T,o,s,q,Q,G,ae,$,x,oe,ie,se,fe,ue,ee,U,J,z]}class Dt extends pt{constructor(e){super(),ut(this,e,St,It,et,{serviceId:19,medicalCardId:20},null,[-1,-1])}}const Et="#show_info_table_title",me="treatment-scheme-container",C={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),log(t,e,...l){if(!this.debug)return;const o={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${o} [RecordBtn-${this.instanceId}] ${e}`,...l)}};function Xe(t){const e=new URL(t,window.location.origin),l=e.pathname,n=l.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!n,patientId:n?n[1]:null,recordId:n?n[2]:null,fullPath:l+e.search,params:e.searchParams}}function ne(){C.log("action","Запущена процедура очистки"),C.intervalId!==null&&(clearInterval(C.intervalId),C.log("unmount","Интервал остановлен:",C.intervalId),C.intervalId=null);const t=document.getElementById(me);t&&(t.remove(),C.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),C.mounted=!1}function ce(t=!1){const e=Xe(window.location.href);C.log("check","Проверка страницы:",e),e.recordId!==C.currentRecordId&&(C.log("route",`Изменился ID записи: ${C.currentRecordId||"none"} -> ${e.recordId||"none"}`),C.currentRecordId=e.recordId,C.currentPatientId=e.patientId,C.mounted&&(C.log("action","Удаляем компоненты из-за смены записи"),ne()));const n=document.querySelector(Et),o=document.getElementById(me);if(C.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!n}, mounted=${C.mounted}`),!o&&C.mounted&&(C.log("warn","Компонент исчез из DOM, но состояние не обновлено"),C.mounted=!1),e.isRecordPage&&n){if(!o){C.log("mount","Монтируем компонент TreatmentSchemeButton");const s=document.createElement("div");s.id=me,n.appendChild(s);try{new Dt({target:s,props:{serviceId:e.recordId,medicalCardId:e.patientId}}),C.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),C.mounted=!0}catch(i){C.log("error","Ошибка при монтировании TreatmentSchemeButton:",i),s.remove()}}}else!e.isRecordPage&&(o||C.mounted)&&(C.log("action","Не страница записи - удаляем компонент"),ne())}function Tt(){C.log("start","Инициализация компонентов"),ne(),window._recordButtonListenersInitialized||(Ct(),window._recordButtonListenersInitialized=!0);const t=Xe(window.location.href);return C.currentPath=t.fullPath,C.currentRecordId=t.recordId,C.currentPatientId=t.patientId,ce(!0),C.intervalId=setInterval(()=>{C.log("timer","Регулярная проверка по интервалу"),ce()},1e3),C.log("success","Интервал установлен, ID:",C.intervalId),ne}function Ct(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),C.log("route",`Обнаружен ${t}`),Ye()}}),window.addEventListener("popstate",()=>{C.log("route","Обнаружен popstate"),Ye()})}function Ye(){[10,50,100,250,500,1e3,1500].forEach((e,l)=>{setTimeout(()=>{C.log("timer",`Запланированная проверка #${l+1} (${e}ms)`),ce(!0)},e)})}window.addEventListener("beforeunload",ne),C.log("info","Модуль загружен"),ce(!0);const Mt=[{match:/\/medical_records\/\d+\/\d+$/,render:Tt}];let Ze=null;function Rt(){console.log("📡 Router запущен"),$e(()=>{const t=window.location.pathname,e=Mt.find(l=>l.match.test(t));console.log("📌 Найден роут:",e?.match),e!==Ze&&(Ze=e,e?.render())})}console.log("✅ Content script работает"),Rt()})();
