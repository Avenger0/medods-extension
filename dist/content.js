(function(){"use strict";var _e=document.createElement("style");_e.textContent=`.treatment-scheme-button.svelte-1ckva7w.svelte-1ckva7w{background-color:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}.modal-overlay.svelte-1ckva7w.svelte-1ckva7w{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content.svelte-1ckva7w.svelte-1ckva7w{background:white;border-radius:8px;max-width:1100px;max-height:80%;position:relative;padding:20px;box-shadow:0 4px 6px #0000001a}.modal-grid.svelte-1ckva7w.svelte-1ckva7w{display:grid;grid-template-columns:1fr 1fr;gap:20px}.medication-form-column.svelte-1ckva7w.svelte-1ckva7w{display:flex;flex-direction:column;gap:10px;max-width:350px}.schedule-column.svelte-1ckva7w.svelte-1ckva7w{display:flex;flex-direction:column;gap:10px}.form-control.svelte-1ckva7w.svelte-1ckva7w{width:100%;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;font-size:14px}.modal-close.svelte-1ckva7w.svelte-1ckva7w{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999}.administration-type.svelte-1ckva7w.svelte-1ckva7w,.diluent-choice.svelte-1ckva7w.svelte-1ckva7w{display:flex;gap:15px;margin-bottom:10px}.administration-type.svelte-1ckva7w label.svelte-1ckva7w,.diluent-choice.svelte-1ckva7w label.svelte-1ckva7w{display:flex;align-items:center;gap:5px}.schedule-table.svelte-1ckva7w.svelte-1ckva7w{border:1px solid #ddd}.schedule-header.svelte-1ckva7w.svelte-1ckva7w{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-1ckva7w.svelte-1ckva7w,.medication-column.svelte-1ckva7w.svelte-1ckva7w{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-1ckva7w.svelte-1ckva7w{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-1ckva7w.svelte-1ckva7w{padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-1ckva7w.svelte-1ckva7w{height:30px;border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-1ckva7w.svelte-1ckva7w:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-1ckva7w.svelte-1ckva7w{background-color:#007bff}.btn-add.svelte-1ckva7w.svelte-1ckva7w,.btn-continue.svelte-1ckva7w.svelte-1ckva7w{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}.btn-add.svelte-1ckva7w.svelte-1ckva7w:disabled,.btn-continue.svelte-1ckva7w.svelte-1ckva7w:disabled{opacity:.5;cursor:not-allowed}.existing-schemes.svelte-1ckva7w.svelte-1ckva7w{margin-top:20px}.scheme-item.svelte-1ckva7w.svelte-1ckva7w{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:10px;margin-bottom:10px;cursor:pointer;transition:background-color .3s ease}.scheme-item.svelte-1ckva7w.svelte-1ckva7w:hover{background-color:#e9ecef}.medication-details.svelte-1ckva7w.svelte-1ckva7w{color:#6c757d;font-size:.9em;margin-top:5px}.btn-add-new-scheme.svelte-1ckva7w.svelte-1ckva7w{background-color:#28a745;color:#fff;border:none;padding:10px;border-radius:4px;margin-top:10px;cursor:pointer;width:100%}
`,document.head.appendChild(_e);function qe(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function l(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(n=>{const i=history[n];history[n]=function(...s){i.apply(this,s),l()}}),window.addEventListener("popstate",l),t()}function V(){}function ve(t){return t()}function he(){return Object.create(null)}function J(t){t.forEach(ve)}function me(t){return typeof t=="function"}function Ge(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function He(t){return Object.keys(t).length===0}function a(t,e){t.appendChild(e)}function E(t,e,l){t.insertBefore(e,l||null)}function C(t){t.parentNode&&t.parentNode.removeChild(t)}function Z(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function m(t){return document.createElement(t)}function R(t){return document.createTextNode(t)}function M(){return R(" ")}function Ve(){return R("")}function U(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function Je(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function w(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function pe(t){let e;return{p(...l){e=l,e.forEach(n=>t.push(n))},r(){e.forEach(l=>t.splice(t.indexOf(l),1))}}}function Ke(t){return Array.from(t.childNodes)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function ie(t,e){t.value=e??""}function ce(t,e,l){for(let n=0;n<t.options.length;n+=1){const i=t.options[n];if(i.__value===e){i.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function ge(t){const e=t.querySelector(":checked");return e&&e.__value}function ke(t,e,l){t.classList[l?"add":"remove"](e)}let re;function ee(t){re=t}function Qe(t,e){const l=t.$$.callbacks[e.type];l&&l.slice().forEach(n=>n.call(this,e))}const Q=[],we=[];let W=[];const be=[],We=Promise.resolve();let ue=!1;function Xe(){ue||(ue=!0,We.then(ye))}function te(t){W.push(t)}const de=new Set;let X=0;function ye(){if(X!==0)return;const t=re;do{try{for(;X<Q.length;){const e=Q[X];X++,ee(e),Ye(e.$$)}}catch(e){throw Q.length=0,X=0,e}for(ee(null),Q.length=0,X=0;we.length;)we.pop()();for(let e=0;e<W.length;e+=1){const l=W[e];de.has(l)||(de.add(l),l())}W.length=0}while(Q.length);for(;be.length;)be.pop()();ue=!1,de.clear(),ee(t)}function Ye(t){if(t.fragment!==null){t.update(),J(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(te)}}function Ze(t){const e=[],l=[];W.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),W=e}const $e=new Set;function Ie(t,e){t&&t.i&&($e.delete(t),t.i(e))}function et(t,e){t.d(1),e.delete(t.key)}function tt(t,e,l,n,i,s,o,_,v,c,f,r){let u=t.length,p=s.length,d=u;const P={};for(;d--;)P[t[d].key]=d;const B=[],T=new Map,O=new Map,S=[];for(d=p;d--;){const k=r(i,s,d),L=l(k);let z=o.get(L);z?n&&S.push(()=>z.p(k,e)):(z=c(L,k),z.c()),T.set(L,B[d]=z),L in P&&O.set(L,Math.abs(d-P[L]))}const I=new Set,g=new Set;function y(k){Ie(k,1),k.m(_,f),o.set(k.key,k),f=k.first,p--}for(;u&&p;){const k=B[p-1],L=t[u-1],z=k.key,q=L.key;k===L?(f=k.first,u--,p--):T.has(q)?!o.has(z)||I.has(z)?y(k):g.has(q)?u--:O.get(z)>O.get(q)?(g.add(z),y(k)):(I.add(q),u--):(v(L,o),u--)}for(;u--;){const k=t[u];T.has(k.key)||v(k,o)}for(;p;)y(B[p-1]);return J(S),B}function lt(t,e,l,n){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,l),n||te(()=>{const o=t.$$.on_mount.map(ve).filter(me);t.$$.on_destroy?t.$$.on_destroy.push(...o):J(o),t.$$.on_mount=[]}),s.forEach(te)}function nt(t,e){const l=t.$$;l.fragment!==null&&(Ze(l.after_update),J(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function ot(t,e){t.$$.dirty[0]===-1&&(Q.push(t),Xe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function it(t,e,l,n,i,s,o,_=[-1]){const v=re;ee(t);const c=t.$$={fragment:null,ctx:[],props:s,update:V,not_equal:i,bound:he(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(v?v.$$.context:[])),callbacks:he(),dirty:_,skip_bound:!1,root:e.target||v.$$.root};o&&o(c.root);let f=!1;if(c.ctx=l?l(t,e.props||{},(r,u,...p)=>{const d=p.length?p[0]:u;return c.ctx&&i(c.ctx[r],c.ctx[r]=d)&&(!c.skip_bound&&c.bound[r]&&c.bound[r](d),f&&ot(t,r)),u}):[],c.update(),f=!0,J(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const r=Ke(e.target);c.fragment&&c.fragment.l(r),r.forEach(C)}else c.fragment&&c.fragment.c();e.intro&&Ie(t.$$.fragment),lt(t,e.target,e.anchor,e.customElement),ye()}ee(v)}class ct{$destroy(){nt(this,1),this.$destroy=V}$on(e,l){if(!me(l))return V;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const i=n.indexOf(l);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!He(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const bt="";function De(t,e,l){const n=t.slice();return n[30]=e[l],n}function Ce(t,e,l){const n=t.slice();return n[33]=e[l],n}function st(t,e,l){const n=t.slice();return n[33]=e[l],n}function Ee(t,e,l){const n=t.slice();return n[41]=e[l],n}function Te(t,e,l){const n=t.slice();return n[38]=e[l],n}function Se(t,e,l){const n=t.slice();return n[41]=e[l],n}function Re(t){let e,l,n,i,s,o,_,v,c;function f(d,P){return d[2]?at:rt}let r=f(t),u=r(t),p=t[2]&&t[3].length>0&&Ne(t);return{c(){e=m("div"),l=m("div"),n=m("button"),n.textContent="✖",i=M(),s=m("div"),o=m("div"),u.c(),_=M(),p&&p.c(),w(n,"class","modal-close svelte-1ckva7w"),w(o,"class","medication-form-column svelte-1ckva7w"),w(s,"class","modal-grid svelte-1ckva7w"),w(l,"class","modal-content svelte-1ckva7w"),w(e,"class","modal-overlay svelte-1ckva7w")},m(d,P){E(d,e,P),a(e,l),a(l,n),a(l,i),a(l,s),a(s,o),u.m(o,null),a(s,_),p&&p.m(s,null),v||(c=[U(n,"click",t[8]),U(l,"click",Je(t[16])),U(e,"mousedown",t[28])],v=!0)},p(d,P){r===(r=f(d))&&u?u.p(d,P):(u.d(1),u=r(d),u&&(u.c(),u.m(o,null))),d[2]&&d[3].length>0?p?p.p(d,P):(p=Ne(d),p.c(),p.m(s,null)):p&&(p.d(1),p=null)},d(d){d&&C(e),u.d(),p&&p.d(),v=!1,J(c)}}}function at(t){let e,l,n,i,s,o,_,v,c,f,r,u,p,d,P,B,T,O,S,I,g,y,k,L,z,q,K,G,ae,Y,ne,oe,D,x,H=t[6],j=[];for(let h=0;h<H.length;h+=1)j[h]=Me(Ee(t,H,h));let F=t[0].hasDiluent==="да"&&Pe(t);return ne=pe(t[20][0]),oe=pe(t[20][1]),{c(){e=m("h2"),e.textContent="Добавление препарата",l=M(),n=m("select");for(let h=0;h<j.length;h+=1)j[h].c();i=M(),s=m("div"),o=m("label"),_=m("input"),v=R(` \r
                  Внутримышечно`),c=M(),f=m("label"),r=m("input"),u=R(` \r
                  Внутривенно`),p=M(),d=m("input"),P=M(),B=m("div"),T=m("label"),T.textContent="Использовать растворитель:",O=M(),S=m("label"),I=m("input"),g=R(` \r
                  Нет`),y=M(),k=m("label"),L=m("input"),z=R(` \r
                  Да`),q=M(),F&&F.c(),K=M(),G=m("button"),ae=R("Добавить препарат"),w(n,"class","form-control svelte-1ckva7w"),t[0].medication===void 0&&te(()=>t[18].call(n)),w(_,"type","radio"),_.__value="в/м",_.value=_.__value,w(o,"class","svelte-1ckva7w"),w(r,"type","radio"),r.__value="в/в",r.value=r.__value,w(f,"class","svelte-1ckva7w"),w(s,"class","administration-type svelte-1ckva7w"),w(d,"type","text"),w(d,"placeholder","Дозировка препарата"),w(d,"class","form-control svelte-1ckva7w"),w(T,"class","svelte-1ckva7w"),w(I,"type","radio"),I.__value="нет",I.value=I.__value,w(S,"class","svelte-1ckva7w"),w(L,"type","radio"),L.__value="да",L.value=L.__value,w(k,"class","svelte-1ckva7w"),w(B,"class","diluent-choice svelte-1ckva7w"),w(G,"class","btn-add svelte-1ckva7w"),G.disabled=Y=!t[5],ne.p(I,L),oe.p(_,r)},m(h,N){E(h,e,N),E(h,l,N),E(h,n,N);for(let A=0;A<j.length;A+=1)j[A]&&j[A].m(n,null);ce(n,t[0].medication,!0),E(h,i,N),E(h,s,N),a(s,o),a(o,_),_.checked=_.__value===t[0].administrationType,a(o,v),a(s,c),a(s,f),a(f,r),r.checked=r.__value===t[0].administrationType,a(f,u),E(h,p,N),E(h,d,N),ie(d,t[0].dosage),E(h,P,N),E(h,B,N),a(B,T),a(B,O),a(B,S),a(S,I),I.checked=I.__value===t[0].hasDiluent,a(S,g),a(B,y),a(B,k),a(k,L),L.checked=L.__value===t[0].hasDiluent,a(k,z),E(h,q,N),F&&F.m(h,N),E(h,K,N),E(h,G,N),a(G,ae),D||(x=[U(n,"change",t[18]),U(_,"change",t[19]),U(r,"change",t[21]),U(d,"input",t[22]),U(I,"change",t[23]),U(L,"change",t[24]),U(G,"click",t[9])],D=!0)},p(h,N){if(N[0]&64){H=h[6];let A;for(A=0;A<H.length;A+=1){const Fe=Ee(h,H,A);j[A]?j[A].p(Fe,N):(j[A]=Me(Fe),j[A].c(),j[A].m(n,null))}for(;A<j.length;A+=1)j[A].d(1);j.length=H.length}N[0]&65&&ce(n,h[0].medication),N[0]&65&&(_.checked=_.__value===h[0].administrationType),N[0]&65&&(r.checked=r.__value===h[0].administrationType),N[0]&65&&d.value!==h[0].dosage&&ie(d,h[0].dosage),N[0]&65&&(I.checked=I.__value===h[0].hasDiluent),N[0]&65&&(L.checked=L.__value===h[0].hasDiluent),h[0].hasDiluent==="да"?F?F.p(h,N):(F=Pe(h),F.c(),F.m(K.parentNode,K)):F&&(F.d(1),F=null),N[0]&32&&Y!==(Y=!h[5])&&(G.disabled=Y)},d(h){h&&C(e),h&&C(l),h&&C(n),Z(j,h),h&&C(i),h&&C(s),h&&C(p),h&&C(d),h&&C(P),h&&C(B),h&&C(q),F&&F.d(h),h&&C(K),h&&C(G),ne.r(),oe.r(),D=!1,J(x)}}}function rt(t){let e,l,n,i,s,o,_;function v(r,u){return r[7].length?dt:ut}let f=v(t)(t);return{c(){e=m("div"),l=m("h2"),l.textContent="Существующие схемы лечения",n=M(),f.c(),i=M(),s=m("button"),s.textContent="+ Создать новую схему",w(e,"class","existing-schemes svelte-1ckva7w"),w(s,"class","btn-add-new-scheme svelte-1ckva7w")},m(r,u){E(r,e,u),a(e,l),a(e,n),f.m(e,null),E(r,i,u),E(r,s,u),o||(_=U(s,"click",t[12]),o=!0)},p(r,u){f.p(r,u)},d(r){r&&C(e),f.d(),r&&C(i),r&&C(s),o=!1,_()}}}function Me(t){let e,l=t[41].name+"",n;return{c(){e=m("option"),n=R(l),e.__value=t[41],e.value=e.__value},m(i,s){E(i,e,s),a(e,n)},p:V,d(i){i&&C(e)}}}function Pe(t){let e,l,n,i,s,o,_,v;return{c(){e=m("select"),l=m("option"),l.textContent="Выберите растворитель",n=m("option"),n.textContent="Глюкоза",i=m("option"),i.textContent="Физраствор",s=M(),o=m("input"),l.__value="",l.value=l.__value,n.__value="глюкоза",n.value=n.__value,i.__value="физраствор",i.value=i.__value,w(e,"class","form-control svelte-1ckva7w"),t[0].diluent===void 0&&te(()=>t[25].call(e)),w(o,"type","text"),w(o,"placeholder","Дозировка растворителя"),w(o,"class","form-control svelte-1ckva7w")},m(c,f){E(c,e,f),a(e,l),a(e,n),a(e,i),ce(e,t[0].diluent,!0),E(c,s,f),E(c,o,f),ie(o,t[0].diluentDosage),_||(v=[U(e,"change",t[25]),U(o,"input",t[26])],_=!0)},p(c,f){f[0]&65&&ce(e,c[0].diluent),f[0]&65&&o.value!==c[0].diluentDosage&&ie(o,c[0].diluentDosage)},d(c){c&&C(e),c&&C(s),c&&C(o),_=!1,J(v)}}}function ut(t){let e;return{c(){e=m("p"),e.textContent="Нет существующих схем"},m(l,n){E(l,e,n)},p:V,d(l){l&&C(e)}}}function dt(t){let e,l=t[7],n=[];for(let i=0;i<l.length;i+=1)n[i]=Be(Te(t,l,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=Ve()},m(i,s){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(i,s);E(i,e,s)},p(i,s){if(s[0]&2176){l=i[7];let o;for(o=0;o<l.length;o+=1){const _=Te(i,l,o);n[o]?n[o].p(_,s):(n[o]=Be(_),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=l.length}},d(i){Z(n,i),i&&C(e)}}}function Le(t){let e,l=t[41].name+"",n,i,s=t[41].dosage+"",o,_,v=t[41].администрationType+"",c,f;return{c(){e=m("div"),n=R(l),i=R(", "),o=R(s),_=R(" ("),c=R(v),f=R(")"),w(e,"class","medication-details svelte-1ckva7w")},m(r,u){E(r,e,u),a(e,n),a(e,i),a(e,o),a(e,_),a(e,c),a(e,f)},p:V,d(r){r&&C(e)}}}function Be(t){let e,l,n=t[38].name+"",i,s,o,_,v,c=t[38].medications,f=[];for(let u=0;u<c.length;u+=1)f[u]=Le(Se(t,c,u));function r(){return t[17](t[38])}return{c(){e=m("div"),l=m("strong"),i=R(n),s=M();for(let u=0;u<f.length;u+=1)f[u].c();o=M(),w(e,"class","scheme-item svelte-1ckva7w")},m(u,p){E(u,e,p),a(e,l),a(l,i),a(e,s);for(let d=0;d<f.length;d+=1)f[d]&&f[d].m(e,null);a(e,o),_||(v=U(e,"click",r),_=!0)},p(u,p){if(t=u,p[0]&128){c=t[38].medications;let d;for(d=0;d<c.length;d+=1){const P=Se(t,c,d);f[d]?f[d].p(P,p):(f[d]=Le(P),f[d].c(),f[d].m(e,o))}for(;d<f.length;d+=1)f[d].d(1);f.length=c.length}},d(u){u&&C(e),Z(f,u),_=!1,v()}}}function Ne(t){let e,l,n,i,s,o,_,v,c=[],f=new Map,r,u,p,d,P,B,T=[1,2,3,4,5,6,7,8,9,10],O=[];for(let g=0;g<10;g+=1)O[g]=ft(st(t,T,g));let S=t[3];const I=g=>g[30].id;for(let g=0;g<S.length;g+=1){let y=De(t,S,g),k=I(y);f.set(k,c[g]=Ae(k,y))}return{c(){e=m("div"),l=m("h2"),l.textContent="График приема препаратов",n=M(),i=m("div"),s=m("div"),o=m("div"),o.textContent="Препарат",_=M();for(let g=0;g<10;g+=1)O[g].c();v=M();for(let g=0;g<c.length;g+=1)c[g].c();r=M(),u=m("button"),p=R("Опубликовать схему"),w(o,"class","medication-column svelte-1ckva7w"),w(s,"class","schedule-header svelte-1ckva7w"),w(i,"class","schedule-table svelte-1ckva7w"),w(u,"class","btn-continue svelte-1ckva7w"),u.disabled=d=t[3].length===0,w(e,"class","schedule-column svelte-1ckva7w")},m(g,y){E(g,e,y),a(e,l),a(e,n),a(e,i),a(i,s),a(s,o),a(s,_);for(let k=0;k<10;k+=1)O[k]&&O[k].m(s,null);a(i,v);for(let k=0;k<c.length;k+=1)c[k]&&c[k].m(i,null);a(e,r),a(e,u),a(u,p),P||(B=U(u,"click",t[13]),P=!0)},p(g,y){y[0]&1048&&(S=g[3],c=tt(c,y,I,1,g,S,f,i,et,Ae,null,De)),y[0]&8&&d!==(d=g[3].length===0)&&(u.disabled=d)},d(g){g&&C(e),Z(O,g);for(let y=0;y<c.length;y+=1)c[y].d();P=!1,B()}}}function ft(t){let e,l,n;return{c(){e=m("div"),l=R("День "),n=R(t[33]),w(e,"class","day-header svelte-1ckva7w")},m(i,s){E(i,e,s),a(e,l),a(e,n)},p:V,d(i){i&&C(e)}}}function Oe(t){let e,l,n=t[30].diluent+"",i,s,o=t[30].diluentDosage+"",_;return{c(){e=m("div"),l=R("Растворитель: "),i=R(n),s=R(`, \r
                          Доза: `),_=R(o)},m(v,c){E(v,e,c),a(e,l),a(e,i),a(e,s),a(e,_)},p(v,c){c[0]&8&&n!==(n=v[30].diluent+"")&&$(i,n),c[0]&8&&o!==(o=v[30].diluentDosage+"")&&$(_,o)},d(v){v&&C(e)}}}function Ue(t){let e,l,n;function i(){return t[27](t[30],t[33])}return{c(){e=m("div"),w(e,"class","schedule-cell svelte-1ckva7w"),ke(e,"selected",t[4][t[30].id]&&t[4][t[30].id][1]&&t[4][t[30].id][1].has(t[33]))},m(s,o){E(s,e,o),l||(n=U(e,"click",i),l=!0)},p(s,o){t=s,o[0]&24&&ke(e,"selected",t[4][t[30].id]&&t[4][t[30].id][1]&&t[4][t[30].id][1].has(t[33]))},d(s){s&&C(e),l=!1,n()}}}function Ae(t,e){let l,n,i,s=e[30].medication.name+"",o,_,v,c=e[30].administrationType+"",f,r,u=e[30].dosage+"",p,d,P,B,T=e[30].hasDiluent==="да"&&Oe(e),O=[1,2,3,4,5,6,7,8,9,10],S=[];for(let I=0;I<10;I+=1)S[I]=Ue(Ce(e,O,I));return{key:t,first:null,c(){l=m("div"),n=m("div"),i=m("strong"),o=R(s),_=M(),v=m("div"),f=R(c),r=R(", "),p=R(u),d=M(),T&&T.c(),P=M();for(let I=0;I<10;I+=1)S[I].c();B=M(),w(n,"class","medication-cell svelte-1ckva7w"),w(l,"class","schedule-row svelte-1ckva7w"),this.first=l},m(I,g){E(I,l,g),a(l,n),a(n,i),a(i,o),a(n,_),a(n,v),a(v,f),a(v,r),a(v,p),a(n,d),T&&T.m(n,null),a(l,P);for(let y=0;y<10;y+=1)S[y]&&S[y].m(l,null);a(l,B)},p(I,g){if(e=I,g[0]&8&&s!==(s=e[30].medication.name+"")&&$(o,s),g[0]&8&&c!==(c=e[30].administrationType+"")&&$(f,c),g[0]&8&&u!==(u=e[30].dosage+"")&&$(p,u),e[30].hasDiluent==="да"?T?T.p(e,g):(T=Oe(e),T.c(),T.m(n,null)):T&&(T.d(1),T=null),g[0]&1048){O=[1,2,3,4,5,6,7,8,9,10];let y;for(y=0;y<10;y+=1){const k=Ce(e,O,y);S[y]?S[y].p(k,g):(S[y]=Ue(k),S[y].c(),S[y].m(l,B))}for(;y<10;y+=1)S[y].d(1)}},d(I){I&&C(l),T&&T.d(),Z(S,I)}}}function _t(t){let e,l,n,i,s,o=t[1]&&Re(t);return{c(){e=m("div"),l=m("button"),l.textContent="📋 Схема лечения",n=M(),o&&o.c(),w(l,"class","treatment-scheme-button svelte-1ckva7w"),w(e,"class","treatment-scheme-container")},m(_,v){E(_,e,v),a(e,l),a(e,n),o&&o.m(e,null),i||(s=U(l,"click",t[8]),i=!0)},p(_,v){_[1]?o?o.p(_,v):(o=Re(_),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i:V,o:V,d(_){_&&C(e),o&&o.d(),i=!1,s()}}}function vt(t,e,l){let n,{serviceId:i=null}=e,{medicalCardId:s=null}=e,o=!1,_=!1,v=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],c={medication:v[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluent:"",diluentDosage:""},f=[],r={},u=[{id:1,name:"Схема лечения №1",medications:[{name:"Цефтриаксон",dosage:"1г",администрationType:"в/м"}]},{id:2,name:"Схема лечения №2",medications:[{name:"Метронидазол",dosage:"500мг",администрationType:"в/в"}]}];function p(){l(1,o=!o),o||d()}function d(){l(0,c={medication:v[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluent:"",diluentDosage:""}),l(3,f=[]),l(4,r={}),l(2,_=!1)}function P(){if(n){const D={...c,id:Date.now()};D.hasDiluent==="нет"&&(D.diluent="",D.diluentDosage=""),l(3,f=[...f,D]),l(0,c={medication:v[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluent:"",diluentDosage:""})}}function B(D,x,H){r[D]||l(4,r[D]={},r),r[D][x]||l(4,r[D][x]=new Set,r),r[D][x].has(H)?r[D][x].delete(H):r[D][x].add(H),l(4,r={...r})}function T(D){console.log("Выбрана схема:",D),l(3,f=D.medications.map(x=>({...x,id:Date.now(),medication:{name:x.name},administrationType:x.администрationType}))),p()}function O(){l(2,_=!0),l(3,f=[]),l(4,r={})}function S(){console.log("Publish treatment scheme",{serviceId:i,medicalCardId:s,medications:f,schedule:r}),p()}const I=[[],[]];function g(D){Qe.call(this,t,D)}const y=D=>T(D);function k(){c.medication=ge(this),l(0,c),l(6,v)}function L(){c.administrationType=this.__value,l(0,c),l(6,v)}function z(){c.administrationType=this.__value,l(0,c),l(6,v)}function q(){c.dosage=this.value,l(0,c),l(6,v)}function K(){c.hasDiluent=this.__value,l(0,c),l(6,v)}function G(){c.hasDiluent=this.__value,l(0,c),l(6,v)}function ae(){c.diluent=ge(this),l(0,c),l(6,v)}function Y(){c.diluentDosage=this.value,l(0,c),l(6,v)}const ne=(D,x)=>B(D.id,1,x),oe=D=>{D.target.classList.contains("modal-overlay")&&p()};return t.$$set=D=>{"serviceId"in D&&l(14,i=D.serviceId),"medicalCardId"in D&&l(15,s=D.medicalCardId)},t.$$.update=()=>{t.$$.dirty[0]&1&&l(5,n=!!(c.medication&&c.administrationType&&c.dosage&&(c.hasDiluent==="нет"||c.hasDiluent==="да"&&c.diluent&&c.diluentDosage)))},[c,o,_,f,r,n,v,u,p,P,B,T,O,S,i,s,g,y,k,L,I,z,q,K,G,ae,Y,ne,oe]}class ht extends ct{constructor(e){super(),it(this,e,vt,_t,Ge,{serviceId:14,medicalCardId:15},null,[-1,-1])}}const mt="#show_info_table_title",fe="treatment-scheme-container",b={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),log(t,e,...l){if(!this.debug)return;const i={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${i} [RecordBtn-${this.instanceId}] ${e}`,...l)}};function ze(t){const e=new URL(t,window.location.origin),l=e.pathname,n=l.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!n,patientId:n?n[1]:null,recordId:n?n[2]:null,fullPath:l+e.search,params:e.searchParams}}function le(){b.log("action","Запущена процедура очистки"),b.intervalId!==null&&(clearInterval(b.intervalId),b.log("unmount","Интервал остановлен:",b.intervalId),b.intervalId=null);const t=document.getElementById(fe);t&&(t.remove(),b.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),b.mounted=!1}function se(t=!1){const e=ze(window.location.href);b.log("check","Проверка страницы:",e),e.recordId!==b.currentRecordId&&(b.log("route",`Изменился ID записи: ${b.currentRecordId||"none"} -> ${e.recordId||"none"}`),b.currentRecordId=e.recordId,b.currentPatientId=e.patientId,b.mounted&&(b.log("action","Удаляем компоненты из-за смены записи"),le()));const n=document.querySelector(mt),i=document.getElementById(fe);if(b.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!n}, mounted=${b.mounted}`),!i&&b.mounted&&(b.log("warn","Компонент исчез из DOM, но состояние не обновлено"),b.mounted=!1),e.isRecordPage&&n){if(!i){b.log("mount","Монтируем компонент TreatmentSchemeButton");const s=document.createElement("div");s.id=fe,n.appendChild(s);try{new ht({target:s,props:{serviceId:e.recordId,medicalCardId:e.patientId}}),b.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),b.mounted=!0}catch(o){b.log("error","Ошибка при монтировании TreatmentSchemeButton:",o),s.remove()}}}else!e.isRecordPage&&(i||b.mounted)&&(b.log("action","Не страница записи - удаляем компонент"),le())}function pt(){b.log("start","Инициализация компонентов"),le(),window._recordButtonListenersInitialized||(gt(),window._recordButtonListenersInitialized=!0);const t=ze(window.location.href);return b.currentPath=t.fullPath,b.currentRecordId=t.recordId,b.currentPatientId=t.patientId,se(!0),b.intervalId=setInterval(()=>{b.log("timer","Регулярная проверка по интервалу"),se()},1e3),b.log("success","Интервал установлен, ID:",b.intervalId),le}function gt(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),b.log("route",`Обнаружен ${t}`),je()}}),window.addEventListener("popstate",()=>{b.log("route","Обнаружен popstate"),je()})}function je(){[10,50,100,250,500,1e3,1500].forEach((e,l)=>{setTimeout(()=>{b.log("timer",`Запланированная проверка #${l+1} (${e}ms)`),se(!0)},e)})}window.addEventListener("beforeunload",le),b.log("info","Модуль загружен"),se(!0);const kt=[{match:/\/medical_records\/\d+\/\d+$/,render:pt}];let xe=null;function wt(){console.log("📡 Router запущен"),qe(()=>{const t=window.location.pathname,e=kt.find(l=>l.match.test(t));console.log("📌 Найден роут:",e?.match),e!==xe&&(xe=e,e?.render())})}console.log("✅ Content script работает"),wt()})();
