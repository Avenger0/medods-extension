(function(){"use strict";var We=document.createElement("style");We.textContent=`.scheme-item.svelte-56bhtz{background-color:var(--item-bg-color, #f8f9fa);border:1px solid var(--item-border-color, #e9ecef);border-radius:4px;padding:12px;margin-bottom:10px;transition:background-color .2s ease,transform .1s ease}.scheme-item.svelte-56bhtz:hover{background-color:var(--item-hover-color, #e9ecef);transform:translateY(-1px);box-shadow:0 2px 4px #0000000d}.scheme-title.svelte-56bhtz{color:var(--title-color, #333)}.medication-details.svelte-56bhtz{color:var(--details-color, #6c757d);font-size:.9em;margin-top:5px}.scheme-actions.svelte-56bhtz{display:flex;gap:8px;margin-top:10px}.btn-use-scheme.svelte-56bhtz,.btn-edit-scheme.svelte-56bhtz{padding:6px 10px;font-size:13px;border:none;border-radius:4px;cursor:pointer;transition:opacity .2s ease}.btn-use-scheme.svelte-56bhtz{background-color:var(--use-btn-bg, #007bff);color:var(--use-btn-text, #fff)}.btn-edit-scheme.svelte-56bhtz{background-color:var(--edit-btn-bg, #6c757d);color:var(--edit-btn-text, #fff)}.btn-use-scheme.svelte-56bhtz:hover,.btn-edit-scheme.svelte-56bhtz:hover{opacity:.9}.existing-schemes.svelte-5qbczz{margin-top:20px;background-color:var(--bg-color, #f8f9fa);border-radius:6px;padding:15px;border:1px solid var(--border-color, #e9ecef)}h2.svelte-5qbczz{margin-top:0;color:var(--title-color, #333);font-size:1.2rem;margin-bottom:15px;border-bottom:1px solid var(--border-color, #e9ecef);padding-bottom:10px}.schemes-list.svelte-5qbczz{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-height:500px;overflow-y:auto;padding-right:5px}.no-schemes.svelte-5qbczz{font-style:italic;color:#6c757d;text-align:center;padding:15px 0}.modal-overlay.svelte-1lbmm4i{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--overlay-color, rgba(0,0,0,.5));display:flex;justify-content:center;align-items:center;z-index:var(--z-index, 1000);overflow-y:auto}.modal-content.svelte-1lbmm4i{background:var(--bg-color, white);border-radius:var(--border-radius, 8px);max-width:var(--max-width, 1100px);max-height:var(--max-height, 80%);width:calc(100% - 40px);position:relative;padding:var(--padding, 20px);box-shadow:var(--box-shadow, 0 4px 6px rgba(0,0,0,.1));overflow-y:auto}.modal-close.svelte-1lbmm4i{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999;transition:color .2s ease;z-index:1}.modal-close.svelte-1lbmm4i:hover{color:#333}.form-control.svelte-1csq6i4.svelte-1csq6i4{width:100%;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;font-size:14px;padding:8px}.administration-type.svelte-1csq6i4.svelte-1csq6i4,.diluent-choice.svelte-1csq6i4.svelte-1csq6i4{display:flex;gap:15px;margin-bottom:15px}.administration-type.svelte-1csq6i4 label.svelte-1csq6i4,.diluent-choice.svelte-1csq6i4 label.svelte-1csq6i4{display:flex;align-items:center;gap:5px}.diluents-container.svelte-1csq6i4.svelte-1csq6i4{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-1csq6i4.svelte-1csq6i4{display:flex;gap:8px;align-items:center}.diluent-select.svelte-1csq6i4.svelte-1csq6i4{flex:3}.diluent-dosage.svelte-1csq6i4.svelte-1csq6i4{flex:2}.btn-remove-diluent.svelte-1csq6i4.svelte-1csq6i4{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-1csq6i4.svelte-1csq6i4{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer;align-self:flex-start;margin-top:5px}.button-row.svelte-1csq6i4.svelte-1csq6i4{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}.btn-save.svelte-1csq6i4.svelte-1csq6i4,.btn-cancel.svelte-1csq6i4.svelte-1csq6i4{padding:8px 16px;border-radius:4px;cursor:pointer;border:none}.btn-save.svelte-1csq6i4.svelte-1csq6i4{background-color:#2196f3;color:#fff}.btn-save.svelte-1csq6i4.svelte-1csq6i4:disabled{opacity:.5;cursor:not-allowed}.btn-cancel.svelte-1csq6i4.svelte-1csq6i4{background-color:#f1f1f1;color:#333}.btn-add-new-scheme.svelte-zgjj6w{background-color:var(--btn-bg-color, #28a745);color:var(--btn-text-color, #fff);border:none;padding:12px 16px;border-radius:var(--btn-border-radius, 4px);margin-top:15px;cursor:pointer;width:100%;font-weight:500;transition:background-color .2s ease,transform .1s ease;box-shadow:0 2px 4px #0000001a}.btn-add-new-scheme.svelte-zgjj6w:hover{background-color:var(--btn-hover-color, #218838);transform:translateY(-1px);box-shadow:0 3px 6px #00000026}.btn-add-new-scheme.svelte-zgjj6w:active{transform:translateY(1px);box-shadow:0 1px 2px #0000001a}.treatment-scheme-button.svelte-1k8ji36.svelte-1k8ji36{background-color:var(--bg-color, #007bff);color:var(--text-color, white);border:none;padding:8px 12px;border-radius:var(--border-radius, 4px);cursor:pointer;transition:opacity .2s ease}.treatment-scheme-button.svelte-1k8ji36.svelte-1k8ji36:hover{opacity:.9}.modal-grid.svelte-1k8ji36.svelte-1k8ji36{display:grid;gap:20px}.medication-form-column.svelte-1k8ji36.svelte-1k8ji36,.schedule-column.svelte-1k8ji36.svelte-1k8ji36{display:flex;flex-direction:column;gap:10px}.schedule-table.svelte-1k8ji36.svelte-1k8ji36{border:1px solid #ddd}.schedule-header.svelte-1k8ji36.svelte-1k8ji36{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-1k8ji36.svelte-1k8ji36,.medication-column.svelte-1k8ji36.svelte-1k8ji36{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-1k8ji36.svelte-1k8ji36{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-1k8ji36.svelte-1k8ji36{gap:15px;display:flex;align-items:center;justify-content:center;padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-1k8ji36.svelte-1k8ji36{width:50px;border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-1k8ji36.svelte-1k8ji36:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-1k8ji36.svelte-1k8ji36{background-color:#007bff}.btn-continue.svelte-1k8ji36.svelte-1k8ji36{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}.btn-continue.svelte-1k8ji36.svelte-1k8ji36:disabled{opacity:.5;cursor:not-allowed}.error-highlight.svelte-1k8ji36 .medication-cell.svelte-1k8ji36{background-color:#fff4f4;border-left:3px solid #dc3545}.validation-error.svelte-1k8ji36.svelte-1k8ji36{background-color:#fff3cd;color:#856404;padding:10px;margin-bottom:15px;border-radius:4px;border-left:4px solid #ffc107;font-size:14px}.medication-actions.svelte-1k8ji36.svelte-1k8ji36{margin-top:5px;display:flex;gap:5px}.btn-edit-medication.svelte-1k8ji36.svelte-1k8ji36,.btn-delete-medication.svelte-1k8ji36.svelte-1k8ji36{padding:2px 5px;font-size:12px;border:none;border-radius:3px;cursor:pointer;background-color:transparent}.btn-edit-medication.svelte-1k8ji36.svelte-1k8ji36:hover{background-color:#f0f0f0}.btn-delete-medication.svelte-1k8ji36.svelte-1k8ji36:hover{background-color:#fff5f5}.spinner.svelte-1k8ji36.svelte-1k8ji36{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-1k8ji36-spin 1s ease-in-out infinite;margin-right:8px}.btn-add-medication.svelte-1k8ji36.svelte-1k8ji36{background-color:#2196f3;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:14px}@keyframes svelte-1k8ji36-spin{to{transform:rotate(360deg)}}
`,document.head.appendChild(We);function jt(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function o(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(l=>{const i=history[l];history[l]=function(...n){i.apply(this,n),o()}}),window.addEventListener("popstate",o),t()}function re(){}function Tt(t,e){for(const o in e)t[o]=e[o];return t}function Ae(t){return t()}function Ue(){return Object.create(null)}function ne(t){t.forEach(Ae)}function de(t){return typeof t=="function"}function ge(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function St(t){return Object.keys(t).length===0}function It(t,e,o,l){if(t){const i=Ye(t,e,o,l);return t[0](i)}}function Ye(t,e,o,l){return t[1]&&l?Tt(o.ctx.slice(),t[1](l(e))):o.ctx}function qt(t,e,o,l){if(t[2]&&l){const i=t[2](l(o));if(e.dirty===void 0)return i;if(typeof i=="object"){const n=[],c=Math.max(e.dirty.length,i.length);for(let s=0;s<c;s+=1)n[s]=e.dirty[s]|i[s];return n}return e.dirty|i}return e.dirty}function zt(t,e,o,l,i,n){if(i){const c=Ye(e,o,l,n);t.p(c,i)}}function Et(t){if(t.ctx.length>32){const e=[],o=t.ctx.length/32;for(let l=0;l<o;l++)e[l]=-1;return e}return-1}function m(t,e){t.appendChild(e)}function S(t,e,o){t.insertBefore(e,o||null)}function T(t){t.parentNode&&t.parentNode.removeChild(t)}function ye(t,e){for(let o=0;o<t.length;o+=1)t[o]&&t[o].d(e)}function v(t){return document.createElement(t)}function x(t){return document.createTextNode(t)}function O(){return x(" ")}function Ie(){return x("")}function N(t,e,o,l){return t.addEventListener(e,o,l),()=>t.removeEventListener(e,o,l)}function Me(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function C(t,e,o){o==null?t.removeAttribute(e):t.getAttribute(e)!==o&&t.setAttribute(e,o)}function Ve(t){let e;return{p(...o){e=o,e.forEach(l=>t.push(l))},r(){e.forEach(o=>t.splice(t.indexOf(o),1))}}}function Dt(t){return Array.from(t.childNodes)}function le(t,e){e=""+e,t.data!==e&&(t.data=e)}function qe(t,e){t.value=e??""}function y(t,e,o,l){o==null?t.style.removeProperty(e):t.style.setProperty(e,o,l?"important":"")}function ze(t,e,o){for(let l=0;l<t.options.length;l+=1){const i=t.options[l];if(i.__value===e){i.selected=!0;return}}(!o||e!==void 0)&&(t.selectedIndex=-1)}function Ge(t){const e=t.querySelector(":checked");return e&&e.__value}function Je(t,e,o){t.classList[o?"add":"remove"](e)}let He;function we(t){He=t}function Rt(t,e){const o=t.$$.callbacks[e.type];o&&o.slice().forEach(l=>l.call(this,e))}const _e=[],Ke=[];let be=[];const Qe=[],Ot=Promise.resolve();let Pe=!1;function xt(){Pe||(Pe=!0,Ot.then(Xe))}function je(t){be.push(t)}const Le=new Set;let ve=0;function Xe(){if(ve!==0)return;const t=He;do{try{for(;ve<_e.length;){const e=_e[ve];ve++,we(e),Mt(e.$$)}}catch(e){throw _e.length=0,ve=0,e}for(we(null),_e.length=0,ve=0;Ke.length;)Ke.pop()();for(let e=0;e<be.length;e+=1){const o=be[e];Le.has(o)||(Le.add(o),o())}be.length=0}while(_e.length);for(;Qe.length;)Qe.pop()();Pe=!1,Le.clear(),we(t)}function Mt(t){if(t.fragment!==null){t.update(),ne(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(je)}}function Ht(t){const e=[],o=[];be.forEach(l=>t.indexOf(l)===-1?e.push(l):o.push(l)),o.forEach(l=>l()),be=e}const Ee=new Set;let fe;function De(){fe={r:0,c:[],p:fe}}function Re(){fe.r||ne(fe.c),fe=fe.p}function J(t,e){t&&t.i&&(Ee.delete(t),t.i(e))}function $(t,e,o,l){if(t&&t.o){if(Ee.has(t))return;Ee.add(t),fe.c.push(()=>{Ee.delete(t),l&&(o&&t.d(1),l())}),t.o(e)}else l&&l()}function Ze(t,e){t.d(1),e.delete(t.key)}function Pt(t,e){$(t,1,1,()=>{e.delete(t.key)})}function Fe(t,e,o,l,i,n,c,s,r,a,d,u){let h=t.length,p=n.length,j=h;const b={};for(;j--;)b[t[j].key]=j;const B=[],_=new Map,q=new Map,F=[];for(j=p;j--;){const k=u(i,n,j),D=o(k);let g=c.get(D);g?l&&F.push(()=>g.p(k,e)):(g=a(D,k),g.c()),_.set(D,B[j]=g),D in b&&q.set(D,Math.abs(j-b[D]))}const K=new Set,U=new Set;function M(k){J(k,1),k.m(s,d),c.set(k.key,k),d=k.first,p--}for(;h&&p;){const k=B[p-1],D=t[h-1],g=k.key,R=D.key;k===D?(d=k.first,h--,p--):_.has(R)?!c.has(g)||K.has(g)?M(k):U.has(R)?h--:q.get(g)>q.get(R)?(U.add(g),M(k)):(K.add(R),h--):(r(D,c),h--)}for(;h--;){const k=t[h];_.has(k.key)||r(k,c)}for(;p;)M(B[p-1]);return ne(F),B}function Ce(t){t&&t.c()}function me(t,e,o,l){const{fragment:i,after_update:n}=t.$$;i&&i.m(e,o),l||je(()=>{const c=t.$$.on_mount.map(Ae).filter(de);t.$$.on_destroy?t.$$.on_destroy.push(...c):ne(c),t.$$.on_mount=[]}),n.forEach(je)}function he(t,e){const o=t.$$;o.fragment!==null&&(Ht(o.after_update),ne(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[])}function Lt(t,e){t.$$.dirty[0]===-1&&(_e.push(t),xt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ke(t,e,o,l,i,n,c,s=[-1]){const r=He;we(t);const a=t.$$={fragment:null,ctx:[],props:n,update:re,not_equal:i,bound:Ue(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(r?r.$$.context:[])),callbacks:Ue(),dirty:s,skip_bound:!1,root:e.target||r.$$.root};c&&c(a.root);let d=!1;if(a.ctx=o?o(t,e.props||{},(u,h,...p)=>{const j=p.length?p[0]:h;return a.ctx&&i(a.ctx[u],a.ctx[u]=j)&&(!a.skip_bound&&a.bound[u]&&a.bound[u](j),d&&Lt(t,u)),h}):[],a.update(),d=!0,ne(a.before_update),a.fragment=l?l(a.ctx):!1,e.target){if(e.hydrate){const u=Dt(e.target);a.fragment&&a.fragment.l(u),u.forEach(T)}else a.fragment&&a.fragment.c();e.intro&&J(t.$$.fragment),me(t,e.target,e.anchor,e.customElement),Xe()}we(r)}class pe{$destroy(){he(this,1),this.$destroy=re}$on(e,o){if(!de(o))return re;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(o),()=>{const i=l.indexOf(o);i!==-1&&l.splice(i,1)}}$set(e){this.$$set&&!St(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Io="";function $e(t,e,o){const l=t.slice();return l[12]=e[o],l}function et(t){let e,o=t[12].name+"",l,i,n=t[12].dosage+"",c,s,r=t[12].администрationType+"",a,d;return{c(){e=v("div"),l=x(o),i=x(", "),c=x(n),s=x(" ("),a=x(r),d=x(`)\r
        `),C(e,"class","medication-details svelte-56bhtz")},m(u,h){S(u,e,h),m(e,l),m(e,i),m(e,c),m(e,s),m(e,a),m(e,d)},p(u,h){h&1&&o!==(o=u[12].name+"")&&le(l,o),h&1&&n!==(n=u[12].dosage+"")&&le(c,n),h&1&&r!==(r=u[12].администрationType+"")&&le(a,r)},d(u){u&&T(e)}}}function Ft(t){let e,o,l,i=t[0].name+"",n,c,s,r,a,d,u,h,p,j=t[0].medications,b=[];for(let B=0;B<j.length;B+=1)b[B]=et($e(t,j,B));return{c(){e=v("div"),o=v("div"),l=v("strong"),n=x(i),c=O();for(let B=0;B<b.length;B+=1)b[B].c();s=O(),r=v("div"),a=v("button"),a.textContent="Использовать",d=O(),u=v("button"),u.textContent="Редактировать",C(o,"class","scheme-title svelte-56bhtz"),C(a,"class","btn-use-scheme svelte-56bhtz"),C(u,"class","btn-edit-scheme svelte-56bhtz"),C(r,"class","scheme-actions svelte-56bhtz"),C(e,"class","scheme-item svelte-56bhtz"),y(e,"--item-bg-color",t[3]),y(e,"--item-hover-color",t[4]),y(e,"--item-border-color",t[5]),y(e,"--title-color",t[6]),y(e,"--details-color",t[7]),y(e,"--use-btn-bg",t[8]),y(e,"--use-btn-text",t[9]),y(e,"--edit-btn-bg",t[10]),y(e,"--edit-btn-text",t[11])},m(B,_){S(B,e,_),m(e,o),m(o,l),m(l,n),m(o,c);for(let q=0;q<b.length;q+=1)b[q]&&b[q].m(o,null);m(e,s),m(e,r),m(r,a),m(r,d),m(r,u),h||(p=[N(a,"click",Me(function(){de(t[1])&&t[1].apply(this,arguments)})),N(u,"click",Me(function(){de(t[2])&&t[2].apply(this,arguments)}))],h=!0)},p(B,[_]){if(t=B,_&1&&i!==(i=t[0].name+"")&&le(n,i),_&1){j=t[0].medications;let q;for(q=0;q<j.length;q+=1){const F=$e(t,j,q);b[q]?b[q].p(F,_):(b[q]=et(F),b[q].c(),b[q].m(o,null))}for(;q<b.length;q+=1)b[q].d(1);b.length=j.length}_&8&&y(e,"--item-bg-color",t[3]),_&16&&y(e,"--item-hover-color",t[4]),_&32&&y(e,"--item-border-color",t[5]),_&64&&y(e,"--title-color",t[6]),_&128&&y(e,"--details-color",t[7]),_&256&&y(e,"--use-btn-bg",t[8]),_&512&&y(e,"--use-btn-text",t[9]),_&1024&&y(e,"--edit-btn-bg",t[10]),_&2048&&y(e,"--edit-btn-text",t[11])},i:re,o:re,d(B){B&&T(e),ye(b,B),h=!1,ne(p)}}}function Nt(t,e,o){let{scheme:l={}}=e,{onSelect:i}=e,{onEdit:n}=e,{itemBgColor:c="#f8f9fa"}=e,{itemHoverColor:s="#e9ecef"}=e,{itemBorderColor:r="#e9ecef"}=e,{titleColor:a="#333"}=e,{detailsColor:d="#6c757d"}=e,{useButtonBgColor:u="#007bff"}=e,{useButtonTextColor:h="#fff"}=e,{editButtonBgColor:p="#6c757d"}=e,{editButtonTextColor:j="#fff"}=e;return t.$$set=b=>{"scheme"in b&&o(0,l=b.scheme),"onSelect"in b&&o(1,i=b.onSelect),"onEdit"in b&&o(2,n=b.onEdit),"itemBgColor"in b&&o(3,c=b.itemBgColor),"itemHoverColor"in b&&o(4,s=b.itemHoverColor),"itemBorderColor"in b&&o(5,r=b.itemBorderColor),"titleColor"in b&&o(6,a=b.titleColor),"detailsColor"in b&&o(7,d=b.detailsColor),"useButtonBgColor"in b&&o(8,u=b.useButtonBgColor),"useButtonTextColor"in b&&o(9,h=b.useButtonTextColor),"editButtonBgColor"in b&&o(10,p=b.editButtonBgColor),"editButtonTextColor"in b&&o(11,j=b.editButtonTextColor)},[l,i,n,c,s,r,a,d,u,h,p,j]}class Wt extends pe{constructor(e){super(),ke(this,e,Nt,Ft,ge,{scheme:0,onSelect:1,onEdit:2,itemBgColor:3,itemHoverColor:4,itemBorderColor:5,titleColor:6,detailsColor:7,useButtonBgColor:8,useButtonTextColor:9,editButtonBgColor:10,editButtonTextColor:11})}}const qo="";function tt(t,e,o){const l=t.slice();return l[8]=e[o],l}function At(t){let e;return{c(){e=v("p"),e.textContent="Нет существующих схем",C(e,"class","no-schemes svelte-5qbczz")},m(o,l){S(o,e,l)},p:re,i:re,o:re,d(o){o&&T(e)}}}function Ut(t){let e,o=[],l=new Map,i,n=t[0];const c=s=>s[8].id;for(let s=0;s<n.length;s+=1){let r=tt(t,n,s),a=c(r);l.set(a,o[s]=ot(a,r))}return{c(){e=v("div");for(let s=0;s<o.length;s+=1)o[s].c();C(e,"class","schemes-list svelte-5qbczz")},m(s,r){S(s,e,r);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null);i=!0},p(s,r){r&7&&(n=s[0],De(),o=Fe(o,r,c,1,s,n,l,e,Pt,ot,null,tt),Re())},i(s){if(!i){for(let r=0;r<n.length;r+=1)J(o[r]);i=!0}},o(s){for(let r=0;r<o.length;r+=1)$(o[r]);i=!1},d(s){s&&T(e);for(let r=0;r<o.length;r+=1)o[r].d()}}}function ot(t,e){let o,l,i;function n(){return e[6](e[8])}function c(){return e[7](e[8])}return l=new Wt({props:{scheme:e[8],onSelect:n,onEdit:c}}),{key:t,first:null,c(){o=Ie(),Ce(l.$$.fragment),this.first=o},m(s,r){S(s,o,r),me(l,s,r),i=!0},p(s,r){e=s;const a={};r&1&&(a.scheme=e[8]),r&3&&(a.onSelect=n),r&5&&(a.onEdit=c),l.$set(a)},i(s){i||(J(l.$$.fragment,s),i=!0)},o(s){$(l.$$.fragment,s),i=!1},d(s){s&&T(o),he(l,s)}}}function Yt(t){let e,o,l,i,n,c;const s=[Ut,At],r=[];function a(d,u){return d[0].length?0:1}return i=a(t),n=r[i]=s[i](t),{c(){e=v("div"),o=v("h2"),o.textContent="Существующие схемы лечения",l=O(),n.c(),C(o,"class","svelte-5qbczz"),C(e,"class","existing-schemes svelte-5qbczz"),y(e,"--bg-color",t[3]),y(e,"--title-color",t[4]),y(e,"--border-color",t[5])},m(d,u){S(d,e,u),m(e,o),m(e,l),r[i].m(e,null),c=!0},p(d,[u]){let h=i;i=a(d),i===h?r[i].p(d,u):(De(),$(r[h],1,1,()=>{r[h]=null}),Re(),n=r[i],n?n.p(d,u):(n=r[i]=s[i](d),n.c()),J(n,1),n.m(e,null)),(!c||u&8)&&y(e,"--bg-color",d[3]),(!c||u&16)&&y(e,"--title-color",d[4]),(!c||u&32)&&y(e,"--border-color",d[5])},i(d){c||(J(n),c=!0)},o(d){$(n),c=!1},d(d){d&&T(e),r[i].d()}}}function Vt(t,e,o){let{schemes:l=[]}=e,{onSelect:i}=e,{onEdit:n}=e,{bgColor:c="#f8f9fa"}=e,{titleColor:s="#333"}=e,{borderColor:r="#e9ecef"}=e;const a=u=>i(u),d=u=>n(u);return t.$$set=u=>{"schemes"in u&&o(0,l=u.schemes),"onSelect"in u&&o(1,i=u.onSelect),"onEdit"in u&&o(2,n=u.onEdit),"bgColor"in u&&o(3,c=u.bgColor),"titleColor"in u&&o(4,s=u.titleColor),"borderColor"in u&&o(5,r=u.borderColor)},[l,i,n,c,s,r,a,d]}class Gt extends pe{constructor(e){super(),ke(this,e,Vt,Yt,ge,{schemes:0,onSelect:1,onEdit:2,bgColor:3,titleColor:4,borderColor:5})}}const zo="";function lt(t){let e,o,l,i,n,c,s;const r=t[12].default,a=It(r,t,t[11],null);return{c(){e=v("div"),o=v("div"),l=v("button"),l.textContent="✖",i=O(),a&&a.c(),C(l,"class","modal-close svelte-1lbmm4i"),C(o,"class","modal-content svelte-1lbmm4i"),y(o,"--max-width",t[2]),y(o,"--max-height",t[3]),y(o,"--bg-color",t[4]),y(o,"--border-radius",t[5]),y(o,"--padding",t[6]),y(o,"--box-shadow",t[7]),C(e,"class","modal-overlay svelte-1lbmm4i"),y(e,"--overlay-color",t[9]),y(e,"--z-index",t[8])},m(d,u){S(d,e,u),m(e,o),m(o,l),m(o,i),a&&a.m(o,null),n=!0,c||(s=[N(l,"click",function(){de(t[1])&&t[1].apply(this,arguments)}),N(o,"click",Me(t[13])),N(e,"mousedown",t[10])],c=!0)},p(d,u){t=d,a&&a.p&&(!n||u&2048)&&zt(a,r,t,t[11],n?qt(r,t[11],u,null):Et(t[11]),null),(!n||u&4)&&y(o,"--max-width",t[2]),(!n||u&8)&&y(o,"--max-height",t[3]),(!n||u&16)&&y(o,"--bg-color",t[4]),(!n||u&32)&&y(o,"--border-radius",t[5]),(!n||u&64)&&y(o,"--padding",t[6]),(!n||u&128)&&y(o,"--box-shadow",t[7]),(!n||u&512)&&y(e,"--overlay-color",t[9]),(!n||u&256)&&y(e,"--z-index",t[8])},i(d){n||(J(a,d),n=!0)},o(d){$(a,d),n=!1},d(d){d&&T(e),a&&a.d(d),c=!1,ne(s)}}}function Jt(t){let e,o,l=t[0]&&lt(t);return{c(){l&&l.c(),e=Ie()},m(i,n){l&&l.m(i,n),S(i,e,n),o=!0},p(i,[n]){i[0]?l?(l.p(i,n),n&1&&J(l,1)):(l=lt(i),l.c(),J(l,1),l.m(e.parentNode,e)):l&&(De(),$(l,1,1,()=>{l=null}),Re())},i(i){o||(J(l),o=!0)},o(i){$(l),o=!1},d(i){l&&l.d(i),i&&T(e)}}}function Kt(t,e,o){let{$$slots:l={},$$scope:i}=e,{isOpen:n=!1}=e,{onClose:c}=e,{maxWidth:s="1100px"}=e,{maxHeight:r="80%"}=e,{backgroundColor:a="white"}=e,{borderRadius:d="8px"}=e,{padding:u="20px"}=e,{boxShadow:h="0 4px 6px rgba(0,0,0,0.1)"}=e,{zIndex:p=1e3}=e,{overlayColor:j="rgba(0,0,0,0.5)"}=e;function b(_){_.target.classList.contains("modal-overlay")&&c()}function B(_){Rt.call(this,t,_)}return t.$$set=_=>{"isOpen"in _&&o(0,n=_.isOpen),"onClose"in _&&o(1,c=_.onClose),"maxWidth"in _&&o(2,s=_.maxWidth),"maxHeight"in _&&o(3,r=_.maxHeight),"backgroundColor"in _&&o(4,a=_.backgroundColor),"borderRadius"in _&&o(5,d=_.borderRadius),"padding"in _&&o(6,u=_.padding),"boxShadow"in _&&o(7,h=_.boxShadow),"zIndex"in _&&o(8,p=_.zIndex),"overlayColor"in _&&o(9,j=_.overlayColor),"$$scope"in _&&o(11,i=_.$$scope)},[n,c,s,r,a,d,u,h,p,j,b,i,l,B]}class nt extends pe{constructor(e){super(),ke(this,e,Kt,Jt,ge,{isOpen:0,onClose:1,maxWidth:2,maxHeight:3,backgroundColor:4,borderRadius:5,padding:6,boxShadow:7,zIndex:8,overlayColor:9})}}const Eo="";function it(t,e,o){const l=t.slice();return l[20]=e[o],l[21]=e,l[22]=o,l}function st(t,e,o){const l=t.slice();return l[23]=e[o],l}function rt(t){let e,o=t[23].name+"",l,i;return{c(){e=v("option"),l=x(o),e.__value=i=t[23],e.value=e.__value},m(n,c){S(n,e,c),m(e,l)},p(n,c){c&8&&o!==(o=n[23].name+"")&&le(l,o),c&8&&i!==(i=n[23])&&(e.__value=i,e.value=e.__value)},d(n){n&&T(e)}}}function ct(t){let e,o=[],l=new Map,i,n,c,s,r=t[0].diluents;const a=d=>d[20].id;for(let d=0;d<r.length;d+=1){let u=it(t,r,d),h=a(u);l.set(h,o[d]=ut(h,u))}return{c(){e=v("div");for(let d=0;d<o.length;d+=1)o[d].c();i=O(),n=v("button"),n.textContent="+ Добавить растворитель",C(n,"class","btn-add-diluent svelte-1csq6i4"),C(e,"class","diluents-container svelte-1csq6i4")},m(d,u){S(d,e,u);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(e,null);m(e,i),m(e,n),c||(s=N(n,"click",t[6]),c=!0)},p(d,u){u&129&&(r=d[0].diluents,o=Fe(o,u,a,1,d,r,l,e,Ze,ut,i,it))},d(d){d&&T(e);for(let u=0;u<o.length;u+=1)o[u].d();c=!1,s()}}}function ut(t,e){let o,l,i,n,c,s,r,a,d,u,h;function p(){e[17].call(l,e[21],e[22])}function j(){e[18].call(r,e[21],e[22])}function b(){return e[19](e[20])}return{key:t,first:null,c(){o=v("div"),l=v("select"),i=v("option"),i.textContent="Выберите растворитель",n=v("option"),n.textContent="Глюкоза",c=v("option"),c.textContent="Физраствор",s=O(),r=v("input"),a=O(),d=v("button"),d.textContent="✖",i.__value="",i.value=i.__value,n.__value="глюкоза",n.value=n.__value,c.__value="физраствор",c.value=c.__value,C(l,"class","form-control diluent-select svelte-1csq6i4"),e[20].type===void 0&&je(p),C(r,"type","text"),C(r,"placeholder","Дозировка"),C(r,"class","form-control diluent-dosage svelte-1csq6i4"),C(d,"class","btn-remove-diluent svelte-1csq6i4"),C(o,"class","diluent-row svelte-1csq6i4"),this.first=o},m(B,_){S(B,o,_),m(o,l),m(l,i),m(l,n),m(l,c),ze(l,e[20].type,!0),m(o,s),m(o,r),qe(r,e[20].dosage),m(o,a),m(o,d),u||(h=[N(l,"change",p),N(r,"input",j),N(d,"click",b)],u=!0)},p(B,_){e=B,_&9&&ze(l,e[20].type),_&9&&r.value!==e[20].dosage&&qe(r,e[20].dosage)},d(B){B&&T(o),u=!1,ne(h)}}}function Qt(t){let e,o=t[4]?"Редактирование препарата":"Добавление препарата",l,i,n,c,s,r,a,d,u,h,p,j,b,B,_,q,F,K,U,M,k,D,g,R,Y,ce,A,H,W,P,ee,te=t[4]?"Сохранить изменения":"Добавить препарат",ie,se,V,E,ae,Be,ue=t[3],Q=[];for(let I=0;I<ue.length;I+=1)Q[I]=rt(st(t,ue,I));let X=t[0].hasDiluent==="да"&&ct(t);return V=Ve(t[12][0]),E=Ve(t[12][1]),{c(){e=v("h2"),l=x(o),i=O(),n=v("select");for(let I=0;I<Q.length;I+=1)Q[I].c();c=O(),s=v("div"),r=v("label"),a=v("input"),d=x(` \r
            Внутримышечно`),u=O(),h=v("label"),p=v("input"),j=x(` \r
            Внутривенно`),b=O(),B=v("input"),_=O(),q=v("div"),F=v("label"),F.textContent="Использовать растворитель:",K=O(),U=v("label"),M=v("input"),k=x(` \r
            Нет`),D=O(),g=v("label"),R=v("input"),Y=x(` \r
            Да`),ce=O(),X&&X.c(),A=O(),H=v("div"),W=v("button"),W.textContent="Отмена",P=O(),ee=v("button"),ie=x(te),C(n,"class","form-control svelte-1csq6i4"),t[0].medication===void 0&&je(()=>t[10].call(n)),C(a,"type","radio"),a.__value="в/м",a.value=a.__value,C(r,"class","svelte-1csq6i4"),C(p,"type","radio"),p.__value="в/в",p.value=p.__value,C(h,"class","svelte-1csq6i4"),C(s,"class","administration-type svelte-1csq6i4"),C(B,"type","text"),C(B,"placeholder","Дозировка препарата"),C(B,"class","form-control svelte-1csq6i4"),C(F,"class","svelte-1csq6i4"),C(M,"type","radio"),M.__value="нет",M.value=M.__value,C(U,"class","svelte-1csq6i4"),C(R,"type","radio"),R.__value="да",R.value=R.__value,C(g,"class","svelte-1csq6i4"),C(q,"class","diluent-choice svelte-1csq6i4"),C(W,"class","btn-cancel svelte-1csq6i4"),C(ee,"class","btn-save svelte-1csq6i4"),ee.disabled=se=!t[5],C(H,"class","button-row svelte-1csq6i4"),V.p(M,R),E.p(a,p)},m(I,L){S(I,e,L),m(e,l),S(I,i,L),S(I,n,L);for(let G=0;G<Q.length;G+=1)Q[G]&&Q[G].m(n,null);ze(n,t[0].medication,!0),S(I,c,L),S(I,s,L),m(s,r),m(r,a),a.checked=a.__value===t[0].administrationType,m(r,d),m(s,u),m(s,h),m(h,p),p.checked=p.__value===t[0].administrationType,m(h,j),S(I,b,L),S(I,B,L),qe(B,t[0].dosage),S(I,_,L),S(I,q,L),m(q,F),m(q,K),m(q,U),m(U,M),M.checked=M.__value===t[0].hasDiluent,m(U,k),m(q,D),m(q,g),m(g,R),R.checked=R.__value===t[0].hasDiluent,m(g,Y),S(I,ce,L),X&&X.m(I,L),S(I,A,L),S(I,H,L),m(H,W),m(H,P),m(H,ee),m(ee,ie),ae||(Be=[N(n,"change",t[10]),N(a,"change",t[11]),N(p,"change",t[13]),N(B,"input",t[14]),N(M,"change",t[15]),N(R,"change",t[16]),N(W,"click",function(){de(t[2])&&t[2].apply(this,arguments)}),N(ee,"click",t[8])],ae=!0)},p(I,L){if(t=I,L&16&&o!==(o=t[4]?"Редактирование препарата":"Добавление препарата")&&le(l,o),L&8){ue=t[3];let G;for(G=0;G<ue.length;G+=1){const xe=st(t,ue,G);Q[G]?Q[G].p(xe,L):(Q[G]=rt(xe),Q[G].c(),Q[G].m(n,null))}for(;G<Q.length;G+=1)Q[G].d(1);Q.length=ue.length}L&9&&ze(n,t[0].medication),L&9&&(a.checked=a.__value===t[0].administrationType),L&9&&(p.checked=p.__value===t[0].administrationType),L&9&&B.value!==t[0].dosage&&qe(B,t[0].dosage),L&9&&(M.checked=M.__value===t[0].hasDiluent),L&9&&(R.checked=R.__value===t[0].hasDiluent),t[0].hasDiluent==="да"?X?X.p(t,L):(X=ct(t),X.c(),X.m(A.parentNode,A)):X&&(X.d(1),X=null),L&16&&te!==(te=t[4]?"Сохранить изменения":"Добавить препарат")&&le(ie,te),L&32&&se!==(se=!t[5])&&(ee.disabled=se)},d(I){I&&T(e),I&&T(i),I&&T(n),ye(Q,I),I&&T(c),I&&T(s),I&&T(b),I&&T(B),I&&T(_),I&&T(q),I&&T(ce),X&&X.d(I),I&&T(A),I&&T(H),V.r(),E.r(),ae=!1,ne(Be)}}}function Xt(t){let e,o;return e=new nt({props:{isOpen:t[1],onClose:t[2],maxWidth:"500px",$$slots:{default:[Qt]},$$scope:{ctx:t}}}),{c(){Ce(e.$$.fragment)},m(l,i){me(e,l,i),o=!0},p(l,[i]){const n={};i&2&&(n.isOpen=l[1]),i&4&&(n.onClose=l[2]),i&67108925&&(n.$$scope={dirty:i,ctx:l}),e.$set(n)},i(l){o||(J(e.$$.fragment,l),o=!0)},o(l){$(e.$$.fragment,l),o=!1},d(l){he(e,l)}}}function Zt(t,e,o){let l,{isOpen:i=!1}=e,{onClose:n}=e,{medications:c=[]}=e,{medicationForm:s}=e,{isEditing:r=!1}=e,{onSave:a}=e;function d(){o(0,s.diluents=[...s.diluents,{id:Date.now(),type:"",dosage:""}],s)}function u(k){o(0,s.diluents=s.diluents.filter(D=>D.id!==k),s)}function h(){if(l){const k={...s,diluents:s.diluents.map(D=>({...D}))};a(k)}}const p=[[],[]];function j(){s.medication=Ge(this),o(0,s),o(3,c)}function b(){s.administrationType=this.__value,o(0,s),o(3,c)}function B(){s.administrationType=this.__value,o(0,s),o(3,c)}function _(){s.dosage=this.value,o(0,s),o(3,c)}function q(){s.hasDiluent=this.__value,o(0,s),o(3,c)}function F(){s.hasDiluent=this.__value,o(0,s),o(3,c)}function K(k,D){k[D].type=Ge(this),o(0,s),o(3,c)}function U(k,D){k[D].dosage=this.value,o(0,s),o(3,c)}const M=k=>u(k.id);return t.$$set=k=>{"isOpen"in k&&o(1,i=k.isOpen),"onClose"in k&&o(2,n=k.onClose),"medications"in k&&o(3,c=k.medications),"medicationForm"in k&&o(0,s=k.medicationForm),"isEditing"in k&&o(4,r=k.isEditing),"onSave"in k&&o(9,a=k.onSave)},t.$$.update=()=>{t.$$.dirty&1&&o(5,l=!!(s.medication&&s.administrationType&&s.dosage&&(s.hasDiluent==="нет"||s.hasDiluent==="да"&&s.diluents.length>0&&s.diluents.every(k=>k.type&&k.dosage))))},[s,i,n,c,r,l,d,u,h,a,j,b,p,B,_,q,F,K,U,M]}class $t extends pe{constructor(e){super(),ke(this,e,Zt,Xt,ge,{isOpen:1,onClose:2,medications:3,medicationForm:0,isEditing:4,onSave:9})}}const Do="";function eo(t){let e,o,l,i;return{c(){e=v("button"),o=x("+ Создать новую схему"),C(e,"class","btn-add-new-scheme svelte-zgjj6w"),y(e,"--btn-bg-color",t[1]),y(e,"--btn-text-color",t[2]),y(e,"--btn-hover-color",t[3]),y(e,"--btn-border-radius",t[4])},m(n,c){S(n,e,c),m(e,o),l||(i=N(e,"click",function(){de(t[0])&&t[0].apply(this,arguments)}),l=!0)},p(n,[c]){t=n,c&2&&y(e,"--btn-bg-color",t[1]),c&4&&y(e,"--btn-text-color",t[2]),c&8&&y(e,"--btn-hover-color",t[3]),c&16&&y(e,"--btn-border-radius",t[4])},i:re,o:re,d(n){n&&T(e),l=!1,i()}}}function to(t,e,o){let{onClick:l}=e,{buttonBgColor:i="#28a745"}=e,{buttonTextColor:n="#fff"}=e,{buttonHoverColor:c="#218838"}=e,{buttonBorderRadius:s="4px"}=e;return t.$$set=r=>{"onClick"in r&&o(0,l=r.onClick),"buttonBgColor"in r&&o(1,i=r.buttonBgColor),"buttonTextColor"in r&&o(2,n=r.buttonTextColor),"buttonHoverColor"in r&&o(3,c=r.buttonHoverColor),"buttonBorderRadius"in r&&o(4,s=r.buttonBorderRadius)},[l,i,n,c,s]}class oo extends pe{constructor(e){super(),ke(this,e,to,eo,ge,{onClick:0,buttonBgColor:1,buttonTextColor:2,buttonHoverColor:3,buttonBorderRadius:4})}}const Ro="";function at(t,e,o){const l=t.slice();return l[59]=e[o],l}function dt(t,e,o){const l=t.slice();return l[62]=e[o],l}function ft(t,e,o){const l=t.slice();return l[65]=e[o],l}function lo(t,e,o){const l=t.slice();return l[62]=e[o],l}function mt(t){let e,o,l,i;return e=new Gt({props:{schemes:t[23],onSelect:t[31],onEdit:t[34],bgColor:t[4],titleColor:t[5],borderColor:t[6]}}),l=new oo({props:{onClick:t[32],buttonBgColor:t[7],buttonTextColor:t[8],buttonHoverColor:t[9],buttonBorderRadius:t[10]}}),{c(){Ce(e.$$.fragment),o=O(),Ce(l.$$.fragment)},m(n,c){me(e,n,c),S(n,o,c),me(l,n,c),i=!0},p(n,c){const s={};c[0]&8388608&&(s.schemes=n[23]),c[0]&16&&(s.bgColor=n[4]),c[0]&32&&(s.titleColor=n[5]),c[0]&64&&(s.borderColor=n[6]),e.$set(s);const r={};c[0]&128&&(r.buttonBgColor=n[7]),c[0]&256&&(r.buttonTextColor=n[8]),c[0]&512&&(r.buttonHoverColor=n[9]),c[0]&1024&&(r.buttonBorderRadius=n[10]),l.$set(r)},i(n){i||(J(e.$$.fragment,n),J(l.$$.fragment,n),i=!0)},o(n){$(e.$$.fragment,n),$(l.$$.fragment,n),i=!1},d(n){he(e,n),n&&T(o),he(l,n)}}}function ht(t){let e,o,l,i,n,c,s,r,a=[],d=new Map,u,h,p,j,b,B,_,q=[1,2,3,4,5,6,7,8,9,10],F=[];for(let g=0;g<10;g+=1)F[g]=no(lo(t,q,g));let K=t[14];const U=g=>g[59].id;for(let g=0;g<K.length;g+=1){let R=at(t,K,g),Y=U(R);d.set(Y,a[g]=vt(Y,R))}function M(g,R){return g[19]?so:io}let k=M(t),D=k(t);return{c(){e=v("div"),o=v("h2"),o.textContent="График приема препаратов",l=O(),i=v("div"),n=v("div"),c=v("div"),c.textContent="Препарат",s=O();for(let g=0;g<10;g+=1)F[g].c();r=O();for(let g=0;g<a.length;g+=1)a[g].c();u=O(),h=v("button"),D.c(),j=O(),b=v("button"),b.textContent="+ Добавить препарат",C(c,"class","medication-column svelte-1k8ji36"),C(n,"class","schedule-header svelte-1k8ji36"),C(i,"class","schedule-table svelte-1k8ji36"),C(h,"class","btn-continue svelte-1k8ji36"),h.disabled=p=t[14].length===0||t[19]||!t[24],C(b,"class","btn-add-medication svelte-1k8ji36"),C(e,"class","schedule-column svelte-1k8ji36")},m(g,R){S(g,e,R),m(e,o),m(e,l),m(e,i),m(i,n),m(n,c),m(n,s);for(let Y=0;Y<10;Y+=1)F[Y]&&F[Y].m(n,null);m(i,r);for(let Y=0;Y<a.length;Y+=1)a[Y]&&a[Y].m(i,null);m(e,u),m(e,h),D.m(h,null),m(e,j),m(e,b),B||(_=[N(h,"click",t[33]),N(b,"click",t[50])],B=!0)},p(g,R){R[0]&1409335296&&(K=g[14],a=Fe(a,R,U,1,g,K,d,i,Ze,vt,null,at)),k!==(k=M(g))&&(D.d(1),D=k(g),D&&(D.c(),D.m(h,null))),R[0]&17317888&&p!==(p=g[14].length===0||g[19]||!g[24])&&(h.disabled=p)},d(g){g&&T(e),ye(F,g);for(let R=0;R<a.length;R+=1)a[R].d();D.d(),B=!1,ne(_)}}}function no(t){let e,o;return{c(){e=v("div"),o=x(t[62]),C(e,"class","day-header svelte-1k8ji36")},m(l,i){S(l,e,i),m(e,o)},p:re,d(l){l&&T(e)}}}function gt(t){let e,o=t[59].diluents,l=[];for(let i=0;i<o.length;i+=1)l[i]=_t(ft(t,o,i));return{c(){for(let i=0;i<l.length;i+=1)l[i].c();e=Ie()},m(i,n){for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(i,n);S(i,e,n)},p(i,n){if(n[0]&16384){o=i[59].diluents;let c;for(c=0;c<o.length;c+=1){const s=ft(i,o,c);l[c]?l[c].p(s,n):(l[c]=_t(s),l[c].c(),l[c].m(e.parentNode,e))}for(;c<l.length;c+=1)l[c].d(1);l.length=o.length}},d(i){ye(l,i),i&&T(e)}}}function _t(t){let e,o=t[65].type+"",l,i,n=t[65].dosage+"",c,s;return{c(){e=x("+ "),l=x(o),i=x(" ("),c=x(n),s=x(")")},m(r,a){S(r,e,a),S(r,l,a),S(r,i,a),S(r,c,a),S(r,s,a)},p(r,a){a[0]&16384&&o!==(o=r[65].type+"")&&le(l,o),a[0]&16384&&n!==(n=r[65].dosage+"")&&le(c,n)},d(r){r&&T(e),r&&T(l),r&&T(i),r&&T(c),r&&T(s)}}}function bt(t){let e,o,l;function i(){return t[49](t[59],t[62])}return{c(){e=v("div"),C(e,"class","schedule-cell svelte-1k8ji36"),Je(e,"selected",t[15][t[59].id]&&t[15][t[59].id][1]&&t[15][t[59].id][1].has(t[62]))},m(n,c){S(n,e,c),o||(l=N(e,"click",i),o=!0)},p(n,c){t=n,c[0]&49152&&Je(e,"selected",t[15][t[59].id]&&t[15][t[59].id][1]&&t[15][t[59].id][1].has(t[62]))},d(n){n&&T(e),o=!1,l()}}}function vt(t,e){let o,l,i,n,c=e[59].medication.name+"",s,r,a=e[59].administrationType+"",d,u,h=e[59].dosage+"",p,j,b,B,_,q,F,K,U,M,k,D,g=e[59].hasDiluent==="да"&&e[59].diluents&&e[59].diluents.length>0&&gt(e);function R(){return e[47](e[59])}function Y(){return e[48](e[59])}let ce=[1,2,3,4,5,6,7,8,9,10],A=[];for(let H=0;H<10;H+=1)A[H]=bt(dt(e,ce,H));return{key:t,first:null,c(){o=v("div"),l=v("div"),i=v("div"),n=v("strong"),s=x(c),r=O(),d=x(a),u=x(", "),p=x(h),j=O(),g&&g.c(),b=O(),B=v("div"),_=v("button"),_.textContent="✏️",q=O(),F=v("button"),F.textContent="🗑️",K=O();for(let H=0;H<10;H+=1)A[H].c();U=O(),C(i,"class","medication-title"),C(_,"class","btn-edit-medication svelte-1k8ji36"),C(F,"class","btn-delete-medication svelte-1k8ji36"),C(B,"class","medication-actions svelte-1k8ji36"),C(l,"class","medication-cell svelte-1k8ji36"),C(o,"class",M="schedule-row "+(!e[15][e[59].id]||!Object.values(e[15][e[59].id]).some(kt)?"error-highlight":"")+" svelte-1k8ji36"),this.first=o},m(H,W){S(H,o,W),m(o,l),m(l,i),m(i,n),m(n,s),m(i,r),m(i,d),m(i,u),m(i,p),m(i,j),g&&g.m(i,null),m(l,b),m(l,B),m(B,_),m(B,q),m(B,F),m(o,K);for(let P=0;P<10;P+=1)A[P]&&A[P].m(o,null);m(o,U),k||(D=[N(_,"click",R),N(F,"click",Y)],k=!0)},p(H,W){if(e=H,W[0]&16384&&c!==(c=e[59].medication.name+"")&&le(s,c),W[0]&16384&&a!==(a=e[59].administrationType+"")&&le(d,a),W[0]&16384&&h!==(h=e[59].dosage+"")&&le(p,h),e[59].hasDiluent==="да"&&e[59].diluents&&e[59].diluents.length>0?g?g.p(e,W):(g=gt(e),g.c(),g.m(i,null)):g&&(g.d(1),g=null),W[0]&1073790976){ce=[1,2,3,4,5,6,7,8,9,10];let P;for(P=0;P<10;P+=1){const ee=dt(e,ce,P);A[P]?A[P].p(ee,W):(A[P]=bt(ee),A[P].c(),A[P].m(o,U))}for(;P<10;P+=1)A[P].d(1)}W[0]&49152&&M!==(M="schedule-row "+(!e[15][e[59].id]||!Object.values(e[15][e[59].id]).some(kt)?"error-highlight":"")+" svelte-1k8ji36")&&C(o,"class",M)},d(H){H&&T(o),g&&g.d(),ye(A,H),k=!1,ne(D)}}}function io(t){let e;return{c(){e=x("Опубликовать схему")},m(o,l){S(o,e,l)},d(o){o&&T(e)}}}function so(t){let e,o;return{c(){e=v("span"),o=x(" Сохранение..."),C(e,"class","spinner svelte-1k8ji36")},m(l,i){S(l,e,i),S(l,o,i)},d(l){l&&T(e),l&&T(o)}}}function Ct(t){let e,o,l;return{c(){e=v("div"),o=x("⚠️ "),l=x(t[18]),C(e,"class","validation-error svelte-1k8ji36")},m(i,n){S(i,e,n),m(e,o),m(e,l)},p(i,n){n[0]&262144&&le(l,i[18])},d(i){i&&T(e)}}}function ro(t){let e,o,l,i,n,c,s=!t[17]&&mt(t),r=t[17]&&ht(t),a=t[18]&&Ct(t);return{c(){e=v("div"),o=v("div"),s&&s.c(),l=O(),r&&r.c(),i=O(),a&&a.c(),n=Ie(),C(o,"class","medication-form-column svelte-1k8ji36"),C(e,"class","modal-grid svelte-1k8ji36")},m(d,u){S(d,e,u),m(e,o),s&&s.m(o,null),m(e,l),r&&r.m(e,null),S(d,i,u),a&&a.m(d,u),S(d,n,u),c=!0},p(d,u){d[17]?s&&(De(),$(s,1,1,()=>{s=null}),Re()):s?(s.p(d,u),u[0]&131072&&J(s,1)):(s=mt(d),s.c(),J(s,1),s.m(o,null)),d[17]?r?r.p(d,u):(r=ht(d),r.c(),r.m(e,null)):r&&(r.d(1),r=null),d[18]?a?a.p(d,u):(a=Ct(d),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(d){c||(J(s),c=!0)},o(d){$(s),c=!1},d(d){d&&T(e),s&&s.d(),r&&r.d(),d&&T(i),a&&a.d(d),d&&T(n)}}}function co(t){let e,o,l,i,n,c,s,r,a,d;return n=new nt({props:{isOpen:t[16],onClose:t[29],maxWidth:t[0],backgroundColor:t[1],borderRadius:t[2],overlayColor:t[3],$$slots:{default:[ro]},$$scope:{ctx:t}}}),s=new $t({props:{isOpen:t[21],onClose:t[51],medications:t[25],medicationForm:t[22],isEditing:!!t[20],onSave:t[27]}}),{c(){e=v("div"),o=v("button"),l=x("📋 Схема лечения"),i=O(),Ce(n.$$.fragment),c=O(),Ce(s.$$.fragment),C(o,"class","treatment-scheme-button svelte-1k8ji36"),y(o,"--bg-color",t[11]),y(o,"--text-color",t[12]),y(o,"--border-radius",t[13]),C(e,"class","treatment-scheme-container")},m(u,h){S(u,e,h),m(e,o),m(o,l),m(e,i),me(n,e,null),S(u,c,h),me(s,u,h),r=!0,a||(d=N(o,"click",t[29]),a=!0)},p(u,h){(!r||h[0]&2048)&&y(o,"--bg-color",u[11]),(!r||h[0]&4096)&&y(o,"--text-color",u[12]),(!r||h[0]&8192)&&y(o,"--border-radius",u[13]);const p={};h[0]&65536&&(p.isOpen=u[16]),h[0]&1&&(p.maxWidth=u[0]),h[0]&2&&(p.backgroundColor=u[1]),h[0]&4&&(p.borderRadius=u[2]),h[0]&8&&(p.overlayColor=u[3]),h[0]&32425968|h[2]&256&&(p.$$scope={dirty:h,ctx:u}),n.$set(p);const j={};h[0]&2097152&&(j.isOpen=u[21]),h[0]&3145728&&(j.onClose=u[51]),h[0]&4194304&&(j.medicationForm=u[22]),h[0]&1048576&&(j.isEditing=!!u[20]),s.$set(j)},i(u){r||(J(n.$$.fragment,u),J(s.$$.fragment,u),r=!0)},o(u){$(n.$$.fragment,u),$(s.$$.fragment,u),r=!1},d(u){u&&T(e),he(n),u&&T(c),he(s,u),a=!1,d()}}}const kt=t=>t.size>0;function uo(t,e,o){let l,{serviceId:i=null}=e,{medicalCardId:n=null}=e,{modalMaxWidth:c="1100px"}=e,{modalBgColor:s="white"}=e,{modalBorderRadius:r="8px"}=e,{modalOverlayColor:a="rgba(0,0,0,0.5)"}=e,{schemesBgColor:d="#f8f9fa"}=e,{schemesTitleColor:u="#333"}=e,{schemesBorderColor:h="#e9ecef"}=e,{schemeItemBgColor:p="#f8f9fa"}=e,{schemeItemHoverColor:j="#e9ecef"}=e,{schemeItemBorderColor:b="#e9ecef"}=e,{schemeTitleColor:B="#333"}=e,{schemeDetailsColor:_="#6c757d"}=e,{useButtonBgColor:q="#007bff"}=e,{useButtonTextColor:F="#fff"}=e,{editButtonBgColor:K="#6c757d"}=e,{editButtonTextColor:U="#fff"}=e,{createButtonBgColor:M="#28a745"}=e,{createButtonTextColor:k="#fff"}=e,{createButtonHoverColor:D="#218838"}=e,{createButtonBorderRadius:g="4px"}=e,{mainButtonBgColor:R="#007bff"}=e,{mainButtonTextColor:Y="white"}=e,{mainButtonBorderRadius:ce="4px"}=e,A=!1,H=!1,W=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],P="",ee=!1,te={medication:W[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},ie=null,se=null,V=[],E={},ae=!1,Be={medication:W[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},ue=[{id:1,name:"Схема лечения №1",medications:[{id:101,name:"Цефтриаксон",dosage:"1г",администрationType:"в/м",diluents:[{id:1001,type:"физраствор",dosage:"2мл"}]}],schedule:{101:{1:[1,3,5,7,9]}}},{id:2,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:3,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:4,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:5,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:6,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}}];function Q(f){o(22,Be={medication:W.find(w=>w.name===f.medication.name)||W[0],administrationType:f.administrationType,dosage:f.dosage,hasDiluent:f.diluents&&f.diluents.length>0?"да":"нет",diluents:f.diluents?[...f.diluents]:[]}),o(20,ie=f.id),o(21,ae=!0)}function X(f){if(ie)o(14,V=V.map(w=>w.id===ie?{...f,id:w.id,diluents:[...f.diluents]}:w)),o(20,ie=null);else{const w={...f,id:Date.now(),diluents:[...f.diluents]};o(14,V=[...V,w])}o(21,ae=!1)}function I(f){o(14,V=V.filter(w=>w.id!==f)),E[f]&&(delete E[f],o(15,E={...E})),ie===f&&xe(),o(18,P="")}function L(){o(16,A=!A),A||G()}function G(){o(46,te={medication:W[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),o(14,V=[]),o(15,E={}),o(17,H=!1),se=null,o(18,P="")}function xe(){o(46,te={medication:W[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),o(20,ie=null)}function wt(f,w,Z){E[f]||o(15,E[f]={},E),E[f][w]||o(15,E[f][w]=new Set,E),E[f][w].has(Z)?E[f][w].delete(Z):E[f][w].add(Z),o(15,E={...E}),o(18,P="")}function bo(f){console.log("Выбрана схема:",f),o(14,V=f.medications.map(w=>({id:w.id||Date.now()+Math.random(),medication:{name:w.name},administrationType:w.администрationType,dosage:w.dosage,hasDiluent:w.diluents&&w.diluents.length>0?"да":"нет",diluents:w.diluents||[]}))),o(15,E={}),f.schedule&&Object.entries(f.schedule).forEach(([w,Z])=>{o(15,E[w]={},E),Object.entries(Z).forEach(([oe,Se])=>{o(15,E[w][oe]=new Set(Se),E)})}),o(17,H=!0),o(18,P="")}function vo(){o(17,H=!0),o(14,V=[]),o(15,E={}),o(18,P="")}function Co(){const f=V.filter(w=>!E[w.id]||!Object.values(E[w.id]).some(Z=>Z.size>0));if(f.length>0){const w=f.map(Z=>Z.medication.name).join(", ");o(18,P=`Не выбрано ни одного дня для препаратов: ${w}`);return}try{o(19,ee=!0);const w={};Object.entries(E).forEach(([oe,Se])=>{w[oe]={},Object.entries(Se).forEach(([To,So])=>{w[oe][To]=Array.from(So)})});const Z={id:Date.now(),name:se?`${se.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:V.map(oe=>({id:oe.id,name:oe.medication.name,dosage:oe.dosage,администрationType:oe.administrationType,hasDiluent:oe.hasDiluent,diluent:oe.diluent,diluentDosage:oe.diluentDosage})),createdFor:{serviceId:i,medicalCardId:n},createdAt:new Date().toISOString(),isRevision:!!se,originalSchemeId:se?se.id:null,schedule:w};setTimeout(()=>{o(23,ue=[...ue,Z]),console.log("Опубликована схема лечения",Z),o(19,ee=!1),L()},1e3)}catch(w){console.error("Ошибка публикации схемы:",w),o(19,ee=!1)}}function ko(f){console.log("Редактирование схемы:",f),o(14,V=f.medications.map(w=>({id:w.id||Date.now()+Math.random(),medication:{name:w.name},administrationType:w.администрationType,dosage:w.dosage,hasDiluent:w.diluents&&w.diluents.length>0?"да":"нет",diluents:w.diluents||[]}))),o(15,E={}),f.schedule&&Object.entries(f.schedule).forEach(([w,Z])=>{o(15,E[w]={},E),Object.entries(Z).forEach(([oe,Se])=>{o(15,E[w][oe]=new Set(Se),E)})}),o(17,H=!0),se=f,o(18,P="")}const po=f=>Q(f),Bo=f=>I(f.id),yo=(f,w)=>wt(f.id,1,w),wo=()=>{o(22,Be={medication:W[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),o(21,ae=!0)},jo=()=>{o(21,ae=!1),o(20,ie=null)};return t.$$set=f=>{"serviceId"in f&&o(35,i=f.serviceId),"medicalCardId"in f&&o(36,n=f.medicalCardId),"modalMaxWidth"in f&&o(0,c=f.modalMaxWidth),"modalBgColor"in f&&o(1,s=f.modalBgColor),"modalBorderRadius"in f&&o(2,r=f.modalBorderRadius),"modalOverlayColor"in f&&o(3,a=f.modalOverlayColor),"schemesBgColor"in f&&o(4,d=f.schemesBgColor),"schemesTitleColor"in f&&o(5,u=f.schemesTitleColor),"schemesBorderColor"in f&&o(6,h=f.schemesBorderColor),"schemeItemBgColor"in f&&o(37,p=f.schemeItemBgColor),"schemeItemHoverColor"in f&&o(38,j=f.schemeItemHoverColor),"schemeItemBorderColor"in f&&o(39,b=f.schemeItemBorderColor),"schemeTitleColor"in f&&o(40,B=f.schemeTitleColor),"schemeDetailsColor"in f&&o(41,_=f.schemeDetailsColor),"useButtonBgColor"in f&&o(42,q=f.useButtonBgColor),"useButtonTextColor"in f&&o(43,F=f.useButtonTextColor),"editButtonBgColor"in f&&o(44,K=f.editButtonBgColor),"editButtonTextColor"in f&&o(45,U=f.editButtonTextColor),"createButtonBgColor"in f&&o(7,M=f.createButtonBgColor),"createButtonTextColor"in f&&o(8,k=f.createButtonTextColor),"createButtonHoverColor"in f&&o(9,D=f.createButtonHoverColor),"createButtonBorderRadius"in f&&o(10,g=f.createButtonBorderRadius),"mainButtonBgColor"in f&&o(11,R=f.mainButtonBgColor),"mainButtonTextColor"in f&&o(12,Y=f.mainButtonTextColor),"mainButtonBorderRadius"in f&&o(13,ce=f.mainButtonBorderRadius)},t.$$.update=()=>{t.$$.dirty[0]&49152&&o(24,l=V.length>0&&V.every(f=>E[f.id]&&Object.values(E[f.id]).some(w=>w.size>0))),t.$$.dirty[1]&32768&&te.medication&&te.administrationType&&te.dosage&&(te.hasDiluent==="нет"||te.hasDiluent==="да"&&te.diluents.length>0&&te.diluents.every(f=>f.type&&f.dosage))},[c,s,r,a,d,u,h,M,k,D,g,R,Y,ce,V,E,A,H,P,ee,ie,ae,Be,ue,l,W,Q,X,I,L,wt,bo,vo,Co,ko,i,n,p,j,b,B,_,q,F,K,U,te,po,Bo,yo,wo,jo]}class ao extends pe{constructor(e){super(),ke(this,e,uo,co,ge,{serviceId:35,medicalCardId:36,modalMaxWidth:0,modalBgColor:1,modalBorderRadius:2,modalOverlayColor:3,schemesBgColor:4,schemesTitleColor:5,schemesBorderColor:6,schemeItemBgColor:37,schemeItemHoverColor:38,schemeItemBorderColor:39,schemeTitleColor:40,schemeDetailsColor:41,useButtonBgColor:42,useButtonTextColor:43,editButtonBgColor:44,editButtonTextColor:45,createButtonBgColor:7,createButtonTextColor:8,createButtonHoverColor:9,createButtonBorderRadius:10,mainButtonBgColor:11,mainButtonTextColor:12,mainButtonBorderRadius:13},null,[-1,-1,-1])}}const fo="#show_info_table_title",Ne="treatment-scheme-container",z={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),styleConfigs:{clinic1:{mainButtonBgColor:"#4CAF50",mainButtonTextColor:"white",schemesBgColor:"#f0f8ff",schemesTitleColor:"#2c3e50",useButtonBgColor:"#3498db",editButtonBgColor:"#9b59b6",createButtonBgColor:"#e74c3c"}},log(t,e,...o){if(!this.debug)return;const i={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${i} [RecordBtn-${this.instanceId}] ${e}`,...o)}};function pt(t){const e=new URL(t,window.location.origin),o=e.pathname,l=o.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!l,patientId:l?l[1]:null,recordId:l?l[2]:null,fullPath:o+e.search,params:e.searchParams}}function Te(){z.log("action","Запущена процедура очистки"),z.intervalId!==null&&(clearInterval(z.intervalId),z.log("unmount","Интервал остановлен:",z.intervalId),z.intervalId=null);const t=document.getElementById(Ne);t&&(t.remove(),z.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),z.mounted=!1}function Oe(t=!1){const e=pt(window.location.href);z.log("check","Проверка страницы:",e),e.recordId!==z.currentRecordId&&(z.log("route",`Изменился ID записи: ${z.currentRecordId||"none"} -> ${e.recordId||"none"}`),z.currentRecordId=e.recordId,z.currentPatientId=e.patientId,z.mounted&&(z.log("action","Удаляем компоненты из-за смены записи"),Te()));const l=document.querySelector(fo),i=document.getElementById(Ne);if(z.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!l}, mounted=${z.mounted}`),!i&&z.mounted&&(z.log("warn","Компонент исчез из DOM, но состояние не обновлено"),z.mounted=!1),e.isRecordPage&&l){if(!i){z.log("mount","Монтируем компонент TreatmentSchemeButton");const n=document.createElement("div");n.id=Ne,l.appendChild(n);try{new ao({target:n,props:{serviceId:e.recordId,medicalCardId:e.patientId,...z.styleConfigs.clinic1}}),z.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),z.mounted=!0}catch(c){z.log("error","Ошибка при монтировании TreatmentSchemeButton:",c),n.remove()}}}else!e.isRecordPage&&(i||z.mounted)&&(z.log("action","Не страница записи - удаляем компонент"),Te())}function mo(){z.log("start","Инициализация компонентов"),Te(),window._recordButtonListenersInitialized||(ho(),window._recordButtonListenersInitialized=!0);const t=pt(window.location.href);return z.currentPath=t.fullPath,z.currentRecordId=t.recordId,z.currentPatientId=t.patientId,Oe(!0),z.intervalId=setInterval(()=>{z.log("timer","Регулярная проверка по интервалу"),Oe()},1e3),z.log("success","Интервал установлен, ID:",z.intervalId),Te}function ho(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),z.log("route",`Обнаружен ${t}`),Bt()}}),window.addEventListener("popstate",()=>{z.log("route","Обнаружен popstate"),Bt()})}function Bt(){[10,50,100,250,500,1e3,1500].forEach((e,o)=>{setTimeout(()=>{z.log("timer",`Запланированная проверка #${o+1} (${e}ms)`),Oe(!0)},e)})}window.addEventListener("beforeunload",Te),z.log("info","Модуль загружен"),Oe(!0);const go=[{match:/\/medical_records\/\d+\/\d+$/,render:mo}];let yt=null;function _o(){console.log("📡 Router запущен"),jt(()=>{const t=window.location.pathname,e=go.find(o=>o.match.test(t));console.log("📌 Найден роут:",e?.match),e!==yt&&(yt=e,e?.render())})}console.log("✅ Content script работает"),_o()})();
