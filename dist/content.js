(function(){"use strict";function J(e){console.log("üëÄ SPA URL Observer –∑–∞–ø—É—â–µ–Ω");let t=location.href;function n(){location.href!==t&&(t=location.href,console.log("üîÅ URL –∏–∑–º–µ–Ω–∏–ª—Å—è:",t),e())}["pushState","replaceState"].forEach(o=>{const c=history[o];history[o]=function(...i){c.apply(this,i),n()}}),window.addEventListener("popstate",n),e()}function $(){}function C(e){return e()}function M(){return Object.create(null)}function I(e){e.forEach(C)}function U(e){return typeof e=="function"}function K(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Q(e){return Object.keys(e).length===0}function x(e,t){e.appendChild(t)}function B(e,t,n){e.insertBefore(t,n||null)}function k(e){e.parentNode&&e.parentNode.removeChild(e)}function R(e){return document.createElement(e)}function A(e){return document.createTextNode(e)}function V(){return A(" ")}function W(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function X(e){return Array.from(e.childNodes)}function Y(e,t){t=""+t,e.data!==t&&(e.data=t)}function l(e,t,n,o){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}let P;function v(e){P=e}const f=[],T=[];let h=[];const D=[],Z=Promise.resolve();let L=!1;function tt(){L||(L=!0,Z.then(N))}function S(e){h.push(e)}const O=new Set;let g=0;function N(){if(g!==0)return;const e=P;do{try{for(;g<f.length;){const t=f[g];g++,v(t),et(t.$$)}}catch(t){throw f.length=0,g=0,t}for(v(null),f.length=0,g=0;T.length;)T.pop()();for(let t=0;t<h.length;t+=1){const n=h[t];O.has(n)||(O.add(n),n())}h.length=0}while(f.length);for(;D.length;)D.pop()();L=!1,O.clear(),v(e)}function et(e){if(e.fragment!==null){e.update(),I(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(S)}}function nt(e){const t=[],n=[];h.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),h=t}const rt=new Set;function ot(e,t){e&&e.i&&(rt.delete(e),e.i(t))}function ct(e,t,n,o){const{fragment:c,after_update:i}=e.$$;c&&c.m(t,n),o||S(()=>{const a=e.$$.on_mount.map(C).filter(U);e.$$.on_destroy?e.$$.on_destroy.push(...a):I(a),e.$$.on_mount=[]}),i.forEach(S)}function it(e,t){const n=e.$$;n.fragment!==null&&(nt(n.after_update),I(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function st(e,t){e.$$.dirty[0]===-1&&(f.push(e),tt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function lt(e,t,n,o,c,i,a,E=[-1]){const u=P;v(e);const s=e.$$={fragment:null,ctx:[],props:i,update:$,not_equal:c,bound:M(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:M(),dirty:E,skip_bound:!1,root:t.target||u.$$.root};a&&a(s.root);let b=!1;if(s.ctx=n?n(e,t.props||{},(d,F,...G)=>{const H=G.length?G[0]:F;return s.ctx&&c(s.ctx[d],s.ctx[d]=H)&&(!s.skip_bound&&s.bound[d]&&s.bound[d](H),b&&st(e,d)),F}):[],s.update(),b=!0,I(s.before_update),s.fragment=o?o(s.ctx):!1,t.target){if(t.hydrate){const d=X(t.target);s.fragment&&s.fragment.l(d),d.forEach(k)}else s.fragment&&s.fragment.c();t.intro&&ot(e.$$.fragment),ct(e,t.target,t.anchor,t.customElement),N()}v(u)}class ut{$destroy(){it(this,1),this.$destroy=$}$on(t,n){if(!U(n))return $;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const c=o.indexOf(n);c!==-1&&o.splice(c,1)}}$set(t){this.$$set&&!Q(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function j(e){let t;return{c(){t=R("div"),t.innerHTML=`<strong>–≠—Ç–∞–ø 1:</strong> –û—Å–º–æ—Ç—Ä<br/> 
      <strong>–≠—Ç–∞–ø 2:</strong> –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è<br/> 
      <strong>–≠—Ç–∞–ø 3:</strong> –ö–æ–Ω—Ç—Ä–æ–ª—å<br/>`,l(t,"position","absolute"),l(t,"top","45px"),l(t,"left","0"),l(t,"background","white"),l(t,"border","1px solid #ccc"),l(t,"padding","10px"),l(t,"width","250px"),l(t,"box-shadow","0 2px 10px rgba(0,0,0,0.15)"),l(t,"border-radius","6px")},m(n,o){B(n,t,o)},d(n){n&&k(t)}}}function at(e){let t,n,o=e[0]?"‚úñ –ó–∞–∫—Ä—ã—Ç—å":"üìã –û—Ç–∫—Ä—ã—Ç—å —Å—Ö–µ–º–æ—á–∫—É —Ç–µ—Å—Ç 1",c,i,a,E,u=e[0]&&j();return{c(){t=R("div"),n=R("button"),c=A(o),i=V(),u&&u.c(),l(n,"padding","8px 14px"),l(n,"background","#007bff"),l(n,"color","white"),l(n,"border","none"),l(n,"border-radius","4px"),l(n,"cursor","pointer"),l(t,"display","inline-block"),l(t,"position","relative"),l(t,"margin","10px")},m(s,b){B(s,t,b),x(t,n),x(n,c),x(t,i),u&&u.m(t,null),a||(E=W(n,"click",e[1]),a=!0)},p(s,[b]){b&1&&o!==(o=s[0]?"‚úñ –ó–∞–∫—Ä—ã—Ç—å":"üìã –û—Ç–∫—Ä—ã—Ç—å —Å—Ö–µ–º–æ—á–∫—É —Ç–µ—Å—Ç 1")&&Y(c,o),s[0]?u||(u=j(),u.c(),u.m(t,null)):u&&(u.d(1),u=null)},i:$,o:$,d(s){s&&k(t),u&&u.d(),a=!1,E()}}}function dt(e,t,n){let o=!1;function c(){n(0,o=!o)}return[o,c]}class ft extends ut{constructor(t){super(),lt(this,t,dt,at,K,{})}}const q="#show_info_table_title",w="record-button-container",r={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),log(e,t,...n){if(!this.debug)return;const c={info:"‚ÑπÔ∏è",warn:"‚ö†Ô∏è",error:"‚ùå",success:"‚úÖ",start:"üöÄ",action:"üîÑ",timer:"‚è±Ô∏è",mount:"üìå",unmount:"üóëÔ∏è",route:"üß≠",check:"üîç"}[e]||"üìù";console.log(`${c} [RecordBtn-${this.instanceId}] ${t}`,...n)}};function y(e){const t=new URL(e,window.location.origin),n=t.pathname,o=n.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!o,patientId:o?o[1]:null,recordId:o?o[2]:null,fullPath:n+t.search,params:t.searchParams}}function m(){r.log("action","–ó–∞–ø—É—â–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ—á–∏—Å—Ç–∫–∏"),r.intervalId!==null&&(clearInterval(r.intervalId),r.log("unmount","–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",r.intervalId),r.intervalId=null);const e=document.getElementById(w);e&&(e.remove(),r.log("unmount","–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª–µ–Ω –∏–∑ DOM")),r.mounted=!1}function p(e=!1){const t=y(window.location.href);r.log("check","–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",t),t.recordId!==r.currentRecordId&&(r.log("route",`–ò–∑–º–µ–Ω–∏–ª—Å—è ID –∑–∞–ø–∏—Å–∏: ${r.currentRecordId||"none"} -> ${t.recordId||"none"}`),r.currentRecordId=t.recordId,r.mounted&&(r.log("action","–£–¥–∞–ª—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑-–∑–∞ —Å–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏"),m()));const o=document.querySelector(q),c=document.getElementById(w);if(r.log("check",`–°–æ—Å—Ç–æ—è–Ω–∏–µ: –∑–∞–ø–∏—Å—å=${t.isRecordPage}, —Ü–µ–ª–µ–≤–æ–π_—ç–ª–µ–º–µ–Ω—Ç=${!!o}, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç=${!!c}, mounted=${r.mounted}`),!c&&r.mounted&&(r.log("warn","–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"),r.mounted=!1),t.isRecordPage&&o)if(c){const i=c.getAttribute("data-record-id");i!==t.recordId?(r.log("warn",`–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–π –∑–∞–ø–∏—Å–∏ (${i} vs ${t.recordId})`),m(),setTimeout(()=>p(!0),10)):r.log("info","–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–∂–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏")}else{r.log("mount","–ú–æ–Ω—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏:",t.recordId);const i=document.createElement("div");i.id=w,i.setAttribute("data-record-id",t.recordId),i.setAttribute("data-instance",r.instanceId),i.setAttribute("data-timestamp",Date.now()),o.appendChild(i);try{new ft({target:i}),r.mounted=!0,r.log("success","–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω")}catch(a){r.log("error","–û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:",a),i.remove()}}else!t.isRecordPage&&(c||r.mounted)&&(r.log("action","–ù–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–ø–∏—Å–∏ - —É–¥–∞–ª—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç"),m())}function _(){[10,50,100,250,500,1e3,1500].forEach((t,n)=>{setTimeout(()=>{r.log("timer",`–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ #${n+1} (${t}ms)`),p(!0)},t)})}function ht(){const e=history.pushState;history.pushState=function(){e.apply(this,arguments),r.log("route","–û–±–Ω–∞—Ä—É–∂–µ–Ω pushState"),_()};const t=history.replaceState;history.replaceState=function(){t.apply(this,arguments),r.log("route","–û–±–Ω–∞—Ä—É–∂–µ–Ω replaceState"),_()},window.addEventListener("popstate",()=>{r.log("route","–û–±–Ω–∞—Ä—É–∂–µ–Ω popstate"),_()}),new MutationObserver(()=>{const c=window.location.href,i=y(c);i.fullPath!==r.currentPath&&(r.log("route",`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL: ${r.currentPath||"initial"} -> ${i.fullPath}`),r.currentPath=i.fullPath,_())}).observe(document,{subtree:!0,childList:!0}),document.addEventListener("click",c=>{const i=c.target.closest("a");i&&i.href&&i.href.includes("/medical_records/")&&(r.log("route","–ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ –∑–∞–ø–∏—Å–∏:",i.href),_())}),new MutationObserver(c=>{y(window.location.href).isRecordPage&&!document.getElementById(w)&&document.querySelector(q)&&(r.log("action","DOM Observer: –æ–±–Ω–∞—Ä—É–∂–µ–Ω —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç"),p(!0))}).observe(document.body,{childList:!0,subtree:!0}),r.log("success","–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã")}function gt(){r.log("start","–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ RecordButton"),m(),window._recordButtonListenersInitialized||(ht(),window._recordButtonListenersInitialized=!0);const e=y(window.location.href);return r.currentPath=e.fullPath,r.currentRecordId=e.recordId,p(!0),r.intervalId=setInterval(()=>{r.log("timer","–†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É"),p()},1e3),r.log("success","–ò–Ω—Ç–µ—Ä–≤–∞–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, ID:",r.intervalId),_(),m}window.addEventListener("beforeunload",m),r.log("info","–ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω"),p(!0);const mt=[{match:/\/medical_records\/\d+\/\d+$/,render:gt}];let z=null;function pt(){console.log("üì° Router –∑–∞–ø—É—â–µ–Ω"),J(()=>{const e=window.location.pathname,t=mt.find(n=>n.match.test(e));console.log("üìå –ù–∞–π–¥–µ–Ω —Ä–æ—É—Ç:",t?.match),t!==z&&(z=t,t?.render())})}console.log("‚úÖ Content script —Ä–∞–±–æ—Ç–∞–µ—Ç"),pt()})();
