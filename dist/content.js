(function(){"use strict";var Se=document.createElement("style");Se.textContent=`.treatment-scheme-button.svelte-1lim31.svelte-1lim31{background-color:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}.modal-overlay.svelte-1lim31.svelte-1lim31{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content.svelte-1lim31.svelte-1lim31{background:white;border-radius:8px;max-width:1100px;max-height:80%;position:relative;padding:20px;box-shadow:0 4px 6px #0000001a}.modal-grid.svelte-1lim31.svelte-1lim31{display:grid;grid-template-columns:1fr 1fr;gap:20px}.medication-form-column.svelte-1lim31.svelte-1lim31{display:flex;flex-direction:column;gap:10px;max-width:350px}.schedule-column.svelte-1lim31.svelte-1lim31{display:flex;flex-direction:column;gap:10px}.form-control.svelte-1lim31.svelte-1lim31{width:100%;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;font-size:14px}.modal-close.svelte-1lim31.svelte-1lim31{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999}.administration-type.svelte-1lim31.svelte-1lim31,.diluent-choice.svelte-1lim31.svelte-1lim31{display:flex;gap:15px;margin-bottom:10px}.administration-type.svelte-1lim31 label.svelte-1lim31,.diluent-choice.svelte-1lim31 label.svelte-1lim31{display:flex;align-items:center;gap:5px}.schedule-table.svelte-1lim31.svelte-1lim31{border:1px solid #ddd}.schedule-header.svelte-1lim31.svelte-1lim31{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-1lim31.svelte-1lim31,.medication-column.svelte-1lim31.svelte-1lim31{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-1lim31.svelte-1lim31{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-1lim31.svelte-1lim31{gap:15px;display:flex;align-items:center;justify-content:center;padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-1lim31.svelte-1lim31{width:50px;border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-1lim31.svelte-1lim31:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-1lim31.svelte-1lim31{background-color:#007bff}.btn-add.svelte-1lim31.svelte-1lim31,.btn-continue.svelte-1lim31.svelte-1lim31{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}.btn-add.svelte-1lim31.svelte-1lim31:disabled,.btn-continue.svelte-1lim31.svelte-1lim31:disabled{opacity:.5;cursor:not-allowed}.existing-schemes.svelte-1lim31.svelte-1lim31{margin-top:20px}.scheme-item.svelte-1lim31.svelte-1lim31{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:10px;margin-bottom:10px;cursor:pointer;transition:background-color .3s ease}.scheme-item.svelte-1lim31.svelte-1lim31:hover{background-color:#e9ecef}.medication-details.svelte-1lim31.svelte-1lim31{color:#6c757d;font-size:.9em;margin-top:5px}.btn-add-new-scheme.svelte-1lim31.svelte-1lim31{background-color:#28a745;color:#fff;border:none;padding:10px;border-radius:4px;margin-top:10px;cursor:pointer;width:100%}.scheme-actions.svelte-1lim31.svelte-1lim31{display:flex;gap:8px;margin-top:8px}.btn-use-scheme.svelte-1lim31.svelte-1lim31,.btn-edit-scheme.svelte-1lim31.svelte-1lim31{padding:4px 8px;font-size:12px;border:none;border-radius:4px;cursor:pointer}.btn-use-scheme.svelte-1lim31.svelte-1lim31{background-color:#007bff;color:#fff}.btn-edit-scheme.svelte-1lim31.svelte-1lim31{background-color:#6c757d;color:#fff}.spinner.svelte-1lim31.svelte-1lim31{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-1lim31-spin 1s ease-in-out infinite;margin-right:8px}@keyframes svelte-1lim31-spin{to{transform:rotate(360deg)}}.diluents-container.svelte-1lim31.svelte-1lim31{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-1lim31.svelte-1lim31{display:flex;gap:8px;align-items:center}.diluent-select.svelte-1lim31.svelte-1lim31{flex:3}.diluent-dosage.svelte-1lim31.svelte-1lim31{flex:2}.btn-remove-diluent.svelte-1lim31.svelte-1lim31{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-1lim31.svelte-1lim31{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer;align-self:flex-start}.error-highlight.svelte-1lim31 .medication-cell.svelte-1lim31{background-color:#fff4f4;border-left:3px solid #dc3545}.validation-error.svelte-1lim31.svelte-1lim31{background-color:#fff3cd;color:#856404;padding:10px;margin-bottom:15px;border-radius:4px;border-left:4px solid #ffc107;font-size:14px}.medication-actions.svelte-1lim31.svelte-1lim31{margin-top:5px;display:flex;gap:5px}.btn-edit-medication.svelte-1lim31.svelte-1lim31,.btn-delete-medication.svelte-1lim31.svelte-1lim31{padding:2px 5px;font-size:12px;border:none;border-radius:3px;cursor:pointer;background-color:transparent}.btn-edit-medication.svelte-1lim31.svelte-1lim31:hover{background-color:#f0f0f0}.btn-delete-medication.svelte-1lim31.svelte-1lim31:hover{background-color:#fff5f5}
`,document.head.appendChild(Se);function rt(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function l(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(n=>{const i=history[n];history[n]=function(...s){i.apply(this,s),l()}}),window.addEventListener("popstate",l),t()}function ee(){}function De(t){return t()}function Ee(){return Object.create(null)}function Z(t){t.forEach(De)}function Te(t){return typeof t=="function"}function ct(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function dt(t){return Object.keys(t).length===0}function u(t,e){t.appendChild(e)}function T(t,e,l){t.insertBefore(e,l||null)}function D(t){t.parentNode&&t.parentNode.removeChild(t)}function ne(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function g(t){return document.createElement(t)}function j(t){return document.createTextNode(t)}function L(){return j(" ")}function Ce(){return j("")}function x(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function be(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function k(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Me(t){let e;return{p(...l){e=l,e.forEach(n=>t.push(n))},r(){e.forEach(l=>t.splice(t.indexOf(l),1))}}}function ut(t){return Array.from(t.childNodes)}function X(t,e){e=""+e,t.data!==e&&(t.data=e)}function me(t,e){t.value=e??""}function _e(t,e,l){for(let n=0;n<t.options.length;n+=1){const i=t.options[n];if(i.__value===e){i.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Oe(t){const e=t.querySelector(":checked");return e&&e.__value}function Re(t,e,l){t.classList[l?"add":"remove"](e)}let ke;function ce(t){ke=t}function at(t,e){const l=t.$$.callbacks[e.type];l&&l.slice().forEach(n=>n.call(this,e))}const ie=[],je=[];let oe=[];const Le=[],ft=Promise.resolve();let ye=!1;function mt(){ye||(ye=!0,ft.then(Pe))}function de(t){oe.push(t)}const we=new Set;let se=0;function Pe(){if(se!==0)return;const t=ke;do{try{for(;se<ie.length;){const e=ie[se];se++,ce(e),_t(e.$$)}}catch(e){throw ie.length=0,se=0,e}for(ce(null),ie.length=0,se=0;je.length;)je.pop()();for(let e=0;e<oe.length;e+=1){const l=oe[e];we.has(l)||(we.add(l),l())}oe.length=0}while(ie.length);for(;Le.length;)Le.pop()();ye=!1,we.clear(),ce(t)}function _t(t){if(t.fragment!==null){t.update(),Z(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(de)}}function ht(t){const e=[],l=[];oe.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),oe=e}const pt=new Set;function ze(t,e){t&&t.i&&(pt.delete(t),t.i(e))}function Be(t,e){t.d(1),e.delete(t.key)}function Ne(t,e,l,n,i,s,o,p,f,d,m,a){let c=t.length,I=s.length,b=c;const y={};for(;b--;)y[t[b].key]=b;const r=[],M=new Map,F=new Map,O=[];for(b=I;b--;){const h=a(i,s,b),E=l(h);let S=o.get(E);S?n&&O.push(()=>S.p(h,e)):(S=d(E,h),S.c()),M.set(E,r[b]=S),E in y&&F.set(E,Math.abs(b-y[E]))}const P=new Set,R=new Set;function B(h){ze(h,1),h.m(p,m),o.set(h.key,h),m=h.first,I--}for(;c&&I;){const h=r[I-1],E=t[c-1],S=h.key,Q=E.key;h===E?(m=h.first,c--,I--):M.has(Q)?!o.has(S)||P.has(S)?B(h):R.has(Q)?c--:F.get(S)>F.get(Q)?(R.add(S),B(h)):(P.add(Q),c--):(f(E,o),c--)}for(;c--;){const h=t[c];M.has(h.key)||f(h,o)}for(;I;)B(r[I-1]);return Z(O),r}function gt(t,e,l,n){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,l),n||de(()=>{const o=t.$$.on_mount.map(De).filter(Te);t.$$.on_destroy?t.$$.on_destroy.push(...o):Z(o),t.$$.on_mount=[]}),s.forEach(de)}function vt(t,e){const l=t.$$;l.fragment!==null&&(ht(l.after_update),Z(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function bt(t,e){t.$$.dirty[0]===-1&&(ie.push(t),mt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function kt(t,e,l,n,i,s,o,p=[-1]){const f=ke;ce(t);const d=t.$$={fragment:null,ctx:[],props:s,update:ee,not_equal:i,bound:Ee(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:Ee(),dirty:p,skip_bound:!1,root:e.target||f.$$.root};o&&o(d.root);let m=!1;if(d.ctx=l?l(t,e.props||{},(a,c,...I)=>{const b=I.length?I[0]:c;return d.ctx&&i(d.ctx[a],d.ctx[a]=b)&&(!d.skip_bound&&d.bound[a]&&d.bound[a](b),m&&bt(t,a)),c}):[],d.update(),m=!0,Z(d.before_update),d.fragment=n?n(d.ctx):!1,e.target){if(e.hydrate){const a=ut(e.target);d.fragment&&d.fragment.l(a),a.forEach(D)}else d.fragment&&d.fragment.c();e.intro&&ze(t.$$.fragment),gt(t,e.target,e.anchor,e.customElement),Pe()}ce(f)}class yt{$destroy(){vt(this,1),this.$destroy=ee}$on(e,l){if(!Te(l))return ee;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const i=n.indexOf(l);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!dt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Gt="";function xe(t,e,l){const n=t.slice();return n[45]=e[l],n}function Ae(t,e,l){const n=t.slice();return n[48]=e[l],n}function Ue(t,e,l){const n=t.slice();return n[51]=e[l],n}function wt(t,e,l){const n=t.slice();return n[48]=e[l],n}function Fe(t,e,l){const n=t.slice();return n[51]=e[l],n[62]=e,n[63]=l,n}function qe(t,e,l){const n=t.slice();return n[59]=e[l],n}function Ve(t,e,l){const n=t.slice();return n[56]=e[l],n}function Ge(t,e,l){const n=t.slice();return n[59]=e[l],n}function He(t){let e,l,n,i,s,o,p,f,d,m;function a(r,M){return r[4]?It:St}let c=a(t),I=c(t),b=t[4]&&t[1].length>0&&Ye(t),y=t[5]&&lt(t);return{c(){e=g("div"),l=g("div"),n=g("button"),n.textContent="✖",i=L(),s=g("div"),o=g("div"),I.c(),p=L(),b&&b.c(),f=L(),y&&y.c(),k(n,"class","modal-close svelte-1lim31"),k(o,"class","medication-form-column svelte-1lim31"),k(s,"class","modal-grid svelte-1lim31"),k(l,"class","modal-content svelte-1lim31"),k(e,"class","modal-overlay svelte-1lim31")},m(r,M){T(r,e,M),u(e,l),u(l,n),u(l,i),u(l,s),u(s,o),I.m(o,null),u(s,p),b&&b.m(s,null),u(l,f),y&&y.m(l,null),d||(m=[x(n,"click",t[17]),x(l,"click",be(t[26])),x(e,"mousedown",t[42])],d=!0)},p(r,M){c===(c=a(r))&&I?I.p(r,M):(I.d(1),I=c(r),I&&(I.c(),I.m(o,null))),r[4]&&r[1].length>0?b?b.p(r,M):(b=Ye(r),b.c(),b.m(s,null)):b&&(b.d(1),b=null),r[5]?y?y.p(r,M):(y=lt(r),y.c(),y.m(l,null)):y&&(y.d(1),y=null)},d(r){r&&D(e),I.d(),b&&b.d(),y&&y.d(),d=!1,Z(m)}}}function It(t){let e,l,n,i,s,o,p,f,d,m,a,c,I,b,y,r,M,F,O,P,R,B,h,E,S,Q,$,J,q=t[7]?"Сохранить изменения":"Добавить препарат",A,G,N,te,ae,pe;function ge(v,z){return v[8]?Et:Dt}let re=ge(t),Y=re(t),le=t[12],V=[];for(let v=0;v<le.length;v+=1)V[v]=We(qe(t,le,v));let H=t[0].hasDiluent==="да"&&Je(t);return N=Me(t[31][0]),te=Me(t[31][1]),{c(){e=g("h2"),Y.c(),l=L(),n=g("select");for(let v=0;v<V.length;v+=1)V[v].c();i=L(),s=g("div"),o=g("label"),p=g("input"),f=j(` \r
                                    Внутримышечно`),d=L(),m=g("label"),a=g("input"),c=j(` \r
                                    Внутривенно`),I=L(),b=g("input"),y=L(),r=g("div"),M=g("label"),M.textContent="Использовать растворитель:",F=L(),O=g("label"),P=g("input"),R=j(` \r
                                    Нет`),B=L(),h=g("label"),E=g("input"),S=j(` \r
                                    Да`),Q=L(),H&&H.c(),$=L(),J=g("button"),A=j(q),k(n,"class","form-control svelte-1lim31"),t[0].medication===void 0&&de(()=>t[29].call(n)),k(p,"type","radio"),p.__value="в/м",p.value=p.__value,k(o,"class","svelte-1lim31"),k(a,"type","radio"),a.__value="в/в",a.value=a.__value,k(m,"class","svelte-1lim31"),k(s,"class","administration-type svelte-1lim31"),k(b,"type","text"),k(b,"placeholder","Дозировка препарата"),k(b,"class","form-control svelte-1lim31"),k(M,"class","svelte-1lim31"),k(P,"type","radio"),P.__value="нет",P.value=P.__value,k(O,"class","svelte-1lim31"),k(E,"type","radio"),E.__value="да",E.value=E.__value,k(h,"class","svelte-1lim31"),k(r,"class","diluent-choice svelte-1lim31"),k(J,"class","btn-add svelte-1lim31"),J.disabled=G=!t[10],N.p(P,E),te.p(p,a)},m(v,z){T(v,e,z),Y.m(e,null),T(v,l,z),T(v,n,z);for(let U=0;U<V.length;U+=1)V[U]&&V[U].m(n,null);_e(n,t[0].medication,!0),T(v,i,z),T(v,s,z),u(s,o),u(o,p),p.checked=p.__value===t[0].administrationType,u(o,f),u(s,d),u(s,m),u(m,a),a.checked=a.__value===t[0].administrationType,u(m,c),T(v,I,z),T(v,b,z),me(b,t[0].dosage),T(v,y,z),T(v,r,z),u(r,M),u(r,F),u(r,O),u(O,P),P.checked=P.__value===t[0].hasDiluent,u(O,R),u(r,B),u(r,h),u(h,E),E.checked=E.__value===t[0].hasDiluent,u(h,S),T(v,Q,z),H&&H.m(v,z),T(v,$,z),T(v,J,z),u(J,A),ae||(pe=[x(n,"change",t[29]),x(p,"change",t[30]),x(a,"change",t[32]),x(b,"input",t[33]),x(P,"change",t[34]),x(E,"change",t[35]),x(J,"click",t[18])],ae=!0)},p(v,z){if(re===(re=ge(v))&&Y?Y.p(v,z):(Y.d(1),Y=re(v),Y&&(Y.c(),Y.m(e,null))),z[0]&4096){le=v[12];let U;for(U=0;U<le.length;U+=1){const ve=qe(v,le,U);V[U]?V[U].p(ve,z):(V[U]=We(ve),V[U].c(),V[U].m(n,null))}for(;U<V.length;U+=1)V[U].d(1);V.length=le.length}z[0]&4097&&_e(n,v[0].medication),z[0]&4097&&(p.checked=p.__value===v[0].administrationType),z[0]&4097&&(a.checked=a.__value===v[0].administrationType),z[0]&4097&&b.value!==v[0].dosage&&me(b,v[0].dosage),z[0]&4097&&(P.checked=P.__value===v[0].hasDiluent),z[0]&4097&&(E.checked=E.__value===v[0].hasDiluent),v[0].hasDiluent==="да"?H?H.p(v,z):(H=Je(v),H.c(),H.m($.parentNode,$)):H&&(H.d(1),H=null),z[0]&128&&q!==(q=v[7]?"Сохранить изменения":"Добавить препарат")&&X(A,q),z[0]&1024&&G!==(G=!v[10])&&(J.disabled=G)},d(v){v&&D(e),Y.d(),v&&D(l),v&&D(n),ne(V,v),v&&D(i),v&&D(s),v&&D(I),v&&D(b),v&&D(y),v&&D(r),v&&D(Q),H&&H.d(v),v&&D($),v&&D(J),N.r(),te.r(),ae=!1,Z(pe)}}}function St(t){let e,l,n,i,s,o,p;function f(a,c){return a[9].length?Ct:Tt}let d=f(t),m=d(t);return{c(){e=g("div"),l=g("h2"),l.textContent="Существующие схемы лечения",n=L(),m.c(),i=L(),s=g("button"),s.textContent="+ Создать новую схему",k(e,"class","existing-schemes svelte-1lim31"),k(s,"class","btn-add-new-scheme svelte-1lim31")},m(a,c){T(a,e,c),u(e,l),u(e,n),m.m(e,null),T(a,i,c),T(a,s,c),o||(p=x(s,"click",t[21]),o=!0)},p(a,c){d===(d=f(a))&&m?m.p(a,c):(m.d(1),m=d(a),m&&(m.c(),m.m(e,null)))},d(a){a&&D(e),m.d(),a&&D(i),a&&D(s),o=!1,p()}}}function Dt(t){let e;return{c(){e=j("Добавление препарата")},m(l,n){T(l,e,n)},p:ee,d(l){l&&D(e)}}}function Et(t){let e,l=t[8].name+"",n;return{c(){e=j("Редактирование схемы: "),n=j(l)},m(i,s){T(i,e,s),T(i,n,s)},p(i,s){s[0]&256&&l!==(l=i[8].name+"")&&X(n,l)},d(i){i&&D(e),i&&D(n)}}}function We(t){let e,l=t[59].name+"",n;return{c(){e=g("option"),n=j(l),e.__value=t[59],e.value=e.__value},m(i,s){T(i,e,s),u(e,n)},p:ee,d(i){i&&D(e)}}}function Je(t){let e,l=[],n=new Map,i,s,o,p,f=t[0].diluents;const d=m=>m[51].id;for(let m=0;m<f.length;m+=1){let a=Fe(t,f,m),c=d(a);n.set(c,l[m]=Ke(c,a))}return{c(){e=g("div");for(let m=0;m<l.length;m+=1)l[m].c();i=L(),s=g("button"),s.textContent="+ Добавить растворитель",k(s,"class","btn-add-diluent svelte-1lim31"),k(e,"class","diluents-container svelte-1lim31")},m(m,a){T(m,e,a);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null);u(e,i),u(e,s),o||(p=x(s,"click",t[13]),o=!0)},p(m,a){a[0]&65537&&(f=m[0].diluents,l=Ne(l,a,d,1,m,f,n,e,Be,Ke,i,Fe))},d(m){m&&D(e);for(let a=0;a<l.length;a+=1)l[a].d();o=!1,p()}}}function Ke(t,e){let l,n,i,s,o,p,f,d,m,a,c;function I(){e[36].call(n,e[62],e[63])}function b(){e[37].call(f,e[62],e[63])}function y(){return e[38](e[51])}return{key:t,first:null,c(){l=g("div"),n=g("select"),i=g("option"),i.textContent="Выберите растворитель",s=g("option"),s.textContent="Глюкоза",o=g("option"),o.textContent="Физраствор",p=L(),f=g("input"),d=L(),m=g("button"),m.textContent="✖",i.__value="",i.value=i.__value,s.__value="глюкоза",s.value=s.__value,o.__value="физраствор",o.value=o.__value,k(n,"class","form-control diluent-select svelte-1lim31"),e[51].type===void 0&&de(I),k(f,"type","text"),k(f,"placeholder","Дозировка"),k(f,"class","form-control diluent-dosage svelte-1lim31"),k(m,"class","btn-remove-diluent svelte-1lim31"),k(l,"class","diluent-row svelte-1lim31"),this.first=l},m(r,M){T(r,l,M),u(l,n),u(n,i),u(n,s),u(n,o),_e(n,e[51].type,!0),u(l,p),u(l,f),me(f,e[51].dosage),u(l,d),u(l,m),a||(c=[x(n,"change",I),x(f,"input",b),x(m,"click",y)],a=!0)},p(r,M){e=r,M[0]&4097&&_e(n,e[51].type),M[0]&4097&&f.value!==e[51].dosage&&me(f,e[51].dosage)},d(r){r&&D(l),a=!1,Z(c)}}}function Tt(t){let e;return{c(){e=g("p"),e.textContent="Нет существующих схем"},m(l,n){T(l,e,n)},p:ee,d(l){l&&D(e)}}}function Ct(t){let e,l=t[9],n=[];for(let i=0;i<l.length;i+=1)n[i]=Xe(Ve(t,l,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=Ce()},m(i,s){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(i,s);T(i,e,s)},p(i,s){if(s[0]&9437696){l=i[9];let o;for(o=0;o<l.length;o+=1){const p=Ve(i,l,o);n[o]?n[o].p(p,s):(n[o]=Xe(p),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=l.length}},d(i){ne(n,i),i&&D(e)}}}function Qe(t){let e,l=t[59].name+"",n,i,s=t[59].dosage+"",o,p,f=t[59].администрationType+"",d,m;return{c(){e=g("div"),n=j(l),i=j(", "),o=j(s),p=j(" ("),d=j(f),m=j(`)\r
                                              `),k(e,"class","medication-details svelte-1lim31")},m(a,c){T(a,e,c),u(e,n),u(e,i),u(e,o),u(e,p),u(e,d),u(e,m)},p(a,c){c[0]&512&&l!==(l=a[59].name+"")&&X(n,l),c[0]&512&&s!==(s=a[59].dosage+"")&&X(o,s),c[0]&512&&f!==(f=a[59].администрationType+"")&&X(d,f)},d(a){a&&D(e)}}}function Xe(t){let e,l,n,i=t[56].name+"",s,o,p,f,d,m,a,c,I,b,y=t[56].medications,r=[];for(let O=0;O<y.length;O+=1)r[O]=Qe(Ge(t,y,O));function M(){return t[27](t[56])}function F(){return t[28](t[56])}return{c(){e=g("div"),l=g("div"),n=g("strong"),s=j(i),o=L();for(let O=0;O<r.length;O+=1)r[O].c();p=L(),f=g("div"),d=g("button"),d.textContent="Использовать",m=L(),a=g("button"),a.textContent="Редактировать",c=L(),k(l,"class","scheme-title"),k(d,"class","btn-use-scheme svelte-1lim31"),k(a,"class","btn-edit-scheme svelte-1lim31"),k(f,"class","scheme-actions svelte-1lim31"),k(e,"class","scheme-item svelte-1lim31")},m(O,P){T(O,e,P),u(e,l),u(l,n),u(n,s),u(l,o);for(let R=0;R<r.length;R+=1)r[R]&&r[R].m(l,null);u(e,p),u(e,f),u(f,d),u(f,m),u(f,a),u(e,c),I||(b=[x(d,"click",be(M)),x(a,"click",be(F))],I=!0)},p(O,P){if(t=O,P[0]&512&&i!==(i=t[56].name+"")&&X(s,i),P[0]&512){y=t[56].medications;let R;for(R=0;R<y.length;R+=1){const B=Ge(t,y,R);r[R]?r[R].p(B,P):(r[R]=Qe(B),r[R].c(),r[R].m(l,null))}for(;R<r.length;R+=1)r[R].d(1);r.length=y.length}},d(O){O&&D(e),ne(r,O),I=!1,Z(b)}}}function Ye(t){let e,l,n,i,s,o,p,f,d=[],m=new Map,a,c,I,b,y,r=[1,2,3,4,5,6,7,8,9,10],M=[];for(let h=0;h<10;h+=1)M[h]=Mt(wt(t,r,h));let F=t[1];const O=h=>h[45].id;for(let h=0;h<F.length;h+=1){let E=xe(t,F,h),S=O(E);m.set(S,d[h]=tt(S,E))}function P(h,E){return h[6]?Rt:Ot}let R=P(t),B=R(t);return{c(){e=g("div"),l=g("h2"),l.textContent="График приема препаратов",n=L(),i=g("div"),s=g("div"),o=g("div"),o.textContent="Препарат",p=L();for(let h=0;h<10;h+=1)M[h].c();f=L();for(let h=0;h<d.length;h+=1)d[h].c();a=L(),c=g("button"),B.c(),k(o,"class","medication-column svelte-1lim31"),k(s,"class","schedule-header svelte-1lim31"),k(i,"class","schedule-table svelte-1lim31"),k(c,"class","btn-continue svelte-1lim31"),c.disabled=I=t[1].length===0||t[6]||!t[11],k(e,"class","schedule-column svelte-1lim31")},m(h,E){T(h,e,E),u(e,l),u(e,n),u(e,i),u(i,s),u(s,o),u(s,p);for(let S=0;S<10;S+=1)M[S]&&M[S].m(s,null);u(i,f);for(let S=0;S<d.length;S+=1)d[S]&&d[S].m(i,null);u(e,a),u(e,c),B.m(c,null),b||(y=x(c,"click",t[22]),b=!0)},p(h,E){E[0]&573446&&(F=h[1],d=Ne(d,E,O,1,h,F,m,i,Be,tt,null,xe)),R!==(R=P(h))&&(B.d(1),B=R(h),B&&(B.c(),B.m(c,null))),E[0]&2114&&I!==(I=h[1].length===0||h[6]||!h[11])&&(c.disabled=I)},d(h){h&&D(e),ne(M,h);for(let E=0;E<d.length;E+=1)d[E].d();B.d(),b=!1,y()}}}function Mt(t){let e,l;return{c(){e=g("div"),l=j(t[48]),k(e,"class","day-header svelte-1lim31")},m(n,i){T(n,e,i),u(e,l)},p:ee,d(n){n&&D(e)}}}function Ze(t){let e,l=t[45].diluents,n=[];for(let i=0;i<l.length;i+=1)n[i]=$e(Ue(t,l,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=Ce()},m(i,s){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(i,s);T(i,e,s)},p(i,s){if(s[0]&2){l=i[45].diluents;let o;for(o=0;o<l.length;o+=1){const p=Ue(i,l,o);n[o]?n[o].p(p,s):(n[o]=$e(p),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=l.length}},d(i){ne(n,i),i&&D(e)}}}function $e(t){let e,l=t[51].type+"",n,i,s=t[51].dosage+"",o,p;return{c(){e=j("+ "),n=j(l),i=j(" ("),o=j(s),p=j(")")},m(f,d){T(f,e,d),T(f,n,d),T(f,i,d),T(f,o,d),T(f,p,d)},p(f,d){d[0]&2&&l!==(l=f[51].type+"")&&X(n,l),d[0]&2&&s!==(s=f[51].dosage+"")&&X(o,s)},d(f){f&&D(e),f&&D(n),f&&D(i),f&&D(o),f&&D(p)}}}function et(t){let e,l,n;function i(){return t[41](t[45],t[48])}return{c(){e=g("div"),k(e,"class","schedule-cell svelte-1lim31"),Re(e,"selected",t[2][t[45].id]&&t[2][t[45].id][1]&&t[2][t[45].id][1].has(t[48]))},m(s,o){T(s,e,o),l||(n=x(e,"click",i),l=!0)},p(s,o){t=s,o[0]&6&&Re(e,"selected",t[2][t[45].id]&&t[2][t[45].id][1]&&t[2][t[45].id][1].has(t[48]))},d(s){s&&D(e),l=!1,n()}}}function tt(t,e){let l,n,i,s,o=e[45].medication.name+"",p,f,d=e[45].administrationType+"",m,a,c=e[45].dosage+"",I,b,y,r,M,F,O,P,R,B,h,E,S=e[45].hasDiluent==="да"&&e[45].diluents.length>0&&Ze(e);function Q(){return e[39](e[45])}function $(){return e[40](e[45])}let J=[1,2,3,4,5,6,7,8,9,10],q=[];for(let A=0;A<10;A+=1)q[A]=et(Ae(e,J,A));return{key:t,first:null,c(){l=g("div"),n=g("div"),i=g("div"),s=g("strong"),p=j(o),f=L(),m=j(d),a=j(", "),I=j(c),b=L(),S&&S.c(),y=L(),r=g("div"),M=g("button"),M.textContent="✏️",F=L(),O=g("button"),O.textContent="🗑️",P=L();for(let A=0;A<10;A+=1)q[A].c();R=L(),k(i,"class","medication-title"),k(M,"class","btn-edit-medication svelte-1lim31"),k(O,"class","btn-delete-medication svelte-1lim31"),k(r,"class","medication-actions svelte-1lim31"),k(n,"class","medication-cell svelte-1lim31"),k(l,"class",B="schedule-row "+(!e[2][e[45].id]||!Object.values(e[2][e[45].id]).some(nt)?"error-highlight":"")+" svelte-1lim31"),this.first=l},m(A,G){T(A,l,G),u(l,n),u(n,i),u(i,s),u(s,p),u(i,f),u(i,m),u(i,a),u(i,I),u(i,b),S&&S.m(i,null),u(n,y),u(n,r),u(r,M),u(r,F),u(r,O),u(l,P);for(let N=0;N<10;N+=1)q[N]&&q[N].m(l,null);u(l,R),h||(E=[x(M,"click",Q),x(O,"click",$)],h=!0)},p(A,G){if(e=A,G[0]&2&&o!==(o=e[45].medication.name+"")&&X(p,o),G[0]&2&&d!==(d=e[45].administrationType+"")&&X(m,d),G[0]&2&&c!==(c=e[45].dosage+"")&&X(I,c),e[45].hasDiluent==="да"&&e[45].diluents.length>0?S?S.p(e,G):(S=Ze(e),S.c(),S.m(i,null)):S&&(S.d(1),S=null),G[0]&524294){J=[1,2,3,4,5,6,7,8,9,10];let N;for(N=0;N<10;N+=1){const te=Ae(e,J,N);q[N]?q[N].p(te,G):(q[N]=et(te),q[N].c(),q[N].m(l,R))}for(;N<10;N+=1)q[N].d(1)}G[0]&6&&B!==(B="schedule-row "+(!e[2][e[45].id]||!Object.values(e[2][e[45].id]).some(nt)?"error-highlight":"")+" svelte-1lim31")&&k(l,"class",B)},d(A){A&&D(l),S&&S.d(),ne(q,A),h=!1,Z(E)}}}function Ot(t){let e;return{c(){e=j("Опубликовать схему")},m(l,n){T(l,e,n)},d(l){l&&D(e)}}}function Rt(t){let e,l;return{c(){e=g("span"),l=j(" Сохранение..."),k(e,"class","spinner svelte-1lim31")},m(n,i){T(n,e,i),T(n,l,i)},d(n){n&&D(e),n&&D(l)}}}function lt(t){let e,l,n;return{c(){e=g("div"),l=j("⚠️ "),n=j(t[5]),k(e,"class","validation-error svelte-1lim31")},m(i,s){T(i,e,s),u(e,l),u(e,n)},p(i,s){s[0]&32&&X(n,i[5])},d(i){i&&D(e)}}}function jt(t){let e,l,n,i,s,o=t[3]&&He(t);return{c(){e=g("div"),l=g("button"),l.textContent="📋 Схема лечения",n=L(),o&&o.c(),k(l,"class","treatment-scheme-button svelte-1lim31"),k(e,"class","treatment-scheme-container")},m(p,f){T(p,e,f),u(e,l),u(e,n),o&&o.m(e,null),i||(s=x(l,"click",t[17]),i=!0)},p(p,f){p[3]?o?o.p(p,f):(o=He(p),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i:ee,o:ee,d(p){p&&D(e),o&&o.d(),i=!1,s()}}}const nt=t=>t.size>0;function Lt(t,e,l){let n,i,{serviceId:s=null}=e,{medicalCardId:o=null}=e,p=!1,f=!1,d=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],m="",a=!1,c={medication:d[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},I=null,b=null,y=[],r={},M=[{id:1,name:"Схема лечения №1",medications:[{id:101,name:"Цефтриаксон",dosage:"1г",администрationType:"в/м",diluents:[{id:1001,type:"физраствор",dosage:"2мл"}]}],schedule:{101:{1:[1,3,5,7,9]}}},{id:2,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}}];function F(){l(0,c.diluents=[...c.diluents,{id:Date.now(),type:"",dosage:""}],c)}function O(_){l(0,c={medication:d.find(w=>w.name===_.medication.name)||d[0],administrationType:_.administrationType,dosage:_.dosage,hasDiluent:_.hasDiluent,diluents:[..._.diluents]}),l(7,I=_.id)}function P(_){l(1,y=y.filter(w=>w.id!==_)),r[_]&&(delete r[_],l(2,r={...r})),I===_&&S(),l(5,m="")}function R(_){l(0,c.diluents=c.diluents.filter(w=>w.id!==_),c)}function B(){l(3,p=!p),p||h()}function h(){l(0,c={medication:d[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),l(1,y=[]),l(2,r={}),l(4,f=!1),l(8,b=null),l(5,m="")}function E(){if(i){if(I)l(1,y=y.map(_=>_.id===I?{...c,id:_.id}:_)),l(7,I=null);else{const _={...c,id:Date.now()};l(1,y=[...y,_])}S()}}function S(){l(0,c={medication:d[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),l(7,I=null)}function Q(_,w,W){r[_]||l(2,r[_]={},r),r[_][w]||l(2,r[_][w]=new Set,r),r[_][w].has(W)?r[_][w].delete(W):r[_][w].add(W),l(2,r={...r}),l(5,m="")}function $(_){console.log("Выбрана схема:",_),l(1,y=_.medications.map(w=>({id:w.id||Date.now()+Math.random(),medication:{name:w.name},administrationType:w.администрationType,dosage:w.dosage,hasDiluent:w.diluents&&w.diluents.length>0?"да":"нет",diluents:w.diluents||[]}))),l(2,r={}),_.schedule&&Object.entries(_.schedule).forEach(([w,W])=>{l(2,r[w]={},r),Object.entries(W).forEach(([K,fe])=>{l(2,r[w][K]=new Set(fe),r)})}),l(4,f=!0),B(),l(5,m="")}function J(){l(4,f=!0),l(1,y=[]),l(2,r={}),l(5,m="")}function q(){const _=y.filter(w=>!r[w.id]||!Object.values(r[w.id]).some(W=>W.size>0));if(_.length>0){const w=_.map(W=>W.medication.name).join(", ");l(5,m=`Не выбрано ни одного дня для препаратов: ${w}`);return}try{l(6,a=!0);const w={};Object.entries(r).forEach(([K,fe])=>{w[K]={},Object.entries(fe).forEach(([qt,Vt])=>{w[K][qt]=Array.from(Vt)})});const W={id:Date.now(),name:b?`${b.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:y.map(K=>({id:K.id,name:K.medication.name,dosage:K.dosage,администрationType:K.administrationType,hasDiluent:K.hasDiluent,diluent:K.diluent,diluentDosage:K.diluentDosage})),createdFor:{serviceId:s,medicalCardId:o},createdAt:new Date().toISOString(),isRevision:!!b,originalSchemeId:b?b.id:null,schedule:w};setTimeout(()=>{l(9,M=[...M,W]),console.log("Опубликована схема лечения",W),l(6,a=!1),B()},1e3)}catch(w){console.error("Ошибка публикации схемы:",w),l(6,a=!1)}}function A(_){console.log("Редактирование схемы:",_),l(1,y=_.medications.map(w=>({id:w.id||Date.now()+Math.random(),medication:{name:w.name},administrationType:w.администрationType,dosage:w.dosage,hasDiluent:w.diluents&&w.diluents.length>0?"да":"нет",diluents:w.diluents||[]}))),l(2,r={}),_.schedule&&Object.entries(_.schedule).forEach(([w,W])=>{l(2,r[w]={},r),Object.entries(W).forEach(([K,fe])=>{l(2,r[w][K]=new Set(fe),r)})}),l(4,f=!0),l(8,b=_),l(5,m="")}const G=[[],[]];function N(_){at.call(this,t,_)}const te=_=>$(_),ae=_=>A(_);function pe(){c.medication=Oe(this),l(0,c),l(12,d)}function ge(){c.administrationType=this.__value,l(0,c),l(12,d)}function re(){c.administrationType=this.__value,l(0,c),l(12,d)}function Y(){c.dosage=this.value,l(0,c),l(12,d)}function le(){c.hasDiluent=this.__value,l(0,c),l(12,d)}function V(){c.hasDiluent=this.__value,l(0,c),l(12,d)}function H(_,w){_[w].type=Oe(this),l(0,c),l(12,d)}function v(_,w){_[w].dosage=this.value,l(0,c),l(12,d)}const z=_=>R(_.id),U=_=>O(_),ve=_=>P(_.id),Ut=(_,w)=>Q(_.id,1,w),Ft=_=>{_.target.classList.contains("modal-overlay")&&B()};return t.$$set=_=>{"serviceId"in _&&l(24,s=_.serviceId),"medicalCardId"in _&&l(25,o=_.medicalCardId)},t.$$.update=()=>{t.$$.dirty[0]&6&&l(11,n=y.length>0&&y.every(_=>r[_.id]&&Object.values(r[_.id]).some(w=>w.size>0))),t.$$.dirty[0]&1&&l(10,i=!!(c.medication&&c.administrationType&&c.dosage&&(c.hasDiluent==="нет"||c.hasDiluent==="да"&&c.diluents.length>0&&c.diluents.every(_=>_.type&&_.dosage))))},[c,y,r,p,f,m,a,I,b,M,i,n,d,F,O,P,R,B,E,Q,$,J,q,A,s,o,N,te,ae,pe,ge,G,re,Y,le,V,H,v,z,U,ve,Ut,Ft]}class Pt extends yt{constructor(e){super(),kt(this,e,Lt,jt,ct,{serviceId:24,medicalCardId:25},null,[-1,-1,-1])}}const zt="#show_info_table_title",Ie="treatment-scheme-container",C={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),log(t,e,...l){if(!this.debug)return;const i={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${i} [RecordBtn-${this.instanceId}] ${e}`,...l)}};function it(t){const e=new URL(t,window.location.origin),l=e.pathname,n=l.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!n,patientId:n?n[1]:null,recordId:n?n[2]:null,fullPath:l+e.search,params:e.searchParams}}function ue(){C.log("action","Запущена процедура очистки"),C.intervalId!==null&&(clearInterval(C.intervalId),C.log("unmount","Интервал остановлен:",C.intervalId),C.intervalId=null);const t=document.getElementById(Ie);t&&(t.remove(),C.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),C.mounted=!1}function he(t=!1){const e=it(window.location.href);C.log("check","Проверка страницы:",e),e.recordId!==C.currentRecordId&&(C.log("route",`Изменился ID записи: ${C.currentRecordId||"none"} -> ${e.recordId||"none"}`),C.currentRecordId=e.recordId,C.currentPatientId=e.patientId,C.mounted&&(C.log("action","Удаляем компоненты из-за смены записи"),ue()));const n=document.querySelector(zt),i=document.getElementById(Ie);if(C.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!n}, mounted=${C.mounted}`),!i&&C.mounted&&(C.log("warn","Компонент исчез из DOM, но состояние не обновлено"),C.mounted=!1),e.isRecordPage&&n){if(!i){C.log("mount","Монтируем компонент TreatmentSchemeButton");const s=document.createElement("div");s.id=Ie,n.appendChild(s);try{new Pt({target:s,props:{serviceId:e.recordId,medicalCardId:e.patientId}}),C.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),C.mounted=!0}catch(o){C.log("error","Ошибка при монтировании TreatmentSchemeButton:",o),s.remove()}}}else!e.isRecordPage&&(i||C.mounted)&&(C.log("action","Не страница записи - удаляем компонент"),ue())}function Bt(){C.log("start","Инициализация компонентов"),ue(),window._recordButtonListenersInitialized||(Nt(),window._recordButtonListenersInitialized=!0);const t=it(window.location.href);return C.currentPath=t.fullPath,C.currentRecordId=t.recordId,C.currentPatientId=t.patientId,he(!0),C.intervalId=setInterval(()=>{C.log("timer","Регулярная проверка по интервалу"),he()},1e3),C.log("success","Интервал установлен, ID:",C.intervalId),ue}function Nt(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),C.log("route",`Обнаружен ${t}`),ot()}}),window.addEventListener("popstate",()=>{C.log("route","Обнаружен popstate"),ot()})}function ot(){[10,50,100,250,500,1e3,1500].forEach((e,l)=>{setTimeout(()=>{C.log("timer",`Запланированная проверка #${l+1} (${e}ms)`),he(!0)},e)})}window.addEventListener("beforeunload",ue),C.log("info","Модуль загружен"),he(!0);const xt=[{match:/\/medical_records\/\d+\/\d+$/,render:Bt}];let st=null;function At(){console.log("📡 Router запущен"),rt(()=>{const t=window.location.pathname,e=xt.find(l=>l.match.test(t));console.log("📌 Найден роут:",e?.match),e!==st&&(st=e,e?.render())})}console.log("✅ Content script работает"),At()})();
