(function(){"use strict";var Ce=document.createElement("style");Ce.textContent=`.treatment-scheme-button.svelte-1ajpdjc.svelte-1ajpdjc{background-color:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer}.modal-overlay.svelte-1ajpdjc.svelte-1ajpdjc{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content.svelte-1ajpdjc.svelte-1ajpdjc{background:white;border-radius:8px;width:900px;max-height:80%;position:relative;padding:20px;box-shadow:0 4px 6px #0000001a}.modal-grid.svelte-1ajpdjc.svelte-1ajpdjc{display:grid;grid-template-columns:1fr 1fr;gap:20px}.medication-form-column.svelte-1ajpdjc.svelte-1ajpdjc,.schedule-column.svelte-1ajpdjc.svelte-1ajpdjc{display:flex;flex-direction:column;gap:10px}.form-control.svelte-1ajpdjc.svelte-1ajpdjc{width:100%;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;font-size:14px}.modal-close.svelte-1ajpdjc.svelte-1ajpdjc{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999}.administration-type.svelte-1ajpdjc.svelte-1ajpdjc,.diluent-choice.svelte-1ajpdjc.svelte-1ajpdjc{display:flex;gap:15px;margin-bottom:10px}.administration-type.svelte-1ajpdjc label.svelte-1ajpdjc,.diluent-choice.svelte-1ajpdjc label.svelte-1ajpdjc{display:flex;align-items:center;gap:5px}.schedule-table.svelte-1ajpdjc.svelte-1ajpdjc{border:1px solid #ddd}.schedule-header.svelte-1ajpdjc.svelte-1ajpdjc{display:grid;grid-template-columns:200px repeat(7,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-1ajpdjc.svelte-1ajpdjc,.medication-column.svelte-1ajpdjc.svelte-1ajpdjc{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-1ajpdjc.svelte-1ajpdjc{display:grid;grid-template-columns:200px repeat(7,1fr)}.medication-cell.svelte-1ajpdjc.svelte-1ajpdjc{padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-1ajpdjc.svelte-1ajpdjc{height:30px;border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-1ajpdjc.svelte-1ajpdjc:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-1ajpdjc.svelte-1ajpdjc{background-color:#007bff}.no-medications.svelte-1ajpdjc.svelte-1ajpdjc{text-align:center;color:#6c757d;padding:20px}.btn-add.svelte-1ajpdjc.svelte-1ajpdjc,.btn-continue.svelte-1ajpdjc.svelte-1ajpdjc{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}.btn-add.svelte-1ajpdjc.svelte-1ajpdjc:disabled,.btn-continue.svelte-1ajpdjc.svelte-1ajpdjc:disabled{opacity:.5;cursor:not-allowed}.existing-schemes.svelte-1ajpdjc.svelte-1ajpdjc{margin-top:20px}.scheme-item.svelte-1ajpdjc.svelte-1ajpdjc{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:10px;margin-bottom:10px;cursor:pointer;transition:background-color .3s ease}.scheme-item.svelte-1ajpdjc.svelte-1ajpdjc:hover{background-color:#e9ecef}.medication-details.svelte-1ajpdjc.svelte-1ajpdjc{color:#6c757d;font-size:.9em;margin-top:5px}
`,document.head.appendChild(Ce);function dt(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function n(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(l=>{const i=history[l];history[l]=function(...r){i.apply(this,r),n()}}),window.addEventListener("popstate",n),t()}function q(){}function Te(t){return t()}function Se(){return Object.create(null)}function J(t){t.forEach(Te)}function Re(t){return typeof t=="function"}function rt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ut(t){return Object.keys(t).length===0}function c(t,e){t.appendChild(e)}function L(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode&&t.parentNode.removeChild(t)}function ne(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function D(t){return document.createTextNode(t)}function E(){return D(" ")}function ft(){return D("")}function O(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function pt(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function m(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Me(t){let e;return{p(...n){e=n,e.forEach(l=>t.push(l))},r(){e.forEach(n=>t.splice(t.indexOf(n),1))}}}function ht(t){return Array.from(t.childNodes)}function le(t,e){e=""+e,t.data!==e&&(t.data=e)}function ae(t,e){t.value=e??""}function se(t,e,n){for(let l=0;l<t.options.length;l+=1){const i=t.options[l];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Pe(t){const e=t.querySelector(":checked");return e&&e.__value}function Be(t,e,n){t.classList[n?"add":"remove"](e)}let me;function oe(t){me=t}function _t(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(l=>l.call(this,e))}const X=[],Le=[];let Y=[];const Oe=[],mt=Promise.resolve();let ge=!1;function gt(){ge||(ge=!0,mt.then(Ue))}function ie(t){Y.push(t)}const ve=new Set;let Z=0;function Ue(){if(Z!==0)return;const t=me;do{try{for(;Z<X.length;){const e=X[Z];Z++,oe(e),vt(e.$$)}}catch(e){throw X.length=0,Z=0,e}for(oe(null),X.length=0,Z=0;Le.length;)Le.pop()();for(let e=0;e<Y.length;e+=1){const n=Y[e];ve.has(n)||(ve.add(n),n())}Y.length=0}while(X.length);for(;Oe.length;)Oe.pop()();ge=!1,ve.clear(),oe(t)}function vt(t){if(t.fragment!==null){t.update(),J(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ie)}}function jt(t){const e=[],n=[];Y.forEach(l=>t.indexOf(l)===-1?e.push(l):n.push(l)),n.forEach(l=>l()),Y=e}const bt=new Set;function Ae(t,e){t&&t.i&&(bt.delete(t),t.i(e))}function kt(t,e){t.d(1),e.delete(t.key)}function yt(t,e,n,l,i,r,o,f,d,a,u,y){let s=t.length,_=r.length,p=s;const A={};for(;p--;)A[t[p].key]=p;const M=[],b=new Map,F=new Map,C=[];for(p=_;p--;){const I=y(i,r,p),N=n(I);let S=o.get(N);S?l&&C.push(()=>S.p(I,e)):(S=a(N,I),S.c()),b.set(N,M[p]=S),N in A&&F.set(N,Math.abs(p-A[N]))}const w=new Set,U=new Set;function k(I){Ae(I,1),I.m(f,u),o.set(I.key,I),u=I.first,_--}for(;s&&_;){const I=M[_-1],N=t[s-1],S=I.key,T=N.key;I===N?(u=I.first,s--,_--):b.has(T)?!o.has(S)||w.has(S)?k(I):U.has(T)?s--:F.get(S)>F.get(T)?(U.add(S),k(I)):(w.add(T),s--):(d(N,o),s--)}for(;s--;){const I=t[s];b.has(I.key)||d(I,o)}for(;_;)k(M[_-1]);return J(C),M}function wt(t,e,n,l){const{fragment:i,after_update:r}=t.$$;i&&i.m(e,n),l||ie(()=>{const o=t.$$.on_mount.map(Te).filter(Re);t.$$.on_destroy?t.$$.on_destroy.push(...o):J(o),t.$$.on_mount=[]}),r.forEach(ie)}function It(t,e){const n=t.$$;n.fragment!==null&&(jt(n.after_update),J(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Dt(t,e){t.$$.dirty[0]===-1&&(X.push(t),gt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Et(t,e,n,l,i,r,o,f=[-1]){const d=me;oe(t);const a=t.$$={fragment:null,ctx:[],props:r,update:q,not_equal:i,bound:Se(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:Se(),dirty:f,skip_bound:!1,root:e.target||d.$$.root};o&&o(a.root);let u=!1;if(a.ctx=n?n(t,e.props||{},(y,s,..._)=>{const p=_.length?_[0]:s;return a.ctx&&i(a.ctx[y],a.ctx[y]=p)&&(!a.skip_bound&&a.bound[y]&&a.bound[y](p),u&&Dt(t,y)),s}):[],a.update(),u=!0,J(a.before_update),a.fragment=l?l(a.ctx):!1,e.target){if(e.hydrate){const y=ht(e.target);a.fragment&&a.fragment.l(y),y.forEach(R)}else a.fragment&&a.fragment.c();e.intro&&Ae(t.$$.fragment),wt(t,e.target,e.anchor,e.customElement),Ue()}oe(d)}class Ct{$destroy(){It(this,1),this.$destroy=q}$on(e,n){if(!Re(n))return q;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(n),()=>{const i=l.indexOf(n);i!==-1&&l.splice(i,1)}}$set(e){this.$$set&&!ut(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Gt="";function Ne(t,e,n){const l=t.slice();return l[29]=e[n],l}function ze(t,e,n){const l=t.slice();return l[32]=e[n],l}function Tt(t,e,n){const l=t.slice();return l[32]=e[n],l}function xe(t,e,n){const l=t.slice();return l[37]=e[n],l}function Fe(t,e,n){const l=t.slice();return l[40]=e[n],l}function qe(t,e,n){const l=t.slice();return l[40]=e[n],l}function Ge(t){let e,n,l,i,r,o,f,d,a,u,y,s,_,p,A,M,b,F,C,w,U,k,I,N,S,T,re,ue,K,v,G,$,be,Q,et,fe,tt,ee,ke,nt,lt,V,ye,ot,we,W,it,pe,Ie,De,Ee,ct,te=t[5],z=[];for(let j=0;j<te.length;j+=1)z[j]=He(qe(t,te,j));let x=t[0].hasDiluent==="да"&&Ve(t);function qt(j,P){return j[6].length?Rt:St}let he=qt(t)(t);function at(j,P){return j[2].length===0?Pt:Mt}let _e=at(t),H=_e(t);return Ie=Me(t[17][0]),De=Me(t[17][1]),{c(){e=h("div"),n=h("div"),l=h("button"),l.textContent="✖",i=E(),r=h("div"),o=h("div"),f=h("h2"),f.textContent="Добавление препарата",d=E(),a=h("select");for(let j=0;j<z.length;j+=1)z[j].c();u=E(),y=h("div"),s=h("label"),_=h("input"),p=D(` \r
                Внутримышечно`),A=E(),M=h("label"),b=h("input"),F=D(` \r
                Внутривенно`),C=E(),w=h("input"),U=E(),k=h("div"),I=h("label"),I.textContent="Использовать растворитель:",N=E(),S=h("label"),T=h("input"),re=D(` \r
                Нет`),ue=E(),K=h("label"),v=h("input"),G=D(` \r
                Да`),$=E(),x&&x.c(),be=E(),Q=h("button"),et=D("Добавить препарат"),tt=E(),ee=h("div"),ke=h("h2"),ke.textContent="Существующие схемы",nt=E(),he.c(),lt=E(),V=h("div"),ye=h("h2"),ye.textContent="График приема препаратов",ot=E(),H.c(),we=E(),W=h("button"),it=D("Опубликовать схему"),m(l,"class","modal-close svelte-1ajpdjc"),m(a,"class","form-control svelte-1ajpdjc"),t[0].medication===void 0&&ie(()=>t[15].call(a)),m(_,"type","radio"),_.__value="в/м",_.value=_.__value,m(s,"class","svelte-1ajpdjc"),m(b,"type","radio"),b.__value="в/в",b.value=b.__value,m(M,"class","svelte-1ajpdjc"),m(y,"class","administration-type svelte-1ajpdjc"),m(w,"type","text"),m(w,"placeholder","Дозировка препарата"),m(w,"class","form-control svelte-1ajpdjc"),m(I,"class","svelte-1ajpdjc"),m(T,"type","radio"),T.__value="нет",T.value=T.__value,m(S,"class","svelte-1ajpdjc"),m(v,"type","radio"),v.__value="да",v.value=v.__value,m(K,"class","svelte-1ajpdjc"),m(k,"class","diluent-choice svelte-1ajpdjc"),m(Q,"class","btn-add svelte-1ajpdjc"),Q.disabled=fe=!t[4],m(ee,"class","existing-schemes svelte-1ajpdjc"),m(o,"class","medication-form-column svelte-1ajpdjc"),m(W,"class","btn-continue svelte-1ajpdjc"),W.disabled=pe=t[2].length===0,m(V,"class","schedule-column svelte-1ajpdjc"),m(r,"class","modal-grid svelte-1ajpdjc"),m(n,"class","modal-content svelte-1ajpdjc"),m(e,"class","modal-overlay svelte-1ajpdjc"),Ie.p(T,v),De.p(_,b)},m(j,P){L(j,e,P),c(e,n),c(n,l),c(n,i),c(n,r),c(r,o),c(o,f),c(o,d),c(o,a);for(let B=0;B<z.length;B+=1)z[B]&&z[B].m(a,null);se(a,t[0].medication,!0),c(o,u),c(o,y),c(y,s),c(s,_),_.checked=_.__value===t[0].administrationType,c(s,p),c(y,A),c(y,M),c(M,b),b.checked=b.__value===t[0].administrationType,c(M,F),c(o,C),c(o,w),ae(w,t[0].dosage),c(o,U),c(o,k),c(k,I),c(k,N),c(k,S),c(S,T),T.checked=T.__value===t[0].hasDiluent,c(S,re),c(k,ue),c(k,K),c(K,v),v.checked=v.__value===t[0].hasDiluent,c(K,G),c(o,$),x&&x.m(o,null),c(o,be),c(o,Q),c(Q,et),c(o,tt),c(o,ee),c(ee,ke),c(ee,nt),he.m(ee,null),c(r,lt),c(r,V),c(V,ye),c(V,ot),H.m(V,null),c(V,we),c(V,W),c(W,it),Ee||(ct=[O(l,"click",t[7]),O(a,"change",t[15]),O(_,"change",t[16]),O(b,"change",t[18]),O(w,"input",t[19]),O(T,"change",t[20]),O(v,"change",t[21]),O(Q,"click",t[8]),O(W,"click",t[11]),O(n,"click",pt(t[14])),O(e,"click",t[7])],Ee=!0)},p(j,P){if(P[0]&32){te=j[5];let B;for(B=0;B<te.length;B+=1){const st=qe(j,te,B);z[B]?z[B].p(st,P):(z[B]=He(st),z[B].c(),z[B].m(a,null))}for(;B<z.length;B+=1)z[B].d(1);z.length=te.length}P[0]&33&&se(a,j[0].medication),P[0]&33&&(_.checked=_.__value===j[0].administrationType),P[0]&33&&(b.checked=b.__value===j[0].administrationType),P[0]&33&&w.value!==j[0].dosage&&ae(w,j[0].dosage),P[0]&33&&(T.checked=T.__value===j[0].hasDiluent),P[0]&33&&(v.checked=v.__value===j[0].hasDiluent),j[0].hasDiluent==="да"?x?x.p(j,P):(x=Ve(j),x.c(),x.m(o,be)):x&&(x.d(1),x=null),P[0]&16&&fe!==(fe=!j[4])&&(Q.disabled=fe),he.p(j,P),_e===(_e=at(j))&&H?H.p(j,P):(H.d(1),H=_e(j),H&&(H.c(),H.m(V,we))),P[0]&4&&pe!==(pe=j[2].length===0)&&(W.disabled=pe)},d(j){j&&R(e),ne(z,j),x&&x.d(),he.d(),H.d(),Ie.r(),De.r(),Ee=!1,J(ct)}}}function He(t){let e,n=t[40].name+"",l;return{c(){e=h("option"),l=D(n),e.__value=t[40],e.value=e.__value},m(i,r){L(i,e,r),c(e,l)},p:q,d(i){i&&R(e)}}}function Ve(t){let e,n,l,i,r,o,f,d;return{c(){e=h("select"),n=h("option"),n.textContent="Выберите растворитель",l=h("option"),l.textContent="Глюкоза",i=h("option"),i.textContent="Физраствор",r=E(),o=h("input"),n.__value="",n.value=n.__value,l.__value="глюкоза",l.value=l.__value,i.__value="физраствор",i.value=i.__value,m(e,"class","form-control svelte-1ajpdjc"),t[0].diluent===void 0&&ie(()=>t[22].call(e)),m(o,"type","text"),m(o,"placeholder","Дозировка растворителя"),m(o,"class","form-control svelte-1ajpdjc")},m(a,u){L(a,e,u),c(e,n),c(e,l),c(e,i),se(e,t[0].diluent,!0),L(a,r,u),L(a,o,u),ae(o,t[0].diluentDosage),f||(d=[O(e,"change",t[22]),O(o,"input",t[23])],f=!0)},p(a,u){u[0]&33&&se(e,a[0].diluent),u[0]&33&&o.value!==a[0].diluentDosage&&ae(o,a[0].diluentDosage)},d(a){a&&R(e),a&&R(r),a&&R(o),f=!1,J(d)}}}function St(t){let e;return{c(){e=h("p"),e.textContent="Нет существующих схем"},m(n,l){L(n,e,l)},p:q,d(n){n&&R(e)}}}function Rt(t){let e,n=t[6],l=[];for(let i=0;i<n.length;i+=1)l[i]=Ke(xe(t,n,i));return{c(){for(let i=0;i<l.length;i+=1)l[i].c();e=ft()},m(i,r){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(i,r);L(i,e,r)},p(i,r){if(r[0]&1088){n=i[6];let o;for(o=0;o<n.length;o+=1){const f=xe(i,n,o);l[o]?l[o].p(f,r):(l[o]=Ke(f),l[o].c(),l[o].m(e.parentNode,e))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(i){ne(l,i),i&&R(e)}}}function Je(t){let e,n=t[40].name+"",l,i,r=t[40].dosage+"",o,f,d=t[40].administrationType+"",a,u;return{c(){e=h("div"),l=D(n),i=D(", "),o=D(r),f=D(" ("),a=D(d),u=D(")"),m(e,"class","medication-details svelte-1ajpdjc")},m(y,s){L(y,e,s),c(e,l),c(e,i),c(e,o),c(e,f),c(e,a),c(e,u)},p:q,d(y){y&&R(e)}}}function Ke(t){let e,n,l=t[37].name+"",i,r,o,f,d,a=t[37].medications,u=[];for(let s=0;s<a.length;s+=1)u[s]=Je(Fe(t,a,s));function y(){return t[24](t[37])}return{c(){e=h("div"),n=h("strong"),i=D(l),r=E();for(let s=0;s<u.length;s+=1)u[s].c();o=E(),m(e,"class","scheme-item svelte-1ajpdjc")},m(s,_){L(s,e,_),c(e,n),c(n,i),c(e,r);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(e,null);c(e,o),f||(d=O(e,"click",y),f=!0)},p(s,_){if(t=s,_[0]&64){a=t[37].medications;let p;for(p=0;p<a.length;p+=1){const A=Fe(t,a,p);u[p]?u[p].p(A,_):(u[p]=Je(A),u[p].c(),u[p].m(e,o))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}},d(s){s&&R(e),ne(u,s),f=!1,d()}}}function Mt(t){let e,n,l,i,r,o=[],f=new Map,d=[1,2,3,4,5,6,7],a=[];for(let s=0;s<7;s+=1)a[s]=Bt(Tt(t,d,s));let u=t[2];const y=s=>s[29].id;for(let s=0;s<u.length;s+=1){let _=Ne(t,u,s),p=y(_);f.set(p,o[s]=Xe(p,_))}return{c(){e=h("div"),n=h("div"),l=h("div"),l.textContent="Препарат",i=E();for(let s=0;s<7;s+=1)a[s].c();r=E();for(let s=0;s<o.length;s+=1)o[s].c();m(l,"class","medication-column svelte-1ajpdjc"),m(n,"class","schedule-header svelte-1ajpdjc"),m(e,"class","schedule-table svelte-1ajpdjc")},m(s,_){L(s,e,_),c(e,n),c(n,l),c(n,i);for(let p=0;p<7;p+=1)a[p]&&a[p].m(n,null);c(e,r);for(let p=0;p<o.length;p+=1)o[p]&&o[p].m(e,null)},p(s,_){_[0]&524&&(u=s[2],o=yt(o,_,y,1,s,u,f,e,kt,Xe,null,Ne))},d(s){s&&R(e),ne(a,s);for(let _=0;_<o.length;_+=1)o[_].d()}}}function Pt(t){let e;return{c(){e=h("p"),e.textContent="Нет препаратов",m(e,"class","no-medications svelte-1ajpdjc")},m(n,l){L(n,e,l)},p:q,d(n){n&&R(e)}}}function Bt(t){let e,n,l;return{c(){e=h("div"),n=D("День "),l=D(t[32]),m(e,"class","day-header svelte-1ajpdjc")},m(i,r){L(i,e,r),c(e,n),c(e,l)},p:q,d(i){i&&R(e)}}}function Qe(t){let e,n,l=t[29].diluent+"",i,r,o=t[29].diluentDosage+"",f;return{c(){e=h("div"),n=D("Растворитель: "),i=D(l),r=D(`, \r
                          Доза: `),f=D(o)},m(d,a){L(d,e,a),c(e,n),c(e,i),c(e,r),c(e,f)},p(d,a){a[0]&4&&l!==(l=d[29].diluent+"")&&le(i,l),a[0]&4&&o!==(o=d[29].diluentDosage+"")&&le(f,o)},d(d){d&&R(e)}}}function We(t){let e,n,l;function i(){return t[25](t[29],t[32])}return{c(){e=h("div"),m(e,"class","schedule-cell svelte-1ajpdjc"),Be(e,"selected",t[3][t[29].id]&&t[3][t[29].id][1]&&t[3][t[29].id][1].has(t[32]))},m(r,o){L(r,e,o),n||(l=O(e,"click",i),n=!0)},p(r,o){t=r,o[0]&12&&Be(e,"selected",t[3][t[29].id]&&t[3][t[29].id][1]&&t[3][t[29].id][1].has(t[32]))},d(r){r&&R(e),n=!1,l()}}}function Xe(t,e){let n,l,i,r=e[29].medication.name+"",o,f,d,a=e[29].administrationType+"",u,y,s=e[29].dosage+"",_,p,A,M,b=e[29].hasDiluent==="да"&&Qe(e),F=[1,2,3,4,5,6,7],C=[];for(let w=0;w<7;w+=1)C[w]=We(ze(e,F,w));return{key:t,first:null,c(){n=h("div"),l=h("div"),i=h("strong"),o=D(r),f=E(),d=h("div"),u=D(a),y=D(", "),_=D(s),p=E(),b&&b.c(),A=E();for(let w=0;w<7;w+=1)C[w].c();M=E(),m(l,"class","medication-cell svelte-1ajpdjc"),m(n,"class","schedule-row svelte-1ajpdjc"),this.first=n},m(w,U){L(w,n,U),c(n,l),c(l,i),c(i,o),c(l,f),c(l,d),c(d,u),c(d,y),c(d,_),c(l,p),b&&b.m(l,null),c(n,A);for(let k=0;k<7;k+=1)C[k]&&C[k].m(n,null);c(n,M)},p(w,U){if(e=w,U[0]&4&&r!==(r=e[29].medication.name+"")&&le(o,r),U[0]&4&&a!==(a=e[29].administrationType+"")&&le(u,a),U[0]&4&&s!==(s=e[29].dosage+"")&&le(_,s),e[29].hasDiluent==="да"?b?b.p(e,U):(b=Qe(e),b.c(),b.m(l,null)):b&&(b.d(1),b=null),U[0]&524){F=[1,2,3,4,5,6,7];let k;for(k=0;k<7;k+=1){const I=ze(e,F,k);C[k]?C[k].p(I,U):(C[k]=We(I),C[k].c(),C[k].m(n,M))}for(;k<7;k+=1)C[k].d(1)}},d(w){w&&R(n),b&&b.d(),ne(C,w)}}}function Lt(t){let e,n,l,i,r,o=t[1]&&Ge(t);return{c(){e=h("div"),n=h("button"),n.textContent="📋 Схема лечения",l=E(),o&&o.c(),m(n,"class","treatment-scheme-button svelte-1ajpdjc"),m(e,"class","treatment-scheme-container")},m(f,d){L(f,e,d),c(e,n),c(e,l),o&&o.m(e,null),i||(r=O(n,"click",t[7]),i=!0)},p(f,d){f[1]?o?o.p(f,d):(o=Ge(f),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i:q,o:q,d(f){f&&R(e),o&&o.d(),i=!1,r()}}}function Ot(t,e,n){let l,{serviceId:i=null}=e,{medicalCardId:r=null}=e,o=!1,f=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],d={medication:f[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluent:"",diluentDosage:""},a=[],u={},y=[{id:1,name:"Схема лечения №1",medications:[{name:"Цефтриаксон",dosage:"1г",администрationType:"в/м"}]},{id:2,name:"Схема лечения №2",medications:[{name:"Метронидазол",dosage:"500мг",администрationType:"в/в"}]}];function s(){n(1,o=!o),o||_()}function _(){n(0,d={medication:f[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluent:"",diluentDosage:""}),n(2,a=[]),n(3,u={})}function p(){if(l){const v={...d,id:Date.now()};v.hasDiluent==="нет"&&(v.diluent="",v.diluentDosage=""),n(2,a=[...a,v]),n(0,d={medication:f[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluent:"",diluentDosage:""})}}function A(v,G,$){u[v]||n(3,u[v]={},u),u[v][G]||n(3,u[v][G]=new Set,u),u[v][G].has($)?u[v][G].delete($):u[v][G].add($),n(3,u={...u})}function M(v){console.log("Выбрана схема:",v)}function b(){console.log("Publish treatment scheme",{serviceId:i,medicalCardId:r,medications:a,schedule:u}),s()}const F=[[],[]];function C(v){_t.call(this,t,v)}function w(){d.medication=Pe(this),n(0,d),n(5,f)}function U(){d.administrationType=this.__value,n(0,d),n(5,f)}function k(){d.administrationType=this.__value,n(0,d),n(5,f)}function I(){d.dosage=this.value,n(0,d),n(5,f)}function N(){d.hasDiluent=this.__value,n(0,d),n(5,f)}function S(){d.hasDiluent=this.__value,n(0,d),n(5,f)}function T(){d.diluent=Pe(this),n(0,d),n(5,f)}function re(){d.diluentDosage=this.value,n(0,d),n(5,f)}const ue=v=>M(v),K=(v,G)=>A(v.id,1,G);return t.$$set=v=>{"serviceId"in v&&n(12,i=v.serviceId),"medicalCardId"in v&&n(13,r=v.medicalCardId)},t.$$.update=()=>{t.$$.dirty[0]&1&&n(4,l=!!(d.medication&&d.administrationType&&d.dosage&&(d.hasDiluent==="нет"||d.hasDiluent==="да"&&d.diluent&&d.diluentDosage)))},[d,o,a,u,l,f,y,s,p,A,M,b,i,r,C,w,U,F,k,I,N,S,T,re,ue,K]}class Ut extends Ct{constructor(e){super(),Et(this,e,Ot,Lt,rt,{serviceId:12,medicalCardId:13},null,[-1,-1])}}const At="#show_info_table_title",je="treatment-scheme-container",g={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),log(t,e,...n){if(!this.debug)return;const i={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${i} [RecordBtn-${this.instanceId}] ${e}`,...n)}};function Ye(t){const e=new URL(t,window.location.origin),n=e.pathname,l=n.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!l,patientId:l?l[1]:null,recordId:l?l[2]:null,fullPath:n+e.search,params:e.searchParams}}function ce(){g.log("action","Запущена процедура очистки"),g.intervalId!==null&&(clearInterval(g.intervalId),g.log("unmount","Интервал остановлен:",g.intervalId),g.intervalId=null);const t=document.getElementById(je);t&&(t.remove(),g.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),g.mounted=!1}function de(t=!1){const e=Ye(window.location.href);g.log("check","Проверка страницы:",e),e.recordId!==g.currentRecordId&&(g.log("route",`Изменился ID записи: ${g.currentRecordId||"none"} -> ${e.recordId||"none"}`),g.currentRecordId=e.recordId,g.currentPatientId=e.patientId,g.mounted&&(g.log("action","Удаляем компоненты из-за смены записи"),ce()));const l=document.querySelector(At),i=document.getElementById(je);if(g.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!l}, mounted=${g.mounted}`),!i&&g.mounted&&(g.log("warn","Компонент исчез из DOM, но состояние не обновлено"),g.mounted=!1),e.isRecordPage&&l){if(!i){g.log("mount","Монтируем компонент TreatmentSchemeButton");const r=document.createElement("div");r.id=je,l.appendChild(r);try{new Ut({target:r,props:{serviceId:e.recordId,medicalCardId:e.patientId}}),g.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),g.mounted=!0}catch(o){g.log("error","Ошибка при монтировании TreatmentSchemeButton:",o),r.remove()}}}else!e.isRecordPage&&(i||g.mounted)&&(g.log("action","Не страница записи - удаляем компонент"),ce())}function Nt(){g.log("start","Инициализация компонентов"),ce(),window._recordButtonListenersInitialized||(zt(),window._recordButtonListenersInitialized=!0);const t=Ye(window.location.href);return g.currentPath=t.fullPath,g.currentRecordId=t.recordId,g.currentPatientId=t.patientId,de(!0),g.intervalId=setInterval(()=>{g.log("timer","Регулярная проверка по интервалу"),de()},1e3),g.log("success","Интервал установлен, ID:",g.intervalId),ce}function zt(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),g.log("route",`Обнаружен ${t}`),Ze()}}),window.addEventListener("popstate",()=>{g.log("route","Обнаружен popstate"),Ze()})}function Ze(){[10,50,100,250,500,1e3,1500].forEach((e,n)=>{setTimeout(()=>{g.log("timer",`Запланированная проверка #${n+1} (${e}ms)`),de(!0)},e)})}window.addEventListener("beforeunload",ce),g.log("info","Модуль загружен"),de(!0);const xt=[{match:/\/medical_records\/\d+\/\d+$/,render:Nt}];let $e=null;function Ft(){console.log("📡 Router запущен"),dt(()=>{const t=window.location.pathname,e=xt.find(n=>n.match.test(t));console.log("📌 Найден роут:",e?.match),e!==$e&&($e=e,e?.render())})}console.log("✅ Content script работает"),Ft()})();
