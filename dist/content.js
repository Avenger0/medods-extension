(function(){"use strict";var Ae=document.createElement("style");Ae.textContent=`.scheme-item.svelte-1fmghv1{background-color:var(--item-bg-color, #f8f9fa);border:1px solid var(--item-border-color, #e9ecef);border-radius:4px;padding:12px;margin-bottom:10px;transition:background-color .2s ease,transform .1s ease}.scheme-item.svelte-1fmghv1:hover{background-color:var(--item-hover-color, #e9ecef);transform:translateY(-1px);box-shadow:0 2px 4px #0000000d}.scheme-title.svelte-1fmghv1{color:var(--title-color, #333)}.medication-details.svelte-1fmghv1{color:var(--details-color, #6c757d);font-size:.9em}.diluent-info.svelte-1fmghv1{font-style:italic}.scheme-actions.svelte-1fmghv1{display:flex;gap:8px;margin-top:10px}.btn-use-scheme.svelte-1fmghv1{padding:6px 10px;font-size:13px;border:none;border-radius:4px;cursor:pointer;transition:opacity .2s ease}.btn-use-scheme.svelte-1fmghv1{background-color:var(--use-btn-bg, #007bff);color:var(--use-btn-text, #fff)}.btn-use-scheme.svelte-1fmghv1:hover{opacity:.9}.existing-schemes.svelte-5qbczz{margin-top:20px;background-color:var(--bg-color, #f8f9fa);border-radius:6px;padding:15px;border:1px solid var(--border-color, #e9ecef)}h2.svelte-5qbczz{margin-top:0;color:var(--title-color, #333);font-size:1.2rem;margin-bottom:15px;border-bottom:1px solid var(--border-color, #e9ecef);padding-bottom:10px}.schemes-list.svelte-5qbczz{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-height:500px;overflow-y:auto;padding-right:5px}.no-schemes.svelte-5qbczz{font-style:italic;color:#6c757d;text-align:center;padding:15px 0}.modal-overlay.svelte-1lbmm4i{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--overlay-color, rgba(0,0,0,.5));display:flex;justify-content:center;align-items:center;z-index:var(--z-index, 1000);overflow-y:auto}.modal-content.svelte-1lbmm4i{background:var(--bg-color, white);border-radius:var(--border-radius, 8px);max-width:var(--max-width, 1100px);max-height:var(--max-height, 80%);width:calc(100% - 40px);position:relative;padding:var(--padding, 20px);box-shadow:var(--box-shadow, 0 4px 6px rgba(0,0,0,.1));overflow-y:auto}.modal-close.svelte-1lbmm4i{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999;transition:color .2s ease;z-index:1}.modal-close.svelte-1lbmm4i:hover{color:#333}h3.svelte-1njhuli.svelte-1njhuli{font-size:21px;margin:0 0 15px;padding:0}.form-control-ex.svelte-1njhuli.svelte-1njhuli{width:100%;border:1px solid #ccc;border-radius:4px;font-size:16px!important}.form-control-ex.svelte-1njhuli.svelte-1njhuli::placeholder{font-size:16px!important}.administration-type.svelte-1njhuli.svelte-1njhuli,.diluent-choice.svelte-1njhuli.svelte-1njhuli{display:flex;gap:15px;margin-bottom:15px;margin-top:15px}.administration-type.svelte-1njhuli label.svelte-1njhuli,.diluent-choice.svelte-1njhuli label.svelte-1njhuli{font-size:16px;display:flex;align-items:center;gap:5px}.diluents-container.svelte-1njhuli.svelte-1njhuli{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-1njhuli.svelte-1njhuli{display:flex;gap:8px;align-items:center;margin-bottom:10px}.diluent-select.svelte-1njhuli.svelte-1njhuli{flex:3}.diluent-dosage.svelte-1njhuli.svelte-1njhuli{flex:2}.btn-remove-diluent.svelte-1njhuli.svelte-1njhuli{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:16px!important;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-1njhuli.svelte-1njhuli{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:16px!important;cursor:pointer;align-self:flex-start;margin-top:5px}.button-row.svelte-1njhuli.svelte-1njhuli{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}.btn-save.svelte-1njhuli.svelte-1njhuli,.btn-cancel.svelte-1njhuli.svelte-1njhuli{padding:8px 16px;border-radius:4px;cursor:pointer;border:none;font-size:18px}.btn-save.svelte-1njhuli.svelte-1njhuli{background-color:#3faeca;color:#fff}.btn-save.svelte-1njhuli.svelte-1njhuli:disabled{opacity:.5;cursor:not-allowed}.btn-cancel.svelte-1njhuli.svelte-1njhuli{background-color:#f1f1f1;color:#333}.btn-add-new-scheme.svelte-651s9i{background-color:var(--btn-bg-color, #28a745);color:var(--btn-text-color, #fff);border:none;padding:12px 16px;border-radius:var(--btn-border-radius, 4px);cursor:pointer;width:100%;max-width:300px;font-weight:500;transition:background-color .2s ease,transform .1s ease;box-shadow:0 2px 4px #0000001a;margin:auto;font-size:18px}.btn-add-new-scheme.svelte-651s9i:hover{background-color:var(--btn-hover-color, #218838);transform:translateY(-1px);box-shadow:0 3px 6px #00000026}.btn-add-new-scheme.svelte-651s9i:active{transform:translateY(1px);box-shadow:0 1px 2px #0000001a}h3.svelte-16072ha.svelte-16072ha{font-size:21px;margin:0 0 15px;padding:0}.schedule-head.svelte-16072ha.svelte-16072ha{display:flex;align-items:center;justify-content:space-around}.empty.svelte-16072ha.svelte-16072ha{text-align:center;font-size:18px;padding:15px}.treatment-scheme-button.svelte-16072ha.svelte-16072ha{background-color:var(--bg-color, #007bff);color:var(--text-color, white);border:none;padding:8px 12px;border-radius:var(--border-radius, 4px);cursor:pointer;transition:opacity .2s ease}.treatment-scheme-button.svelte-16072ha.svelte-16072ha:hover{opacity:.9}.modal-grid.svelte-16072ha.svelte-16072ha{display:grid;gap:20px}.medication-form-column.svelte-16072ha.svelte-16072ha,.schedule-column.svelte-16072ha.svelte-16072ha{display:flex;flex-direction:column;gap:10px}.schedule-table.svelte-16072ha.svelte-16072ha{border:1px solid #ddd}.schedule-header.svelte-16072ha.svelte-16072ha{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-16072ha.svelte-16072ha,.medication-column.svelte-16072ha.svelte-16072ha{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-16072ha.svelte-16072ha{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-16072ha.svelte-16072ha{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-16072ha.svelte-16072ha{border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-16072ha.svelte-16072ha:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-16072ha.svelte-16072ha{background-color:#007bff}.error-highlight.svelte-16072ha .medication-cell.svelte-16072ha{background-color:#fff4f4;border-left:3px solid #dc3545}.validation-error.svelte-16072ha.svelte-16072ha{background-color:#fff3cd;color:#856404;padding:10px;margin-bottom:15px;border-radius:4px;border-left:4px solid #ffc107;font-size:14px}.medication-actions.svelte-16072ha.svelte-16072ha{margin-top:5px;display:flex;gap:5px}.btn-edit-medication.svelte-16072ha.svelte-16072ha,.btn-delete-medication.svelte-16072ha.svelte-16072ha{padding:2px 5px;font-size:12px;border:none;border-radius:3px;cursor:pointer;background-color:transparent}.btn-edit-medication.svelte-16072ha.svelte-16072ha:hover{background-color:#f0f0f0}.btn-delete-medication.svelte-16072ha.svelte-16072ha:hover{background-color:#fff5f5}.schedule-actions.svelte-16072ha.svelte-16072ha{display:flex;justify-content:space-between;margin-top:10px}.btn-continue.svelte-16072ha.svelte-16072ha{background-color:#4caf50;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:18px}.btn-continue.svelte-16072ha.svelte-16072ha:disabled{opacity:.5;cursor:not-allowed}.btn-add-medication.svelte-16072ha.svelte-16072ha{background-color:#3faeca;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:18px}.spinner.svelte-16072ha.svelte-16072ha{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-16072ha-spin 1s ease-in-out infinite;margin-right:8px}.btn-back.svelte-16072ha.svelte-16072ha{background-color:transparent;border:none;padding:5px 10px;font-size:14px;color:#555;cursor:pointer;margin-right:10px;border-radius:4px;font-size:18px}.btn-back.svelte-16072ha.svelte-16072ha:hover{background-color:#f0f0f0}.medication-title.svelte-16072ha.svelte-16072ha{font-size:15px}@keyframes svelte-16072ha-spin{to{transform:rotate(360deg)}}
`,document.head.appendChild(Ae);function xt(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function l(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(n=>{const o=history[n];history[n]=function(...i){o.apply(this,i),l()}}),window.addEventListener("popstate",l),t()}function le(){}function zt(t,e){for(const l in e)t[l]=e[l];return t}function We(t){return t()}function qe(){return Object.create(null)}function oe(t){t.forEach(We)}function ke(t){return typeof t=="function"}function me(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Rt(t){return Object.keys(t).length===0}function Mt(t,e,l,n){if(t){const o=Ue(t,e,l,n);return t[0](o)}}function Ue(t,e,l,n){return t[1]&&n?zt(l.ctx.slice(),t[1](n(e))):l.ctx}function Ot(t,e,l,n){if(t[2]&&n){const o=t[2](n(l));if(e.dirty===void 0)return o;if(typeof o=="object"){const i=[],r=Math.max(e.dirty.length,o.length);for(let s=0;s<r;s+=1)i[s]=e.dirty[s]|o[s];return i}return e.dirty|o}return e.dirty}function Dt(t,e,l,n,o,i){if(o){const r=Ue(e,l,n,i);t.p(r,o)}}function Pt(t){if(t.ctx.length>32){const e=[],l=t.ctx.length/32;for(let n=0;n<l;n++)e[n]=-1;return e}return-1}function m(t,e){t.appendChild(e)}function S(t,e,l){t.insertBefore(e,l||null)}function j(t){t.parentNode&&t.parentNode.removeChild(t)}function ye(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function b(t){return document.createElement(t)}function D(t){return document.createTextNode(t)}function z(){return D(" ")}function we(){return D("")}function q(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function Ye(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function v(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Ve(t){let e;return{p(...l){e=l,e.forEach(n=>t.push(n))},r(){e.forEach(l=>t.splice(t.indexOf(l),1))}}}function Ht(t){return Array.from(t.childNodes)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ee(t,e){t.value=e??""}function w(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,n?"important":"")}function xe(t,e,l){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e){o.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Ge(t){const e=t.querySelector(":checked");return e&&e.__value}function Je(t,e,l){t.classList[l?"add":"remove"](e)}let Pe;function je(t){Pe=t}function Ft(t,e){const l=t.$$.callbacks[e.type];l&&l.slice().forEach(n=>n.call(this,e))}const ge=[],Ke=[];let _e=[];const Qe=[],Lt=Promise.resolve();let He=!1;function Nt(){He||(He=!0,Lt.then(Xe))}function Te(t){_e.push(t)}const Fe=new Set;let be=0;function Xe(){if(be!==0)return;const t=Pe;do{try{for(;be<ge.length;){const e=ge[be];be++,je(e),At(e.$$)}}catch(e){throw ge.length=0,be=0,e}for(je(null),ge.length=0,be=0;Ke.length;)Ke.pop()();for(let e=0;e<_e.length;e+=1){const l=_e[e];Fe.has(l)||(Fe.add(l),l())}_e.length=0}while(ge.length);for(;Qe.length;)Qe.pop()();He=!1,Fe.clear(),je(t)}function At(t){if(t.fragment!==null){t.update(),oe(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Te)}}function Wt(t){const e=[],l=[];_e.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),_e=e}const ze=new Set;let fe;function Re(){fe={r:0,c:[],p:fe}}function Me(){fe.r||oe(fe.c),fe=fe.p}function G(t,e){t&&t.i&&(ze.delete(t),t.i(e))}function X(t,e,l,n){if(t&&t.o){if(ze.has(t))return;ze.add(t),fe.c.push(()=>{ze.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function Ze(t,e){t.d(1),e.delete(t.key)}function qt(t,e){X(t,1,1,()=>{e.delete(t.key)})}function Le(t,e,l,n,o,i,r,s,a,u,f,c){let d=t.length,g=i.length,p=d;const _={};for(;p--;)_[t[p].key]=p;const y=[],M=new Map,A=new Map,U=[];for(p=g;p--;){const B=c(o,i,p),H=l(B);let E=r.get(H);E?n&&U.push(()=>E.p(B,e)):(E=u(H,B),E.c()),M.set(H,y[p]=E),H in _&&A.set(H,Math.abs(p-_[H]))}const J=new Set,C=new Set;function W(B){G(B,1),B.m(s,f),r.set(B.key,B),f=B.first,g--}for(;d&&g;){const B=y[g-1],H=t[d-1],E=B.key,O=H.key;B===H?(f=B.first,d--,g--):M.has(O)?!r.has(E)||J.has(E)?W(B):C.has(O)?d--:A.get(E)>A.get(O)?(C.add(E),W(B)):(J.add(O),d--):(a(H,r),d--)}for(;d--;){const B=t[d];M.has(B.key)||a(B,r)}for(;g;)W(y[g-1]);return oe(U),y}function ve(t){t&&t.c()}function de(t,e,l,n){const{fragment:o,after_update:i}=t.$$;o&&o.m(e,l),n||Te(()=>{const r=t.$$.on_mount.map(We).filter(ke);t.$$.on_destroy?t.$$.on_destroy.push(...r):oe(r),t.$$.on_mount=[]}),i.forEach(Te)}function he(t,e){const l=t.$$;l.fragment!==null&&(Wt(l.after_update),oe(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function Ut(t,e){t.$$.dirty[0]===-1&&(ge.push(t),Nt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,l,n,o,i,r,s=[-1]){const a=Pe;je(t);const u=t.$$={fragment:null,ctx:[],props:i,update:le,not_equal:o,bound:qe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:qe(),dirty:s,skip_bound:!1,root:e.target||a.$$.root};r&&r(u.root);let f=!1;if(u.ctx=l?l(t,e.props||{},(c,d,...g)=>{const p=g.length?g[0]:d;return u.ctx&&o(u.ctx[c],u.ctx[c]=p)&&(!u.skip_bound&&u.bound[c]&&u.bound[c](p),f&&Ut(t,c)),d}):[],u.update(),f=!0,oe(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const c=Ht(e.target);u.fragment&&u.fragment.l(c),c.forEach(j)}else u.fragment&&u.fragment.c();e.intro&&G(t.$$.fragment),de(t,e.target,e.anchor,e.customElement),Xe()}je(a)}class pe{$destroy(){he(this,1),this.$destroy=le}$on(e,l){if(!ke(l))return le;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const o=n.indexOf(l);o!==-1&&n.splice(o,1)}}$set(e){this.$$set&&!Rt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ml="";function $e(t,e,l){const n=t.slice();return n[12]=e[l],n}function et(t){let e,l=" + ",n,o=t[12].diluents.map(lt).join(", ")+"",i;return{c(){e=b("span"),n=D(l),i=D(o),v(e,"class","diluent-info svelte-1fmghv1")},m(r,s){S(r,e,s),m(e,n),m(e,i)},p(r,s){s&1&&o!==(o=r[12].diluents.map(lt).join(", ")+"")&&$(i,o)},d(r){r&&j(e)}}}function tt(t){let e,l=t[12].name+"",n,o,i=t[12].dosage+"",r,s,a=t[12].administrationType+"",u,f,c,d=t[12].diluents&&t[12].diluents.length>0&&et(t);return{c(){e=b("div"),n=D(l),o=D(", "),r=D(i),s=D(" ("),u=D(a),f=D(`)\r
        `),d&&d.c(),c=z(),v(e,"class","medication-details svelte-1fmghv1")},m(g,p){S(g,e,p),m(e,n),m(e,o),m(e,r),m(e,s),m(e,u),m(e,f),d&&d.m(e,null),m(e,c)},p(g,p){p&1&&l!==(l=g[12].name+"")&&$(n,l),p&1&&i!==(i=g[12].dosage+"")&&$(r,i),p&1&&a!==(a=g[12].administrationType+"")&&$(u,a),g[12].diluents&&g[12].diluents.length>0?d?d.p(g,p):(d=et(g),d.c(),d.m(e,c)):d&&(d.d(1),d=null)},d(g){g&&j(e),d&&d.d()}}}function Yt(t){let e,l,n,o=t[0].name+"",i,r,s,a,u,f,c,d=t[0].medications,g=[];for(let p=0;p<d.length;p+=1)g[p]=tt($e(t,d,p));return{c(){e=b("div"),l=b("div"),n=b("strong"),i=D(o),r=z();for(let p=0;p<g.length;p+=1)g[p].c();s=z(),a=b("div"),u=b("button"),u.textContent="Редактировать",v(l,"class","scheme-title svelte-1fmghv1"),v(u,"class","btn-use-scheme svelte-1fmghv1"),v(a,"class","scheme-actions svelte-1fmghv1"),v(e,"class","scheme-item svelte-1fmghv1"),w(e,"--item-bg-color",t[2]),w(e,"--item-hover-color",t[3]),w(e,"--item-border-color",t[4]),w(e,"--title-color",t[5]),w(e,"--details-color",t[6]),w(e,"--use-btn-bg",t[7]),w(e,"--use-btn-text",t[8]),w(e,"--edit-btn-bg",t[9]),w(e,"--edit-btn-text",t[10])},m(p,_){S(p,e,_),m(e,l),m(l,n),m(n,i),m(l,r);for(let y=0;y<g.length;y+=1)g[y]&&g[y].m(l,null);m(e,s),m(e,a),m(a,u),f||(c=q(u,"click",Ye(function(){ke(t[1])&&t[1].apply(this,arguments)})),f=!0)},p(p,[_]){if(t=p,_&1&&o!==(o=t[0].name+"")&&$(i,o),_&1){d=t[0].medications;let y;for(y=0;y<d.length;y+=1){const M=$e(t,d,y);g[y]?g[y].p(M,_):(g[y]=tt(M),g[y].c(),g[y].m(l,null))}for(;y<g.length;y+=1)g[y].d(1);g.length=d.length}_&4&&w(e,"--item-bg-color",t[2]),_&8&&w(e,"--item-hover-color",t[3]),_&16&&w(e,"--item-border-color",t[4]),_&32&&w(e,"--title-color",t[5]),_&64&&w(e,"--details-color",t[6]),_&128&&w(e,"--use-btn-bg",t[7]),_&256&&w(e,"--use-btn-text",t[8]),_&512&&w(e,"--edit-btn-bg",t[9]),_&1024&&w(e,"--edit-btn-text",t[10])},i:le,o:le,d(p){p&&j(e),ye(g,p),f=!1,c()}}}const lt=t=>`${t.type} (${t.dosage})`;function Vt(t,e,l){let{scheme:n={}}=e,{onSelect:o}=e,{onEdit:i}=e,{itemBgColor:r="#f8f9fa"}=e,{itemHoverColor:s="#e9ecef"}=e,{itemBorderColor:a="#e9ecef"}=e,{titleColor:u="#333"}=e,{detailsColor:f="#6c757d"}=e,{useButtonBgColor:c="#007bff"}=e,{useButtonTextColor:d="#fff"}=e,{editButtonBgColor:g="#6c757d"}=e,{editButtonTextColor:p="#fff"}=e;return t.$$set=_=>{"scheme"in _&&l(0,n=_.scheme),"onSelect"in _&&l(11,o=_.onSelect),"onEdit"in _&&l(1,i=_.onEdit),"itemBgColor"in _&&l(2,r=_.itemBgColor),"itemHoverColor"in _&&l(3,s=_.itemHoverColor),"itemBorderColor"in _&&l(4,a=_.itemBorderColor),"titleColor"in _&&l(5,u=_.titleColor),"detailsColor"in _&&l(6,f=_.detailsColor),"useButtonBgColor"in _&&l(7,c=_.useButtonBgColor),"useButtonTextColor"in _&&l(8,d=_.useButtonTextColor),"editButtonBgColor"in _&&l(9,g=_.editButtonBgColor),"editButtonTextColor"in _&&l(10,p=_.editButtonTextColor)},[n,i,r,s,a,u,f,c,d,g,p,o]}class Gt extends pe{constructor(e){super(),Ce(this,e,Vt,Yt,me,{scheme:0,onSelect:11,onEdit:1,itemBgColor:2,itemHoverColor:3,itemBorderColor:4,titleColor:5,detailsColor:6,useButtonBgColor:7,useButtonTextColor:8,editButtonBgColor:9,editButtonTextColor:10})}}const Ol="";function nt(t,e,l){const n=t.slice();return n[8]=e[l],n}function Jt(t){let e;return{c(){e=b("p"),e.textContent="Нет существующих схем для этого приема",v(e,"class","no-schemes svelte-5qbczz")},m(l,n){S(l,e,n)},p:le,i:le,o:le,d(l){l&&j(e)}}}function Kt(t){let e,l=[],n=new Map,o,i=t[0];const r=s=>s[8].id;for(let s=0;s<i.length;s+=1){let a=nt(t,i,s),u=r(a);n.set(u,l[s]=ot(u,a))}return{c(){e=b("div");for(let s=0;s<l.length;s+=1)l[s].c();v(e,"class","schemes-list svelte-5qbczz")},m(s,a){S(s,e,a);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);o=!0},p(s,a){a&7&&(i=s[0],Re(),l=Le(l,a,r,1,s,i,n,e,qt,ot,null,nt),Me())},i(s){if(!o){for(let a=0;a<i.length;a+=1)G(l[a]);o=!0}},o(s){for(let a=0;a<l.length;a+=1)X(l[a]);o=!1},d(s){s&&j(e);for(let a=0;a<l.length;a+=1)l[a].d()}}}function ot(t,e){let l,n,o;function i(){return e[6](e[8])}function r(){return e[7](e[8])}return n=new Gt({props:{scheme:e[8],onSelect:i,onEdit:r}}),{key:t,first:null,c(){l=we(),ve(n.$$.fragment),this.first=l},m(s,a){S(s,l,a),de(n,s,a),o=!0},p(s,a){e=s;const u={};a&1&&(u.scheme=e[8]),a&3&&(u.onSelect=i),a&5&&(u.onEdit=r),n.$set(u)},i(s){o||(G(n.$$.fragment,s),o=!0)},o(s){X(n.$$.fragment,s),o=!1},d(s){s&&j(l),he(n,s)}}}function Qt(t){let e,l,n,o,i,r;const s=[Kt,Jt],a=[];function u(f,c){return f[0].length?0:1}return o=u(t),i=a[o]=s[o](t),{c(){e=b("div"),l=b("h2"),l.textContent="Существующие схемы лечения для этого приема",n=z(),i.c(),v(l,"class","svelte-5qbczz"),v(e,"class","existing-schemes svelte-5qbczz"),w(e,"--bg-color",t[3]),w(e,"--title-color",t[4]),w(e,"--border-color",t[5])},m(f,c){S(f,e,c),m(e,l),m(e,n),a[o].m(e,null),r=!0},p(f,[c]){let d=o;o=u(f),o===d?a[o].p(f,c):(Re(),X(a[d],1,1,()=>{a[d]=null}),Me(),i=a[o],i?i.p(f,c):(i=a[o]=s[o](f),i.c()),G(i,1),i.m(e,null)),(!r||c&8)&&w(e,"--bg-color",f[3]),(!r||c&16)&&w(e,"--title-color",f[4]),(!r||c&32)&&w(e,"--border-color",f[5])},i(f){r||(G(i),r=!0)},o(f){X(i),r=!1},d(f){f&&j(e),a[o].d()}}}function Xt(t,e,l){let{schemes:n=[]}=e,{onSelect:o}=e,{onEdit:i}=e,{bgColor:r="#f8f9fa"}=e,{titleColor:s="#333"}=e,{borderColor:a="#e9ecef"}=e;const u=c=>o(c),f=c=>i(c);return t.$$set=c=>{"schemes"in c&&l(0,n=c.schemes),"onSelect"in c&&l(1,o=c.onSelect),"onEdit"in c&&l(2,i=c.onEdit),"bgColor"in c&&l(3,r=c.bgColor),"titleColor"in c&&l(4,s=c.titleColor),"borderColor"in c&&l(5,a=c.borderColor)},[n,o,i,r,s,a,u,f]}class Zt extends pe{constructor(e){super(),Ce(this,e,Xt,Qt,me,{schemes:0,onSelect:1,onEdit:2,bgColor:3,titleColor:4,borderColor:5})}}const Dl="";function it(t){let e,l,n,o,i,r,s;const a=t[15].default,u=Mt(a,t,t[14],null);return{c(){e=b("div"),l=b("div"),n=b("button"),n.textContent="✖",o=z(),u&&u.c(),v(n,"class","modal-close svelte-1lbmm4i"),v(l,"class","modal-content svelte-1lbmm4i"),w(l,"--max-width",t[1]),w(l,"--max-height",t[2]),w(l,"--bg-color",t[3]),w(l,"--border-radius",t[4]),w(l,"--padding",t[5]),w(l,"--box-shadow",t[6]),v(e,"class","modal-overlay svelte-1lbmm4i"),w(e,"--overlay-color",t[8]),w(e,"--z-index",t[7])},m(f,c){S(f,e,c),m(e,l),m(l,n),m(l,o),u&&u.m(l,null),i=!0,r||(s=[q(n,"click",t[10]),q(l,"click",Ye(t[16])),q(e,"click",t[9])],r=!0)},p(f,c){u&&u.p&&(!i||c&16384)&&Dt(u,a,f,f[14],i?Ot(a,f[14],c,null):Pt(f[14]),null),(!i||c&2)&&w(l,"--max-width",f[1]),(!i||c&4)&&w(l,"--max-height",f[2]),(!i||c&8)&&w(l,"--bg-color",f[3]),(!i||c&16)&&w(l,"--border-radius",f[4]),(!i||c&32)&&w(l,"--padding",f[5]),(!i||c&64)&&w(l,"--box-shadow",f[6]),(!i||c&256)&&w(e,"--overlay-color",f[8]),(!i||c&128)&&w(e,"--z-index",f[7])},i(f){i||(G(u,f),i=!0)},o(f){X(u,f),i=!1},d(f){f&&j(e),u&&u.d(f),r=!1,oe(s)}}}function $t(t){let e,l,n=t[0]&&it(t);return{c(){n&&n.c(),e=we()},m(o,i){n&&n.m(o,i),S(o,e,i),l=!0},p(o,[i]){o[0]?n?(n.p(o,i),i&1&&G(n,1)):(n=it(o),n.c(),G(n,1),n.m(e.parentNode,e)):n&&(Re(),X(n,1,1,()=>{n=null}),Me())},i(o){l||(G(n),l=!0)},o(o){X(n),l=!1},d(o){n&&n.d(o),o&&j(e)}}}function el(t,e,l){let{$$slots:n={},$$scope:o}=e,{isOpen:i=!1}=e,{onClose:r}=e,{maxWidth:s="1100px"}=e,{maxHeight:a="80%"}=e,{backgroundColor:u="white"}=e,{borderRadius:f="8px"}=e,{padding:c="20px"}=e,{boxShadow:d="0 4px 6px rgba(0,0,0,0.1)"}=e,{zIndex:g=1e3}=e,{overlay:p=!0}=e,{overlayColor:_="rgba(0,0,0,0.2)"}=e,{confirmBeforeClose:y=!1}=e;function M(){return y?confirm("Вы уверены, что хотите закрыть? Несохраненные изменения будут потеряны."):!0}function A(C){p&&C.target.classList.contains("modal-overlay")&&M()&&r()}function U(){M()&&r()}function J(C){Ft.call(this,t,C)}return t.$$set=C=>{"isOpen"in C&&l(0,i=C.isOpen),"onClose"in C&&l(11,r=C.onClose),"maxWidth"in C&&l(1,s=C.maxWidth),"maxHeight"in C&&l(2,a=C.maxHeight),"backgroundColor"in C&&l(3,u=C.backgroundColor),"borderRadius"in C&&l(4,f=C.borderRadius),"padding"in C&&l(5,c=C.padding),"boxShadow"in C&&l(6,d=C.boxShadow),"zIndex"in C&&l(7,g=C.zIndex),"overlay"in C&&l(12,p=C.overlay),"overlayColor"in C&&l(8,_=C.overlayColor),"confirmBeforeClose"in C&&l(13,y=C.confirmBeforeClose),"$$scope"in C&&l(14,o=C.$$scope)},[i,s,a,u,f,c,d,g,_,A,U,r,p,y,o,n,J]}class rt extends pe{constructor(e){super(),Ce(this,e,el,$t,me,{isOpen:0,onClose:11,maxWidth:1,maxHeight:2,backgroundColor:3,borderRadius:4,padding:5,boxShadow:6,zIndex:7,overlay:12,overlayColor:8,confirmBeforeClose:13})}}const Pl="";function st(t,e,l){const n=t.slice();return n[20]=e[l],n[21]=e,n[22]=l,n}function at(t,e,l){const n=t.slice();return n[23]=e[l],n}function ut(t){let e,l=t[23].name+"",n,o;return{c(){e=b("option"),n=D(l),e.__value=o=t[23],e.value=e.__value},m(i,r){S(i,e,r),m(e,n)},p(i,r){r&8&&l!==(l=i[23].name+"")&&$(n,l),r&8&&o!==(o=i[23])&&(e.__value=o,e.value=e.__value)},d(i){i&&j(e)}}}function ct(t){let e,l=[],n=new Map,o,i,r,s,a=t[0].diluents;const u=f=>f[20].id;for(let f=0;f<a.length;f+=1){let c=st(t,a,f),d=u(c);n.set(d,l[f]=ft(d,c))}return{c(){e=b("div");for(let f=0;f<l.length;f+=1)l[f].c();o=z(),i=b("button"),i.textContent="+ Добавить растворитель",v(i,"class","btn-add-diluent svelte-1njhuli"),v(e,"class","diluents-container svelte-1njhuli")},m(f,c){S(f,e,c);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null);m(e,o),m(e,i),r||(s=q(i,"click",t[6]),r=!0)},p(f,c){c&129&&(a=f[0].diluents,l=Le(l,c,u,1,f,a,n,e,Ze,ft,o,st))},d(f){f&&j(e);for(let c=0;c<l.length;c+=1)l[c].d();r=!1,s()}}}function ft(t,e){let l,n,o,i,r,s,a,u,f,c;function d(){e[17].call(n,e[21],e[22])}function g(){e[18].call(s,e[21],e[22])}function p(){return e[19](e[20])}return{key:t,first:null,c(){l=b("div"),n=b("select"),o=b("option"),o.textContent="Глюкоза",i=b("option"),i.textContent="Физраствор",r=z(),s=b("input"),a=z(),u=b("button"),u.textContent="✖",o.__value="глюкоза",o.value=o.__value,i.__value="физраствор",i.value=i.__value,v(n,"class","form-control-ex diluent-select svelte-1njhuli"),e[20].type===void 0&&Te(d),v(s,"type","text"),v(s,"placeholder","Дозировка"),v(s,"class","form-control-ex diluent-dosage svelte-1njhuli"),v(u,"class","btn-remove-diluent svelte-1njhuli"),v(l,"class","diluent-row svelte-1njhuli"),this.first=l},m(_,y){S(_,l,y),m(l,n),m(n,o),m(n,i),xe(n,e[20].type,!0),m(l,r),m(l,s),Ee(s,e[20].dosage),m(l,a),m(l,u),f||(c=[q(n,"change",d),q(s,"input",g),q(u,"click",p)],f=!0)},p(_,y){e=_,y&9&&xe(n,e[20].type),y&9&&s.value!==e[20].dosage&&Ee(s,e[20].dosage)},d(_){_&&j(l),f=!1,oe(c)}}}function tl(t){let e,l=t[4]?"Редактирование препарата":"Добавление препарата",n,o,i,r,s,a,u,f,c,d,g,p,_,y,M,A,U,J,C,W,B,H,E,O,re,Z,P,k,F,L,ee,se=t[4]?"Сохранить изменения":"Добавить препарат",ce,ne,ie,V,R,Be,ue=t[3],K=[];for(let I=0;I<ue.length;I+=1)K[I]=ut(at(t,ue,I));let Q=t[0].hasDiluent==="да"&&ct(t);return ie=Ve(t[12][0]),V=Ve(t[12][1]),{c(){e=b("h3"),n=D(l),o=z(),i=b("select");for(let I=0;I<K.length;I+=1)K[I].c();r=z(),s=b("div"),a=b("label"),u=b("input"),f=D(` \r
            Внутримышечно`),c=z(),d=b("label"),g=b("input"),p=D(` \r
            Внутривенно`),_=z(),y=b("input"),M=z(),A=b("div"),U=b("label"),U.textContent="Использовать растворитель:",J=z(),C=b("label"),W=b("input"),B=D(` \r
            Нет`),H=z(),E=b("label"),O=b("input"),re=D(` \r
            Да`),Z=z(),Q&&Q.c(),P=z(),k=b("div"),F=b("button"),F.textContent="Отмена",L=z(),ee=b("button"),ce=D(se),v(e,"class","svelte-1njhuli"),v(i,"class","form-control-ex svelte-1njhuli"),t[0].medication===void 0&&Te(()=>t[10].call(i)),v(u,"type","radio"),u.__value="в/м",u.value=u.__value,v(a,"class","svelte-1njhuli"),v(g,"type","radio"),g.__value="в/в",g.value=g.__value,v(d,"class","svelte-1njhuli"),v(s,"class","administration-type svelte-1njhuli"),v(y,"type","text"),v(y,"placeholder","Дозировка препарата"),v(y,"class","form-control-ex svelte-1njhuli"),v(U,"class","svelte-1njhuli"),v(W,"type","radio"),W.__value="нет",W.value=W.__value,v(C,"class","svelte-1njhuli"),v(O,"type","radio"),O.__value="да",O.value=O.__value,v(E,"class","svelte-1njhuli"),v(A,"class","diluent-choice svelte-1njhuli"),v(F,"class","btn-cancel svelte-1njhuli"),v(ee,"class","btn-save svelte-1njhuli"),ee.disabled=ne=!t[5],v(k,"class","button-row svelte-1njhuli"),ie.p(W,O),V.p(u,g)},m(I,N){S(I,e,N),m(e,n),S(I,o,N),S(I,i,N);for(let Y=0;Y<K.length;Y+=1)K[Y]&&K[Y].m(i,null);xe(i,t[0].medication,!0),S(I,r,N),S(I,s,N),m(s,a),m(a,u),u.checked=u.__value===t[0].administrationType,m(a,f),m(s,c),m(s,d),m(d,g),g.checked=g.__value===t[0].administrationType,m(d,p),S(I,_,N),S(I,y,N),Ee(y,t[0].dosage),S(I,M,N),S(I,A,N),m(A,U),m(A,J),m(A,C),m(C,W),W.checked=W.__value===t[0].hasDiluent,m(C,B),m(A,H),m(A,E),m(E,O),O.checked=O.__value===t[0].hasDiluent,m(E,re),S(I,Z,N),Q&&Q.m(I,N),S(I,P,N),S(I,k,N),m(k,F),m(k,L),m(k,ee),m(ee,ce),R||(Be=[q(i,"change",t[10]),q(u,"change",t[11]),q(g,"change",t[13]),q(y,"input",t[14]),q(W,"change",t[15]),q(O,"change",t[16]),q(F,"click",function(){ke(t[2])&&t[2].apply(this,arguments)}),q(ee,"click",t[8])],R=!0)},p(I,N){if(t=I,N&16&&l!==(l=t[4]?"Редактирование препарата":"Добавление препарата")&&$(n,l),N&8){ue=t[3];let Y;for(Y=0;Y<ue.length;Y+=1){const De=at(t,ue,Y);K[Y]?K[Y].p(De,N):(K[Y]=ut(De),K[Y].c(),K[Y].m(i,null))}for(;Y<K.length;Y+=1)K[Y].d(1);K.length=ue.length}N&9&&xe(i,t[0].medication),N&9&&(u.checked=u.__value===t[0].administrationType),N&9&&(g.checked=g.__value===t[0].administrationType),N&9&&y.value!==t[0].dosage&&Ee(y,t[0].dosage),N&9&&(W.checked=W.__value===t[0].hasDiluent),N&9&&(O.checked=O.__value===t[0].hasDiluent),t[0].hasDiluent==="да"?Q?Q.p(t,N):(Q=ct(t),Q.c(),Q.m(P.parentNode,P)):Q&&(Q.d(1),Q=null),N&16&&se!==(se=t[4]?"Сохранить изменения":"Добавить препарат")&&$(ce,se),N&32&&ne!==(ne=!t[5])&&(ee.disabled=ne)},d(I){I&&j(e),I&&j(o),I&&j(i),ye(K,I),I&&j(r),I&&j(s),I&&j(_),I&&j(y),I&&j(M),I&&j(A),I&&j(Z),Q&&Q.d(I),I&&j(P),I&&j(k),ie.r(),V.r(),R=!1,oe(Be)}}}function ll(t){let e,l;return e=new rt({props:{isOpen:t[1],onClose:t[2],maxWidth:"500px",$$slots:{default:[tl]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(n,o){de(e,n,o),l=!0},p(n,[o]){const i={};o&2&&(i.isOpen=n[1]),o&4&&(i.onClose=n[2]),o&67108925&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){l||(G(e.$$.fragment,n),l=!0)},o(n){X(e.$$.fragment,n),l=!1},d(n){he(e,n)}}}function nl(t,e,l){let n,{isOpen:o=!1}=e,{onClose:i}=e,{medications:r=[]}=e,{medicationForm:s}=e,{isEditing:a=!1}=e,{onSave:u}=e;function f(){l(0,s.diluents=[...s.diluents,{id:Date.now(),type:"глюкоза",dosage:""}],s)}function c(B){l(0,s.diluents=s.diluents.filter(H=>H.id!==B),s)}function d(){if(n){const B={...s,diluents:s.diluents.map(H=>({...H}))};u(B)}}const g=[[],[]];function p(){s.medication=Ge(this),l(0,s),l(3,r)}function _(){s.administrationType=this.__value,l(0,s),l(3,r)}function y(){s.administrationType=this.__value,l(0,s),l(3,r)}function M(){s.dosage=this.value,l(0,s),l(3,r)}function A(){s.hasDiluent=this.__value,l(0,s),l(3,r)}function U(){s.hasDiluent=this.__value,l(0,s),l(3,r)}function J(B,H){B[H].type=Ge(this),l(0,s),l(3,r)}function C(B,H){B[H].dosage=this.value,l(0,s),l(3,r)}const W=B=>c(B.id);return t.$$set=B=>{"isOpen"in B&&l(1,o=B.isOpen),"onClose"in B&&l(2,i=B.onClose),"medications"in B&&l(3,r=B.medications),"medicationForm"in B&&l(0,s=B.medicationForm),"isEditing"in B&&l(4,a=B.isEditing),"onSave"in B&&l(9,u=B.onSave)},t.$$.update=()=>{t.$$.dirty&1&&l(5,n=!!(s.medication&&s.administrationType&&s.dosage&&(s.hasDiluent==="нет"||s.hasDiluent==="да"&&s.diluents.length>0&&s.diluents.every(B=>B.type&&B.dosage))))},[s,o,i,r,a,n,f,c,d,u,p,_,g,y,M,A,U,J,C,W]}class ol extends pe{constructor(e){super(),Ce(this,e,nl,ll,me,{isOpen:1,onClose:2,medications:3,medicationForm:0,isEditing:4,onSave:9})}}const Hl="";function il(t){let e,l,n,o;return{c(){e=b("button"),l=D("+ Создать новую схему"),v(e,"class","btn-add-new-scheme svelte-651s9i"),w(e,"--btn-bg-color",t[1]),w(e,"--btn-text-color",t[2]),w(e,"--btn-hover-color",t[3]),w(e,"--btn-border-radius",t[4])},m(i,r){S(i,e,r),m(e,l),n||(o=q(e,"click",function(){ke(t[0])&&t[0].apply(this,arguments)}),n=!0)},p(i,[r]){t=i,r&2&&w(e,"--btn-bg-color",t[1]),r&4&&w(e,"--btn-text-color",t[2]),r&8&&w(e,"--btn-hover-color",t[3]),r&16&&w(e,"--btn-border-radius",t[4])},i:le,o:le,d(i){i&&j(e),n=!1,o()}}}function rl(t,e,l){let{onClick:n}=e,{buttonBgColor:o="#28a745"}=e,{buttonTextColor:i="#fff"}=e,{buttonHoverColor:r="#218838"}=e,{buttonBorderRadius:s="4px"}=e;return t.$$set=a=>{"onClick"in a&&l(0,n=a.onClick),"buttonBgColor"in a&&l(1,o=a.buttonBgColor),"buttonTextColor"in a&&l(2,i=a.buttonTextColor),"buttonHoverColor"in a&&l(3,r=a.buttonHoverColor),"buttonBorderRadius"in a&&l(4,s=a.buttonBorderRadius)},[n,o,i,r,s]}class sl extends pe{constructor(e){super(),Ce(this,e,rl,il,me,{onClick:0,buttonBgColor:1,buttonTextColor:2,buttonHoverColor:3,buttonBorderRadius:4})}}const Fl="";function dt(t,e,l){const n=t.slice();return n[57]=e[l],n}function ht(t,e,l){const n=t.slice();return n[60]=e[l],n}function mt(t,e,l){const n=t.slice();return n[63]=e[l],n}function al(t,e,l){const n=t.slice();return n[60]=e[l],n}function gt(t){let e,l,n,o,i;return l=new Zt({props:{schemes:t[23],onSelect:t[32],onEdit:t[34],bgColor:t[4],titleColor:t[5],borderColor:t[6]}}),o=new sl({props:{onClick:t[33],buttonBgColor:t[7],buttonTextColor:t[8],buttonHoverColor:t[9],buttonBorderRadius:t[10]}}),{c(){e=b("div"),ve(l.$$.fragment),n=z(),ve(o.$$.fragment),v(e,"class","medication-form-column svelte-16072ha")},m(r,s){S(r,e,s),de(l,e,null),m(e,n),de(o,e,null),i=!0},p(r,s){const a={};s[0]&8388608&&(a.schemes=r[23]),s[0]&16&&(a.bgColor=r[4]),s[0]&32&&(a.titleColor=r[5]),s[0]&64&&(a.borderColor=r[6]),l.$set(a);const u={};s[0]&128&&(u.buttonBgColor=r[7]),s[0]&256&&(u.buttonTextColor=r[8]),s[0]&512&&(u.buttonHoverColor=r[9]),s[0]&1024&&(u.buttonBorderRadius=r[10]),o.$set(u)},i(r){i||(G(l.$$.fragment,r),G(o.$$.fragment,r),i=!0)},o(r){X(l.$$.fragment,r),X(o.$$.fragment,r),i=!1},d(r){r&&j(e),he(l),he(o)}}}function _t(t){let e,l,n,o,i,r,s,a,u,f,c,d,g,p,_,y,M,A,U,J,C=t[15].length>0&&bt(t),W=[1,2,3,4,5,6,7,8,9,10],B=[];for(let k=0;k<10;k+=1)B[k]=ul(al(t,W,k));function H(k,F){return k[15].length>0?fl:cl}let E=H(t),O=E(t);function re(k,F){return k[19]?hl:dl}let Z=re(t),P=Z(t);return{c(){e=b("div"),l=b("div"),n=b("h3"),n.textContent="Создание новой схемы лечения",o=z(),C&&C.c(),i=z(),r=b("div"),s=b("div"),a=b("div"),a.textContent="Препарат",u=z();for(let k=0;k<10;k+=1)B[k].c();f=z(),O.c(),c=z(),d=b("div"),g=b("button"),g.textContent="← Назад",p=z(),_=b("button"),_.textContent="+ Добавить препарат",y=z(),M=b("button"),P.c(),v(n,"class","svelte-16072ha"),v(l,"class","schedule-head svelte-16072ha"),v(a,"class","medication-column svelte-16072ha"),v(s,"class","schedule-header svelte-16072ha"),v(r,"class","schedule-table svelte-16072ha"),v(g,"class","btn-back svelte-16072ha"),v(_,"class","btn-add-medication svelte-16072ha"),v(M,"class","btn-continue svelte-16072ha"),M.disabled=A=t[15].length===0||t[19]||!t[24],v(d,"class","schedule-actions svelte-16072ha"),v(e,"class","schedule-column svelte-16072ha")},m(k,F){S(k,e,F),m(e,l),m(l,n),m(l,o),C&&C.m(l,null),m(e,i),m(e,r),m(r,s),m(s,a),m(s,u);for(let L=0;L<10;L+=1)B[L]&&B[L].m(s,null);m(r,f),O.m(r,null),m(e,c),m(e,d),m(d,g),m(d,p),m(d,_),m(d,y),m(d,M),P.m(M,null),U||(J=[q(g,"click",t[37]),q(_,"click",t[27]),q(M,"click",t[35])],U=!0)},p(k,F){k[15].length>0?C?C.p(k,F):(C=bt(k),C.c(),C.m(l,null)):C&&(C.d(1),C=null),E===(E=H(k))&&O?O.p(k,F):(O.d(1),O=E(k),O&&(O.c(),O.m(r,null))),Z!==(Z=re(k))&&(P.d(1),P=Z(k),P&&(P.c(),P.m(M,null))),F[0]&17334272&&A!==(A=k[15].length===0||k[19]||!k[24])&&(M.disabled=A)},d(k){k&&j(e),C&&C.d(),ye(B,k),O.d(),P.d(),U=!1,oe(J)}}}function bt(t){let e=t[15].some(t[49]),l,n=e&&vt();return{c(){n&&n.c(),l=we()},m(o,i){n&&n.m(o,i),S(o,l,i)},p(o,i){i[0]&98304&&(e=o[15].some(o[49])),e?n||(n=vt(),n.c(),n.m(l.parentNode,l)):n&&(n.d(1),n=null)},d(o){n&&n.d(o),o&&j(l)}}}function vt(t){let e;return{c(){e=b("div"),e.textContent="⚠️ Необходимо выбрать дни приема для всех препаратов",v(e,"class","validation-error svelte-16072ha")},m(l,n){S(l,e,n)},d(l){l&&j(e)}}}function ul(t){let e,l;return{c(){e=b("div"),l=D(t[60]),v(e,"class","day-header svelte-16072ha")},m(n,o){S(n,e,o),m(e,l)},p:le,d(n){n&&j(e)}}}function cl(t){let e;return{c(){e=b("p"),e.textContent="Пока назначений нет",v(e,"class","empty svelte-16072ha")},m(l,n){S(l,e,n)},p:le,d(l){l&&j(e)}}}function fl(t){let e=[],l=new Map,n,o=t[15];const i=r=>r[57].id;for(let r=0;r<o.length;r+=1){let s=dt(t,o,r),a=i(s);l.set(a,e[r]=kt(a,s))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();n=we()},m(r,s){for(let a=0;a<e.length;a+=1)e[a]&&e[a].m(r,s);S(r,n,s)},p(r,s){s[0]&805404672|s[1]&1&&(o=r[15],e=Le(e,s,i,1,r,o,l,n.parentNode,Ze,kt,n,dt))},d(r){for(let s=0;s<e.length;s+=1)e[s].d(r);r&&j(n)}}}function Ct(t){let e,l=t[57].diluents,n=[];for(let o=0;o<l.length;o+=1)n[o]=pt(mt(t,l,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=we()},m(o,i){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,i);S(o,e,i)},p(o,i){if(i[0]&32768){l=o[57].diluents;let r;for(r=0;r<l.length;r+=1){const s=mt(o,l,r);n[r]?n[r].p(s,i):(n[r]=pt(s),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=l.length}},d(o){ye(n,o),o&&j(e)}}}function pt(t){let e=" + ",l,n=t[63].type+"",o,i,r=t[63].dosage+"",s,a;return{c(){l=D(e),o=D(n),i=D(" ("),s=D(r),a=D(")")},m(u,f){S(u,l,f),S(u,o,f),S(u,i,f),S(u,s,f),S(u,a,f)},p(u,f){f[0]&32768&&n!==(n=u[63].type+"")&&$(o,n),f[0]&32768&&r!==(r=u[63].dosage+"")&&$(s,r)},d(u){u&&j(l),u&&j(o),u&&j(i),u&&j(s),u&&j(a)}}}function Bt(t){let e,l,n;function o(){return t[52](t[57],t[60])}return{c(){e=b("div"),v(e,"class","schedule-cell svelte-16072ha"),Je(e,"selected",t[16][t[57].id]&&t[16][t[57].id][1]&&t[16][t[57].id][1].has(t[60]))},m(i,r){S(i,e,r),l||(n=q(e,"click",o),l=!0)},p(i,r){t=i,r[0]&98304&&Je(e,"selected",t[16][t[57].id]&&t[16][t[57].id][1]&&t[16][t[57].id][1].has(t[60]))},d(i){i&&j(e),l=!1,n()}}}function kt(t,e){let l,n,o,i,r=e[57].medication.name+"",s,a,u=e[57].administrationType+"",f,c,d=e[57].dosage+"",g,p,_,y,M,A,U,J,C,W,B,H,E=e[57].hasDiluent==="да"&&e[57].diluents&&e[57].diluents.length>0&&Ct(e);function O(){return e[50](e[57])}function re(){return e[51](e[57])}let Z=[1,2,3,4,5,6,7,8,9,10],P=[];for(let k=0;k<10;k+=1)P[k]=Bt(ht(e,Z,k));return{key:t,first:null,c(){l=b("div"),n=b("div"),o=b("div"),i=b("strong"),s=D(r),a=z(),f=D(u),c=D(", "),g=D(d),p=z(),E&&E.c(),_=z(),y=b("div"),M=b("button"),M.textContent="✏️",A=z(),U=b("button"),U.textContent="🗑️",J=z();for(let k=0;k<10;k+=1)P[k].c();C=z(),v(o,"class","medication-title svelte-16072ha"),v(M,"class","btn-edit-medication svelte-16072ha"),v(U,"class","btn-delete-medication svelte-16072ha"),v(y,"class","medication-actions svelte-16072ha"),v(n,"class","medication-cell svelte-16072ha"),v(l,"class",W="schedule-row "+(!e[16][e[57].id]||!Object.values(e[16][e[57].id]).some(yt)?"error-highlight":"")+" svelte-16072ha"),this.first=l},m(k,F){S(k,l,F),m(l,n),m(n,o),m(o,i),m(i,s),m(o,a),m(o,f),m(o,c),m(o,g),m(o,p),E&&E.m(o,null),m(n,_),m(n,y),m(y,M),m(y,A),m(y,U),m(l,J);for(let L=0;L<10;L+=1)P[L]&&P[L].m(l,null);m(l,C),B||(H=[q(M,"click",O),q(U,"click",re)],B=!0)},p(k,F){if(e=k,F[0]&32768&&r!==(r=e[57].medication.name+"")&&$(s,r),F[0]&32768&&u!==(u=e[57].administrationType+"")&&$(f,u),F[0]&32768&&d!==(d=e[57].dosage+"")&&$(g,d),e[57].hasDiluent==="да"&&e[57].diluents&&e[57].diluents.length>0?E?E.p(e,F):(E=Ct(e),E.c(),E.m(o,null)):E&&(E.d(1),E=null),F[0]&98304|F[1]&1){Z=[1,2,3,4,5,6,7,8,9,10];let L;for(L=0;L<10;L+=1){const ee=ht(e,Z,L);P[L]?P[L].p(ee,F):(P[L]=Bt(ee),P[L].c(),P[L].m(l,C))}for(;L<10;L+=1)P[L].d(1)}F[0]&98304&&W!==(W="schedule-row "+(!e[16][e[57].id]||!Object.values(e[16][e[57].id]).some(yt)?"error-highlight":"")+" svelte-16072ha")&&v(l,"class",W)},d(k){k&&j(l),E&&E.d(),ye(P,k),B=!1,oe(H)}}}function dl(t){let e;return{c(){e=D("Добавить схему")},m(l,n){S(l,e,n)},d(l){l&&j(e)}}}function hl(t){let e,l;return{c(){e=b("span"),l=D(" Сохранение..."),v(e,"class","spinner svelte-16072ha")},m(n,o){S(n,e,o),S(n,l,o)},d(n){n&&j(e),n&&j(l)}}}function ml(t){let e,l,n,o=!t[14]&&gt(t),i=t[14]&&_t(t);return{c(){e=b("div"),o&&o.c(),l=z(),i&&i.c(),v(e,"class","modal-grid svelte-16072ha")},m(r,s){S(r,e,s),o&&o.m(e,null),m(e,l),i&&i.m(e,null),n=!0},p(r,s){r[14]?o&&(Re(),X(o,1,1,()=>{o=null}),Me()):o?(o.p(r,s),s[0]&16384&&G(o,1)):(o=gt(r),o.c(),G(o,1),o.m(e,l)),r[14]?i?i.p(r,s):(i=_t(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(r){n||(G(o),n=!0)},o(r){X(o),n=!1},d(r){r&&j(e),o&&o.d(),i&&i.d()}}}function gl(t){let e,l,n,o,i,r,s,a,u,f;return i=new rt({props:{isOpen:t[17],onClose:t[26],maxWidth:t[0],backgroundColor:t[1],borderRadius:t[2],overlayColor:t[3],confirmBeforeClose:t[20],$$slots:{default:[ml]},$$scope:{ctx:t}}}),s=new ol({props:{isOpen:t[18],onClose:t[36],medications:t[25],medicationForm:t[21],isEditing:!!t[22],onSave:t[30],overlayColor:"rgba(0,0,0,0)"}}),{c(){e=b("div"),l=b("button"),n=D("📋 Схема лечения"),o=z(),ve(i.$$.fragment),r=z(),ve(s.$$.fragment),v(l,"class","treatment-scheme-button svelte-16072ha"),w(l,"--bg-color",t[11]),w(l,"--text-color",t[12]),w(l,"--border-radius",t[13]),v(e,"class","treatment-scheme-container")},m(c,d){S(c,e,d),m(e,l),m(l,n),m(e,o),de(i,e,null),m(e,r),de(s,e,null),a=!0,u||(f=q(l,"click",t[26]),u=!0)},p(c,d){(!a||d[0]&2048)&&w(l,"--bg-color",c[11]),(!a||d[0]&4096)&&w(l,"--text-color",c[12]),(!a||d[0]&8192)&&w(l,"--border-radius",c[13]);const g={};d[0]&131072&&(g.isOpen=c[17]),d[0]&1&&(g.maxWidth=c[0]),d[0]&2&&(g.backgroundColor=c[1]),d[0]&4&&(g.borderRadius=c[2]),d[0]&8&&(g.overlayColor=c[3]),d[0]&1048576&&(g.confirmBeforeClose=c[20]),d[0]&25806832|d[2]&64&&(g.$$scope={dirty:d,ctx:c}),i.$set(g);const p={};d[0]&262144&&(p.isOpen=c[18]),d[0]&2097152&&(p.medicationForm=c[21]),d[0]&4194304&&(p.isEditing=!!c[22]),s.$set(p)},i(c){a||(G(i.$$.fragment,c),G(s.$$.fragment,c),a=!0)},o(c){X(i.$$.fragment,c),X(s.$$.fragment,c),a=!1},d(c){c&&j(e),he(i),he(s),u=!1,f()}}}const yt=t=>t.size>0;function _l(t,e,l){let n,{serviceId:o=null}=e,{medicalCardId:i=null}=e,{modalMaxWidth:r="1100px"}=e,{modalBgColor:s="white"}=e,{modalBorderRadius:a="8px"}=e,{modalOverlayColor:u="rgba(0,0,0,0.2)"}=e,{schemesBgColor:f="#f8f9fa"}=e,{schemesTitleColor:c="#333"}=e,{schemesBorderColor:d="#e9ecef"}=e,{schemeItemBgColor:g="#f8f9fa"}=e,{schemeItemHoverColor:p="#e9ecef"}=e,{schemeItemBorderColor:_="#e9ecef"}=e,{schemeTitleColor:y="#333"}=e,{schemeDetailsColor:M="#6c757d"}=e,{useButtonBgColor:A="#007bff"}=e,{useButtonTextColor:U="#fff"}=e,{editButtonBgColor:J="#6c757d"}=e,{editButtonTextColor:C="#fff"}=e,{createButtonBgColor:W="#28a745"}=e,{createButtonTextColor:B="#fff"}=e,{createButtonHoverColor:H="#218838"}=e,{createButtonBorderRadius:E="4px"}=e,{mainButtonBgColor:O="#007bff"}=e,{mainButtonTextColor:re="white"}=e,{mainButtonBorderRadius:Z="4px"}=e,P=!1,k=!1,F=!1,L=!1,ee=!1,se=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],ce={medication:se[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},ne=null,ie=null,V=[],R={},Be=[];function ue(){l(17,P=!P),P||K()}function K(){l(21,ce=Q()),l(15,V=[]),l(16,R={}),l(14,k=!1),ie=null}function Q(){return{medication:se[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}}function I(){l(21,ce=Q()),l(22,ne=null),l(18,F=!0)}function N(h){l(21,ce={medication:se.find(T=>T.name===h.medication.name)||se[0],administrationType:h.administrationType,dosage:h.dosage,hasDiluent:h.diluents&&h.diluents.length>0?"да":"нет",diluents:h.diluents?h.diluents.map(T=>({...T})):[]}),l(22,ne=h.id),l(18,F=!0)}function Y(h){l(15,V=V.filter(T=>T.id!==h)),R[h]&&(delete R[h],l(16,R={...R}))}function De(h){if(ne)l(15,V=V.map(T=>T.id===ne?{...h,id:T.id}:T)),l(22,ne=null);else{const T={...h,id:Date.now()};l(15,V=[...V,T])}l(18,F=!1)}function It(h,T,ae){R[h]||l(16,R[h]={},R),R[h][T]||l(16,R[h][T]=new Set,R),R[h][T].has(ae)?R[h][T].delete(ae):R[h][T].add(ae),l(16,R={...R})}function Et(h){l(15,V=h.medications.map(T=>({id:T.id||Date.now()+Math.random(),medication:{name:T.name},administrationType:T.administrationType,dosage:T.dosage,hasDiluent:T.diluents&&T.diluents.length>0?"да":"нет",diluents:T.diluents?T.diluents.map(te=>({...te})):[]}))),l(16,R={}),h.schedule&&Object.entries(h.schedule).forEach(([T,ae])=>{l(16,R[T]={},R),Object.entries(ae).forEach(([te,Ie])=>{l(16,R[T][te]=new Set(Ie),R)})}),l(14,k=!0)}function kl(){l(14,k=!0),l(15,V=[]),l(16,R={})}function yl(h){Et(h),ie=h}function wl(){const h=V.filter(T=>!R[T.id]||!Object.values(R[T.id]).some(ae=>ae.size>0));if(h.length>0){h.map(T=>T.medication.name).join(", ");return}try{l(19,L=!0);const T={};Object.entries(R).forEach(([te,Ie])=>{T[te]={},Object.entries(Ie).forEach(([zl,Rl])=>{T[te][zl]=Array.from(Rl)})});const ae={id:Date.now(),name:ie?`${ie.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:V.map(te=>({id:te.id,name:te.medication.name,dosage:te.dosage,administrationType:te.administrationType,diluents:te.diluents?te.diluents.map(Ie=>({...Ie})):[]})),createdFor:{serviceId:o,medicalCardId:i},createdAt:new Date().toISOString(),isRevision:!!ie,originalSchemeId:ie?ie.id:null,schedule:T};setTimeout(()=>{l(23,Be=[...Be,ae]),l(19,L=!1),ue()},1e3)}catch(T){console.error("Ошибка публикации схемы:",T),l(19,L=!1)}}function jl(){l(18,F=!1),l(22,ne=null)}function Tl(){l(14,k=!1)}const Sl=h=>!R[h.id]||!Object.values(R[h.id]).some(T=>T.size>0),Il=h=>N(h),El=h=>Y(h.id),xl=(h,T)=>It(h.id,1,T);return t.$$set=h=>{"serviceId"in h&&l(38,o=h.serviceId),"medicalCardId"in h&&l(39,i=h.medicalCardId),"modalMaxWidth"in h&&l(0,r=h.modalMaxWidth),"modalBgColor"in h&&l(1,s=h.modalBgColor),"modalBorderRadius"in h&&l(2,a=h.modalBorderRadius),"modalOverlayColor"in h&&l(3,u=h.modalOverlayColor),"schemesBgColor"in h&&l(4,f=h.schemesBgColor),"schemesTitleColor"in h&&l(5,c=h.schemesTitleColor),"schemesBorderColor"in h&&l(6,d=h.schemesBorderColor),"schemeItemBgColor"in h&&l(40,g=h.schemeItemBgColor),"schemeItemHoverColor"in h&&l(41,p=h.schemeItemHoverColor),"schemeItemBorderColor"in h&&l(42,_=h.schemeItemBorderColor),"schemeTitleColor"in h&&l(43,y=h.schemeTitleColor),"schemeDetailsColor"in h&&l(44,M=h.schemeDetailsColor),"useButtonBgColor"in h&&l(45,A=h.useButtonBgColor),"useButtonTextColor"in h&&l(46,U=h.useButtonTextColor),"editButtonBgColor"in h&&l(47,J=h.editButtonBgColor),"editButtonTextColor"in h&&l(48,C=h.editButtonTextColor),"createButtonBgColor"in h&&l(7,W=h.createButtonBgColor),"createButtonTextColor"in h&&l(8,B=h.createButtonTextColor),"createButtonHoverColor"in h&&l(9,H=h.createButtonHoverColor),"createButtonBorderRadius"in h&&l(10,E=h.createButtonBorderRadius),"mainButtonBgColor"in h&&l(11,O=h.mainButtonBgColor),"mainButtonTextColor"in h&&l(12,re=h.mainButtonTextColor),"mainButtonBorderRadius"in h&&l(13,Z=h.mainButtonBorderRadius)},t.$$.update=()=>{t.$$.dirty[0]&49152&&l(20,ee=V.length>0&&k),t.$$.dirty[0]&98304&&l(24,n=V.length>0&&V.every(h=>R[h.id]&&Object.values(R[h.id]).some(T=>T.size>0)))},[r,s,a,u,f,c,d,W,B,H,E,O,re,Z,k,V,R,P,F,L,ee,ce,ne,Be,n,se,ue,I,N,Y,De,It,Et,kl,yl,wl,jl,Tl,o,i,g,p,_,y,M,A,U,J,C,Sl,Il,El,xl]}class bl extends pe{constructor(e){super(),Ce(this,e,_l,gl,me,{serviceId:38,medicalCardId:39,modalMaxWidth:0,modalBgColor:1,modalBorderRadius:2,modalOverlayColor:3,schemesBgColor:4,schemesTitleColor:5,schemesBorderColor:6,schemeItemBgColor:40,schemeItemHoverColor:41,schemeItemBorderColor:42,schemeTitleColor:43,schemeDetailsColor:44,useButtonBgColor:45,useButtonTextColor:46,editButtonBgColor:47,editButtonTextColor:48,createButtonBgColor:7,createButtonTextColor:8,createButtonHoverColor:9,createButtonBorderRadius:10,mainButtonBgColor:11,mainButtonTextColor:12,mainButtonBorderRadius:13},null,[-1,-1,-1])}}const vl=".medical-records-protocol-selector .flex",Ne="treatment-scheme-container",x={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),styleConfigs:{clinic1:{mainButtonBgColor:"#4CAF50",mainButtonTextColor:"white",schemesBgColor:"#f0f8ff",schemesTitleColor:"#2c3e50",useButtonBgColor:"#3498db",editButtonBgColor:"#9b59b6",createButtonBgColor:"#4CAF50"}},log(t,e,...l){if(!this.debug)return;const o={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${o} [RecordBtn-${this.instanceId}] ${e}`,...l)}};function wt(t){const e=new URL(t,window.location.origin),l=e.pathname,n=l.match(/\/medical_records\/(\d+)\/(\d+)/),o=l.match(/\/entries\/(\d+)/);return n?{isRecordPage:!0,patientId:n[1],recordId:n[2],fullPath:l+e.search,params:e.searchParams}:o?{isRecordPage:!0,patientId:null,recordId:o[1],fullPath:l+e.search,params:e.searchParams,isEntryPage:!0}:{isRecordPage:!1,patientId:null,recordId:null,fullPath:l+e.search,params:e.searchParams}}function Se(){x.log("action","Запущена процедура очистки"),x.intervalId!==null&&x.log("unmount","Интервал остановлен:",x.intervalId);const t=document.getElementById(Ne);t&&(t.remove(),x.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),x.mounted=!1}function Oe(t=!1){const e=wt(window.location.href);x.log("check","Проверка страницы:",e),e.recordId!==x.currentRecordId&&(x.log("route",`Изменился ID записи: ${x.currentRecordId||"none"} -> ${e.recordId||"none"}`),x.currentRecordId=e.recordId,x.currentPatientId=e.patientId,x.mounted&&(x.log("action","Удаляем компоненты из-за смены записи"),Se()));const n=document.querySelector(vl),o=document.getElementById(Ne);if(x.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!n}, mounted=${x.mounted}`),!o&&x.mounted&&(x.log("warn","Компонент исчез из DOM, но состояние не обновлено"),x.mounted=!1),e.isRecordPage&&n){if(!o){x.log("mount","Монтируем компонент TreatmentSchemeButton");const i=document.createElement("div");i.id=Ne,n.appendChild(i);try{new bl({target:i,props:{serviceId:e.recordId,medicalCardId:e.patientId||"entries",isEntryPage:e.isEntryPage||!1,...x.styleConfigs.clinic1}}),x.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),x.mounted=!0}catch(r){x.log("error","Ошибка при монтировании TreatmentSchemeButton:",r),i.remove()}}}else!e.isRecordPage&&(o||x.mounted)&&(x.log("action","Не страница записи - удаляем компонент"),Se())}function jt(){x.log("start","Инициализация компонентов"),Se(),window._recordButtonListenersInitialized||(Cl(),window._recordButtonListenersInitialized=!0);const t=wt(window.location.href);return x.currentPath=t.fullPath,x.currentRecordId=t.recordId,x.currentPatientId=t.patientId,Oe(!0),x.intervalId=setInterval(()=>{x.log("timer","Регулярная проверка по интервалу"),Oe()},1e3),x.log("success","Интервал установлен, ID:",x.intervalId),Se}function Cl(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),x.log("route",`Обнаружен ${t}`),Tt()}}),window.addEventListener("popstate",()=>{x.log("route","Обнаружен popstate"),Tt()})}function Tt(){[10,50,100,250,500,1e3,1500].forEach((e,l)=>{setTimeout(()=>{x.log("timer",`Запланированная проверка #${l+1} (${e}ms)`),Oe(!0)},e)})}window.addEventListener("beforeunload",Se),x.log("info","Модуль загружен"),Oe(!0);const pl=[{match:/\/medical_records\/\d+\/\d+$/,render:jt},{match:/\/entries\/\d+$/,render:jt}];let St=null;function Bl(){console.log("📡 Router запущен"),xt(()=>{const t=window.location.pathname,e=pl.find(l=>l.match.test(t));console.log("📌 Найден роут:",e?.match),e!==St&&(St=e,e?.render())})}window.addEventListener("error",function(t){if(t.message&&t.message.includes("fileupload"))return console.log("🛡️ Проигнорирована ошибка fileupload"),t.preventDefault(),t.stopPropagation(),!0},!0),console.log("✅ Content script работает"),Bl()})();
