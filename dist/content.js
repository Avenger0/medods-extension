(function(){"use strict";var Ne=document.createElement("style");Ne.textContent=`.scheme-item.svelte-56bhtz{background-color:var(--item-bg-color, #f8f9fa);border:1px solid var(--item-border-color, #e9ecef);border-radius:4px;padding:12px;margin-bottom:10px;transition:background-color .2s ease,transform .1s ease}.scheme-item.svelte-56bhtz:hover{background-color:var(--item-hover-color, #e9ecef);transform:translateY(-1px);box-shadow:0 2px 4px #0000000d}.scheme-title.svelte-56bhtz{color:var(--title-color, #333)}.medication-details.svelte-56bhtz{color:var(--details-color, #6c757d);font-size:.9em;margin-top:5px}.scheme-actions.svelte-56bhtz{display:flex;gap:8px;margin-top:10px}.btn-use-scheme.svelte-56bhtz,.btn-edit-scheme.svelte-56bhtz{padding:6px 10px;font-size:13px;border:none;border-radius:4px;cursor:pointer;transition:opacity .2s ease}.btn-use-scheme.svelte-56bhtz{background-color:var(--use-btn-bg, #007bff);color:var(--use-btn-text, #fff)}.btn-edit-scheme.svelte-56bhtz{background-color:var(--edit-btn-bg, #6c757d);color:var(--edit-btn-text, #fff)}.btn-use-scheme.svelte-56bhtz:hover,.btn-edit-scheme.svelte-56bhtz:hover{opacity:.9}.existing-schemes.svelte-19ao7u4{margin-top:20px;background-color:var(--bg-color, #f8f9fa);border-radius:6px;padding:15px;border:1px solid var(--border-color, #e9ecef)}h2.svelte-19ao7u4{margin-top:0;color:var(--title-color, #333);font-size:1.2rem;margin-bottom:15px;border-bottom:1px solid var(--border-color, #e9ecef);padding-bottom:10px}.schemes-list.svelte-19ao7u4{display:flex;flex-direction:column;gap:10px}.no-schemes.svelte-19ao7u4{font-style:italic;color:#6c757d;text-align:center;padding:15px 0}.btn-add-new-scheme.svelte-zgjj6w{background-color:var(--btn-bg-color, #28a745);color:var(--btn-text-color, #fff);border:none;padding:12px 16px;border-radius:var(--btn-border-radius, 4px);margin-top:15px;cursor:pointer;width:100%;font-weight:500;transition:background-color .2s ease,transform .1s ease;box-shadow:0 2px 4px #0000001a}.btn-add-new-scheme.svelte-zgjj6w:hover{background-color:var(--btn-hover-color, #218838);transform:translateY(-1px);box-shadow:0 3px 6px #00000026}.btn-add-new-scheme.svelte-zgjj6w:active{transform:translateY(1px);box-shadow:0 1px 2px #0000001a}.modal-overlay.svelte-1lbmm4i{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--overlay-color, rgba(0,0,0,.5));display:flex;justify-content:center;align-items:center;z-index:var(--z-index, 1000);overflow-y:auto}.modal-content.svelte-1lbmm4i{background:var(--bg-color, white);border-radius:var(--border-radius, 8px);max-width:var(--max-width, 1100px);max-height:var(--max-height, 80%);width:calc(100% - 40px);position:relative;padding:var(--padding, 20px);box-shadow:var(--box-shadow, 0 4px 6px rgba(0,0,0,.1));overflow-y:auto}.modal-close.svelte-1lbmm4i{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999;transition:color .2s ease;z-index:1}.modal-close.svelte-1lbmm4i:hover{color:#333}.treatment-scheme-button.svelte-quag8p.svelte-quag8p{background-color:var(--bg-color, #007bff);color:var(--text-color, white);border:none;padding:8px 12px;border-radius:var(--border-radius, 4px);cursor:pointer;transition:opacity .2s ease}.treatment-scheme-button.svelte-quag8p.svelte-quag8p:hover{opacity:.9}.modal-grid.svelte-quag8p.svelte-quag8p{display:grid;grid-template-columns:1fr 1fr;gap:20px}.medication-form-column.svelte-quag8p.svelte-quag8p{display:flex;flex-direction:column;gap:10px;max-width:350px}.schedule-column.svelte-quag8p.svelte-quag8p{display:flex;flex-direction:column;gap:10px}.form-control.svelte-quag8p.svelte-quag8p{width:100%;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;font-size:14px}.administration-type.svelte-quag8p.svelte-quag8p,.diluent-choice.svelte-quag8p.svelte-quag8p{display:flex;gap:15px;margin-bottom:10px}.administration-type.svelte-quag8p label.svelte-quag8p,.diluent-choice.svelte-quag8p label.svelte-quag8p{display:flex;align-items:center;gap:5px}.schedule-table.svelte-quag8p.svelte-quag8p{border:1px solid #ddd}.schedule-header.svelte-quag8p.svelte-quag8p{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-quag8p.svelte-quag8p,.medication-column.svelte-quag8p.svelte-quag8p{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-quag8p.svelte-quag8p{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-quag8p.svelte-quag8p{gap:15px;display:flex;align-items:center;justify-content:center;padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-quag8p.svelte-quag8p{width:50px;border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-quag8p.svelte-quag8p:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-quag8p.svelte-quag8p{background-color:#007bff}.btn-add.svelte-quag8p.svelte-quag8p,.btn-continue.svelte-quag8p.svelte-quag8p{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}.btn-add.svelte-quag8p.svelte-quag8p:disabled,.btn-continue.svelte-quag8p.svelte-quag8p:disabled{opacity:.5;cursor:not-allowed}.diluents-container.svelte-quag8p.svelte-quag8p{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-quag8p.svelte-quag8p{display:flex;gap:8px;align-items:center}.diluent-select.svelte-quag8p.svelte-quag8p{flex:3}.diluent-dosage.svelte-quag8p.svelte-quag8p{flex:2}.btn-remove-diluent.svelte-quag8p.svelte-quag8p{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-quag8p.svelte-quag8p{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer;align-self:flex-start}.error-highlight.svelte-quag8p .medication-cell.svelte-quag8p{background-color:#fff4f4;border-left:3px solid #dc3545}.validation-error.svelte-quag8p.svelte-quag8p{background-color:#fff3cd;color:#856404;padding:10px;margin-bottom:15px;border-radius:4px;border-left:4px solid #ffc107;font-size:14px}.medication-actions.svelte-quag8p.svelte-quag8p{margin-top:5px;display:flex;gap:5px}.btn-edit-medication.svelte-quag8p.svelte-quag8p,.btn-delete-medication.svelte-quag8p.svelte-quag8p{padding:2px 5px;font-size:12px;border:none;border-radius:3px;cursor:pointer;background-color:transparent}.btn-edit-medication.svelte-quag8p.svelte-quag8p:hover{background-color:#f0f0f0}.btn-delete-medication.svelte-quag8p.svelte-quag8p:hover{background-color:#fff5f5}.spinner.svelte-quag8p.svelte-quag8p{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-quag8p-spin 1s ease-in-out infinite;margin-right:8px}@keyframes svelte-quag8p-spin{to{transform:rotate(360deg)}}
`,document.head.appendChild(Ne);function kt(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function o(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(l=>{const n=history[l];history[l]=function(...i){n.apply(this,i),o()}}),window.addEventListener("popstate",o),t()}function X(){}function yt(t,e){for(const o in e)t[o]=e[o];return t}function Ae(t){return t()}function We(){return Object.create(null)}function re(t){t.forEach(Ae)}function de(t){return typeof t=="function"}function he(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function qt(t){return Object.keys(t).length===0}function wt(t,e,o,l){if(t){const n=Ue(t,e,o,l);return t[0](n)}}function Ue(t,e,o,l){return t[1]&&l?yt(o.ctx.slice(),t[1](l(e))):o.ctx}function Tt(t,e,o,l){if(t[2]&&l){const n=t[2](l(o));if(e.dirty===void 0)return n;if(typeof n=="object"){const i=[],r=Math.max(e.dirty.length,n.length);for(let c=0;c<r;c+=1)i[c]=e.dirty[c]|n[c];return i}return e.dirty|n}return e.dirty}function It(t,e,o,l,n,i){if(n){const r=Ue(e,o,l,i);t.p(r,n)}}function St(t){if(t.ctx.length>32){const e=[],o=t.ctx.length/32;for(let l=0;l<o;l++)e[l]=-1;return e}return-1}function m(t,e){t.appendChild(e)}function I(t,e,o){t.insertBefore(e,o||null)}function T(t){t.parentNode&&t.parentNode.removeChild(t)}function _e(t,e){for(let o=0;o<t.length;o+=1)t[o]&&t[o].d(e)}function p(t){return document.createElement(t)}function O(t){return document.createTextNode(t)}function j(){return O(" ")}function Te(){return O("")}function U(t,e,o,l){return t.addEventListener(e,o,l),()=>t.removeEventListener(e,o,l)}function Me(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function B(t,e,o){o==null?t.removeAttribute(e):t.getAttribute(e)!==o&&t.setAttribute(e,o)}function Fe(t){let e;return{p(...o){e=o,e.forEach(l=>t.push(l))},r(){e.forEach(o=>t.splice(t.indexOf(o),1))}}}function Et(t){return Array.from(t.childNodes)}function ie(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ie(t,e){t.value=e??""}function k(t,e,o,l){o==null?t.style.removeProperty(e):t.style.setProperty(e,o,l?"important":"")}function Se(t,e,o){for(let l=0;l<t.options.length;l+=1){const n=t.options[l];if(n.__value===e){n.selected=!0;return}}(!o||e!==void 0)&&(t.selectedIndex=-1)}function Ye(t){const e=t.querySelector(":checked");return e&&e.__value}function Ve(t,e,o){t.classList[o?"add":"remove"](e)}let Oe;function be(t){Oe=t}function Dt(t,e){const o=t.$$.callbacks[e.type];o&&o.slice().forEach(l=>l.call(this,e))}const fe=[],Ge=[];let me=[];const Je=[],xt=Promise.resolve();let je=!1;function zt(){je||(je=!0,xt.then(Ke))}function ve(t){me.push(t)}const He=new Set;let ge=0;function Ke(){if(ge!==0)return;const t=Oe;do{try{for(;ge<fe.length;){const e=fe[ge];ge++,be(e),Rt(e.$$)}}catch(e){throw fe.length=0,ge=0,e}for(be(null),fe.length=0,ge=0;Ge.length;)Ge.pop()();for(let e=0;e<me.length;e+=1){const o=me[e];He.has(o)||(He.add(o),o())}me.length=0}while(fe.length);for(;Je.length;)Je.pop()();je=!1,He.clear(),be(t)}function Rt(t){if(t.fragment!==null){t.update(),re(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ve)}}function Mt(t){const e=[],o=[];me.forEach(l=>t.indexOf(l)===-1?e.push(l):o.push(l)),o.forEach(l=>l()),me=e}const Ee=new Set;let ce;function De(){ce={r:0,c:[],p:ce}}function xe(){ce.r||re(ce.c),ce=ce.p}function Z(t,e){t&&t.i&&(Ee.delete(t),t.i(e))}function oe(t,e,o,l){if(t&&t.o){if(Ee.has(t))return;Ee.add(t),ce.c.push(()=>{Ee.delete(t),l&&(o&&t.d(1),l())}),t.o(e)}else l&&l()}function Qe(t,e){t.d(1),e.delete(t.key)}function Ot(t,e){oe(t,1,1,()=>{e.delete(t.key)})}function Pe(t,e,o,l,n,i,r,c,s,u,d,a){let g=t.length,q=i.length,h=g;const _={};for(;h--;)_[t[h].key]=h;const y=[],b=new Map,M=new Map,A=[];for(h=q;h--;){const v=a(n,i,h),S=o(v);let E=r.get(S);E?l&&A.push(()=>E.p(v,e)):(E=u(S,v),E.c()),b.set(S,y[h]=E),S in _&&M.set(S,Math.abs(h-_[S]))}const L=new Set,J=new Set;function W(v){Z(v,1),v.m(c,d),r.set(v.key,v),d=v.first,q--}for(;g&&q;){const v=y[q-1],S=t[g-1],E=v.key,le=S.key;v===S?(d=v.first,g--,q--):b.has(le)?!r.has(E)||L.has(E)?W(v):J.has(le)?g--:M.get(E)>M.get(le)?(J.add(E),W(v)):(L.add(le),g--):(s(S,r),g--)}for(;g--;){const v=t[g];b.has(v.key)||s(v,r)}for(;q;)W(y[q-1]);return re(A),y}function ze(t){t&&t.c()}function pe(t,e,o,l){const{fragment:n,after_update:i}=t.$$;n&&n.m(e,o),l||ve(()=>{const r=t.$$.on_mount.map(Ae).filter(de);t.$$.on_destroy?t.$$.on_destroy.push(...r):re(r),t.$$.on_mount=[]}),i.forEach(ve)}function Ce(t,e){const o=t.$$;o.fragment!==null&&(Mt(o.after_update),re(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[])}function jt(t,e){t.$$.dirty[0]===-1&&(fe.push(t),zt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Be(t,e,o,l,n,i,r,c=[-1]){const s=Oe;be(t);const u=t.$$={fragment:null,ctx:[],props:i,update:X,not_equal:n,bound:We(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:We(),dirty:c,skip_bound:!1,root:e.target||s.$$.root};r&&r(u.root);let d=!1;if(u.ctx=o?o(t,e.props||{},(a,g,...q)=>{const h=q.length?q[0]:g;return u.ctx&&n(u.ctx[a],u.ctx[a]=h)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](h),d&&jt(t,a)),g}):[],u.update(),d=!0,re(u.before_update),u.fragment=l?l(u.ctx):!1,e.target){if(e.hydrate){const a=Et(e.target);u.fragment&&u.fragment.l(a),a.forEach(T)}else u.fragment&&u.fragment.c();e.intro&&Z(t.$$.fragment),pe(t,e.target,e.anchor,e.customElement),Ke()}be(s)}class ke{$destroy(){Ce(this,1),this.$destroy=X}$on(e,o){if(!de(o))return X;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(o),()=>{const n=l.indexOf(o);n!==-1&&l.splice(n,1)}}$set(e){this.$$set&&!qt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const jo="";function Xe(t,e,o){const l=t.slice();return l[12]=e[o],l}function Ze(t){let e,o=t[12].name+"",l,n,i=t[12].dosage+"",r,c,s=t[12].администрationType+"",u,d;return{c(){e=p("div"),l=O(o),n=O(", "),r=O(i),c=O(" ("),u=O(s),d=O(`)\r
        `),B(e,"class","medication-details svelte-56bhtz")},m(a,g){I(a,e,g),m(e,l),m(e,n),m(e,r),m(e,c),m(e,u),m(e,d)},p(a,g){g&1&&o!==(o=a[12].name+"")&&ie(l,o),g&1&&i!==(i=a[12].dosage+"")&&ie(r,i),g&1&&s!==(s=a[12].администрationType+"")&&ie(u,s)},d(a){a&&T(e)}}}function Ht(t){let e,o,l,n=t[0].name+"",i,r,c,s,u,d,a,g,q,h=t[0].medications,_=[];for(let y=0;y<h.length;y+=1)_[y]=Ze(Xe(t,h,y));return{c(){e=p("div"),o=p("div"),l=p("strong"),i=O(n),r=j();for(let y=0;y<_.length;y+=1)_[y].c();c=j(),s=p("div"),u=p("button"),u.textContent="Использовать",d=j(),a=p("button"),a.textContent="Редактировать",B(o,"class","scheme-title svelte-56bhtz"),B(u,"class","btn-use-scheme svelte-56bhtz"),B(a,"class","btn-edit-scheme svelte-56bhtz"),B(s,"class","scheme-actions svelte-56bhtz"),B(e,"class","scheme-item svelte-56bhtz"),k(e,"--item-bg-color",t[3]),k(e,"--item-hover-color",t[4]),k(e,"--item-border-color",t[5]),k(e,"--title-color",t[6]),k(e,"--details-color",t[7]),k(e,"--use-btn-bg",t[8]),k(e,"--use-btn-text",t[9]),k(e,"--edit-btn-bg",t[10]),k(e,"--edit-btn-text",t[11])},m(y,b){I(y,e,b),m(e,o),m(o,l),m(l,i),m(o,r);for(let M=0;M<_.length;M+=1)_[M]&&_[M].m(o,null);m(e,c),m(e,s),m(s,u),m(s,d),m(s,a),g||(q=[U(u,"click",Me(function(){de(t[1])&&t[1].apply(this,arguments)})),U(a,"click",Me(function(){de(t[2])&&t[2].apply(this,arguments)}))],g=!0)},p(y,[b]){if(t=y,b&1&&n!==(n=t[0].name+"")&&ie(i,n),b&1){h=t[0].medications;let M;for(M=0;M<h.length;M+=1){const A=Xe(t,h,M);_[M]?_[M].p(A,b):(_[M]=Ze(A),_[M].c(),_[M].m(o,null))}for(;M<_.length;M+=1)_[M].d(1);_.length=h.length}b&8&&k(e,"--item-bg-color",t[3]),b&16&&k(e,"--item-hover-color",t[4]),b&32&&k(e,"--item-border-color",t[5]),b&64&&k(e,"--title-color",t[6]),b&128&&k(e,"--details-color",t[7]),b&256&&k(e,"--use-btn-bg",t[8]),b&512&&k(e,"--use-btn-text",t[9]),b&1024&&k(e,"--edit-btn-bg",t[10]),b&2048&&k(e,"--edit-btn-text",t[11])},i:X,o:X,d(y){y&&T(e),_e(_,y),g=!1,re(q)}}}function Pt(t,e,o){let{scheme:l={}}=e,{onSelect:n}=e,{onEdit:i}=e,{itemBgColor:r="#f8f9fa"}=e,{itemHoverColor:c="#e9ecef"}=e,{itemBorderColor:s="#e9ecef"}=e,{titleColor:u="#333"}=e,{detailsColor:d="#6c757d"}=e,{useButtonBgColor:a="#007bff"}=e,{useButtonTextColor:g="#fff"}=e,{editButtonBgColor:q="#6c757d"}=e,{editButtonTextColor:h="#fff"}=e;return t.$$set=_=>{"scheme"in _&&o(0,l=_.scheme),"onSelect"in _&&o(1,n=_.onSelect),"onEdit"in _&&o(2,i=_.onEdit),"itemBgColor"in _&&o(3,r=_.itemBgColor),"itemHoverColor"in _&&o(4,c=_.itemHoverColor),"itemBorderColor"in _&&o(5,s=_.itemBorderColor),"titleColor"in _&&o(6,u=_.titleColor),"detailsColor"in _&&o(7,d=_.detailsColor),"useButtonBgColor"in _&&o(8,a=_.useButtonBgColor),"useButtonTextColor"in _&&o(9,g=_.useButtonTextColor),"editButtonBgColor"in _&&o(10,q=_.editButtonBgColor),"editButtonTextColor"in _&&o(11,h=_.editButtonTextColor)},[l,n,i,r,c,s,u,d,a,g,q,h]}class Lt extends ke{constructor(e){super(),Be(this,e,Pt,Ht,he,{scheme:0,onSelect:1,onEdit:2,itemBgColor:3,itemHoverColor:4,itemBorderColor:5,titleColor:6,detailsColor:7,useButtonBgColor:8,useButtonTextColor:9,editButtonBgColor:10,editButtonTextColor:11})}}const Ho="";function $e(t,e,o){const l=t.slice();return l[8]=e[o],l}function Nt(t){let e;return{c(){e=p("p"),e.textContent="Нет существующих схем",B(e,"class","no-schemes svelte-19ao7u4")},m(o,l){I(o,e,l)},p:X,i:X,o:X,d(o){o&&T(e)}}}function At(t){let e,o=[],l=new Map,n,i=t[0];const r=c=>c[8].id;for(let c=0;c<i.length;c+=1){let s=$e(t,i,c),u=r(s);l.set(u,o[c]=et(u,s))}return{c(){e=p("div");for(let c=0;c<o.length;c+=1)o[c].c();B(e,"class","schemes-list svelte-19ao7u4")},m(c,s){I(c,e,s);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);n=!0},p(c,s){s&7&&(i=c[0],De(),o=Pe(o,s,r,1,c,i,l,e,Ot,et,null,$e),xe())},i(c){if(!n){for(let s=0;s<i.length;s+=1)Z(o[s]);n=!0}},o(c){for(let s=0;s<o.length;s+=1)oe(o[s]);n=!1},d(c){c&&T(e);for(let s=0;s<o.length;s+=1)o[s].d()}}}function et(t,e){let o,l,n;function i(){return e[6](e[8])}function r(){return e[7](e[8])}return l=new Lt({props:{scheme:e[8],onSelect:i,onEdit:r}}),{key:t,first:null,c(){o=Te(),ze(l.$$.fragment),this.first=o},m(c,s){I(c,o,s),pe(l,c,s),n=!0},p(c,s){e=c;const u={};s&1&&(u.scheme=e[8]),s&3&&(u.onSelect=i),s&5&&(u.onEdit=r),l.$set(u)},i(c){n||(Z(l.$$.fragment,c),n=!0)},o(c){oe(l.$$.fragment,c),n=!1},d(c){c&&T(o),Ce(l,c)}}}function Wt(t){let e,o,l,n,i,r;const c=[At,Nt],s=[];function u(d,a){return d[0].length?0:1}return n=u(t),i=s[n]=c[n](t),{c(){e=p("div"),o=p("h2"),o.textContent="Существующие схемы лечения",l=j(),i.c(),B(o,"class","svelte-19ao7u4"),B(e,"class","existing-schemes svelte-19ao7u4"),k(e,"--bg-color",t[3]),k(e,"--title-color",t[4]),k(e,"--border-color",t[5])},m(d,a){I(d,e,a),m(e,o),m(e,l),s[n].m(e,null),r=!0},p(d,[a]){let g=n;n=u(d),n===g?s[n].p(d,a):(De(),oe(s[g],1,1,()=>{s[g]=null}),xe(),i=s[n],i?i.p(d,a):(i=s[n]=c[n](d),i.c()),Z(i,1),i.m(e,null)),(!r||a&8)&&k(e,"--bg-color",d[3]),(!r||a&16)&&k(e,"--title-color",d[4]),(!r||a&32)&&k(e,"--border-color",d[5])},i(d){r||(Z(i),r=!0)},o(d){oe(i),r=!1},d(d){d&&T(e),s[n].d()}}}function Ut(t,e,o){let{schemes:l=[]}=e,{onSelect:n}=e,{onEdit:i}=e,{bgColor:r="#f8f9fa"}=e,{titleColor:c="#333"}=e,{borderColor:s="#e9ecef"}=e;const u=a=>n(a),d=a=>i(a);return t.$$set=a=>{"schemes"in a&&o(0,l=a.schemes),"onSelect"in a&&o(1,n=a.onSelect),"onEdit"in a&&o(2,i=a.onEdit),"bgColor"in a&&o(3,r=a.bgColor),"titleColor"in a&&o(4,c=a.titleColor),"borderColor"in a&&o(5,s=a.borderColor)},[l,n,i,r,c,s,u,d]}class Ft extends ke{constructor(e){super(),Be(this,e,Ut,Wt,he,{schemes:0,onSelect:1,onEdit:2,bgColor:3,titleColor:4,borderColor:5})}}const Po="";function Yt(t){let e,o,l,n;return{c(){e=p("button"),o=O("+ Создать новую схему"),B(e,"class","btn-add-new-scheme svelte-zgjj6w"),k(e,"--btn-bg-color",t[1]),k(e,"--btn-text-color",t[2]),k(e,"--btn-hover-color",t[3]),k(e,"--btn-border-radius",t[4])},m(i,r){I(i,e,r),m(e,o),l||(n=U(e,"click",function(){de(t[0])&&t[0].apply(this,arguments)}),l=!0)},p(i,[r]){t=i,r&2&&k(e,"--btn-bg-color",t[1]),r&4&&k(e,"--btn-text-color",t[2]),r&8&&k(e,"--btn-hover-color",t[3]),r&16&&k(e,"--btn-border-radius",t[4])},i:X,o:X,d(i){i&&T(e),l=!1,n()}}}function Vt(t,e,o){let{onClick:l}=e,{buttonBgColor:n="#28a745"}=e,{buttonTextColor:i="#fff"}=e,{buttonHoverColor:r="#218838"}=e,{buttonBorderRadius:c="4px"}=e;return t.$$set=s=>{"onClick"in s&&o(0,l=s.onClick),"buttonBgColor"in s&&o(1,n=s.buttonBgColor),"buttonTextColor"in s&&o(2,i=s.buttonTextColor),"buttonHoverColor"in s&&o(3,r=s.buttonHoverColor),"buttonBorderRadius"in s&&o(4,c=s.buttonBorderRadius)},[l,n,i,r,c]}class Gt extends ke{constructor(e){super(),Be(this,e,Vt,Yt,he,{onClick:0,buttonBgColor:1,buttonTextColor:2,buttonHoverColor:3,buttonBorderRadius:4})}}const Lo="";function tt(t){let e,o,l,n,i,r,c;const s=t[12].default,u=wt(s,t,t[11],null);return{c(){e=p("div"),o=p("div"),l=p("button"),l.textContent="✖",n=j(),u&&u.c(),B(l,"class","modal-close svelte-1lbmm4i"),B(o,"class","modal-content svelte-1lbmm4i"),k(o,"--max-width",t[2]),k(o,"--max-height",t[3]),k(o,"--bg-color",t[4]),k(o,"--border-radius",t[5]),k(o,"--padding",t[6]),k(o,"--box-shadow",t[7]),B(e,"class","modal-overlay svelte-1lbmm4i"),k(e,"--overlay-color",t[9]),k(e,"--z-index",t[8])},m(d,a){I(d,e,a),m(e,o),m(o,l),m(o,n),u&&u.m(o,null),i=!0,r||(c=[U(l,"click",function(){de(t[1])&&t[1].apply(this,arguments)}),U(o,"click",Me(t[13])),U(e,"mousedown",t[10])],r=!0)},p(d,a){t=d,u&&u.p&&(!i||a&2048)&&It(u,s,t,t[11],i?Tt(s,t[11],a,null):St(t[11]),null),(!i||a&4)&&k(o,"--max-width",t[2]),(!i||a&8)&&k(o,"--max-height",t[3]),(!i||a&16)&&k(o,"--bg-color",t[4]),(!i||a&32)&&k(o,"--border-radius",t[5]),(!i||a&64)&&k(o,"--padding",t[6]),(!i||a&128)&&k(o,"--box-shadow",t[7]),(!i||a&512)&&k(e,"--overlay-color",t[9]),(!i||a&256)&&k(e,"--z-index",t[8])},i(d){i||(Z(u,d),i=!0)},o(d){oe(u,d),i=!1},d(d){d&&T(e),u&&u.d(d),r=!1,re(c)}}}function Jt(t){let e,o,l=t[0]&&tt(t);return{c(){l&&l.c(),e=Te()},m(n,i){l&&l.m(n,i),I(n,e,i),o=!0},p(n,[i]){n[0]?l?(l.p(n,i),i&1&&Z(l,1)):(l=tt(n),l.c(),Z(l,1),l.m(e.parentNode,e)):l&&(De(),oe(l,1,1,()=>{l=null}),xe())},i(n){o||(Z(l),o=!0)},o(n){oe(l),o=!1},d(n){l&&l.d(n),n&&T(e)}}}function Kt(t,e,o){let{$$slots:l={},$$scope:n}=e,{isOpen:i=!1}=e,{onClose:r}=e,{maxWidth:c="1100px"}=e,{maxHeight:s="80%"}=e,{backgroundColor:u="white"}=e,{borderRadius:d="8px"}=e,{padding:a="20px"}=e,{boxShadow:g="0 4px 6px rgba(0,0,0,0.1)"}=e,{zIndex:q=1e3}=e,{overlayColor:h="rgba(0,0,0,0.5)"}=e;function _(b){b.target.classList.contains("modal-overlay")&&r()}function y(b){Dt.call(this,t,b)}return t.$$set=b=>{"isOpen"in b&&o(0,i=b.isOpen),"onClose"in b&&o(1,r=b.onClose),"maxWidth"in b&&o(2,c=b.maxWidth),"maxHeight"in b&&o(3,s=b.maxHeight),"backgroundColor"in b&&o(4,u=b.backgroundColor),"borderRadius"in b&&o(5,d=b.borderRadius),"padding"in b&&o(6,a=b.padding),"boxShadow"in b&&o(7,g=b.boxShadow),"zIndex"in b&&o(8,q=b.zIndex),"overlayColor"in b&&o(9,h=b.overlayColor),"$$scope"in b&&o(11,n=b.$$scope)},[i,r,c,s,u,d,a,g,q,h,_,n,l,y]}class Qt extends ke{constructor(e){super(),Be(this,e,Kt,Jt,he,{isOpen:0,onClose:1,maxWidth:2,maxHeight:3,backgroundColor:4,borderRadius:5,padding:6,boxShadow:7,zIndex:8,overlayColor:9})}}const No="";function ot(t,e,o){const l=t.slice();return l[64]=e[o],l}function lt(t,e,o){const l=t.slice();return l[67]=e[o],l}function nt(t,e,o){const l=t.slice();return l[70]=e[o],l}function Xt(t,e,o){const l=t.slice();return l[67]=e[o],l}function it(t,e,o){const l=t.slice();return l[70]=e[o],l[75]=e,l[76]=o,l}function rt(t,e,o){const l=t.slice();return l[77]=e[o],l}function Zt(t){let e,o,l,n,i,r,c,s,u,d,a,g,q,h,_,y,b,M,A,L,J,W,v,S,E,le,se,$,V=t[21]?"Сохранить изменения":"Добавить препарат",N,F,z,ee,ae,R;function ue(C,H){return C[22]?to:eo}let ne=ue(t),P=ne(t),x=t[26],G=[];for(let C=0;C<x.length;C+=1)G[C]=st(rt(t,x,C));let K=t[14].hasDiluent==="да"&&ut(t);return z=Fe(t[51][0]),ee=Fe(t[51][1]),{c(){e=p("h2"),P.c(),o=j(),l=p("select");for(let C=0;C<G.length;C+=1)G[C].c();n=j(),i=p("div"),r=p("label"),c=p("input"),s=O(` \r
                            Внутримышечно`),u=j(),d=p("label"),a=p("input"),g=O(` \r
                            Внутривенно`),q=j(),h=p("input"),_=j(),y=p("div"),b=p("label"),b.textContent="Использовать растворитель:",M=j(),A=p("label"),L=p("input"),J=O(` \r
                            Нет`),W=j(),v=p("label"),S=p("input"),E=O(` \r
                            Да`),le=j(),K&&K.c(),se=j(),$=p("button"),N=O(V),B(l,"class","form-control svelte-quag8p"),t[14].medication===void 0&&ve(()=>t[49].call(l)),B(c,"type","radio"),c.__value="в/м",c.value=c.__value,B(r,"class","svelte-quag8p"),B(a,"type","radio"),a.__value="в/в",a.value=a.__value,B(d,"class","svelte-quag8p"),B(i,"class","administration-type svelte-quag8p"),B(h,"type","text"),B(h,"placeholder","Дозировка препарата"),B(h,"class","form-control svelte-quag8p"),B(b,"class","svelte-quag8p"),B(L,"type","radio"),L.__value="нет",L.value=L.__value,B(A,"class","svelte-quag8p"),B(S,"type","radio"),S.__value="да",S.value=S.__value,B(v,"class","svelte-quag8p"),B(y,"class","diluent-choice svelte-quag8p"),B($,"class","btn-add svelte-quag8p"),$.disabled=F=!t[24],z.p(L,S),ee.p(c,a)},m(C,H){I(C,e,H),P.m(e,null),I(C,o,H),I(C,l,H);for(let Y=0;Y<G.length;Y+=1)G[Y]&&G[Y].m(l,null);Se(l,t[14].medication,!0),I(C,n,H),I(C,i,H),m(i,r),m(r,c),c.checked=c.__value===t[14].administrationType,m(r,s),m(i,u),m(i,d),m(d,a),a.checked=a.__value===t[14].administrationType,m(d,g),I(C,q,H),I(C,h,H),Ie(h,t[14].dosage),I(C,_,H),I(C,y,H),m(y,b),m(y,M),m(y,A),m(A,L),L.checked=L.__value===t[14].hasDiluent,m(A,J),m(y,W),m(y,v),m(v,S),S.checked=S.__value===t[14].hasDiluent,m(v,E),I(C,le,H),K&&K.m(C,H),I(C,se,H),I(C,$,H),m($,N),ae||(R=[U(l,"change",t[49]),U(c,"change",t[50]),U(a,"change",t[52]),U(h,"input",t[53]),U(L,"change",t[54]),U(S,"change",t[55]),U($,"click",t[32])],ae=!0)},p(C,H){if(ne===(ne=ue(C))&&P?P.p(C,H):(P.d(1),P=ne(C),P&&(P.c(),P.m(e,null))),H[0]&67108864){x=C[26];let Y;for(Y=0;Y<x.length;Y+=1){const qe=rt(C,x,Y);G[Y]?G[Y].p(qe,H):(G[Y]=st(qe),G[Y].c(),G[Y].m(l,null))}for(;Y<G.length;Y+=1)G[Y].d(1);G.length=x.length}H[0]&67125248&&Se(l,C[14].medication),H[0]&67125248&&(c.checked=c.__value===C[14].administrationType),H[0]&67125248&&(a.checked=a.__value===C[14].administrationType),H[0]&67125248&&h.value!==C[14].dosage&&Ie(h,C[14].dosage),H[0]&67125248&&(L.checked=L.__value===C[14].hasDiluent),H[0]&67125248&&(S.checked=S.__value===C[14].hasDiluent),C[14].hasDiluent==="да"?K?K.p(C,H):(K=ut(C),K.c(),K.m(se.parentNode,se)):K&&(K.d(1),K=null),H[0]&2097152&&V!==(V=C[21]?"Сохранить изменения":"Добавить препарат")&&ie(N,V),H[0]&16777216&&F!==(F=!C[24])&&($.disabled=F)},i:X,o:X,d(C){C&&T(e),P.d(),C&&T(o),C&&T(l),_e(G,C),C&&T(n),C&&T(i),C&&T(q),C&&T(h),C&&T(_),C&&T(y),C&&T(le),K&&K.d(C),C&&T(se),C&&T($),z.r(),ee.r(),ae=!1,re(R)}}}function $t(t){let e,o,l,n;return e=new Ft({props:{schemes:t[23],onSelect:t[34],onEdit:t[37],bgColor:t[4],titleColor:t[5],borderColor:t[6]}}),l=new Gt({props:{onClick:t[35],buttonBgColor:t[7],buttonTextColor:t[8],buttonHoverColor:t[9],buttonBorderRadius:t[10]}}),{c(){ze(e.$$.fragment),o=j(),ze(l.$$.fragment)},m(i,r){pe(e,i,r),I(i,o,r),pe(l,i,r),n=!0},p(i,r){const c={};r[0]&8388608&&(c.schemes=i[23]),r[0]&16&&(c.bgColor=i[4]),r[0]&32&&(c.titleColor=i[5]),r[0]&64&&(c.borderColor=i[6]),e.$set(c);const s={};r[0]&128&&(s.buttonBgColor=i[7]),r[0]&256&&(s.buttonTextColor=i[8]),r[0]&512&&(s.buttonHoverColor=i[9]),r[0]&1024&&(s.buttonBorderRadius=i[10]),l.$set(s)},i(i){n||(Z(e.$$.fragment,i),Z(l.$$.fragment,i),n=!0)},o(i){oe(e.$$.fragment,i),oe(l.$$.fragment,i),n=!1},d(i){Ce(e,i),i&&T(o),Ce(l,i)}}}function eo(t){let e;return{c(){e=O("Добавление препарата")},m(o,l){I(o,e,l)},p:X,d(o){o&&T(e)}}}function to(t){let e,o=t[22].name+"",l;return{c(){e=O("Редактирование схемы: "),l=O(o)},m(n,i){I(n,e,i),I(n,l,i)},p(n,i){i[0]&4194304&&o!==(o=n[22].name+"")&&ie(l,o)},d(n){n&&T(e),n&&T(l)}}}function st(t){let e,o=t[77].name+"",l;return{c(){e=p("option"),l=O(o),e.__value=t[77],e.value=e.__value},m(n,i){I(n,e,i),m(e,l)},p:X,d(n){n&&T(e)}}}function ut(t){let e,o=[],l=new Map,n,i,r,c,s=t[14].diluents;const u=d=>d[70].id;for(let d=0;d<s.length;d+=1){let a=it(t,s,d),g=u(a);l.set(g,o[d]=at(g,a))}return{c(){e=p("div");for(let d=0;d<o.length;d+=1)o[d].c();n=j(),i=p("button"),i.textContent="+ Добавить растворитель",B(i,"class","btn-add-diluent svelte-quag8p"),B(e,"class","diluents-container svelte-quag8p")},m(d,a){I(d,e,a);for(let g=0;g<o.length;g+=1)o[g]&&o[g].m(e,null);m(e,n),m(e,i),r||(c=U(i,"click",t[27]),r=!0)},p(d,a){a[0]&1073758208&&(s=d[14].diluents,o=Pe(o,a,u,1,d,s,l,e,Qe,at,n,it))},d(d){d&&T(e);for(let a=0;a<o.length;a+=1)o[a].d();r=!1,c()}}}function at(t,e){let o,l,n,i,r,c,s,u,d,a,g;function q(){e[56].call(l,e[75],e[76])}function h(){e[57].call(s,e[75],e[76])}function _(){return e[58](e[70])}return{key:t,first:null,c(){o=p("div"),l=p("select"),n=p("option"),n.textContent="Выберите растворитель",i=p("option"),i.textContent="Глюкоза",r=p("option"),r.textContent="Физраствор",c=j(),s=p("input"),u=j(),d=p("button"),d.textContent="✖",n.__value="",n.value=n.__value,i.__value="глюкоза",i.value=i.__value,r.__value="физраствор",r.value=r.__value,B(l,"class","form-control diluent-select svelte-quag8p"),e[70].type===void 0&&ve(q),B(s,"type","text"),B(s,"placeholder","Дозировка"),B(s,"class","form-control diluent-dosage svelte-quag8p"),B(d,"class","btn-remove-diluent svelte-quag8p"),B(o,"class","diluent-row svelte-quag8p"),this.first=o},m(y,b){I(y,o,b),m(o,l),m(l,n),m(l,i),m(l,r),Se(l,e[70].type,!0),m(o,c),m(o,s),Ie(s,e[70].dosage),m(o,u),m(o,d),a||(g=[U(l,"change",q),U(s,"input",h),U(d,"click",_)],a=!0)},p(y,b){e=y,b[0]&67125248&&Se(l,e[70].type),b[0]&67125248&&s.value!==e[70].dosage&&Ie(s,e[70].dosage)},d(y){y&&T(o),a=!1,re(g)}}}function ct(t){let e,o,l,n,i,r,c,s,u=[],d=new Map,a,g,q,h,_,y=[1,2,3,4,5,6,7,8,9,10],b=[];for(let v=0;v<10;v+=1)b[v]=oo(Xt(t,y,v));let M=t[15];const A=v=>v[64].id;for(let v=0;v<M.length;v+=1){let S=ot(t,M,v),E=A(S);d.set(E,u[v]=gt(E,S))}function L(v,S){return v[20]?no:lo}let J=L(t),W=J(t);return{c(){e=p("div"),o=p("h2"),o.textContent="График приема препаратов",l=j(),n=p("div"),i=p("div"),r=p("div"),r.textContent="Препарат",c=j();for(let v=0;v<10;v+=1)b[v].c();s=j();for(let v=0;v<u.length;v+=1)u[v].c();a=j(),g=p("button"),W.c(),B(r,"class","medication-column svelte-quag8p"),B(i,"class","schedule-header svelte-quag8p"),B(n,"class","schedule-table svelte-quag8p"),B(g,"class","btn-continue svelte-quag8p"),g.disabled=q=t[15].length===0||t[20]||!t[25],B(e,"class","schedule-column svelte-quag8p")},m(v,S){I(v,e,S),m(e,o),m(e,l),m(e,n),m(n,i),m(i,r),m(i,c);for(let E=0;E<10;E+=1)b[E]&&b[E].m(i,null);m(n,s);for(let E=0;E<u.length;E+=1)u[E]&&u[E].m(n,null);m(e,a),m(e,g),W.m(g,null),h||(_=U(g,"click",t[36]),h=!0)},p(v,S){S[0]&805404672|S[1]&4&&(M=v[15],u=Pe(u,S,A,1,v,M,d,n,Qe,gt,null,ot)),J!==(J=L(v))&&(W.d(1),W=J(v),W&&(W.c(),W.m(g,null))),S[0]&34635776&&q!==(q=v[15].length===0||v[20]||!v[25])&&(g.disabled=q)},d(v){v&&T(e),_e(b,v);for(let S=0;S<u.length;S+=1)u[S].d();W.d(),h=!1,_()}}}function oo(t){let e,o;return{c(){e=p("div"),o=O(t[67]),B(e,"class","day-header svelte-quag8p")},m(l,n){I(l,e,n),m(e,o)},p:X,d(l){l&&T(e)}}}function dt(t){let e,o=t[64].diluents,l=[];for(let n=0;n<o.length;n+=1)l[n]=ft(nt(t,o,n));return{c(){for(let n=0;n<l.length;n+=1)l[n].c();e=Te()},m(n,i){for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(n,i);I(n,e,i)},p(n,i){if(i[0]&32768){o=n[64].diluents;let r;for(r=0;r<o.length;r+=1){const c=nt(n,o,r);l[r]?l[r].p(c,i):(l[r]=ft(c),l[r].c(),l[r].m(e.parentNode,e))}for(;r<l.length;r+=1)l[r].d(1);l.length=o.length}},d(n){_e(l,n),n&&T(e)}}}function ft(t){let e,o=t[70].type+"",l,n,i=t[70].dosage+"",r,c;return{c(){e=O("+ "),l=O(o),n=O(" ("),r=O(i),c=O(")")},m(s,u){I(s,e,u),I(s,l,u),I(s,n,u),I(s,r,u),I(s,c,u)},p(s,u){u[0]&32768&&o!==(o=s[70].type+"")&&ie(l,o),u[0]&32768&&i!==(i=s[70].dosage+"")&&ie(r,i)},d(s){s&&T(e),s&&T(l),s&&T(n),s&&T(r),s&&T(c)}}}function mt(t){let e,o,l;function n(){return t[61](t[64],t[67])}return{c(){e=p("div"),B(e,"class","schedule-cell svelte-quag8p"),Ve(e,"selected",t[16][t[64].id]&&t[16][t[64].id][1]&&t[16][t[64].id][1].has(t[67]))},m(i,r){I(i,e,r),o||(l=U(e,"click",n),o=!0)},p(i,r){t=i,r[0]&98304&&Ve(e,"selected",t[16][t[64].id]&&t[16][t[64].id][1]&&t[16][t[64].id][1].has(t[67]))},d(i){i&&T(e),o=!1,l()}}}function gt(t,e){let o,l,n,i,r=e[64].medication.name+"",c,s,u=e[64].administrationType+"",d,a,g=e[64].dosage+"",q,h,_,y,b,M,A,L,J,W,v,S,E=e[64].hasDiluent==="да"&&e[64].diluents.length>0&&dt(e);function le(){return e[59](e[64])}function se(){return e[60](e[64])}let $=[1,2,3,4,5,6,7,8,9,10],V=[];for(let N=0;N<10;N+=1)V[N]=mt(lt(e,$,N));return{key:t,first:null,c(){o=p("div"),l=p("div"),n=p("div"),i=p("strong"),c=O(r),s=j(),d=O(u),a=O(", "),q=O(g),h=j(),E&&E.c(),_=j(),y=p("div"),b=p("button"),b.textContent="✏️",M=j(),A=p("button"),A.textContent="🗑️",L=j();for(let N=0;N<10;N+=1)V[N].c();J=j(),B(n,"class","medication-title"),B(b,"class","btn-edit-medication svelte-quag8p"),B(A,"class","btn-delete-medication svelte-quag8p"),B(y,"class","medication-actions svelte-quag8p"),B(l,"class","medication-cell svelte-quag8p"),B(o,"class",W="schedule-row "+(!e[16][e[64].id]||!Object.values(e[16][e[64].id]).some(_t)?"error-highlight":"")+" svelte-quag8p"),this.first=o},m(N,F){I(N,o,F),m(o,l),m(l,n),m(n,i),m(i,c),m(n,s),m(n,d),m(n,a),m(n,q),m(n,h),E&&E.m(n,null),m(l,_),m(l,y),m(y,b),m(y,M),m(y,A),m(o,L);for(let z=0;z<10;z+=1)V[z]&&V[z].m(o,null);m(o,J),v||(S=[U(b,"click",le),U(A,"click",se)],v=!0)},p(N,F){if(e=N,F[0]&32768&&r!==(r=e[64].medication.name+"")&&ie(c,r),F[0]&32768&&u!==(u=e[64].administrationType+"")&&ie(d,u),F[0]&32768&&g!==(g=e[64].dosage+"")&&ie(q,g),e[64].hasDiluent==="да"&&e[64].diluents.length>0?E?E.p(e,F):(E=dt(e),E.c(),E.m(n,null)):E&&(E.d(1),E=null),F[0]&98304|F[1]&4){$=[1,2,3,4,5,6,7,8,9,10];let z;for(z=0;z<10;z+=1){const ee=lt(e,$,z);V[z]?V[z].p(ee,F):(V[z]=mt(ee),V[z].c(),V[z].m(o,J))}for(;z<10;z+=1)V[z].d(1)}F[0]&98304&&W!==(W="schedule-row "+(!e[16][e[64].id]||!Object.values(e[16][e[64].id]).some(_t)?"error-highlight":"")+" svelte-quag8p")&&B(o,"class",W)},d(N){N&&T(o),E&&E.d(),_e(V,N),v=!1,re(S)}}}function lo(t){let e;return{c(){e=O("Опубликовать схему")},m(o,l){I(o,e,l)},d(o){o&&T(e)}}}function no(t){let e,o;return{c(){e=p("span"),o=O(" Сохранение..."),B(e,"class","spinner svelte-quag8p")},m(l,n){I(l,e,n),I(l,o,n)},d(l){l&&T(e),l&&T(o)}}}function ht(t){let e,o,l;return{c(){e=p("div"),o=O("⚠️ "),l=O(t[19]),B(e,"class","validation-error svelte-quag8p")},m(n,i){I(n,e,i),m(e,o),m(e,l)},p(n,i){i[0]&524288&&ie(l,n[19])},d(n){n&&T(e)}}}function io(t){let e,o,l,n,i,r,c,s;const u=[$t,Zt],d=[];function a(h,_){return h[18]?1:0}l=a(t),n=d[l]=u[l](t);let g=t[18]&&t[15].length>0&&ct(t),q=t[19]&&ht(t);return{c(){e=p("div"),o=p("div"),n.c(),i=j(),g&&g.c(),r=j(),q&&q.c(),c=Te(),B(o,"class","medication-form-column svelte-quag8p"),B(e,"class","modal-grid svelte-quag8p")},m(h,_){I(h,e,_),m(e,o),d[l].m(o,null),m(e,i),g&&g.m(e,null),I(h,r,_),q&&q.m(h,_),I(h,c,_),s=!0},p(h,_){let y=l;l=a(h),l===y?d[l].p(h,_):(De(),oe(d[y],1,1,()=>{d[y]=null}),xe(),n=d[l],n?n.p(h,_):(n=d[l]=u[l](h),n.c()),Z(n,1),n.m(o,null)),h[18]&&h[15].length>0?g?g.p(h,_):(g=ct(h),g.c(),g.m(e,null)):g&&(g.d(1),g=null),h[19]?q?q.p(h,_):(q=ht(h),q.c(),q.m(c.parentNode,c)):q&&(q.d(1),q=null)},i(h){s||(Z(n),s=!0)},o(h){oe(n),s=!1},d(h){h&&T(e),d[l].d(),g&&g.d(),h&&T(r),q&&q.d(h),h&&T(c)}}}function ro(t){let e,o,l,n,i,r,c,s;return i=new Qt({props:{isOpen:t[17],onClose:t[31],maxWidth:t[0],backgroundColor:t[1],borderRadius:t[2],overlayColor:t[3],$$slots:{default:[io]},$$scope:{ctx:t}}}),{c(){e=p("div"),o=p("button"),l=O("📋 Схема лечения"),n=j(),ze(i.$$.fragment),B(o,"class","treatment-scheme-button svelte-quag8p"),k(o,"--bg-color",t[11]),k(o,"--text-color",t[12]),k(o,"--border-radius",t[13]),B(e,"class","treatment-scheme-container")},m(u,d){I(u,e,d),m(e,o),m(o,l),m(e,n),pe(i,e,null),r=!0,c||(s=U(o,"click",t[31]),c=!0)},p(u,d){(!r||d[0]&2048)&&k(o,"--bg-color",u[11]),(!r||d[0]&4096)&&k(o,"--text-color",u[12]),(!r||d[0]&8192)&&k(o,"--border-radius",u[13]);const a={};d[0]&131072&&(a.isOpen=u[17]),d[0]&1&&(a.maxWidth=u[0]),d[0]&2&&(a.backgroundColor=u[1]),d[0]&4&&(a.borderRadius=u[2]),d[0]&8&&(a.overlayColor=u[3]),d[0]&66963440|d[2]&262144&&(a.$$scope={dirty:d,ctx:u}),i.$set(a)},i(u){r||(Z(i.$$.fragment,u),r=!0)},o(u){oe(i.$$.fragment,u),r=!1},d(u){u&&T(e),Ce(i),c=!1,s()}}}const _t=t=>t.size>0;function so(t,e,o){let l,n,{serviceId:i=null}=e,{medicalCardId:r=null}=e,{modalMaxWidth:c="1100px"}=e,{modalBgColor:s="white"}=e,{modalBorderRadius:u="8px"}=e,{modalOverlayColor:d="rgba(0,0,0,0.5)"}=e,{schemesBgColor:a="#f8f9fa"}=e,{schemesTitleColor:g="#333"}=e,{schemesBorderColor:q="#e9ecef"}=e,{schemeItemBgColor:h="#f8f9fa"}=e,{schemeItemHoverColor:_="#e9ecef"}=e,{schemeItemBorderColor:y="#e9ecef"}=e,{schemeTitleColor:b="#333"}=e,{schemeDetailsColor:M="#6c757d"}=e,{useButtonBgColor:A="#007bff"}=e,{useButtonTextColor:L="#fff"}=e,{editButtonBgColor:J="#6c757d"}=e,{editButtonTextColor:W="#fff"}=e,{createButtonBgColor:v="#28a745"}=e,{createButtonTextColor:S="#fff"}=e,{createButtonHoverColor:E="#218838"}=e,{createButtonBorderRadius:le="4px"}=e,{mainButtonBgColor:se="#007bff"}=e,{mainButtonTextColor:$="white"}=e,{mainButtonBorderRadius:V="4px"}=e,N=!1,F=!1,z=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],ee="",ae=!1,R={medication:z[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},ue=null,ne=null,P=[],x={},G=[{id:1,name:"Схема лечения №1",medications:[{id:101,name:"Цефтриаксон",dosage:"1г",администрationType:"в/м",diluents:[{id:1001,type:"физраствор",dosage:"2мл"}]}],schedule:{101:{1:[1,3,5,7,9]}}},{id:2,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:3,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:4,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:5,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}},{id:6,name:"Схема лечения №2",medications:[{id:201,name:"Метронидазол",dosage:"500мг",администрationType:"в/в",diluents:[{id:2001,type:"глюкоза",dosage:"100мл"},{id:2002,type:"физраствор",dosage:"50мл"}]}],schedule:{201:{1:[1,2,3,4,5]}}}];function K(){o(14,R.diluents=[...R.diluents,{id:Date.now(),type:"",dosage:""}],R)}function C(f){o(14,R={medication:z.find(w=>w.name===f.medication.name)||z[0],administrationType:f.administrationType,dosage:f.dosage,hasDiluent:f.hasDiluent,diluents:[...f.diluents]}),o(21,ue=f.id)}function H(f){o(15,P=P.filter(w=>w.id!==f)),x[f]&&(delete x[f],o(16,x={...x})),ue===f&&Ct(),o(19,ee="")}function Y(f){o(14,R.diluents=R.diluents.filter(w=>w.id!==f),R)}function qe(){o(17,N=!N),N||ho()}function ho(){o(14,R={medication:z[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),o(15,P=[]),o(16,x={}),o(18,F=!1),o(22,ne=null),o(19,ee="")}function _o(){if(n){if(ue)o(15,P=P.map(f=>f.id===ue?{...R,id:f.id}:f)),o(21,ue=null);else{const f={...R,id:Date.now()};o(15,P=[...P,f])}Ct()}}function Ct(){o(14,R={medication:z[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}),o(21,ue=null)}function Bt(f,w,Q){x[f]||o(16,x[f]={},x),x[f][w]||o(16,x[f][w]=new Set,x),x[f][w].has(Q)?x[f][w].delete(Q):x[f][w].add(Q),o(16,x={...x}),o(19,ee="")}function bo(f){console.log("Выбрана схема:",f),o(15,P=f.medications.map(w=>({id:w.id||Date.now()+Math.random(),medication:{name:w.name},administrationType:w.администрationType,dosage:w.dosage,hasDiluent:w.diluents&&w.diluents.length>0?"да":"нет",diluents:w.diluents||[]}))),o(16,x={}),f.schedule&&Object.entries(f.schedule).forEach(([w,Q])=>{o(16,x[w]={},x),Object.entries(Q).forEach(([te,we])=>{o(16,x[w][te]=new Set(we),x)})}),o(18,F=!0),o(19,ee="")}function vo(){o(18,F=!0),o(15,P=[]),o(16,x={}),o(19,ee="")}function po(){const f=P.filter(w=>!x[w.id]||!Object.values(x[w.id]).some(Q=>Q.size>0));if(f.length>0){const w=f.map(Q=>Q.medication.name).join(", ");o(19,ee=`Не выбрано ни одного дня для препаратов: ${w}`);return}try{o(20,ae=!0);const w={};Object.entries(x).forEach(([te,we])=>{w[te]={},Object.entries(we).forEach(([Mo,Oo])=>{w[te][Mo]=Array.from(Oo)})});const Q={id:Date.now(),name:ne?`${ne.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:P.map(te=>({id:te.id,name:te.medication.name,dosage:te.dosage,администрationType:te.administrationType,hasDiluent:te.hasDiluent,diluent:te.diluent,diluentDosage:te.diluentDosage})),createdFor:{serviceId:i,medicalCardId:r},createdAt:new Date().toISOString(),isRevision:!!ne,originalSchemeId:ne?ne.id:null,schedule:w};setTimeout(()=>{o(23,G=[...G,Q]),console.log("Опубликована схема лечения",Q),o(20,ae=!1),qe()},1e3)}catch(w){console.error("Ошибка публикации схемы:",w),o(20,ae=!1)}}function Co(f){console.log("Редактирование схемы:",f),o(15,P=f.medications.map(w=>({id:w.id||Date.now()+Math.random(),medication:{name:w.name},administrationType:w.администрationType,dosage:w.dosage,hasDiluent:w.diluents&&w.diluents.length>0?"да":"нет",diluents:w.diluents||[]}))),o(16,x={}),f.schedule&&Object.entries(f.schedule).forEach(([w,Q])=>{o(16,x[w]={},x),Object.entries(Q).forEach(([te,we])=>{o(16,x[w][te]=new Set(we),x)})}),o(18,F=!0),o(22,ne=f),o(19,ee="")}const Bo=[[],[]];function ko(){R.medication=Ye(this),o(14,R),o(26,z)}function yo(){R.administrationType=this.__value,o(14,R),o(26,z)}function qo(){R.administrationType=this.__value,o(14,R),o(26,z)}function wo(){R.dosage=this.value,o(14,R),o(26,z)}function To(){R.hasDiluent=this.__value,o(14,R),o(26,z)}function Io(){R.hasDiluent=this.__value,o(14,R),o(26,z)}function So(f,w){f[w].type=Ye(this),o(14,R),o(26,z)}function Eo(f,w){f[w].dosage=this.value,o(14,R),o(26,z)}const Do=f=>Y(f.id),xo=f=>C(f),zo=f=>H(f.id),Ro=(f,w)=>Bt(f.id,1,w);return t.$$set=f=>{"serviceId"in f&&o(38,i=f.serviceId),"medicalCardId"in f&&o(39,r=f.medicalCardId),"modalMaxWidth"in f&&o(0,c=f.modalMaxWidth),"modalBgColor"in f&&o(1,s=f.modalBgColor),"modalBorderRadius"in f&&o(2,u=f.modalBorderRadius),"modalOverlayColor"in f&&o(3,d=f.modalOverlayColor),"schemesBgColor"in f&&o(4,a=f.schemesBgColor),"schemesTitleColor"in f&&o(5,g=f.schemesTitleColor),"schemesBorderColor"in f&&o(6,q=f.schemesBorderColor),"schemeItemBgColor"in f&&o(40,h=f.schemeItemBgColor),"schemeItemHoverColor"in f&&o(41,_=f.schemeItemHoverColor),"schemeItemBorderColor"in f&&o(42,y=f.schemeItemBorderColor),"schemeTitleColor"in f&&o(43,b=f.schemeTitleColor),"schemeDetailsColor"in f&&o(44,M=f.schemeDetailsColor),"useButtonBgColor"in f&&o(45,A=f.useButtonBgColor),"useButtonTextColor"in f&&o(46,L=f.useButtonTextColor),"editButtonBgColor"in f&&o(47,J=f.editButtonBgColor),"editButtonTextColor"in f&&o(48,W=f.editButtonTextColor),"createButtonBgColor"in f&&o(7,v=f.createButtonBgColor),"createButtonTextColor"in f&&o(8,S=f.createButtonTextColor),"createButtonHoverColor"in f&&o(9,E=f.createButtonHoverColor),"createButtonBorderRadius"in f&&o(10,le=f.createButtonBorderRadius),"mainButtonBgColor"in f&&o(11,se=f.mainButtonBgColor),"mainButtonTextColor"in f&&o(12,$=f.mainButtonTextColor),"mainButtonBorderRadius"in f&&o(13,V=f.mainButtonBorderRadius)},t.$$.update=()=>{t.$$.dirty[0]&98304&&o(25,l=P.length>0&&P.every(f=>x[f.id]&&Object.values(x[f.id]).some(w=>w.size>0))),t.$$.dirty[0]&16384&&o(24,n=!!(R.medication&&R.administrationType&&R.dosage&&(R.hasDiluent==="нет"||R.hasDiluent==="да"&&R.diluents.length>0&&R.diluents.every(f=>f.type&&f.dosage))))},[c,s,u,d,a,g,q,v,S,E,le,se,$,V,R,P,x,N,F,ee,ae,ue,ne,G,n,l,z,K,C,H,Y,qe,_o,Bt,bo,vo,po,Co,i,r,h,_,y,b,M,A,L,J,W,ko,yo,Bo,qo,wo,To,Io,So,Eo,Do,xo,zo,Ro]}class uo extends ke{constructor(e){super(),Be(this,e,so,ro,he,{serviceId:38,medicalCardId:39,modalMaxWidth:0,modalBgColor:1,modalBorderRadius:2,modalOverlayColor:3,schemesBgColor:4,schemesTitleColor:5,schemesBorderColor:6,schemeItemBgColor:40,schemeItemHoverColor:41,schemeItemBorderColor:42,schemeTitleColor:43,schemeDetailsColor:44,useButtonBgColor:45,useButtonTextColor:46,editButtonBgColor:47,editButtonTextColor:48,createButtonBgColor:7,createButtonTextColor:8,createButtonHoverColor:9,createButtonBorderRadius:10,mainButtonBgColor:11,mainButtonTextColor:12,mainButtonBorderRadius:13},null,[-1,-1,-1])}}const ao="#show_info_table_title",Le="treatment-scheme-container",D={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),styleConfigs:{clinic1:{mainButtonBgColor:"#4CAF50",mainButtonTextColor:"white",schemesBgColor:"#f0f8ff",schemesTitleColor:"#2c3e50",useButtonBgColor:"#3498db",editButtonBgColor:"#9b59b6",createButtonBgColor:"#e74c3c"}},log(t,e,...o){if(!this.debug)return;const n={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${n} [RecordBtn-${this.instanceId}] ${e}`,...o)}};function bt(t){const e=new URL(t,window.location.origin),o=e.pathname,l=o.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!l,patientId:l?l[1]:null,recordId:l?l[2]:null,fullPath:o+e.search,params:e.searchParams}}function ye(){D.log("action","Запущена процедура очистки"),D.intervalId!==null&&(clearInterval(D.intervalId),D.log("unmount","Интервал остановлен:",D.intervalId),D.intervalId=null);const t=document.getElementById(Le);t&&(t.remove(),D.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),D.mounted=!1}function Re(t=!1){const e=bt(window.location.href);D.log("check","Проверка страницы:",e),e.recordId!==D.currentRecordId&&(D.log("route",`Изменился ID записи: ${D.currentRecordId||"none"} -> ${e.recordId||"none"}`),D.currentRecordId=e.recordId,D.currentPatientId=e.patientId,D.mounted&&(D.log("action","Удаляем компоненты из-за смены записи"),ye()));const l=document.querySelector(ao),n=document.getElementById(Le);if(D.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!l}, mounted=${D.mounted}`),!n&&D.mounted&&(D.log("warn","Компонент исчез из DOM, но состояние не обновлено"),D.mounted=!1),e.isRecordPage&&l){if(!n){D.log("mount","Монтируем компонент TreatmentSchemeButton");const i=document.createElement("div");i.id=Le,l.appendChild(i);try{new uo({target:i,props:{serviceId:e.recordId,medicalCardId:e.patientId,...D.styleConfigs.clinic1}}),D.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),D.mounted=!0}catch(r){D.log("error","Ошибка при монтировании TreatmentSchemeButton:",r),i.remove()}}}else!e.isRecordPage&&(n||D.mounted)&&(D.log("action","Не страница записи - удаляем компонент"),ye())}function co(){D.log("start","Инициализация компонентов"),ye(),window._recordButtonListenersInitialized||(fo(),window._recordButtonListenersInitialized=!0);const t=bt(window.location.href);return D.currentPath=t.fullPath,D.currentRecordId=t.recordId,D.currentPatientId=t.patientId,Re(!0),D.intervalId=setInterval(()=>{D.log("timer","Регулярная проверка по интервалу"),Re()},1e3),D.log("success","Интервал установлен, ID:",D.intervalId),ye}function fo(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),D.log("route",`Обнаружен ${t}`),vt()}}),window.addEventListener("popstate",()=>{D.log("route","Обнаружен popstate"),vt()})}function vt(){[10,50,100,250,500,1e3,1500].forEach((e,o)=>{setTimeout(()=>{D.log("timer",`Запланированная проверка #${o+1} (${e}ms)`),Re(!0)},e)})}window.addEventListener("beforeunload",ye),D.log("info","Модуль загружен"),Re(!0);const mo=[{match:/\/medical_records\/\d+\/\d+$/,render:co}];let pt=null;function go(){console.log("📡 Router запущен"),kt(()=>{const t=window.location.pathname,e=mo.find(o=>o.match.test(t));console.log("📌 Найден роут:",e?.match),e!==pt&&(pt=e,e?.render())})}console.log("✅ Content script работает"),go()})();
