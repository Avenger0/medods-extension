(function(){"use strict";var We=document.createElement("style");We.textContent=`.scheme-item.svelte-6vrfgr{background-color:var(--item-bg-color, #f8f9fa);border:1px solid var(--item-border-color, #e9ecef);border-radius:4px;padding:12px;margin-bottom:10px;transition:background-color .2s ease,transform .1s ease}.scheme-item.svelte-6vrfgr:hover{background-color:var(--item-hover-color, #e9ecef);transform:translateY(-1px);box-shadow:0 2px 4px #0000000d}.scheme-title.svelte-6vrfgr{color:var(--title-color, #333)}.medication-details.svelte-6vrfgr{color:var(--details-color, #6c757d);font-size:.9em;margin-top:5px}.diluent-info.svelte-6vrfgr{font-style:italic}.scheme-actions.svelte-6vrfgr{display:flex;gap:8px;margin-top:10px}.btn-use-scheme.svelte-6vrfgr,.btn-edit-scheme.svelte-6vrfgr{padding:6px 10px;font-size:13px;border:none;border-radius:4px;cursor:pointer;transition:opacity .2s ease}.btn-use-scheme.svelte-6vrfgr{background-color:var(--use-btn-bg, #007bff);color:var(--use-btn-text, #fff)}.btn-edit-scheme.svelte-6vrfgr{background-color:var(--edit-btn-bg, #6c757d);color:var(--edit-btn-text, #fff)}.btn-use-scheme.svelte-6vrfgr:hover,.btn-edit-scheme.svelte-6vrfgr:hover{opacity:.9}.existing-schemes.svelte-5qbczz{margin-top:20px;background-color:var(--bg-color, #f8f9fa);border-radius:6px;padding:15px;border:1px solid var(--border-color, #e9ecef)}h2.svelte-5qbczz{margin-top:0;color:var(--title-color, #333);font-size:1.2rem;margin-bottom:15px;border-bottom:1px solid var(--border-color, #e9ecef);padding-bottom:10px}.schemes-list.svelte-5qbczz{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-height:500px;overflow-y:auto;padding-right:5px}.no-schemes.svelte-5qbczz{font-style:italic;color:#6c757d;text-align:center;padding:15px 0}.modal-overlay.svelte-1lbmm4i{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--overlay-color, rgba(0,0,0,.5));display:flex;justify-content:center;align-items:center;z-index:var(--z-index, 1000);overflow-y:auto}.modal-content.svelte-1lbmm4i{background:var(--bg-color, white);border-radius:var(--border-radius, 8px);max-width:var(--max-width, 1100px);max-height:var(--max-height, 80%);width:calc(100% - 40px);position:relative;padding:var(--padding, 20px);box-shadow:var(--box-shadow, 0 4px 6px rgba(0,0,0,.1));overflow-y:auto}.modal-close.svelte-1lbmm4i{position:absolute;top:15px;right:15px;background:none;border:none;font-size:20px;cursor:pointer;color:#999;transition:color .2s ease;z-index:1}.modal-close.svelte-1lbmm4i:hover{color:#333}h3.svelte-1t6c96i.svelte-1t6c96i{font-size:21px;margin:0 0 15px;padding:0}.form-control-ex.svelte-1t6c96i.svelte-1t6c96i{width:100%;border:1px solid #ccc;border-radius:4px;font-size:16px!important}.administration-type.svelte-1t6c96i.svelte-1t6c96i,.diluent-choice.svelte-1t6c96i.svelte-1t6c96i{display:flex;gap:15px;margin-bottom:15px;margin-top:15px}.administration-type.svelte-1t6c96i label.svelte-1t6c96i,.diluent-choice.svelte-1t6c96i label.svelte-1t6c96i{font-size:16px;display:flex;align-items:center;gap:5px}.diluents-container.svelte-1t6c96i.svelte-1t6c96i{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.diluent-row.svelte-1t6c96i.svelte-1t6c96i{display:flex;gap:8px;align-items:center;margin-bottom:10px}.diluent-select.svelte-1t6c96i.svelte-1t6c96i{flex:3}.diluent-dosage.svelte-1t6c96i.svelte-1t6c96i{flex:2}.btn-remove-diluent.svelte-1t6c96i.svelte-1t6c96i{background:#dc3545;color:#fff;border:none;width:24px;height:24px;border-radius:50%;font-size:16px!important;display:flex;align-items:center;justify-content:center;cursor:pointer}.btn-add-diluent.svelte-1t6c96i.svelte-1t6c96i{background:#6c757d;color:#fff;border:none;padding:4px 8px;border-radius:4px;font-size:16px!important;cursor:pointer;align-self:flex-start;margin-top:5px}.button-row.svelte-1t6c96i.svelte-1t6c96i{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}.btn-save.svelte-1t6c96i.svelte-1t6c96i,.btn-cancel.svelte-1t6c96i.svelte-1t6c96i{padding:8px 16px;border-radius:4px;cursor:pointer;border:none}.btn-save.svelte-1t6c96i.svelte-1t6c96i{background-color:#2196f3;color:#fff}.btn-save.svelte-1t6c96i.svelte-1t6c96i:disabled{opacity:.5;cursor:not-allowed}.btn-cancel.svelte-1t6c96i.svelte-1t6c96i{background-color:#f1f1f1;color:#333}.btn-add-new-scheme.svelte-651s9i{background-color:var(--btn-bg-color, #28a745);color:var(--btn-text-color, #fff);border:none;padding:12px 16px;border-radius:var(--btn-border-radius, 4px);cursor:pointer;width:100%;max-width:300px;font-weight:500;transition:background-color .2s ease,transform .1s ease;box-shadow:0 2px 4px #0000001a;margin:auto;font-size:18px}.btn-add-new-scheme.svelte-651s9i:hover{background-color:var(--btn-hover-color, #218838);transform:translateY(-1px);box-shadow:0 3px 6px #00000026}.btn-add-new-scheme.svelte-651s9i:active{transform:translateY(1px);box-shadow:0 1px 2px #0000001a}h3.svelte-l6krs5.svelte-l6krs5{font-size:21px;margin:0 0 15px;padding:0}.empty.svelte-l6krs5.svelte-l6krs5{text-align:center}.treatment-scheme-button.svelte-l6krs5.svelte-l6krs5{background-color:var(--bg-color, #007bff);color:var(--text-color, white);border:none;padding:8px 12px;border-radius:var(--border-radius, 4px);cursor:pointer;transition:opacity .2s ease}.treatment-scheme-button.svelte-l6krs5.svelte-l6krs5:hover{opacity:.9}.modal-grid.svelte-l6krs5.svelte-l6krs5{display:grid;gap:20px}.medication-form-column.svelte-l6krs5.svelte-l6krs5,.schedule-column.svelte-l6krs5.svelte-l6krs5{display:flex;flex-direction:column;gap:10px}.schedule-table.svelte-l6krs5.svelte-l6krs5{border:1px solid #ddd}.schedule-header.svelte-l6krs5.svelte-l6krs5{display:grid;grid-template-columns:400px repeat(10,1fr);background-color:#f0f0f0;text-align:center}.day-header.svelte-l6krs5.svelte-l6krs5,.medication-column.svelte-l6krs5.svelte-l6krs5{padding:5px;border-right:1px solid #ddd}.schedule-row.svelte-l6krs5.svelte-l6krs5{display:grid;grid-template-columns:400px repeat(10,1fr)}.medication-cell.svelte-l6krs5.svelte-l6krs5{display:flex;justify-content:space-between;padding:10px;border-right:1px solid #ddd;background-color:#f8f9fa}.schedule-cell.svelte-l6krs5.svelte-l6krs5{border:1px solid #ddd;cursor:pointer;transition:background-color .3s}.schedule-cell.svelte-l6krs5.svelte-l6krs5:hover{background-color:#007bff1a}.schedule-cell.selected.svelte-l6krs5.svelte-l6krs5{background-color:#007bff}.error-highlight.svelte-l6krs5 .medication-cell.svelte-l6krs5{background-color:#fff4f4;border-left:3px solid #dc3545}.validation-error.svelte-l6krs5.svelte-l6krs5{background-color:#fff3cd;color:#856404;padding:10px;margin-bottom:15px;border-radius:4px;border-left:4px solid #ffc107;font-size:14px}.medication-actions.svelte-l6krs5.svelte-l6krs5{margin-top:5px;display:flex;gap:5px}.btn-edit-medication.svelte-l6krs5.svelte-l6krs5,.btn-delete-medication.svelte-l6krs5.svelte-l6krs5{padding:2px 5px;font-size:12px;border:none;border-radius:3px;cursor:pointer;background-color:transparent}.btn-edit-medication.svelte-l6krs5.svelte-l6krs5:hover{background-color:#f0f0f0}.btn-delete-medication.svelte-l6krs5.svelte-l6krs5:hover{background-color:#fff5f5}.schedule-actions.svelte-l6krs5.svelte-l6krs5{display:flex;justify-content:space-between;margin-top:10px}.btn-continue.svelte-l6krs5.svelte-l6krs5{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:18px}.btn-continue.svelte-l6krs5.svelte-l6krs5:disabled{opacity:.5;cursor:not-allowed}.btn-add-medication.svelte-l6krs5.svelte-l6krs5{background-color:#4caf50;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:18px}.spinner.svelte-l6krs5.svelte-l6krs5{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:svelte-l6krs5-spin 1s ease-in-out infinite;margin-right:8px}@keyframes svelte-l6krs5-spin{to{transform:rotate(360deg)}}
`,document.head.appendChild(We);function Et(t){console.log("👀 SPA URL Observer запущен");let e=location.href;function l(){location.href!==e&&(e=location.href,console.log("🔁 URL изменился:",e),t())}["pushState","replaceState"].forEach(o=>{const i=history[o];history[o]=function(...n){i.apply(this,n),l()}}),window.addEventListener("popstate",l),t()}function te(){}function xt(t,e){for(const l in e)t[l]=e[l];return t}function qe(t){return t()}function Ue(){return Object.create(null)}function le(t){t.forEach(qe)}function fe(t){return typeof t=="function"}function ge(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function zt(t){return Object.keys(t).length===0}function Rt(t,e,l,o){if(t){const i=Ye(t,e,l,o);return t[0](i)}}function Ye(t,e,l,o){return t[1]&&o?xt(l.ctx.slice(),t[1](o(e))):l.ctx}function Mt(t,e,l,o){if(t[2]&&o){const i=t[2](o(l));if(e.dirty===void 0)return i;if(typeof i=="object"){const n=[],s=Math.max(e.dirty.length,i.length);for(let r=0;r<s;r+=1)n[r]=e.dirty[r]|i[r];return n}return e.dirty|i}return e.dirty}function Ot(t,e,l,o,i,n){if(i){const s=Ye(e,l,o,n);t.p(s,i)}}function Dt(t){if(t.ctx.length>32){const e=[],l=t.ctx.length/32;for(let o=0;o<l;o++)e[o]=-1;return e}return-1}function m(t,e){t.appendChild(e)}function I(t,e,l){t.insertBefore(e,l||null)}function T(t){t.parentNode&&t.parentNode.removeChild(t)}function ye(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function b(t){return document.createElement(t)}function D(t){return document.createTextNode(t)}function O(){return D(" ")}function we(){return D("")}function W(t,e,l,o){return t.addEventListener(e,l,o),()=>t.removeEventListener(e,l,o)}function je(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function v(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Ve(t){let e;return{p(...l){e=l,e.forEach(o=>t.push(o))},r(){e.forEach(l=>t.splice(t.indexOf(l),1))}}}function Ht(t){return Array.from(t.childNodes)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function xe(t,e){t.value=e??""}function y(t,e,l,o){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,o?"important":"")}function ze(t,e,l){for(let o=0;o<t.options.length;o+=1){const i=t.options[o];if(i.__value===e){i.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Ge(t){const e=t.querySelector(":checked");return e&&e.__value}function Je(t,e,l){t.classList[l?"add":"remove"](e)}let Fe;function Te(t){Fe=t}function jt(t,e){const l=t.$$.callbacks[e.type];l&&l.slice().forEach(o=>o.call(this,e))}const _e=[],Ke=[];let be=[];const Qe=[],Ft=Promise.resolve();let Pe=!1;function Pt(){Pe||(Pe=!0,Ft.then(Xe))}function Se(t){be.push(t)}const Le=new Set;let ve=0;function Xe(){if(ve!==0)return;const t=Fe;do{try{for(;ve<_e.length;){const e=_e[ve];ve++,Te(e),Lt(e.$$)}}catch(e){throw _e.length=0,ve=0,e}for(Te(null),_e.length=0,ve=0;Ke.length;)Ke.pop()();for(let e=0;e<be.length;e+=1){const l=be[e];Le.has(l)||(Le.add(l),l())}be.length=0}while(_e.length);for(;Qe.length;)Qe.pop()();Pe=!1,Le.clear(),Te(t)}function Lt(t){if(t.fragment!==null){t.update(),le(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Se)}}function Nt(t){const e=[],l=[];be.forEach(o=>t.indexOf(o)===-1?e.push(o):l.push(o)),l.forEach(o=>o()),be=e}const Re=new Set;let de;function Me(){de={r:0,c:[],p:de}}function Oe(){de.r||le(de.c),de=de.p}function V(t,e){t&&t.i&&(Re.delete(t),t.i(e))}function Z(t,e,l,o){if(t&&t.o){if(Re.has(t))return;Re.add(t),de.c.push(()=>{Re.delete(t),o&&(l&&t.d(1),o())}),t.o(e)}else o&&o()}function Ze(t,e){t.d(1),e.delete(t.key)}function At(t,e){Z(t,1,1,()=>{e.delete(t.key)})}function Ne(t,e,l,o,i,n,s,r,c,a,f,u){let h=t.length,g=n.length,p=h;const _={};for(;p--;)_[t[p].key]=p;const w=[],R=new Map,S=new Map,B=[];for(p=g;p--;){const C=u(i,n,p),M=l(C);let k=s.get(M);k?o&&B.push(()=>k.p(C,e)):(k=a(M,C),k.c()),R.set(M,w[p]=k),M in _&&S.set(M,Math.abs(p-_[M]))}const G=new Set,L=new Set;function j(C){V(C,1),C.m(r,f),s.set(C.key,C),f=C.first,g--}for(;h&&g;){const C=w[g-1],M=t[h-1],k=C.key,F=M.key;C===M?(f=C.first,h--,g--):R.has(F)?!s.has(k)||G.has(k)?j(C):L.has(F)?h--:S.get(k)>S.get(F)?(L.add(k),j(C)):(G.add(F),h--):(c(M,s),h--)}for(;h--;){const C=t[h];R.has(C.key)||c(C,s)}for(;g;)j(w[g-1]);return le(B),w}function ke(t){t&&t.c()}function me(t,e,l,o){const{fragment:i,after_update:n}=t.$$;i&&i.m(e,l),o||Se(()=>{const s=t.$$.on_mount.map(qe).filter(fe);t.$$.on_destroy?t.$$.on_destroy.push(...s):le(s),t.$$.on_mount=[]}),n.forEach(Se)}function he(t,e){const l=t.$$;l.fragment!==null&&(Nt(l.after_update),le(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function Wt(t,e){t.$$.dirty[0]===-1&&(_e.push(t),Pt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,l,o,i,n,s,r=[-1]){const c=Fe;Te(t);const a=t.$$={fragment:null,ctx:[],props:n,update:te,not_equal:i,bound:Ue(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Ue(),dirty:r,skip_bound:!1,root:e.target||c.$$.root};s&&s(a.root);let f=!1;if(a.ctx=l?l(t,e.props||{},(u,h,...g)=>{const p=g.length?g[0]:h;return a.ctx&&i(a.ctx[u],a.ctx[u]=p)&&(!a.skip_bound&&a.bound[u]&&a.bound[u](p),f&&Wt(t,u)),h}):[],a.update(),f=!0,le(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){const u=Ht(e.target);a.fragment&&a.fragment.l(u),u.forEach(T)}else a.fragment&&a.fragment.c();e.intro&&V(t.$$.fragment),me(t,e.target,e.anchor,e.customElement),Xe()}Te(c)}class pe{$destroy(){he(this,1),this.$destroy=te}$on(e,l){if(!fe(l))return te;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(l),()=>{const i=o.indexOf(l);i!==-1&&o.splice(i,1)}}$set(e){this.$$set&&!zt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const zl="";function $e(t,e,l){const o=t.slice();return o[12]=e[l],o}function et(t){let e,l,o=t[12].diluents.map(lt).join(", ")+"",i;return{c(){e=b("span"),l=D("+ "),i=D(o),v(e,"class","diluent-info svelte-6vrfgr")},m(n,s){I(n,e,s),m(e,l),m(e,i)},p(n,s){s&1&&o!==(o=n[12].diluents.map(lt).join(", ")+"")&&$(i,o)},d(n){n&&T(e)}}}function tt(t){let e,l=t[12].name+"",o,i,n=t[12].dosage+"",s,r,c=t[12].administrationType+"",a,f,u,h=t[12].diluents&&t[12].diluents.length>0&&et(t);return{c(){e=b("div"),o=D(l),i=D(", "),s=D(n),r=D(" ("),a=D(c),f=D(`)\r
        `),h&&h.c(),u=O(),v(e,"class","medication-details svelte-6vrfgr")},m(g,p){I(g,e,p),m(e,o),m(e,i),m(e,s),m(e,r),m(e,a),m(e,f),h&&h.m(e,null),m(e,u)},p(g,p){p&1&&l!==(l=g[12].name+"")&&$(o,l),p&1&&n!==(n=g[12].dosage+"")&&$(s,n),p&1&&c!==(c=g[12].administrationType+"")&&$(a,c),g[12].diluents&&g[12].diluents.length>0?h?h.p(g,p):(h=et(g),h.c(),h.m(e,u)):h&&(h.d(1),h=null)},d(g){g&&T(e),h&&h.d()}}}function qt(t){let e,l,o,i=t[0].name+"",n,s,r,c,a,f,u,h,g,p=t[0].medications,_=[];for(let w=0;w<p.length;w+=1)_[w]=tt($e(t,p,w));return{c(){e=b("div"),l=b("div"),o=b("strong"),n=D(i),s=O();for(let w=0;w<_.length;w+=1)_[w].c();r=O(),c=b("div"),a=b("button"),a.textContent="Использовать",f=O(),u=b("button"),u.textContent="Редактировать",v(l,"class","scheme-title svelte-6vrfgr"),v(a,"class","btn-use-scheme svelte-6vrfgr"),v(u,"class","btn-edit-scheme svelte-6vrfgr"),v(c,"class","scheme-actions svelte-6vrfgr"),v(e,"class","scheme-item svelte-6vrfgr"),y(e,"--item-bg-color",t[3]),y(e,"--item-hover-color",t[4]),y(e,"--item-border-color",t[5]),y(e,"--title-color",t[6]),y(e,"--details-color",t[7]),y(e,"--use-btn-bg",t[8]),y(e,"--use-btn-text",t[9]),y(e,"--edit-btn-bg",t[10]),y(e,"--edit-btn-text",t[11])},m(w,R){I(w,e,R),m(e,l),m(l,o),m(o,n),m(l,s);for(let S=0;S<_.length;S+=1)_[S]&&_[S].m(l,null);m(e,r),m(e,c),m(c,a),m(c,f),m(c,u),h||(g=[W(a,"click",je(function(){fe(t[1])&&t[1].apply(this,arguments)})),W(u,"click",je(function(){fe(t[2])&&t[2].apply(this,arguments)}))],h=!0)},p(w,[R]){if(t=w,R&1&&i!==(i=t[0].name+"")&&$(n,i),R&1){p=t[0].medications;let S;for(S=0;S<p.length;S+=1){const B=$e(t,p,S);_[S]?_[S].p(B,R):(_[S]=tt(B),_[S].c(),_[S].m(l,null))}for(;S<_.length;S+=1)_[S].d(1);_.length=p.length}R&8&&y(e,"--item-bg-color",t[3]),R&16&&y(e,"--item-hover-color",t[4]),R&32&&y(e,"--item-border-color",t[5]),R&64&&y(e,"--title-color",t[6]),R&128&&y(e,"--details-color",t[7]),R&256&&y(e,"--use-btn-bg",t[8]),R&512&&y(e,"--use-btn-text",t[9]),R&1024&&y(e,"--edit-btn-bg",t[10]),R&2048&&y(e,"--edit-btn-text",t[11])},i:te,o:te,d(w){w&&T(e),ye(_,w),h=!1,le(g)}}}const lt=t=>`${t.type} (${t.dosage})`;function Ut(t,e,l){let{scheme:o={}}=e,{onSelect:i}=e,{onEdit:n}=e,{itemBgColor:s="#f8f9fa"}=e,{itemHoverColor:r="#e9ecef"}=e,{itemBorderColor:c="#e9ecef"}=e,{titleColor:a="#333"}=e,{detailsColor:f="#6c757d"}=e,{useButtonBgColor:u="#007bff"}=e,{useButtonTextColor:h="#fff"}=e,{editButtonBgColor:g="#6c757d"}=e,{editButtonTextColor:p="#fff"}=e;return t.$$set=_=>{"scheme"in _&&l(0,o=_.scheme),"onSelect"in _&&l(1,i=_.onSelect),"onEdit"in _&&l(2,n=_.onEdit),"itemBgColor"in _&&l(3,s=_.itemBgColor),"itemHoverColor"in _&&l(4,r=_.itemHoverColor),"itemBorderColor"in _&&l(5,c=_.itemBorderColor),"titleColor"in _&&l(6,a=_.titleColor),"detailsColor"in _&&l(7,f=_.detailsColor),"useButtonBgColor"in _&&l(8,u=_.useButtonBgColor),"useButtonTextColor"in _&&l(9,h=_.useButtonTextColor),"editButtonBgColor"in _&&l(10,g=_.editButtonBgColor),"editButtonTextColor"in _&&l(11,p=_.editButtonTextColor)},[o,i,n,s,r,c,a,f,u,h,g,p]}class Yt extends pe{constructor(e){super(),Ce(this,e,Ut,qt,ge,{scheme:0,onSelect:1,onEdit:2,itemBgColor:3,itemHoverColor:4,itemBorderColor:5,titleColor:6,detailsColor:7,useButtonBgColor:8,useButtonTextColor:9,editButtonBgColor:10,editButtonTextColor:11})}}const Rl="";function ot(t,e,l){const o=t.slice();return o[8]=e[l],o}function Vt(t){let e;return{c(){e=b("p"),e.textContent="Нет существующих схем",v(e,"class","no-schemes svelte-5qbczz")},m(l,o){I(l,e,o)},p:te,i:te,o:te,d(l){l&&T(e)}}}function Gt(t){let e,l=[],o=new Map,i,n=t[0];const s=r=>r[8].id;for(let r=0;r<n.length;r+=1){let c=ot(t,n,r),a=s(c);o.set(a,l[r]=nt(a,c))}return{c(){e=b("div");for(let r=0;r<l.length;r+=1)l[r].c();v(e,"class","schemes-list svelte-5qbczz")},m(r,c){I(r,e,c);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null);i=!0},p(r,c){c&7&&(n=r[0],Me(),l=Ne(l,c,s,1,r,n,o,e,At,nt,null,ot),Oe())},i(r){if(!i){for(let c=0;c<n.length;c+=1)V(l[c]);i=!0}},o(r){for(let c=0;c<l.length;c+=1)Z(l[c]);i=!1},d(r){r&&T(e);for(let c=0;c<l.length;c+=1)l[c].d()}}}function nt(t,e){let l,o,i;function n(){return e[6](e[8])}function s(){return e[7](e[8])}return o=new Yt({props:{scheme:e[8],onSelect:n,onEdit:s}}),{key:t,first:null,c(){l=we(),ke(o.$$.fragment),this.first=l},m(r,c){I(r,l,c),me(o,r,c),i=!0},p(r,c){e=r;const a={};c&1&&(a.scheme=e[8]),c&3&&(a.onSelect=n),c&5&&(a.onEdit=s),o.$set(a)},i(r){i||(V(o.$$.fragment,r),i=!0)},o(r){Z(o.$$.fragment,r),i=!1},d(r){r&&T(l),he(o,r)}}}function Jt(t){let e,l,o,i,n,s;const r=[Gt,Vt],c=[];function a(f,u){return f[0].length?0:1}return i=a(t),n=c[i]=r[i](t),{c(){e=b("div"),l=b("h2"),l.textContent="Существующие схемы лечения",o=O(),n.c(),v(l,"class","svelte-5qbczz"),v(e,"class","existing-schemes svelte-5qbczz"),y(e,"--bg-color",t[3]),y(e,"--title-color",t[4]),y(e,"--border-color",t[5])},m(f,u){I(f,e,u),m(e,l),m(e,o),c[i].m(e,null),s=!0},p(f,[u]){let h=i;i=a(f),i===h?c[i].p(f,u):(Me(),Z(c[h],1,1,()=>{c[h]=null}),Oe(),n=c[i],n?n.p(f,u):(n=c[i]=r[i](f),n.c()),V(n,1),n.m(e,null)),(!s||u&8)&&y(e,"--bg-color",f[3]),(!s||u&16)&&y(e,"--title-color",f[4]),(!s||u&32)&&y(e,"--border-color",f[5])},i(f){s||(V(n),s=!0)},o(f){Z(n),s=!1},d(f){f&&T(e),c[i].d()}}}function Kt(t,e,l){let{schemes:o=[]}=e,{onSelect:i}=e,{onEdit:n}=e,{bgColor:s="#f8f9fa"}=e,{titleColor:r="#333"}=e,{borderColor:c="#e9ecef"}=e;const a=u=>i(u),f=u=>n(u);return t.$$set=u=>{"schemes"in u&&l(0,o=u.schemes),"onSelect"in u&&l(1,i=u.onSelect),"onEdit"in u&&l(2,n=u.onEdit),"bgColor"in u&&l(3,s=u.bgColor),"titleColor"in u&&l(4,r=u.titleColor),"borderColor"in u&&l(5,c=u.borderColor)},[o,i,n,s,r,c,a,f]}class Qt extends pe{constructor(e){super(),Ce(this,e,Kt,Jt,ge,{schemes:0,onSelect:1,onEdit:2,bgColor:3,titleColor:4,borderColor:5})}}const Ml="";function it(t){let e,l,o,i,n,s,r;const c=t[14].default,a=Rt(c,t,t[13],null);return{c(){e=b("div"),l=b("div"),o=b("button"),o.textContent="✖",i=O(),a&&a.c(),v(o,"class","modal-close svelte-1lbmm4i"),v(l,"class","modal-content svelte-1lbmm4i"),y(l,"--max-width",t[2]),y(l,"--max-height",t[3]),y(l,"--bg-color",t[4]),y(l,"--border-radius",t[5]),y(l,"--padding",t[6]),y(l,"--box-shadow",t[7]),v(e,"class","modal-overlay svelte-1lbmm4i"),y(e,"--overlay-color",t[9]),y(e,"--z-index",t[8])},m(f,u){I(f,e,u),m(e,l),m(l,o),m(l,i),a&&a.m(l,null),n=!0,s||(r=[W(o,"click",function(){fe(t[1])&&t[1].apply(this,arguments)}),W(l,"click",je(t[15])),W(e,"mousedown",t[10])],s=!0)},p(f,u){t=f,a&&a.p&&(!n||u&8192)&&Ot(a,c,t,t[13],n?Mt(c,t[13],u,null):Dt(t[13]),null),(!n||u&4)&&y(l,"--max-width",t[2]),(!n||u&8)&&y(l,"--max-height",t[3]),(!n||u&16)&&y(l,"--bg-color",t[4]),(!n||u&32)&&y(l,"--border-radius",t[5]),(!n||u&64)&&y(l,"--padding",t[6]),(!n||u&128)&&y(l,"--box-shadow",t[7]),(!n||u&512)&&y(e,"--overlay-color",t[9]),(!n||u&256)&&y(e,"--z-index",t[8])},i(f){n||(V(a,f),n=!0)},o(f){Z(a,f),n=!1},d(f){f&&T(e),a&&a.d(f),s=!1,le(r)}}}function Xt(t){let e,l,o=t[0]&&it(t);return{c(){o&&o.c(),e=we()},m(i,n){o&&o.m(i,n),I(i,e,n),l=!0},p(i,[n]){i[0]?o?(o.p(i,n),n&1&&V(o,1)):(o=it(i),o.c(),V(o,1),o.m(e.parentNode,e)):o&&(Me(),Z(o,1,1,()=>{o=null}),Oe())},i(i){l||(V(o),l=!0)},o(i){Z(o),l=!1},d(i){o&&o.d(i),i&&T(e)}}}function Zt(t,e,l){let{$$slots:o={},$$scope:i}=e,{isOpen:n=!1}=e,{onClose:s}=e,{maxWidth:r="1100px"}=e,{maxHeight:c="80%"}=e,{backgroundColor:a="white"}=e,{borderRadius:f="8px"}=e,{padding:u="20px"}=e,{boxShadow:h="0 4px 6px rgba(0,0,0,0.1)"}=e,{zIndex:g=1e3}=e,{overlay:p=!0}=e,{overlayColor:_="rgba(0,0,0,0.5)"}=e,{top:w=0}=e;function R(B){p&&B.target.classList.contains("modal-overlay")&&s()}function S(B){jt.call(this,t,B)}return t.$$set=B=>{"isOpen"in B&&l(0,n=B.isOpen),"onClose"in B&&l(1,s=B.onClose),"maxWidth"in B&&l(2,r=B.maxWidth),"maxHeight"in B&&l(3,c=B.maxHeight),"backgroundColor"in B&&l(4,a=B.backgroundColor),"borderRadius"in B&&l(5,f=B.borderRadius),"padding"in B&&l(6,u=B.padding),"boxShadow"in B&&l(7,h=B.boxShadow),"zIndex"in B&&l(8,g=B.zIndex),"overlay"in B&&l(11,p=B.overlay),"overlayColor"in B&&l(9,_=B.overlayColor),"top"in B&&l(12,w=B.top),"$$scope"in B&&l(13,i=B.$$scope)},[n,s,r,c,a,f,u,h,g,_,R,p,w,i,o,S]}class rt extends pe{constructor(e){super(),Ce(this,e,Zt,Xt,ge,{isOpen:0,onClose:1,maxWidth:2,maxHeight:3,backgroundColor:4,borderRadius:5,padding:6,boxShadow:7,zIndex:8,overlay:11,overlayColor:9,top:12})}}const Ol="";function st(t,e,l){const o=t.slice();return o[20]=e[l],o[21]=e,o[22]=l,o}function ct(t,e,l){const o=t.slice();return o[23]=e[l],o}function ut(t){let e,l=t[23].name+"",o,i;return{c(){e=b("option"),o=D(l),e.__value=i=t[23],e.value=e.__value},m(n,s){I(n,e,s),m(e,o)},p(n,s){s&8&&l!==(l=n[23].name+"")&&$(o,l),s&8&&i!==(i=n[23])&&(e.__value=i,e.value=e.__value)},d(n){n&&T(e)}}}function at(t){let e,l=[],o=new Map,i,n,s,r,c=t[0].diluents;const a=f=>f[20].id;for(let f=0;f<c.length;f+=1){let u=st(t,c,f),h=a(u);o.set(h,l[f]=ft(h,u))}return{c(){e=b("div");for(let f=0;f<l.length;f+=1)l[f].c();i=O(),n=b("button"),n.textContent="+ Добавить растворитель",v(n,"class","btn-add-diluent svelte-1t6c96i"),v(e,"class","diluents-container svelte-1t6c96i")},m(f,u){I(f,e,u);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(e,null);m(e,i),m(e,n),s||(r=W(n,"click",t[6]),s=!0)},p(f,u){u&129&&(c=f[0].diluents,l=Ne(l,u,a,1,f,c,o,e,Ze,ft,i,st))},d(f){f&&T(e);for(let u=0;u<l.length;u+=1)l[u].d();s=!1,r()}}}function ft(t,e){let l,o,i,n,s,r,c,a,f,u;function h(){e[17].call(o,e[21],e[22])}function g(){e[18].call(r,e[21],e[22])}function p(){return e[19](e[20])}return{key:t,first:null,c(){l=b("div"),o=b("select"),i=b("option"),i.textContent="Глюкоза",n=b("option"),n.textContent="Физраствор",s=O(),r=b("input"),c=O(),a=b("button"),a.textContent="✖",i.__value="глюкоза",i.value=i.__value,n.__value="физраствор",n.value=n.__value,v(o,"class","form-control-ex diluent-select svelte-1t6c96i"),e[20].type===void 0&&Se(h),v(r,"type","text"),v(r,"placeholder","Дозировка"),v(r,"class","form-control-ex diluent-dosage svelte-1t6c96i"),v(a,"class","btn-remove-diluent svelte-1t6c96i"),v(l,"class","diluent-row svelte-1t6c96i"),this.first=l},m(_,w){I(_,l,w),m(l,o),m(o,i),m(o,n),ze(o,e[20].type,!0),m(l,s),m(l,r),xe(r,e[20].dosage),m(l,c),m(l,a),f||(u=[W(o,"change",h),W(r,"input",g),W(a,"click",p)],f=!0)},p(_,w){e=_,w&9&&ze(o,e[20].type),w&9&&r.value!==e[20].dosage&&xe(r,e[20].dosage)},d(_){_&&T(l),f=!1,le(u)}}}function $t(t){let e,l=t[4]?"Редактирование препарата":"Добавление препарата",o,i,n,s,r,c,a,f,u,h,g,p,_,w,R,S,B,G,L,j,C,M,k,F,oe,se,q,N,U,A,J,ce=t[4]?"Сохранить изменения":"Добавить препарат",ae,ne,re,K,H,Be,ue=t[3],Q=[];for(let x=0;x<ue.length;x+=1)Q[x]=ut(ct(t,ue,x));let X=t[0].hasDiluent==="да"&&at(t);return re=Ve(t[12][0]),K=Ve(t[12][1]),{c(){e=b("h3"),o=D(l),i=O(),n=b("select");for(let x=0;x<Q.length;x+=1)Q[x].c();s=O(),r=b("div"),c=b("label"),a=b("input"),f=D(` \r
            Внутримышечно`),u=O(),h=b("label"),g=b("input"),p=D(` \r
            Внутривенно`),_=O(),w=b("input"),R=O(),S=b("div"),B=b("label"),B.textContent="Использовать растворитель:",G=O(),L=b("label"),j=b("input"),C=D(` \r
            Нет`),M=O(),k=b("label"),F=b("input"),oe=D(` \r
            Да`),se=O(),X&&X.c(),q=O(),N=b("div"),U=b("button"),U.textContent="Отмена",A=O(),J=b("button"),ae=D(ce),v(e,"class","svelte-1t6c96i"),v(n,"class","form-control-ex svelte-1t6c96i"),t[0].medication===void 0&&Se(()=>t[10].call(n)),v(a,"type","radio"),a.__value="в/м",a.value=a.__value,v(c,"class","svelte-1t6c96i"),v(g,"type","radio"),g.__value="в/в",g.value=g.__value,v(h,"class","svelte-1t6c96i"),v(r,"class","administration-type svelte-1t6c96i"),v(w,"type","text"),v(w,"placeholder","Дозировка препарата"),v(w,"class","form-control-ex svelte-1t6c96i"),v(B,"class","svelte-1t6c96i"),v(j,"type","radio"),j.__value="нет",j.value=j.__value,v(L,"class","svelte-1t6c96i"),v(F,"type","radio"),F.__value="да",F.value=F.__value,v(k,"class","svelte-1t6c96i"),v(S,"class","diluent-choice svelte-1t6c96i"),v(U,"class","btn-cancel svelte-1t6c96i"),v(J,"class","btn-save svelte-1t6c96i"),J.disabled=ne=!t[5],v(N,"class","button-row svelte-1t6c96i"),re.p(j,F),K.p(a,g)},m(x,P){I(x,e,P),m(e,o),I(x,i,P),I(x,n,P);for(let Y=0;Y<Q.length;Y+=1)Q[Y]&&Q[Y].m(n,null);ze(n,t[0].medication,!0),I(x,s,P),I(x,r,P),m(r,c),m(c,a),a.checked=a.__value===t[0].administrationType,m(c,f),m(r,u),m(r,h),m(h,g),g.checked=g.__value===t[0].administrationType,m(h,p),I(x,_,P),I(x,w,P),xe(w,t[0].dosage),I(x,R,P),I(x,S,P),m(S,B),m(S,G),m(S,L),m(L,j),j.checked=j.__value===t[0].hasDiluent,m(L,C),m(S,M),m(S,k),m(k,F),F.checked=F.__value===t[0].hasDiluent,m(k,oe),I(x,se,P),X&&X.m(x,P),I(x,q,P),I(x,N,P),m(N,U),m(N,A),m(N,J),m(J,ae),H||(Be=[W(n,"change",t[10]),W(a,"change",t[11]),W(g,"change",t[13]),W(w,"input",t[14]),W(j,"change",t[15]),W(F,"change",t[16]),W(U,"click",function(){fe(t[2])&&t[2].apply(this,arguments)}),W(J,"click",t[8])],H=!0)},p(x,P){if(t=x,P&16&&l!==(l=t[4]?"Редактирование препарата":"Добавление препарата")&&$(o,l),P&8){ue=t[3];let Y;for(Y=0;Y<ue.length;Y+=1){const He=ct(t,ue,Y);Q[Y]?Q[Y].p(He,P):(Q[Y]=ut(He),Q[Y].c(),Q[Y].m(n,null))}for(;Y<Q.length;Y+=1)Q[Y].d(1);Q.length=ue.length}P&9&&ze(n,t[0].medication),P&9&&(a.checked=a.__value===t[0].administrationType),P&9&&(g.checked=g.__value===t[0].administrationType),P&9&&w.value!==t[0].dosage&&xe(w,t[0].dosage),P&9&&(j.checked=j.__value===t[0].hasDiluent),P&9&&(F.checked=F.__value===t[0].hasDiluent),t[0].hasDiluent==="да"?X?X.p(t,P):(X=at(t),X.c(),X.m(q.parentNode,q)):X&&(X.d(1),X=null),P&16&&ce!==(ce=t[4]?"Сохранить изменения":"Добавить препарат")&&$(ae,ce),P&32&&ne!==(ne=!t[5])&&(J.disabled=ne)},d(x){x&&T(e),x&&T(i),x&&T(n),ye(Q,x),x&&T(s),x&&T(r),x&&T(_),x&&T(w),x&&T(R),x&&T(S),x&&T(se),X&&X.d(x),x&&T(q),x&&T(N),re.r(),K.r(),H=!1,le(Be)}}}function el(t){let e,l;return e=new rt({props:{isOpen:t[1],onClose:t[2],maxWidth:"500px",$$slots:{default:[$t]},$$scope:{ctx:t}}}),{c(){ke(e.$$.fragment)},m(o,i){me(e,o,i),l=!0},p(o,[i]){const n={};i&2&&(n.isOpen=o[1]),i&4&&(n.onClose=o[2]),i&67108925&&(n.$$scope={dirty:i,ctx:o}),e.$set(n)},i(o){l||(V(e.$$.fragment,o),l=!0)},o(o){Z(e.$$.fragment,o),l=!1},d(o){he(e,o)}}}function tl(t,e,l){let o,{isOpen:i=!1}=e,{onClose:n}=e,{medications:s=[]}=e,{medicationForm:r}=e,{isEditing:c=!1}=e,{onSave:a}=e;function f(){l(0,r.diluents=[...r.diluents,{id:Date.now(),type:"глюкоза",dosage:""}],r)}function u(C){l(0,r.diluents=r.diluents.filter(M=>M.id!==C),r)}function h(){if(o){const C={...r,diluents:r.diluents.map(M=>({...M}))};a(C)}}const g=[[],[]];function p(){r.medication=Ge(this),l(0,r),l(3,s)}function _(){r.administrationType=this.__value,l(0,r),l(3,s)}function w(){r.administrationType=this.__value,l(0,r),l(3,s)}function R(){r.dosage=this.value,l(0,r),l(3,s)}function S(){r.hasDiluent=this.__value,l(0,r),l(3,s)}function B(){r.hasDiluent=this.__value,l(0,r),l(3,s)}function G(C,M){C[M].type=Ge(this),l(0,r),l(3,s)}function L(C,M){C[M].dosage=this.value,l(0,r),l(3,s)}const j=C=>u(C.id);return t.$$set=C=>{"isOpen"in C&&l(1,i=C.isOpen),"onClose"in C&&l(2,n=C.onClose),"medications"in C&&l(3,s=C.medications),"medicationForm"in C&&l(0,r=C.medicationForm),"isEditing"in C&&l(4,c=C.isEditing),"onSave"in C&&l(9,a=C.onSave)},t.$$.update=()=>{t.$$.dirty&1&&l(5,o=!!(r.medication&&r.administrationType&&r.dosage&&(r.hasDiluent==="нет"||r.hasDiluent==="да"&&r.diluents.length>0&&r.diluents.every(C=>C.type&&C.dosage))))},[r,i,n,s,c,o,f,u,h,a,p,_,g,w,R,S,B,G,L,j]}class ll extends pe{constructor(e){super(),Ce(this,e,tl,el,ge,{isOpen:1,onClose:2,medications:3,medicationForm:0,isEditing:4,onSave:9})}}const Dl="";function ol(t){let e,l,o,i;return{c(){e=b("button"),l=D("+ Создать новую схему"),v(e,"class","btn-add-new-scheme svelte-651s9i"),y(e,"--btn-bg-color",t[1]),y(e,"--btn-text-color",t[2]),y(e,"--btn-hover-color",t[3]),y(e,"--btn-border-radius",t[4])},m(n,s){I(n,e,s),m(e,l),o||(i=W(e,"click",function(){fe(t[0])&&t[0].apply(this,arguments)}),o=!0)},p(n,[s]){t=n,s&2&&y(e,"--btn-bg-color",t[1]),s&4&&y(e,"--btn-text-color",t[2]),s&8&&y(e,"--btn-hover-color",t[3]),s&16&&y(e,"--btn-border-radius",t[4])},i:te,o:te,d(n){n&&T(e),o=!1,i()}}}function nl(t,e,l){let{onClick:o}=e,{buttonBgColor:i="#28a745"}=e,{buttonTextColor:n="#fff"}=e,{buttonHoverColor:s="#218838"}=e,{buttonBorderRadius:r="4px"}=e;return t.$$set=c=>{"onClick"in c&&l(0,o=c.onClick),"buttonBgColor"in c&&l(1,i=c.buttonBgColor),"buttonTextColor"in c&&l(2,n=c.buttonTextColor),"buttonHoverColor"in c&&l(3,s=c.buttonHoverColor),"buttonBorderRadius"in c&&l(4,r=c.buttonBorderRadius)},[o,i,n,s,r]}class il extends pe{constructor(e){super(),Ce(this,e,nl,ol,ge,{onClick:0,buttonBgColor:1,buttonTextColor:2,buttonHoverColor:3,buttonBorderRadius:4})}}const Hl="";function dt(t,e,l){const o=t.slice();return o[54]=e[l],o}function mt(t,e,l){const o=t.slice();return o[57]=e[l],o}function ht(t,e,l){const o=t.slice();return o[60]=e[l],o}function rl(t,e,l){const o=t.slice();return o[57]=e[l],o}function gt(t){let e,l,o,i;return e=new Qt({props:{schemes:t[23],onSelect:t[32],onEdit:t[34],bgColor:t[4],titleColor:t[5],borderColor:t[6]}}),o=new il({props:{onClick:t[33],buttonBgColor:t[7],buttonTextColor:t[8],buttonHoverColor:t[9],buttonBorderRadius:t[10]}}),{c(){ke(e.$$.fragment),l=O(),ke(o.$$.fragment)},m(n,s){me(e,n,s),I(n,l,s),me(o,n,s),i=!0},p(n,s){const r={};s[0]&8388608&&(r.schemes=n[23]),s[0]&16&&(r.bgColor=n[4]),s[0]&32&&(r.titleColor=n[5]),s[0]&64&&(r.borderColor=n[6]),e.$set(r);const c={};s[0]&128&&(c.buttonBgColor=n[7]),s[0]&256&&(c.buttonTextColor=n[8]),s[0]&512&&(c.buttonHoverColor=n[9]),s[0]&1024&&(c.buttonBorderRadius=n[10]),o.$set(c)},i(n){i||(V(e.$$.fragment,n),V(o.$$.fragment,n),i=!0)},o(n){Z(e.$$.fragment,n),Z(o.$$.fragment,n),i=!1},d(n){he(e,n),n&&T(l),he(o,n)}}}function _t(t){let e,l,o,i,n,s,r,c,a,f,u,h,g,p,_,w,R=[1,2,3,4,5,6,7,8,9,10],S=[];for(let k=0;k<10;k+=1)S[k]=sl(rl(t,R,k));function B(k,F){return k[14].length>0?ul:cl}let G=B(t),L=G(t);function j(k,F){return k[19]?fl:al}let C=j(t),M=C(t);return{c(){e=b("div"),l=b("h3"),l.textContent="Создание новой схемы лечения",o=O(),i=b("div"),n=b("div"),s=b("div"),s.textContent="Препарат",r=O();for(let k=0;k<10;k+=1)S[k].c();c=O(),L.c(),a=O(),f=b("div"),u=b("button"),u.textContent="+ Добавить препарат",h=O(),g=b("button"),M.c(),v(l,"class","svelte-l6krs5"),v(s,"class","medication-column svelte-l6krs5"),v(n,"class","schedule-header svelte-l6krs5"),v(i,"class","schedule-table svelte-l6krs5"),v(u,"class","btn-add-medication svelte-l6krs5"),v(g,"class","btn-continue svelte-l6krs5"),g.disabled=p=t[14].length===0||t[19]||!t[24],v(f,"class","schedule-actions svelte-l6krs5"),v(e,"class","schedule-column svelte-l6krs5")},m(k,F){I(k,e,F),m(e,l),m(e,o),m(e,i),m(i,n),m(n,s),m(n,r);for(let oe=0;oe<10;oe+=1)S[oe]&&S[oe].m(n,null);m(i,c),L.m(i,null),m(e,a),m(e,f),m(f,u),m(f,h),m(f,g),M.m(g,null),_||(w=[W(u,"click",t[27]),W(g,"click",t[35])],_=!0)},p(k,F){G===(G=B(k))&&L?L.p(k,F):(L.d(1),L=G(k),L&&(L.c(),L.m(i,null))),C!==(C=j(k))&&(M.d(1),M=C(k),M&&(M.c(),M.m(g,null))),F[0]&17317888&&p!==(p=k[14].length===0||k[19]||!k[24])&&(g.disabled=p)},d(k){k&&T(e),ye(S,k),L.d(),M.d(),_=!1,le(w)}}}function sl(t){let e,l;return{c(){e=b("div"),l=D(t[57]),v(e,"class","day-header svelte-l6krs5")},m(o,i){I(o,e,i),m(e,l)},p:te,d(o){o&&T(e)}}}function cl(t){let e;return{c(){e=b("p"),e.textContent="Пока назначений нет",v(e,"class","empty svelte-l6krs5")},m(l,o){I(l,e,o)},p:te,d(l){l&&T(e)}}}function ul(t){let e=[],l=new Map,o,i=t[14];const n=s=>s[54].id;for(let s=0;s<i.length;s+=1){let r=dt(t,i,s),c=n(r);l.set(c,e[s]=Ct(c,r))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();o=we()},m(s,r){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(s,r);I(s,o,r)},p(s,r){r[0]&805355520|r[1]&1&&(i=s[14],e=Ne(e,r,n,1,s,i,l,o.parentNode,Ze,Ct,o,dt))},d(s){for(let r=0;r<e.length;r+=1)e[r].d(s);s&&T(o)}}}function bt(t){let e,l=t[54].diluents,o=[];for(let i=0;i<l.length;i+=1)o[i]=vt(ht(t,l,i));return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=we()},m(i,n){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(i,n);I(i,e,n)},p(i,n){if(n[0]&16384){l=i[54].diluents;let s;for(s=0;s<l.length;s+=1){const r=ht(i,l,s);o[s]?o[s].p(r,n):(o[s]=vt(r),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=l.length}},d(i){ye(o,i),i&&T(e)}}}function vt(t){let e,l=t[60].type+"",o,i,n=t[60].dosage+"",s,r;return{c(){e=D("+ "),o=D(l),i=D(" ("),s=D(n),r=D(")")},m(c,a){I(c,e,a),I(c,o,a),I(c,i,a),I(c,s,a),I(c,r,a)},p(c,a){a[0]&16384&&l!==(l=c[60].type+"")&&$(o,l),a[0]&16384&&n!==(n=c[60].dosage+"")&&$(s,n)},d(c){c&&T(e),c&&T(o),c&&T(i),c&&T(s),c&&T(r)}}}function kt(t){let e,l,o;function i(){return t[50](t[54],t[57])}return{c(){e=b("div"),v(e,"class","schedule-cell svelte-l6krs5"),Je(e,"selected",t[15][t[54].id]&&t[15][t[54].id][1]&&t[15][t[54].id][1].has(t[57]))},m(n,s){I(n,e,s),l||(o=W(e,"click",i),l=!0)},p(n,s){t=n,s[0]&49152&&Je(e,"selected",t[15][t[54].id]&&t[15][t[54].id][1]&&t[15][t[54].id][1].has(t[57]))},d(n){n&&T(e),l=!1,o()}}}function Ct(t,e){let l,o,i,n,s=e[54].medication.name+"",r,c,a=e[54].administrationType+"",f,u,h=e[54].dosage+"",g,p,_,w,R,S,B,G,L,j,C,M,k=e[54].hasDiluent==="да"&&e[54].diluents&&e[54].diluents.length>0&&bt(e);function F(){return e[48](e[54])}function oe(){return e[49](e[54])}let se=[1,2,3,4,5,6,7,8,9,10],q=[];for(let N=0;N<10;N+=1)q[N]=kt(mt(e,se,N));return{key:t,first:null,c(){l=b("div"),o=b("div"),i=b("div"),n=b("strong"),r=D(s),c=O(),f=D(a),u=D(", "),g=D(h),p=O(),k&&k.c(),_=O(),w=b("div"),R=b("button"),R.textContent="✏️",S=O(),B=b("button"),B.textContent="🗑️",G=O();for(let N=0;N<10;N+=1)q[N].c();L=O(),v(i,"class","medication-title"),v(R,"class","btn-edit-medication svelte-l6krs5"),v(B,"class","btn-delete-medication svelte-l6krs5"),v(w,"class","medication-actions svelte-l6krs5"),v(o,"class","medication-cell svelte-l6krs5"),v(l,"class",j="schedule-row "+(!e[15][e[54].id]||!Object.values(e[15][e[54].id]).some(Bt)?"error-highlight":"")+" svelte-l6krs5"),this.first=l},m(N,U){I(N,l,U),m(l,o),m(o,i),m(i,n),m(n,r),m(i,c),m(i,f),m(i,u),m(i,g),m(i,p),k&&k.m(i,null),m(o,_),m(o,w),m(w,R),m(w,S),m(w,B),m(l,G);for(let A=0;A<10;A+=1)q[A]&&q[A].m(l,null);m(l,L),C||(M=[W(R,"click",F),W(B,"click",oe)],C=!0)},p(N,U){if(e=N,U[0]&16384&&s!==(s=e[54].medication.name+"")&&$(r,s),U[0]&16384&&a!==(a=e[54].administrationType+"")&&$(f,a),U[0]&16384&&h!==(h=e[54].dosage+"")&&$(g,h),e[54].hasDiluent==="да"&&e[54].diluents&&e[54].diluents.length>0?k?k.p(e,U):(k=bt(e),k.c(),k.m(i,null)):k&&(k.d(1),k=null),U[0]&49152|U[1]&1){se=[1,2,3,4,5,6,7,8,9,10];let A;for(A=0;A<10;A+=1){const J=mt(e,se,A);q[A]?q[A].p(J,U):(q[A]=kt(J),q[A].c(),q[A].m(l,L))}for(;A<10;A+=1)q[A].d(1)}U[0]&49152&&j!==(j="schedule-row "+(!e[15][e[54].id]||!Object.values(e[15][e[54].id]).some(Bt)?"error-highlight":"")+" svelte-l6krs5")&&v(l,"class",j)},d(N){N&&T(l),k&&k.d(),ye(q,N),C=!1,le(M)}}}function al(t){let e;return{c(){e=D("Опубликовать схему")},m(l,o){I(l,e,o)},d(l){l&&T(e)}}}function fl(t){let e,l;return{c(){e=b("span"),l=D(" Сохранение..."),v(e,"class","spinner svelte-l6krs5")},m(o,i){I(o,e,i),I(o,l,i)},d(o){o&&T(e),o&&T(l)}}}function pt(t){let e,l,o;return{c(){e=b("div"),l=D("⚠️ "),o=D(t[20]),v(e,"class","validation-error svelte-l6krs5")},m(i,n){I(i,e,n),m(e,l),m(e,o)},p(i,n){n[0]&1048576&&$(o,i[20])},d(i){i&&T(e)}}}function dl(t){let e,l,o,i,n,s,r=!t[17]&&gt(t),c=t[17]&&_t(t),a=t[20]&&pt(t);return{c(){e=b("div"),l=b("div"),r&&r.c(),o=O(),c&&c.c(),i=O(),a&&a.c(),n=we(),v(l,"class","medication-form-column svelte-l6krs5"),v(e,"class","modal-grid svelte-l6krs5")},m(f,u){I(f,e,u),m(e,l),r&&r.m(l,null),m(e,o),c&&c.m(e,null),I(f,i,u),a&&a.m(f,u),I(f,n,u),s=!0},p(f,u){f[17]?r&&(Me(),Z(r,1,1,()=>{r=null}),Oe()):r?(r.p(f,u),u[0]&131072&&V(r,1)):(r=gt(f),r.c(),V(r,1),r.m(l,null)),f[17]?c?c.p(f,u):(c=_t(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null),f[20]?a?a.p(f,u):(a=pt(f),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(f){s||(V(r),s=!0)},o(f){Z(r),s=!1},d(f){f&&T(e),r&&r.d(),c&&c.d(),f&&T(i),a&&a.d(f),f&&T(n)}}}function ml(t){let e,l,o,i,n,s,r,c,a,f;return n=new rt({props:{isOpen:t[16],onClose:t[26],maxWidth:t[0],backgroundColor:t[1],borderRadius:t[2],overlayColor:t[3],$$slots:{default:[dl]},$$scope:{ctx:t}}}),r=new ll({props:{isOpen:t[18],onClose:t[36],medications:t[25],medicationForm:t[21],isEditing:!!t[22],onSave:t[30],overlayColor:"rgba(0,0,0,0)"}}),{c(){e=b("div"),l=b("button"),o=D("📋 Схема лечения"),i=O(),ke(n.$$.fragment),s=O(),ke(r.$$.fragment),v(l,"class","treatment-scheme-button svelte-l6krs5"),y(l,"--bg-color",t[11]),y(l,"--text-color",t[12]),y(l,"--border-radius",t[13]),v(e,"class","treatment-scheme-container")},m(u,h){I(u,e,h),m(e,l),m(l,o),m(e,i),me(n,e,null),m(e,s),me(r,e,null),c=!0,a||(f=W(l,"click",t[26]),a=!0)},p(u,h){(!c||h[0]&2048)&&y(l,"--bg-color",u[11]),(!c||h[0]&4096)&&y(l,"--text-color",u[12]),(!c||h[0]&8192)&&y(l,"--border-radius",u[13]);const g={};h[0]&65536&&(g.isOpen=u[16]),h[0]&1&&(g.maxWidth=u[0]),h[0]&2&&(g.backgroundColor=u[1]),h[0]&4&&(g.borderRadius=u[2]),h[0]&8&&(g.overlayColor=u[3]),h[0]&26920944|h[2]&8&&(g.$$scope={dirty:h,ctx:u}),n.$set(g);const p={};h[0]&262144&&(p.isOpen=u[18]),h[0]&2097152&&(p.medicationForm=u[21]),h[0]&4194304&&(p.isEditing=!!u[22]),r.$set(p)},i(u){c||(V(n.$$.fragment,u),V(r.$$.fragment,u),c=!0)},o(u){Z(n.$$.fragment,u),Z(r.$$.fragment,u),c=!1},d(u){u&&T(e),he(n),he(r),a=!1,f()}}}const Bt=t=>t.size>0;function hl(t,e,l){let o,{serviceId:i=null}=e,{medicalCardId:n=null}=e,{modalMaxWidth:s="1100px"}=e,{modalBgColor:r="white"}=e,{modalBorderRadius:c="8px"}=e,{modalOverlayColor:a="rgba(0,0,0,0.5)"}=e,{schemesBgColor:f="#f8f9fa"}=e,{schemesTitleColor:u="#333"}=e,{schemesBorderColor:h="#e9ecef"}=e,{schemeItemBgColor:g="#f8f9fa"}=e,{schemeItemHoverColor:p="#e9ecef"}=e,{schemeItemBorderColor:_="#e9ecef"}=e,{schemeTitleColor:w="#333"}=e,{schemeDetailsColor:R="#6c757d"}=e,{useButtonBgColor:S="#007bff"}=e,{useButtonTextColor:B="#fff"}=e,{editButtonBgColor:G="#6c757d"}=e,{editButtonTextColor:L="#fff"}=e,{createButtonBgColor:j="#28a745"}=e,{createButtonTextColor:C="#fff"}=e,{createButtonHoverColor:M="#218838"}=e,{createButtonBorderRadius:k="4px"}=e,{mainButtonBgColor:F="#007bff"}=e,{mainButtonTextColor:oe="white"}=e,{mainButtonBorderRadius:se="4px"}=e,q=!1,N=!1,U=!1,A=!1,J="",ce=[{id:1,name:"Цефтриаксон",type:"в/м"},{id:2,name:"Метронидазол",type:"в/в"},{id:3,name:"Ибупрофен",type:"в/м"}],ae={medication:ce[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]},ne=null,re=null,K=[],H={},Be=[];function ue(){l(16,q=!q),q||Q()}function Q(){l(21,ae=X()),l(14,K=[]),l(15,H={}),l(17,N=!1),re=null,l(20,J="")}function X(){return{medication:ce[0],administrationType:"в/м",dosage:"",hasDiluent:"нет",diluents:[]}}function x(){l(21,ae=X()),l(22,ne=null),l(18,U=!0)}function P(d){l(21,ae={medication:ce.find(E=>E.name===d.medication.name)||ce[0],administrationType:d.administrationType,dosage:d.dosage,hasDiluent:d.diluents&&d.diluents.length>0?"да":"нет",diluents:d.diluents?d.diluents.map(E=>({...E})):[]}),l(22,ne=d.id),l(18,U=!0)}function Y(d){l(14,K=K.filter(E=>E.id!==d)),H[d]&&(delete H[d],l(15,H={...H})),l(20,J="")}function He(d){if(ne)l(14,K=K.map(E=>E.id===ne?{...d,id:E.id}:E)),l(22,ne=null);else{const E={...d,id:Date.now()};l(14,K=[...K,E])}l(18,U=!1)}function St(d,E,ie){H[d]||l(15,H[d]={},H),H[d][E]||l(15,H[d][E]=new Set,H),H[d][E].has(ie)?H[d][E].delete(ie):H[d][E].add(ie),l(15,H={...H}),l(20,J="")}function It(d){l(14,K=d.medications.map(E=>({id:E.id||Date.now()+Math.random(),medication:{name:E.name},administrationType:E.administrationType,dosage:E.dosage,hasDiluent:E.diluents&&E.diluents.length>0?"да":"нет",diluents:E.diluents?E.diluents.map(ee=>({...ee})):[]}))),l(15,H={}),d.schedule&&Object.entries(d.schedule).forEach(([E,ie])=>{l(15,H[E]={},H),Object.entries(ie).forEach(([ee,Ee])=>{l(15,H[E][ee]=new Set(Ee),H)})}),l(17,N=!0),l(20,J="")}function pl(){l(17,N=!0),l(14,K=[]),l(15,H={}),l(20,J="")}function Bl(d){It(d),re=d}function yl(){const d=K.filter(E=>!H[E.id]||!Object.values(H[E.id]).some(ie=>ie.size>0));if(d.length>0){const E=d.map(ie=>ie.medication.name).join(", ");l(20,J=`Не выбрано ни одного дня для препаратов: ${E}`);return}try{l(19,A=!0);const E={};Object.entries(H).forEach(([ee,Ee])=>{E[ee]={},Object.entries(Ee).forEach(([El,xl])=>{E[ee][El]=Array.from(xl)})});const ie={id:Date.now(),name:re?`${re.name} (редакция от ${new Date().toLocaleDateString()})`:`Схема лечения от ${new Date().toLocaleDateString()}`,medications:K.map(ee=>({id:ee.id,name:ee.medication.name,dosage:ee.dosage,administrationType:ee.administrationType,diluents:ee.diluents?ee.diluents.map(Ee=>({...Ee})):[]})),createdFor:{serviceId:i,medicalCardId:n},createdAt:new Date().toISOString(),isRevision:!!re,originalSchemeId:re?re.id:null,schedule:E};setTimeout(()=>{l(23,Be=[...Be,ie]),l(19,A=!1),ue()},1e3)}catch(E){console.error("Ошибка публикации схемы:",E),l(19,A=!1)}}function wl(){l(18,U=!1),l(22,ne=null)}const Tl=d=>P(d),Sl=d=>Y(d.id),Il=(d,E)=>St(d.id,1,E);return t.$$set=d=>{"serviceId"in d&&l(37,i=d.serviceId),"medicalCardId"in d&&l(38,n=d.medicalCardId),"modalMaxWidth"in d&&l(0,s=d.modalMaxWidth),"modalBgColor"in d&&l(1,r=d.modalBgColor),"modalBorderRadius"in d&&l(2,c=d.modalBorderRadius),"modalOverlayColor"in d&&l(3,a=d.modalOverlayColor),"schemesBgColor"in d&&l(4,f=d.schemesBgColor),"schemesTitleColor"in d&&l(5,u=d.schemesTitleColor),"schemesBorderColor"in d&&l(6,h=d.schemesBorderColor),"schemeItemBgColor"in d&&l(39,g=d.schemeItemBgColor),"schemeItemHoverColor"in d&&l(40,p=d.schemeItemHoverColor),"schemeItemBorderColor"in d&&l(41,_=d.schemeItemBorderColor),"schemeTitleColor"in d&&l(42,w=d.schemeTitleColor),"schemeDetailsColor"in d&&l(43,R=d.schemeDetailsColor),"useButtonBgColor"in d&&l(44,S=d.useButtonBgColor),"useButtonTextColor"in d&&l(45,B=d.useButtonTextColor),"editButtonBgColor"in d&&l(46,G=d.editButtonBgColor),"editButtonTextColor"in d&&l(47,L=d.editButtonTextColor),"createButtonBgColor"in d&&l(7,j=d.createButtonBgColor),"createButtonTextColor"in d&&l(8,C=d.createButtonTextColor),"createButtonHoverColor"in d&&l(9,M=d.createButtonHoverColor),"createButtonBorderRadius"in d&&l(10,k=d.createButtonBorderRadius),"mainButtonBgColor"in d&&l(11,F=d.mainButtonBgColor),"mainButtonTextColor"in d&&l(12,oe=d.mainButtonTextColor),"mainButtonBorderRadius"in d&&l(13,se=d.mainButtonBorderRadius)},t.$$.update=()=>{t.$$.dirty[0]&49152&&l(24,o=K.length>0&&K.every(d=>H[d.id]&&Object.values(H[d.id]).some(E=>E.size>0)))},[s,r,c,a,f,u,h,j,C,M,k,F,oe,se,K,H,q,N,U,A,J,ae,ne,Be,o,ce,ue,x,P,Y,He,St,It,pl,Bl,yl,wl,i,n,g,p,_,w,R,S,B,G,L,Tl,Sl,Il]}class gl extends pe{constructor(e){super(),Ce(this,e,hl,ml,ge,{serviceId:37,medicalCardId:38,modalMaxWidth:0,modalBgColor:1,modalBorderRadius:2,modalOverlayColor:3,schemesBgColor:4,schemesTitleColor:5,schemesBorderColor:6,schemeItemBgColor:39,schemeItemHoverColor:40,schemeItemBorderColor:41,schemeTitleColor:42,schemeDetailsColor:43,useButtonBgColor:44,useButtonTextColor:45,editButtonBgColor:46,editButtonTextColor:47,createButtonBgColor:7,createButtonTextColor:8,createButtonHoverColor:9,createButtonBorderRadius:10,mainButtonBgColor:11,mainButtonTextColor:12,mainButtonBorderRadius:13},null,[-1,-1,-1])}}const _l="#show_info_table_title",Ae="treatment-scheme-container",z={mounted:!1,intervalId:null,currentPath:null,currentRecordId:null,currentPatientId:null,debug:!0,instanceId:Math.random().toString(36).substring(2,9),styleConfigs:{clinic1:{mainButtonBgColor:"#4CAF50",mainButtonTextColor:"white",schemesBgColor:"#f0f8ff",schemesTitleColor:"#2c3e50",useButtonBgColor:"#3498db",editButtonBgColor:"#9b59b6",createButtonBgColor:"#4CAF50"}},log(t,e,...l){if(!this.debug)return;const i={info:"ℹ️",warn:"⚠️",error:"❌",success:"✅",start:"🚀",action:"🔄",timer:"⏱️",mount:"📌",unmount:"🗑️",route:"🧭",check:"🔍"}[t]||"📝";console.log(`${i} [RecordBtn-${this.instanceId}] ${e}`,...l)}};function yt(t){const e=new URL(t,window.location.origin),l=e.pathname,o=l.match(/\/medical_records\/(\d+)\/(\d+)/);return{isRecordPage:!!o,patientId:o?o[1]:null,recordId:o?o[2]:null,fullPath:l+e.search,params:e.searchParams}}function Ie(){z.log("action","Запущена процедура очистки"),z.intervalId!==null&&(clearInterval(z.intervalId),z.log("unmount","Интервал остановлен:",z.intervalId),z.intervalId=null);const t=document.getElementById(Ae);t&&(t.remove(),z.log("unmount","Компонент TreatmentSchemeButton удален из DOM")),z.mounted=!1}function De(t=!1){const e=yt(window.location.href);z.log("check","Проверка страницы:",e),e.recordId!==z.currentRecordId&&(z.log("route",`Изменился ID записи: ${z.currentRecordId||"none"} -> ${e.recordId||"none"}`),z.currentRecordId=e.recordId,z.currentPatientId=e.patientId,z.mounted&&(z.log("action","Удаляем компоненты из-за смены записи"),Ie()));const o=document.querySelector(_l),i=document.getElementById(Ae);if(z.log("check",`Состояние: запись=${e.isRecordPage}, целевой_элемент=${!!o}, mounted=${z.mounted}`),!i&&z.mounted&&(z.log("warn","Компонент исчез из DOM, но состояние не обновлено"),z.mounted=!1),e.isRecordPage&&o){if(!i){z.log("mount","Монтируем компонент TreatmentSchemeButton");const n=document.createElement("div");n.id=Ae,o.appendChild(n);try{new gl({target:n,props:{serviceId:e.recordId,medicalCardId:e.patientId,...z.styleConfigs.clinic1}}),z.log("success","Компонент TreatmentSchemeButton успешно смонтирован"),z.mounted=!0}catch(s){z.log("error","Ошибка при монтировании TreatmentSchemeButton:",s),n.remove()}}}else!e.isRecordPage&&(i||z.mounted)&&(z.log("action","Не страница записи - удаляем компонент"),Ie())}function bl(){z.log("start","Инициализация компонентов"),Ie(),window._recordButtonListenersInitialized||(vl(),window._recordButtonListenersInitialized=!0);const t=yt(window.location.href);return z.currentPath=t.fullPath,z.currentRecordId=t.recordId,z.currentPatientId=t.patientId,De(!0),z.intervalId=setInterval(()=>{z.log("timer","Регулярная проверка по интервалу"),De()},1e3),z.log("success","Интервал установлен, ID:",z.intervalId),Ie}function vl(){["pushState","replaceState"].forEach(t=>{const e=history[t];history[t]=function(){e.apply(this,arguments),z.log("route",`Обнаружен ${t}`),wt()}}),window.addEventListener("popstate",()=>{z.log("route","Обнаружен popstate"),wt()})}function wt(){[10,50,100,250,500,1e3,1500].forEach((e,l)=>{setTimeout(()=>{z.log("timer",`Запланированная проверка #${l+1} (${e}ms)`),De(!0)},e)})}window.addEventListener("beforeunload",Ie),z.log("info","Модуль загружен"),De(!0);const kl=[{match:/\/medical_records\/\d+\/\d+$/,render:bl}];let Tt=null;function Cl(){console.log("📡 Router запущен"),Et(()=>{const t=window.location.pathname,e=kl.find(l=>l.match.test(t));console.log("📌 Найден роут:",e?.match),e!==Tt&&(Tt=e,e?.render())})}console.log("✅ Content script работает"),Cl()})();
